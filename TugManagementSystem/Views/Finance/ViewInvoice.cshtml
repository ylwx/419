@{
    Layout = null;
    ViewBag.EMPTY = "";
}


<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>ViewInvoice</title>
    <!-- bootstrap-table -->
    <link rel="stylesheet" type="text/css" href="~/Resources/Frame/js/bootstrap-table/bootstrap-table.css" />

    <!-- BOOTSTRAP -->
    <script type="text/javascript" src="~/Resources/Frame/js/bootstrap-table/bootstrap-table.js"></script>

    @{
        if (ViewBag.Language == "zh-CN")
        {
            <script type="text/javascript" src="~/Resources/JqGrid/js/i18n/grid.locale-cn.js"></script>
            <script type="text/javascript" src="~/Resources/Frame/js/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>
        }
        else if (ViewBag.Language == "en-US")
        {
            <script type="text/javascript" src="~/Resources/JqGrid/js/i18n/grid.locale-en.js"></script>
            <script type="text/javascript" src="~/Resources/Frame/js/locale/bootstrap-table/bootstrap-table-en-US.js"></script>
        }
        else
        {
            <script type="text/javascript" src="~/Resources/JqGrid/js/i18n/grid.locale-tw.js"></script>
            <script type="text/javascript" src="~/Resources/Frame/js/bootstrap-table/locale/bootstrap-table-zh-TW.js"></script>
        }
    }
</head>

<body>
    <div>
        <div class="row">
            <div class="col-md-6 ">
                <div class="box border blue">

                    <div class="box-title small">
                        <h4><i class="fa fa-credit-card"></i> @Resources.Language.GenerateInvoice </h4>
                    </div>

                    <div class="box-body">

                        <div class="row">
                            <div class="col-md-12">
                                <div class="panel panel-default">
                                    <div class="panel-body">
                                        <div class="tabbable">
                                            <ul class="nav nav-tabs">
                                                <li class="active"><a href="#tab_1_1" data-toggle="tab"><i class="fa fa-home"></i> 账单</a></li>
                                                <li><a href="#tab_1_2" data-toggle="tab"><i class="fa fa-envelope"></i> 回扣单</a></li>

                                            </ul>
                                            <div class="tab-content">
                                                <div class="tab-pane fade in active" id="tab_1_1">

                                                    <div id="div_services" class="col-md-12">
                                                        <div class="col-md-2">
                                                            <p>服务项目:<br>SERVICE:</p>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <p>服务项目:<br>SERVICE:</p>
                                                            <p>服务项目:<br>SERVICE:</p>
                                                            <p>服务项目:<br>SERVICE:</p>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <p>服务项目:<br>SERVICE:</p>
                                                        </div>
                                                    </div>

                                                    <div style="margin: 8px; padding: 0px; width: 940px; height: 1px; background-color: black; overflow: hidden;"></div>

                                                    <div id="div_detail">
                                                        <table id="tb_detail" class="table table-bordered">
                                                            <thead>
                                                                <tr>
                                                                    <th width="" rowspan="2" data-halign="center" data-align="center" data-valign="bottom" style="text-align:center;vertical-align:middle">拖轮</th>
                                                                    <th width="" colspan="2" data-halign="center" data-align="center" data-valign="middle">泊码头</th>
                                                                    <th width="" colspan="3" data-halign="center" data-align="center" data-valign="middle">离码头</th>
                                                                    <th width="" colspan="1" data-halign="center" data-align="center" data-valign="middle">护航</th>
                                                                </tr>
                                                                <tr>
                                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">海发</th>
                                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">海泰</th>
                                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">海友</th>
                                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td><input type="checkbox" class=""> 离厂时间</td>
                                                                    <td>08:00</td>
                                                                    <td>12:20</td>
                                                                    <td>1</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <input type="checkbox" class=""> 回厂时间
                                                                    </td>
                                                                    <td>Item 2</td>
                                                                    <td>￥3.00</td>
                                                                    <td>2</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <input type="checkbox" class=""> 工作时间
                                                                    </td>
                                                                    <td>Item 2</td>
                                                                    <td>￥3.00</td>
                                                                    <td>2</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <input type="checkbox" class=""> 协议收费
                                                                    </td>
                                                                    <td>Item 2</td>
                                                                    <td>￥3.00</td>
                                                                    <td>2</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <input type="checkbox" class=""> 合计港币
                                                                    </td>
                                                                    <td>Item 2</td>
                                                                    <td>￥3.00</td>
                                                                    <td>2</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        工作耗时
                                                                    </td>
                                                                    <td>Item 2</td>
                                                                    <td>￥3.00</td>
                                                                    <td>2</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <input type="checkbox" class=""> 燃油附加费
                                                                    </td>
                                                                    <td>Item 2</td>
                                                                    <td>￥3.00</td>
                                                                    <td>2</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <input type="checkbox" class=""> 拖缆费
                                                                    </td>
                                                                    <td>Item 2</td>
                                                                    <td>￥3.00</td>
                                                                    <td>2</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <input type="checkbox" class=""> 总数港币
                                                                    </td>
                                                                    <td>Item 2</td>
                                                                    <td>￥3.00</td>
                                                                    <td>2</td>
                                                                </tr>
                                                            </tbody>
                                                            <tfoot>
                                                                <tr>
                                                                    @*<td colspan="13" style="text-align:right">共&nbsp; 计&nbsp;港&nbsp;币：12333 <br> Grand Total HKS</td>*@
                                                                    <td colspan="6" style="text-align:right"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>
                                                                    <td style="text-align:center;"><strong>12345.67</strong></td>
                                                                </tr>
                                                            </tfoot>
                                                        </table>
                                                    </div>

                                                </div>
                                                <div class="tab-pane fade" id="tab_1_2">
                                                    <div class="divide-10"></div>
                                                    <p> Everyone turned toward me and gave me the death stare and I knew I had screwed up once again, they all walked in slow motion towards me saying the same familiar chant I had heard earlier, before anyone could reach me I awoke in a frantic sweaty rush in my bed. My legs were no longer on fire and I felt slightly normal again. I noticed that my mom, a preacher, and several other family members were standing around me. </p>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        $().ready(function () {

            reGenerate('@ViewBag.OrderID');
        })
    </script>

    <!--生成报表-->
    <script type="text/javascript">

    function reGenerate(orderId) {

        alert(1);
        $('#tb_detail').empty();

        $.ajax({
            type: "post",
            url: '@Url.Action("GetInvoice", "Finance")',
            data: {
                'orderId': orderId
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {
                //$('#tb_detail').empty();
                $('#div_services').empty();

                var div1 = $('<div class="col-md-2"><p>服务项目:<br>SERVICE:</p></div>');
                var div2 = $('<div class="col-md-2"></div>');
                var div3 = $('<div class="col-md-3"></div>');
                var div4 = $('<div class="col-md-5"></div>')
                for (key in result.invoice.ServiceNature)
                {
                    var value = result.invoice.ServiceNature[key];
                    var p = $('<p>' + value.ServiceName + '</p>')
                    div2.append(p);

                    p = $('<p>' + value.ServiceWorkDate + '</p>');
                    div3.append(p)

                    p = $('<p>' + value.ServiceWorkPlace + '</p>');
                    div4.append(p)

                }

                $('#div_services').append(div1).append(div2).append(div3).append(div4);

                //----生成表格

                //1.表头
                {
                    var thead = $('<thead></thead>');
                    var tr1 = $('<tr></tr>');
                    var tr2 = $('<tr></tr>');
                    var th = $('<th width="20%" rowspan="2" style="text-align:center;vertical-align:middle">拖轮</th>');
                    tr1.append(th);


                    for (key in result.invoice.ServiceNature) {
                        var value = result.invoice.ServiceNature[key];
                        //alert(result.invoice.Schedulers[key].length);
                        var th = $('<th width="" style="text-align:center;vertical-align:middle" colspan=' + result.invoice.Schedulers[key].length + '>' + value.ServiceName + '</th>');
                        tr1.append(th)
                    }
                    thead.append(tr1);

                    var colspan = 0;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {
                            var th = $('<th width="" style="text-align:center;vertical-align:middle">' + value[i].TugCnName + '</th>');


                            var span1 = $('<span hidden>' + value[i].SchedulerID + '</span>');
                            th.append(span1);

                            tr2.append(th);
                            colspan++;
                        }
                    }


                    thead.append(tr2);
                    $('#tb_detail').append(thead);
                }

                //2.表体
                DynamicGenerateTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);

                //3.表尾
                {
                    var tfoot = $('<tfoot></tfoot>')
                    var tr = $('<tr></tr>')

                    if (colspan == 0) {
                        var td = $('<td colspan=' + colspan + ' style="text-align:center;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：&nbsp;&nbsp;&nbsp;&nbsp;' + result.invoice.GrandTotalHKS + '<br> Grand Total HKS</strong></td>');
                        tr.append(td);
                    }
                    else {
                        var td1 = $('<td colspan=' + colspan + ' style="text-align:right;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>');
                        var td2 = $('<td id="GrandTotalHKS" style="text-align:center;vertical-align:middle"><strong>' + result.invoice.GrandTotalHKS + '</strong></td>');

                        tr.append(td1);
                        tr.append(td2);
                    }
                    tfoot.append(tr);

                    $('#tb_detail').append(tfoot);
                }
            },
        });
    }


    function DynamicGenerateTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
    {
        //使用计费方案
        var customerCode = customerBillingScheme.split('%')[0].split('~')[2];
        if (customerCode == "-1") {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                DefaultQuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
                DefaultBanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
                DefaultTiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }
        else {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                QuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
                BanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
                TiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }

    }


    function QuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }



            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);
        }
    }

    function BanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "半包") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].Price + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }



            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(1) == '1') {


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoTopCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="BanbaoMidCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }



            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }


                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {


                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {


                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);

        }
    }

    function TiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "计时") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="每小时收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + value[i].Price + '</td>');

                        //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="正常收费" value="' + value[i].Price + '"></input>');
                        //td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }



            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(2) == '1') {


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanTopCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="TiaoKuanMidCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }



            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }


                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {


                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {


                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }



            $('#tb_detail').append(tbody);

        }

    }

    function DefaultQuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //缺省全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }



            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);
        }
    }

    function DefaultBanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "半包") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].Price + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }



            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(1) == '1') {


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoTopCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID  + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="BanbaoMidCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }



            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }


                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0,3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {


                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {


                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID  + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);

        }
    }

    function DefaultTiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "计时") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="每小时收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + value[i].Price + '</td>');

                        //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="正常收费" value="' + value[i].Price + '"></input>');
                        //td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }



            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(2) == '1') {


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanTopCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="TiaoKuanMidCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }



            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }


                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {


                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {


                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }



            $('#tb_detail').append(tbody);

        }
    }



    function billingSchemeChanged(selectedValue) {

        $('#sel_billing_type').val(selectedValue.split('%')[1].split('~')[2]);

        $('#sel_time_type').val(selectedValue.split('%')[2].split('~')[2]);

        btnClick();
    }

    function inputCheck(obj) {
        //return value.replace(/[^\d.]/g, '');
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //if (obj.value.trim().length == 0) {
        //    obj.value = 0;
        //}
        //obj.value;

    }

    function btnClick() {
        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据
        var customerBillingScheme = $("#sel_billing_scheme").val().toString();

        $('#txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        //alert(billingTypeId + " --- " + billingTypeValue + ' --- ' + billingTypeLabel);

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        //alert(timeTypeId + " --- " + timeTypeValue + ' --- ' + timeTypeLabel);

        var discount = $('#txt_discount').val();

        reGenerate(dr.OrderID, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount);
    }
    </script>


    <!--价格编辑框输入改变-->
    <script>

        function DefaultQuanbao_XieYiShouFei_InputChanged(obj) {
            //return value.replace(/[^\d.]/g, '');
            obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
            obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
            obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
            obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
            obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

            $('input[name="协议收费"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0])
                    $(this).val(obj.value);
            });

            $('td[name="合计港币"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
                    var v = parseFloat(obj.value);
                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }
            });

            $('td[name="折扣后合计港币"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
                    //var v = parseFloat($('#txt_discount').val()) * parseFloat(obj.value);
                    var v = parseFloat(obj.value);
                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }
            });

            $('td[name="总计港币"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
                    var v = parseFloat($('#txt_discount').val()) * parseFloat(obj.value);
                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }
            });

            var grand_total = 0;
            $('td[name="总计港币"]').each(function () {
                {
                    var v = parseFloat($(this).text());
                    grand_total += v;
                }
            });
            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));

        }

        function DefaultBanbao_XieYiShouFei_InputChanged(obj) {
            obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
            obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
            obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
            obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
            obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

            $('input[name="协议收费"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0])
                    $(this).val(obj.value);
            });

            $('td[name="百分比"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                    var itemId = $(this).attr("id").split('_')[2];
                    var itemValue = $(this).attr("id").split('_')[3];

                    var checkbox_id = "ckItem_" + itemId + "_" + itemValue;

                    //前面的复选框是否选中
                    if ($('input[type="checkbox"][name="ckItem"][id="' + checkbox_id + '"]').is(':checked') == true) {
                        if ($(this).attr("id").split('_')[2] == 17 || $(this).attr("id").split('_')[3] == "B10") //25%港外附加费
                        {
                            var v = parseFloat($(obj).val()) * 0.25;
                            $(this).text(v.toFixed(2));
                        }

                        if ($(this).attr("id").split('_')[2] == 18 || $(this).attr("id").split('_')[3] == "B11") //50% 18时至22时附加费
                        {
                            var v = parseFloat($(obj).val()) * 0.5;
                            $(this).text(v.toFixed(2));
                        }


                        if ($(this).attr("id").split('_')[2] == 19 || $(this).attr("id").split('_')[3] == "B12") //100% 22时至08时附加费
                        {
                            var v = parseFloat($(obj).val());
                            $(this).text(v.toFixed(2));
                        }

                        if ($(this).attr("id").split('_')[2] == 20 || $(this).attr("id").split('_')[3] == "B13") //100% 22时至08时附加费
                        {
                            var v = parseFloat($(obj).val());
                            $(this).text(v.toFixed(2));
                        }

                        if ($(this).attr("id").split('_')[2] == 21 || $(this).attr("id").split('_')[3] == "B14") //100% 22时至08时附加费
                        {
                            var v = parseFloat($(obj).val());
                            $(this).text(v.toFixed(2));
                        }
                    }
                }
            });

            $('p[name="百分比"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                    var serviceId = $(this).attr("id").split('_')[0];
                    var schedulerId = $(this).attr("id").split('_')[1];
                    var itemId = $(this).attr("id").split('_')[2];
                    var itemValue = $(this).attr("id").split('_')[3];

                    var checkbox_id = serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue;

                    //前面的复选框是否选中
                    if ($('input[type="checkbox"][name="ckItem3600"][id="' + checkbox_id + '"]').is(':checked') == true) {
                        if ($(this).attr("id").split('_')[2] == 22 || $(this).attr("id").split('_')[3] == "C15") //使用3600BHP以上的拖轮+15%
                        {
                            var v = parseFloat($(obj).val()) * 0.15;
                            $(this).text(v.toFixed(2));
                        }
                    }
                }
            });



            $('td[name="合计港币"]').each(function () {
                var top_total = 0, mid_total = 0, bottom_total = 0;

                var self = this;

                top_total = parseFloat(obj.value);

                if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                    var serviceId = $(obj).attr("id").split('_')[0];
                    var schedulerId = $(obj).attr("id").split('_')[1];

                    //获取界面上勾选中的复选框
                    $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[1];
                        var itemValue = $(this).attr("id").split('_')[2];

                        if (itemValue.charAt(0) == "B") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('td[id="' + id + '"]').each(function () {

                                mid_total += parseFloat($(this).text());
                            });
                        }

                        //alert(itemValue);
                    })

                    //获取界面上勾选中的复选框3600BHP
                    $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[2];
                        var itemValue = $(this).attr("id").split('_')[3];

                        if (itemValue.charAt(0) == "B") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('p[id="' + id + '"]').each(function () {

                                top_total += parseFloat($(this).text());
                            });
                        }
                    })

                    var v = top_total + mid_total;

                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }
            });

            $('td[name="折扣后合计港币"]').each(function () {
                var self = this;
                var discount_price = 0;

                if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
                    var serviceId = $(obj).attr("id").split('_')[0];
                    var schedulerId = $(obj).attr("id").split('_')[1];

                    //var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) * parseFloat($('input[id="txt_discount"]').val());


                    //获取界面上勾选中的折扣
                    $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[1];
                        var itemValue = $(this).attr("id").split('_')[2];

                        if (itemValue.substr(0, 3) == "C82") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('td[id="' + id + '"]').each(function () {

                                discount_price = parseFloat($(this).text());
                            });
                        }
                    })

                    var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) + discount_price;

                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }

            });


            $('td[name="总计港币"]').each(function () {
                var topAndmid_total = 0, _3600bhp = 0, ranyo_and_tuolan = 0, bottom_total = 0;

                var self = this;

                if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                    var serviceId = $(obj).attr("id").split('_')[0];
                    var schedulerId = $(obj).attr("id").split('_')[1];

                    topAndmid_total = parseFloat($('td[name="折扣后合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text());


                    //获取界面上勾选中的复选框3600BHP
                    $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[2];
                        var itemValue = $(this).attr("id").split('_')[3];

                        if (itemValue.charAt(0) == "C") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('p[id="' + id + '"]').each(function () {

                                _3600bhp = parseFloat($(this).text());
                            });
                        }
                    })

                    //获取界面上勾选中的复选框燃油费和拖缆费
                    $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[1];
                        var itemValue = $(this).attr("id").split('_')[2];

                        if (itemValue.charAt(0) == "C") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('td[id="' + id + '"]').each(function () {

                                ranyo_and_tuolan += parseFloat($(this).text());
                            });
                        }

                        //alert(itemValue);
                    })

                    bottom_total = _3600bhp + ranyo_and_tuolan;

                    var v = topAndmid_total + bottom_total;

                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }
            });

            var grand_total = 0;
            $('td[name="总计港币"]').each(function () {
                var v = parseFloat($(this).text());
                grand_total += v;
            });

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));

        }

        function DefaultBanbao_RanYou_InputChanged(obj) {
            obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
            obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
            obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
            obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
            obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

            var itemId = $(obj).attr("id").split('_')[1];
            var itemValue = $(obj).attr("id").split('_')[2];

            var checkbox_id = "ckItem_" + itemId + "_" + itemValue;

            //如果燃油附加费复选框选中
            if ($('input[type="checkbox"][name="ckItem"][id="' + checkbox_id + '"]').is(':checked') == true) {

                $('td[name="燃油附加费"]').each(function () {

                    var serviceId = $(this).attr("id").split('_')[0]
                    var schedulerId = $(this).attr("id").split('_')[1];
                    var id = serviceId + '_' + schedulerId;

                    var time_consume = $('td[name="换算耗时"][id="' + id + '"]').text();

                    var v = parseFloat($(obj).val()) * parseFloat(time_consume);

                    $(this).text(v.toFixed(2));
                });

                var grand_total = 0;
                $('td[name="总计港币"]').each(function () {
                    var topAndmid_total = 0, _3600bhp = 0, ranyo_and_tuolan = 0, bottom_total = 0;

                    var self = this;

                    {
                        var serviceId = $(self).attr("id").split('_')[0];
                        var schedulerId = $(self).attr("id").split('_')[1];

                        topAndmid_total = parseFloat($('td[name="折扣后合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text());
                        //alert(topAndmid_total);

                        //获取界面上勾选中的复选框3600BHP
                        $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                            //alert($(this).is(":checked"));
                            var self2 = this;

                            var itemId = $(self2).attr("id").split('_')[2];
                            var itemValue = $(self2).attr("id").split('_')[3];

                            if (itemValue.charAt(0) == "C") {

                                var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;

                                _3600bhp = parseFloat($('p[id="' + id + '"]').text());

                            }
                        })

                        //获取界面上勾选中的复选框燃油费和拖缆费
                        $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                            //alert($(this).is(":checked"));
                            var itemId = $(this).attr("id").split('_')[1];
                            var itemValue = $(this).attr("id").split('_')[2];

                            if (itemValue.charAt(0) == "C") {

                                var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                                $('td[id="' + id + '"]').each(function () {

                                    ranyo_and_tuolan += parseFloat($(this).text());
                                });
                            }
                        })

                        bottom_total = _3600bhp + ranyo_and_tuolan;

                        var v = topAndmid_total + bottom_total;

                        grand_total += v;

                        $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                    }
                });

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
        }

        function DefaultBanbao_TuoLan_InputChanged(obj) {
            obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
            obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
            obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
            obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
            obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数


            var itemId = $(obj).attr("id").split('_')[1];
            var itemValue = $(obj).attr("id").split('_')[2];

            var checkbox_id = "ckItem_" + itemId + "_" + itemValue;

            //如果拖缆费复选框选中
            if ($('input[type="checkbox"][name="ckItem"][id="' + checkbox_id + '"]').is(':checked') == true) {

                $('td[name="拖缆费"]').each(function () {

                    var serviceId = $(this).attr("id").split('_')[0]
                    var schedulerId = $(this).attr("id").split('_')[1];
                    var id = serviceId + '_' + schedulerId;

                    var rope_num = $('td[name="拖缆数量"][id="' + id + '"]').text();

                    var v = parseFloat($(obj).val()) * parseInt(rope_num);

                    $(this).text(v.toFixed(2));
                });

                var grand_total = 0;
                $('td[name="总计港币"]').each(function () {
                    var topAndmid_total = 0, _3600bhp = 0, ranyo_and_tuolan = 0, bottom_total = 0;

                    var self = this;

                    {
                        var serviceId = $(self).attr("id").split('_')[0];
                        var schedulerId = $(self).attr("id").split('_')[1];

                        topAndmid_total = parseFloat($('td[name="折扣后合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text());
                        //alert(topAndmid_total);

                        //获取界面上勾选中的复选框3600BHP
                        $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                            //alert($(this).is(":checked"));
                            var self2 = this;

                            var itemId = $(self2).attr("id").split('_')[2];
                            var itemValue = $(self2).attr("id").split('_')[3];

                            if (itemValue.charAt(0) == "C") {

                                var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;

                                _3600bhp = parseFloat($('p[id="' + id + '"]').text());

                            }
                        })

                        //获取界面上勾选中的复选框燃油费和拖缆费
                        $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                            //alert($(this).is(":checked"));
                            var itemId = $(this).attr("id").split('_')[1];
                            var itemValue = $(this).attr("id").split('_')[2];

                            if (itemValue.charAt(0) == "C") {

                                var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                                $('td[id="' + id + '"]').each(function () {

                                    ranyo_and_tuolan += parseFloat($(this).text());
                                });
                            }
                        })

                        bottom_total = _3600bhp + ranyo_and_tuolan;

                        var v = topAndmid_total + bottom_total;

                        grand_total += v;

                        $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                    }
                });

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
        }

        function DefaultBanbao_DiscountPrice_InputChanged(obj) {
            obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
            obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
            obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
            obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
            obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数


            var itemId = $(obj).attr("id").split('_')[1];
            var itemValue = $(obj).attr("id").split('_')[2];

            var checkbox_id = "ckItem_" + itemId + "_" + itemValue;

            //如果拖缆费复选框选中
            if ($('input[type="checkbox"][name="ckItem"][id="' + checkbox_id + '"]').is(':checked') == true) {

                $('td[name="折扣"]').each(function () {

                    var serviceId = $(this).attr("id").split('_')[0]
                    var schedulerId = $(this).attr("id").split('_')[1];
                    var id = serviceId + '_' + schedulerId;

                    var v = parseFloat($(obj).val()) * -1;

                    $(this).text(v.toFixed(2));
                });

                $('td[name="折扣后合计港币"]').each(function () {
                    var self = this;
                    var discount_price = 0;

                    {
                        var serviceId = $(self).attr("id").split('_')[0];
                        var schedulerId = $(self).attr("id").split('_')[1];

                        //var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) * parseFloat($('input[id="txt_discount"]').val());

                        //获取界面上勾选中的折扣
                        $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                            //alert($(this).is(":checked"));
                            var itemId = $(this).attr("id").split('_')[1];
                            var itemValue = $(this).attr("id").split('_')[2];

                            if (itemValue.substr(0, 3) == "C82") {

                                var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                                $('td[id="' + id + '"]').each(function () {

                                    discount_price = parseFloat($(this).text());
                                });
                            }
                        })

                        var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) + discount_price;

                        $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                    }

                });


                var grand_total = 0;
                $('td[name="总计港币"]').each(function () {
                    var topAndmid_total = 0, _3600bhp = 0, ranyo_and_tuolan = 0, bottom_total = 0;

                    var self = this;

                    {
                        var serviceId = $(self).attr("id").split('_')[0];
                        var schedulerId = $(self).attr("id").split('_')[1];

                        topAndmid_total = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text());
                        //alert(topAndmid_total);

                        //获取界面上勾选中的复选框3600BHP
                        $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                            //alert($(this).is(":checked"));
                            var self2 = this;

                            var itemId = $(self2).attr("id").split('_')[2];
                            var itemValue = $(self2).attr("id").split('_')[3];

                            if (itemValue.charAt(0) == "C") {

                                var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;

                                _3600bhp = parseFloat($('p[id="' + id + '"]').text());

                            }
                        })

                        //获取界面上勾选中的复选框燃油费和拖缆费
                        $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                            //alert($(this).is(":checked"));
                            var itemId = $(this).attr("id").split('_')[1];
                            var itemValue = $(this).attr("id").split('_')[2];

                            if (itemValue.charAt(0) == "C") {

                                var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                                $('td[id="' + id + '"]').each(function () {

                                    ranyo_and_tuolan += parseFloat($(this).text());
                                });
                            }
                        })

                        bottom_total = _3600bhp + ranyo_and_tuolan;

                        var v = topAndmid_total + bottom_total;

                        grand_total += v;

                        $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                    }
                });

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
        }


        function DefaultTiaoKuan_UnitPrice_InputChanged(obj) {
            obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
            obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
            obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
            obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
            obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

            $('input[name="每小时收费"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0])
                    $(this).val(obj.value);
            });

            $('td[name="正常收费"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                    var serviceId = $(this).attr("id").split('_')[0];
                    var schedulerId = $(this).attr("id").split('_')[1];
                    var itemId = $(this).attr("id").split('_')[2];

                    var td = $('td[name="换算耗时"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(td).text()) * obj.value
                    $(this).text(v.toFixed(2));
                }
            });

            $('td[name="百分比"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                    var itemId = $(this).attr("id").split('_')[2];
                    var itemValue = $(this).attr("id").split('_')[3];

                    var checkbox_id = "ckItem_" + itemId + "_" + itemValue;

                    //前面的复选框是否选中
                    if ($('input[type="checkbox"][name="ckItem"][id="' + checkbox_id + '"]').is(':checked') == true) {
                        if ($(this).attr("id").split('_')[2] == 17 || $(this).attr("id").split('_')[3] == "B10") //25%港外附加费
                        {
                            var v = parseFloat($(obj).val()) * 0.25;
                            $(this).text(v.toFixed(2));
                        }

                        if ($(this).attr("id").split('_')[2] == 18 || $(this).attr("id").split('_')[3] == "B11") //50% 18时至22时附加费
                        {
                            var v = parseFloat($(obj).val()) * 0.5;
                            $(this).text(v.toFixed(2));
                        }


                        if ($(this).attr("id").split('_')[2] == 19 || $(this).attr("id").split('_')[3] == "B12") //100% 22时至08时附加费
                        {
                            var v = parseFloat($(obj).val());
                            $(this).text(v.toFixed(2));
                        }

                        if ($(this).attr("id").split('_')[2] == 20 || $(this).attr("id").split('_')[3] == "B13") //100% 22时至08时附加费
                        {
                            var v = parseFloat($(obj).val());
                            $(this).text(v.toFixed(2));
                        }

                        if ($(this).attr("id").split('_')[2] == 21 || $(this).attr("id").split('_')[3] == "B14") //100% 22时至08时附加费
                        {
                            var v = parseFloat($(obj).val());
                            $(this).text(v.toFixed(2));
                        }
                    }
                }
            });

            $('p[name="百分比"]').each(function () {
                if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                    var serviceId = $(this).attr("id").split('_')[0];
                    var schedulerId = $(this).attr("id").split('_')[1];
                    var itemId = $(this).attr("id").split('_')[2];
                    var itemValue = $(this).attr("id").split('_')[3];

                    var checkbox_id = serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue;

                    //前面的复选框是否选中
                    if ($('input[type="checkbox"][name="ckItem3600"][id="' + checkbox_id + '"]').is(':checked') == true) {
                        if ($(this).attr("id").split('_')[2] == 22 || $(this).attr("id").split('_')[3] == "C15") //使用3600BHP以上的拖轮+15%
                        {
                            var v = parseFloat($(obj).val()) * 0.15;
                            $(this).text(v.toFixed(2));
                        }
                    }
                }
            });



            $('td[name="合计港币"]').each(function () {
                var top_total = 0, mid_total = 0, bottom_total = 0;

                var self = this;

                top_total = parseFloat(obj.value);

                if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                    var serviceId = $(obj).attr("id").split('_')[0];
                    var schedulerId = $(obj).attr("id").split('_')[1];

                    //获取界面上勾选中的复选框
                    $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[1];
                        var itemValue = $(this).attr("id").split('_')[2];

                        if (itemValue.charAt(0) == "B") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('td[id="' + id + '"]').each(function () {

                                mid_total += parseFloat($(this).text());
                            });
                        }

                        //alert(itemValue);
                    })

                    //获取界面上勾选中的复选框3600BHP
                    $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[2];
                        var itemValue = $(this).attr("id").split('_')[3];

                        if (itemValue.charAt(0) == "B") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('p[id="' + id + '"]').each(function () {

                                top_total += parseFloat($(this).text());
                            });
                        }
                    })

                    var v = top_total + mid_total;

                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }
            });

            $('td[name="折扣后合计港币"]').each(function () {
                var self = this;

                if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
                    var serviceId = $(obj).attr("id").split('_')[0];
                    var schedulerId = $(obj).attr("id").split('_')[1];

                    //var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) * parseFloat($('input[id="txt_discount"]').val());

                    //获取界面上勾选中的折扣
                    $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[1];
                        var itemValue = $(this).attr("id").split('_')[2];

                        if (itemValue.substr(0, 3) == "C82") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('td[id="' + id + '"]').each(function () {

                                discount_price = parseFloat($(this).text());
                            });
                        }
                    });

                    var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) + discount_price;

                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }

            });

            $('td[name="总计港币"]').each(function () {
                var topAndmid_total = 0, bottom_total = 0;

                var self = this;

                if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                    var serviceId = $(obj).attr("id").split('_')[0];
                    var schedulerId = $(obj).attr("id").split('_')[1];

                    topAndmid_total = parseFloat($('td[name="折扣后合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text());


                    //获取界面上勾选中的复选框3600BHP
                    $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[2];
                        var itemValue = $(this).attr("id").split('_')[3];

                        if (itemValue.charAt(0) == "C") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('p[id="' + id + '"]').each(function () {

                                bottom_total += parseFloat($(this).text());
                            });
                        }
                    })

                    //获取界面上勾选中的复选框燃油费和拖缆费
                    $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[1];
                        var itemValue = $(this).attr("id").split('_')[2];

                        if (itemValue.charAt(0) == "C") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('td[id="' + id + '"]').each(function () {

                                bottom_total += parseFloat($(this).text());
                            });
                        }

                        //alert(itemValue);
                    })

                    var v = topAndmid_total + bottom_total;

                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }
            });

            var grand_total = 0;
            $('td[name="总计港币"]').each(function () {
                var v = parseFloat($(this).text());
                grand_total += v;
            });

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }


    </script>


    <!--提交表单时，检查表格中的数据是否有空或NAN-->
    <script>
        function CheckQuanBaoTBodyData() {

            var ret = true;
            $('input[name="协议收费"]').each(function () {

                if ($(this).val().trim().length <= 0) {
                    ret = false;
                    return;
                }
            });

            return ret;
        }

        function CheckBanBaoTBodyData() {
            var ret = true;
            $('input[name="协议收费"]').each(function () {

                if ($(this).val().trim().length <= 0) {
                    ret = false;
                    return;
                }
            });

            //每个checkbox的元素的id = "ckItem_" + item的id + "_" + item的CustomValue
            if (true == $('input[type="checkbox"][name="ckItem"][id="ckItem_' + 23 + "_" + "C80" + '"]').is(':checked')) {

                if ($('input[name="txt燃油附加费"]').val().length <= 0) {
                    ret = false;
                }
            }

            if (true == $('input[type="checkbox"][name="ckItem"][id="ckItem_' + 24 + "_" + "C81" + '"]').is(':checked')) {
                if ($('input[name="txt拖缆费"]').val().length <= 0) {
                    ret = false;
                }
            }

            return ret;
        }

        function CheckTiaoKuanTBodyData() {
            var ret = true;
            $('input[name="每小时收费"]').each(function () {

                if ($(this).val().trim().length <= 0) {
                    ret = false;
                    return;
                }
            });

            //每个checkbox的元素的id = "ckItem_" + item的id + "_" + item的CustomValue
            if (true == $('input[type="checkbox"][name="ckItem"][id="ckItem_' + 23 + "_" + "C80" + '"]').is(':checked')) {
                if ($('input[name="txt燃油附加费"]').val().length <= 0) {
                    ret = false;
                }
            }

            if (true == $('input[type="checkbox"][name="ckItem"][id="ckItem_' + 24 + "_" + "C81" + '"]').is(':checked')) {
                if ($('input[name="txt拖缆费"]').val().length <= 0) {
                    ret = false;
                }
            }

            return ret;
        }
    </script>


    <!--提交表单时，获取表格中的数据-->
    <script>
        function GetQuanBaoTBodyData() {
            var array = new Array();

            $('input[name="协议收费"]').each(function () {

                var serviceNatureId = $(this).attr("id").split('_')[0]; //服务id
                var schedulerId = $(this).attr("id").split('_')[1]; //调度id
                var itemId = $(this).attr("id").split('_')[2]; //item id
                var unitPrice = $(this).val();
                var currency = "港币";
                //var typeID = ;


                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            });

            return array;

        }

        function GetBanBaoTBodyData() {
            var array = new Array();

            $('input[name="协议收费"]').each(function () {

                var serviceNatureId = $(this).attr("id").split('_')[0]; //服务id
                var schedulerId = $(this).attr("id").split('_')[1]; //调度id
                var itemId = $(this).attr("id").split('_')[2]; //item id
                var unitPrice = $(this).val();
                var currency = "港币";
                //var typeID = ;

                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            });

            var inputs = $('input[name="协议收费"]');

            //1
            for (var i = 0; i < inputs.length; ++i) {
                var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
                var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

                var checkboxes = $('input[name="ckItem"]');
                for (var j = 0; j < checkboxes.length; ++j) {
                    if (true == $(checkboxes[j]).is(':checked')) {
                        var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                        var itemValue = $(checkboxes[j]).attr("id").split('_')[2];
                        if (itemValue.charAt(0) == "B") {

                            var td = $('td[name="百分比"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                            var unitPrice = parseFloat($(td).text());
                            var currency = "港币";

                            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                            array.push(bi);
                        }
                    }
                }
            }


            //2
            $('input[name="ckItem3600"]').each(function () {
                var serviceNatureId = $(this).attr("id").split('_')[0];
                var schedulerId = $(this).attr("id").split('_')[1];
                var itemId = $(this).attr("id").split('_')[2];
                var itemValue = $(this).attr("id").split('_')[3];

                var p = $('p[name="百分比"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                var unitPrice = parseFloat($(p).text());
                var currency = "港币";

                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            });


            //3 燃油和拖缆费
            for (var i = 0; i < inputs.length; ++i) {
                var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
                var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

                var checkboxes = $('input[name="ckItem"]');
                for (var j = 0; j < checkboxes.length; ++j) {
                    if (true == $(checkboxes[j]).is(':checked')) {
                        var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                        var itemValue = $(checkboxes[j]).attr("id").split('_')[2];

                        if (itemValue.substr(0, 3) == "C80") {

                            var input = $('input[name="txt燃油附加费"][id="txtItem_' + itemId + "_" + itemValue + '"]');
                            //var td = $('td[id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                            var unitPrice = parseFloat($(input).val());
                            var currency = "港币";
                            //alert(unitPrice);

                            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                            array.push(bi);
                        }

                        if (itemValue.substr(0, 3) == "C81") {
                            var input = $('input[name="txt拖缆费"][id="txtItem_' + itemId + "_" + itemValue + '"]');
                            //var td = $('td[id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                            var unitPrice = parseFloat($(input).val());
                            var currency = "港币";
                            //alert(unitPrice);

                            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                            array.push(bi);
                        }
                    }
                }
            }

            //4 折扣
            for (var i = 0; i < inputs.length; ++i) {
                var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
                var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

                var checkboxes = $('input[name="ckItem"]');
                for (var j = 0; j < checkboxes.length; ++j) {
                    if (true == $(checkboxes[j]).is(':checked')) {
                        var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                        var itemValue = $(checkboxes[j]).attr("id").split('_')[2];

                        if (itemValue.substr(0, 3) == "C82") {
                            var td = $('td[name="折扣"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                            var unitPrice = parseFloat($(td).text());
                            var currency = "港币";
                            //alert(unitPrice);

                            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                            array.push(bi);
                        }
                    }
                }
            }

            return array;
        }

        function GetTiaoKuanTBodyData() {
            var array = new Array();

            $('input[name="每小时收费"]').each(function () {

                var serviceNatureId = $(this).attr("id").split('_')[0]; //服务id
                var schedulerId = $(this).attr("id").split('_')[1]; //调度id
                var itemId = $(this).attr("id").split('_')[2]; //item id
                var unitPrice = $(this).val();
                var currency = "港币";
                //var typeID = ;

                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            });

            var inputs = $('input[name="每小时收费"]');

            //1
            for (var i = 0; i < inputs.length; ++i) {
                var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
                var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

                var checkboxes = $('input[name="ckItem"]');
                for (var j = 0; j < checkboxes.length; ++j) {
                    if (true == $(checkboxes[j]).is(':checked')) {
                        var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                        var itemValue = $(checkboxes[j]).attr("id").split('_')[2];
                        if (itemValue.charAt(0) == "B") {

                            var td = $('td[name="百分比"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                            var unitPrice = parseFloat($(td).text());
                            var currency = "港币";

                            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                            array.push(bi);
                        }
                    }
                }
            }


            //2
            $('input[name="ckItem3600"]').each(function () {
                var serviceNatureId = $(this).attr("id").split('_')[0];
                var schedulerId = $(this).attr("id").split('_')[1];
                var itemId = $(this).attr("id").split('_')[2];
                var itemValue = $(this).attr("id").split('_')[3];

                var p = $('p[name="百分比"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                var unitPrice = parseFloat($(p).text());
                var currency = "港币";

                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            });


            //3 燃油和拖缆费
            for (var i = 0; i < inputs.length; ++i) {
                var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
                var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

                var checkboxes = $('input[name="ckItem"]');
                for (var j = 0; j < checkboxes.length; ++j) {
                    if (true == $(checkboxes[j]).is(':checked')) {
                        var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                        var itemValue = $(checkboxes[j]).attr("id").split('_')[2];

                        if (itemValue.substr(0, 3) == "C80") {

                            var input = $('input[name="txt燃油附加费"][id="txtItem_' + itemId + "_" + itemValue + '"]');
                            //var td = $('td[id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                            var unitPrice = parseFloat($(input).val());
                            var currency = "港币";
                            //alert(unitPrice);

                            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                            array.push(bi);
                        }

                        if (itemValue.substr(0, 3) == "C81") {
                            var input = $('input[name="txt拖缆费"][id="txtItem_' + itemId + "_" + itemValue + '"]');
                            //var td = $('td[id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                            var unitPrice = parseFloat($(input).val());
                            var currency = "港币";
                            //alert(unitPrice);

                            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                            array.push(bi);
                        }
                    }
                }
            }


            //4折扣
            for (var i = 0; i < inputs.length; ++i) {
                var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
                var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

                var checkboxes = $('input[name="ckItem"]');
                for (var j = 0; j < checkboxes.length; ++j) {
                    if (true == $(checkboxes[j]).is(':checked')) {
                        var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                        var itemValue = $(checkboxes[j]).attr("id").split('_')[2];

                        if (itemValue.substr(0, 3) == "C82") {

                            var td = $('td[name="折扣"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                            var unitPrice = parseFloat($(td).text());
                            var currency = "港币";
                            //alert(unitPrice);

                            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                            array.push(bi);
                        }
                    }
                }
            }

            return array;
        }
    </script>


    <!--复选框勾选改变-->
    <script>
        function BanbaoTopCheckboxChanged(obj) {

            //alert($(obj).is(':checked'));

            var itemId = $(obj).attr("id").split('_')[1];
            var itemValue = $(obj).attr("id").split('_')[2];

            //25%港外附加费
            if (itemId == 17 || itemValue == "B10") {

                var grand_total = 0;
                var inputs = $('input[name="协议收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {
                        var v = parseFloat($(inputs[i]).val()) * 0.25;

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(sub_total).text()) + v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val()) * 0.25;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        var v = parseFloat($(sub_total).text()) - old_v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="百分比"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
            //50% 18时至22时附加费
            if (itemId == 18 || itemValue == "B11") {
                var grand_total = 0;
                var inputs = $('input[name="协议收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {
                        var v = parseFloat($(inputs[i]).val()) * 0.5;

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        v = parseFloat($(sub_total).text()) + v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val()) * 0.5;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        var v = parseFloat($(sub_total).text()) - old_v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="百分比"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
            //100% 22时至08时附加费
            if (itemId == 19 || itemValue == "B12") {
                var grand_total = 0;
                var inputs = $('input[name="协议收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {
                        var v = parseFloat($(inputs[i]).val());

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        v = parseFloat($(sub_total).text()) + v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        var v = parseFloat($(sub_total).text()) - old_v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="百分比"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
            //100%假日附加费
            if (itemId == 20 || itemValue == "B13") {
                var grand_total = 0;
                var inputs = $('input[name="协议收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {
                        var v = parseFloat($(inputs[i]).val());

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        v = parseFloat($(sub_total).text()) + v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        var v = parseFloat($(sub_total).text()) - old_v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="百分比"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
            //100%台风附加费
            if (itemId == 21 || itemValue == "B14") {
                var grand_total = 0;
                var inputs = $('input[name="协议收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {
                        var v = parseFloat($(inputs[i]).val());

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        v = parseFloat($(sub_total).text()) + v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        var v = parseFloat($(sub_total).text()) - old_v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="百分比"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }


        }

        function BanbaoMidCheckboxChanged(obj) {
            var serviceId = $(obj).attr("id").split('_')[0];
            var schedulerId = $(obj).attr("id").split('_')[1];;
            var itemId = $(obj).attr("id").split('_')[2];
            var itemValue = $(obj).attr("id").split('_')[3];

            //使用3600BHP以上的拖轮+15%
            {
                var grand_total = 0;

                {

                    if ($(obj).is(':checked') == true) {

                        var input = $('input[name="协议收费"][id="' + serviceId + "_" + schedulerId + "_" + serviceId + '"]');
                        var v = $(input).val() * 0.15;

                        var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                        $(p).text(v.toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    }
                    else {
                        var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');

                        var old_v = parseFloat($(p).text());

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        var v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        $(p).text(0);
                    }

                }

                $('td[name="总计港币"]').each(function () {
                    grand_total += parseFloat($(this).text());
                })

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }

        }

        function BanbaoBottomCheckboxChanged(obj) {
            var itemId = $(obj).attr("id").split('_')[1];
            var itemValue = $(obj).attr("id").split('_')[2];

            //燃油附加费
            if (itemId == 23 || itemValue == "C80") {

                var grand_total = 0;
                var inputs = $('input[name="协议收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {

                        var unit_price = $('input[name="txt燃油附加费"]').val();
                        var time_consum = $('td[name="换算耗时"][id="' + serviceId + '_' + schedulerId + '"]').text();
                        var v = parseFloat(unit_price) * parseFloat(time_consum);

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="燃油附加费"][id="' + td_id + '"]').text(v.toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="燃油附加费"][id="' + td_id + '"]').text();

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="燃油附加费"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }

            //拖缆费
            if (itemId == 24 || itemValue == "C81") {

                var grand_total = 0;
                var inputs = $('input[name="协议收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {

                        var unit_price = $('input[name="txt拖缆费"]').val();
                        var rope_num = $('td[name="拖缆数量"][id="' + serviceId + '_' + schedulerId + '"]').text();
                        var v = parseFloat(unit_price) * parseFloat(rope_num);

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="拖缆费"][id="' + td_id + '"]').text(v.toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="拖缆费"][id="' + td_id + '"]').text();

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="拖缆费"][id="' + td_id + '"]').text(0);
                    }

                }
            }


            //折扣
            if (itemId == 43 || itemValue == "C82") {

                var grand_total = 0;
                var inputs = $('input[name="协议收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {

                        var unit_price = $('input[name="txt折扣"]').val();

                        var v = parseFloat(unit_price) * -1;

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="折扣"][id="' + td_id + '"]').text(v.toFixed(2));


                        var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(discount_sub_total_total).text()) + v;
                        $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));


                        v = parseFloat(unit_price) * -1;
                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="折扣"][id="' + td_id + '"]').text();

                        var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(discount_sub_total_total).text()) - old_v;
                        $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));


                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="折扣"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }


        }


        function TiaoKuanTopCheckboxChanged(obj) {
            var itemId = $(obj).attr("id").split('_')[1];
            var itemValue = $(obj).attr("id").split('_')[2];

            //25%港外附加费
            if (itemId == 17 || itemValue == "B10") {

                var grand_total = 0;
                var inputs = $('td[name="正常收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {
                        var v = parseFloat($(inputs[i]).text()) * 0.25;

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(sub_total).text()) + v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text()) * 0.25;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        var v = parseFloat($(sub_total).text()) - old_v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="百分比"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
            //50% 18时至22时附加费
            if (itemId == 18 || itemValue == "B11") {
                var grand_total = 0;
                var inputs = $('td[name="正常收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {
                        var v = parseFloat($(inputs[i]).text()) * 0.5;

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        v = parseFloat($(sub_total).text()) + v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text()) * 0.5;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        var v = parseFloat($(sub_total).text()) - old_v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="百分比"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
            //100% 22时至08时附加费
            if (itemId == 19 || itemValue == "B12") {
                var grand_total = 0;
                var inputs = $('td[name="正常收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {
                        var v = parseFloat($(inputs[i]).text());

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        v = parseFloat($(sub_total).text()) + v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text());
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        var v = parseFloat($(sub_total).text()) - old_v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="百分比"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
            //100%假日附加费
            if (itemId == 20 || itemValue == "B13") {
                var grand_total = 0;
                var inputs = $('td[name="正常收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {
                        var v = parseFloat($(inputs[i]).text());

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        v = parseFloat($(sub_total).text()) + v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text());
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        var v = parseFloat($(sub_total).text()) - old_v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="百分比"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
            //100%台风附加费
            if (itemId == 21 || itemValue == "B14") {
                var grand_total = 0;
                var inputs = $('td[name="正常收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {
                        var v = parseFloat($(inputs[i]).text());

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        v = parseFloat($(sub_total).text()) + v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text());
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                        var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                        var v = parseFloat($(sub_total).text()) - old_v;
                        $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                        $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="百分比"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
        }

        function TiaoKuanMidCheckboxChanged(obj) {
            var serviceId = $(obj).attr("id").split('_')[0];
            var schedulerId = $(obj).attr("id").split('_')[1];;
            var itemId = $(obj).attr("id").split('_')[2];
            var itemValue = $(obj).attr("id").split('_')[3];

            //使用3600BHP以上的拖轮+15%
            {
                var grand_total = 0;

                {

                    if ($(obj).is(':checked') == true) {

                        var td = $('td[name="正常收费"][id="' + serviceId + "_" + schedulerId + "_" + serviceId + '"]');
                        var v = parseFloat($(td).text()) * 0.15;


                        var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                        $(p).text(v.toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    }
                    else {
                        var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');

                        var old_v = parseFloat($(p).text());

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        var v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        $(p).text(0);
                    }

                }

                $('td[name="总计港币"]').each(function () {
                    grand_total += parseFloat($(this).text());
                })

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }
        }

        function TiaoKuanBottomCheckboxChanged(obj) {
            var itemId = $(obj).attr("id").split('_')[1];
            var itemValue = $(obj).attr("id").split('_')[2];

            //燃油附加费
            if (itemId == 23 || itemValue == "C80") {

                var grand_total = 0;
                var inputs = $('input[name="每小时收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {

                        var unit_price = $('input[name="txt燃油附加费"]').val();
                        var time_consum = $('td[name="换算耗时"][id="' + serviceId + '_' + schedulerId + '"]').text();
                        var v = parseFloat(unit_price) * parseFloat(time_consum);

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="燃油附加费"][id="' + td_id + '"]').text(v.toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="燃油附加费"][id="' + td_id + '"]').text();

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="燃油附加费"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }

            //拖缆费
            if (itemId == 24 || itemValue == "C81") {

                var grand_total = 0;
                var inputs = $('input[name="每小时收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {

                        var unit_price = $('input[name="txt拖缆费"]').val();
                        var rope_num = $('td[name="拖缆数量"][id="' + serviceId + '_' + schedulerId + '"]').text();
                        var v = parseFloat(unit_price) * parseFloat(rope_num);

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="拖缆费"][id="' + td_id + '"]').text(v.toFixed(2));

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="拖缆费"][id="' + td_id + '"]').text();

                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="拖缆费"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }

            //折扣
            if (itemId == 43 || itemValue == "C82") {

                var grand_total = 0;
                var inputs = $('input[name="每小时收费"]');

                for (var i = 0; i < inputs.length; ++i) {
                    var serviceId = $(inputs[i]).attr("id").split("_")[0];
                    var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                    if ($(obj).is(':checked') == true) {

                        var unit_price = $('input[name="txt折扣"]').val();

                        var v = parseFloat(unit_price) * -1;

                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[name="折扣"][id="' + td_id + '"]').text(v.toFixed(2));


                        var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(discount_sub_total_total).text()) + v;
                        $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));


                        v = parseFloat(unit_price) * -1;
                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) + v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());
                    }
                    else {
                        var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        var old_v = $('td[name="折扣"][id="' + td_id + '"]').text();

                        var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(discount_sub_total_total).text()) - old_v;
                        $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));


                        var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        v = parseFloat($(total_total).text()) - old_v;
                        $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        grand_total += parseFloat($(total_total).text());

                        $('td[name="折扣"][id="' + td_id + '"]').text(0);
                    }

                }

                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
            }

        }
    </script>


</body>
</html>