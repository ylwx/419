@{
    ViewBag.Title = @Resources.Language.InvoiceManage;
    ViewBag.MenuId = "menu6";
    ViewBag.SubMenuIndex = 0;
    Layout = "~/Views/Shared/_ContentLayout.cshtml";
}

<script src="~/Resources/handsontable-master/dist/handsontable.full.min.js"></script>
<link href="~/Resources/handsontable-master/dist/handsontable.full.css" rel="stylesheet" />
<script src="~/Resources/handsontable-master/demo/js/moment/moment.js"></script>
<script src="~/Resources/handsontable-master/demo/js/pikaday/pikaday.js"></script>
<script src="~/Resources/handsontable-master/demo/js/pikaday/css/pikaday.css"></script>

<div id="main-content">
    <!-- Add MODAL FORM-->
    <div class="modal fade" id="parent-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="model-dlg" class="modal-dialog" style="width:1200px">
            <div class="modal-content modal-table">
                @*<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">拖轮选择</h4>
                    </div>*@
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box border blue">
                                <div class="box-title">
                                    <h4><i class="fa fa-windows"></i>生成账单&nbsp;<span id="add_customer">123</span>-<span id="add_customer_ship">1234</span></h4>
                                    <div class="tools hidden-xs">
                                        <a href="javascript:;" class="" onclick="$('#parent-modal').modal('hide');">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>

                                <div class="box-body big">

                                    <div id="div_search" class="col-lg-12" style="padding-bottom:10px;">

                                        <div class="col-xs-4">
                                            选择计费方案
                                            <select id="sel_billing_scheme" class="form-control" onchange="billingSchemeChanged($(this).val())">
                                                <option value="">1</option>
                                                <option value="">2</option>
                                                <option value="">3</option>
                                            </select>
                                        </div>
                                        <div class="col-xs-2">
                                            账单类型
                                            @*<select id="sel_billing_type" class="form-control" onchange="btnClick()">
                                                    <option value="">1</option>
                                                    <option value="">2</option>
                                                    <option value="">3</option>
                                                </select>*@

                                            <input id="sel_billing_type" type="text" class="form-control" readonly />
                                        </div>
                                        <div class="col-xs-2">
                                            计时方式
                                            <input id="sel_time_type" type="text" class="form-control" readonly />
                                        </div>


                                        <div class="col-xs-2">
                                            船长规则
                                            <input id="add_ship_length_rules" type="text" class="form-control" readonly />
                                        </div>

                                        <div class="col-xs-2">
                                            箱量规则
                                            <input id="add_ship_teus_rules" type="text" class="form-control" readonly />
                                        </div>



                                        <div class="col-xs-3" hidden>
                                            折扣
                                            <input id="txt_discount" type="text" class="form-control" readonly />
                                        </div>

                                        <div class="col-xs-2">
                                            作业号(Job No.)
                                            <input id="add_job_no" type="text" class="form-control" placeholder="请输入作业号" onfocus="$(this).parent().removeClass('has-error')" />
                                        </div>

                                        <div class="col-xs-2">
                                            账单月份
                                            <select id="add_sel_month" class="form-control">
                                                <option value="1月">1月</option>
                                                <option value="2月">2月</option>
                                                <option value="3月">3月</option>
                                                <option value="4月">4月</option>
                                                <option value="5月">5月</option>
                                                <option value="6月">6月</option>
                                                <option value="7月">7月</option>
                                                <option value="8月">8月</option>
                                                <option value="9月">9月</option>
                                                <option value="10月">10月</option>
                                                <option value="11月">11月</option>
                                                <option value="12月">12月</option>
                                            </select>
                                        </div>

                                        <div class="col-xs-4">
                                            客户船长
                                            <input id="add_customer_ship_length" type="text" class="form-control" readonly />

                                            账单是否显示船长规则
                                            <input id="add_ck_customer_ship_length" type="checkbox" />
                                        </div>


                                        <div class="col-xs-4">
                                            客户箱量
                                            <input id="add_customer_ship_teus" type="text" class="form-control" readonly />
                                            账单是否显示箱量规则
                                            <input id="add_ck_customer_ship_teus" type="checkbox" />
                                        </div>

                                        <div class="col-xs-12">
                                            备注
                                            <textarea id="add_remark" rows="3" class="form-control" placeholder="点击输入备注" onfocus="$(this).parent().removeClass('has-error')"></textarea>
                                        </div>

                                    </div>

                                    @*<div style="margin:8px;padding:0px; width:940px;height:1px;background-color:black;overflow:hidden;"></div>*@

                                    <div id="div_services" class="col-md-12">
                                        <div class="col-md-2">
                                            <p>服务项目:<br>SERVICE:</p>
                                        </div>
                                        <div class="col-md-2">
                                            <p>服务项目:<br>SERVICE:</p>
                                            <p>服务项目:<br>SERVICE:</p>
                                            <p>服务项目:<br>SERVICE:</p>
                                        </div>
                                        <div class="col-md-8">
                                            <p>服务项目:<br>SERVICE:</p>
                                        </div>
                                    </div>

                                    @*<div style="margin: 8px; padding: 0px; width: 940px; height: 1px; background-color: black; overflow: hidden;"></div>*@

                                    <div id="div_detail">
                                        <table id="tb_detail" class="table table-bordered table-condensed  table-hover table-responsive">
                                            <thead>
                                                <tr>
                                                    <th width="" rowspan="2" data-halign="center" data-align="center" data-valign="bottom" style="text-align:center;vertical-align:middle">拖轮</th>
                                                    <th width="" colspan="2" data-halign="center" data-align="center" data-valign="middle">泊码头</th>
                                                    <th width="" colspan="3" data-halign="center" data-align="center" data-valign="middle">离码头</th>
                                                    <th width="" colspan="1" data-halign="center" data-align="center" data-valign="middle">护航</th>
                                                </tr>
                                                <tr>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">海发</th>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">海泰</th>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">海友</th>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><input type="checkbox" class=""> 离厂时间</td>
                                                    <td width="">08:00</td>
                                                    <td>12:20</td>
                                                    <td>1</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 回厂时间
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 工作时间
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 协议收费
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 合计港币
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        工作耗时
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 燃油附加费
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 拖缆费
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 总数港币
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    @*<td colspan="13" style="text-align:right">共&nbsp; 计&nbsp;港&nbsp;币：12333 <br> Grand Total HKS</td>*@
                                                    <td colspan="6" style="text-align:right"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>
                                                    <td style="text-align:center;"><strong>12345.67</strong></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>

                                    <div id="parentErrMsg" class="alert alert-block alert-warning fade in" hidden>
                                        @*<a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>*@
                                        <i class="fa fa-exclamation-circle"></i><p style=""></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div id="_CustomerID" hidden>-1</div>
                    <div id="_ShipID" hidden>-1</div>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">@Resources.Language.Close</button>
                    <button id="add_btn_sumbit" type="button" class="btn btn-primary" onclick="submitParentModal()">@Resources.Language.Submit</button>
                    <button hidden id="add_btn_voice_preview" class="btn btn-success" onclick="InvoicePreview()">预览</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Add MODAL FORM-->

    <!-- View MODAL FORM-->
    <div class="modal fade" id="view-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="model-dlg" class="modal-dialog" style="width: 1200px">
            <div class="modal-content modal-table">
                @*<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">拖轮选择</h4>
                    </div>*@
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box border blue">
                                <div class="box-title">
                                    <h4><i class="fa fa-windows"></i>查看账单和回扣单&nbsp;<span id="view_customer">123</span>-<span id="view_customer_ship">1234</span></h4>
                                    <div class="tools hidden-xs">
                                        <a href="javascript:;" class="" onclick="$('#view-modal').modal('hide');">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>

                                <div class="box-body big">

                                    <div class="tabbable header-tabs">
                                        <ul class="nav nav-tabs">
                                            <li id="view_credit_tab"><a href="#box_tab2" data-toggle="tab" onclick="viewCreditTabClick()"><i class="fa fa-dollar"></i> <span class="hidden-inline-mobile">回扣单</span></a></li>
                                            <li id="view_invoice_tab" class="active"><a href="#box_tab1" data-toggle="tab" onclick="viewInvoiceTabClick()"><i class="fa fa-credit-card"></i> <span class="hidden-inline-mobile">账单</span></a></li>
                                        </ul>
                                        <div class="tab-content">
                                            <div class="tab-pane fade in active" id="box_tab1">

                                                <div id="view_div_search" class="col-lg-12" style="padding-bottom:10px">

                                                    <div class="col-xs-4">
                                                        选择计费方案
                                                        <select id="view_sel_billing_scheme" class="form-control" onchange="view_billingSchemeChanged($(this).val())">
                                                            <option value="">1</option>
                                                            <option value="">2</option>
                                                            <option value="">3</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-xs-2">
                                                        账单类型
                                                        <input id="view_sel_billing_type" type="text" class="form-control" readonly />
                                                    </div>
                                                    <div class="col-xs-2">
                                                        计时方式
                                                        <input id="view_sel_time_type" type="text" class="form-control" readonly />
                                                    </div>

                                                    <div class="col-xs-2">
                                                        船长规则
                                                        <input id="view_ship_length_rules" type="text" class="form-control" readonly />
                                                    </div>

                                                    <div class="col-xs-2">
                                                        箱量规则
                                                        <input id="view_ship_teus_rules" type="text" class="form-control" readonly />
                                                    </div>

                                                    <div class="col-xs-3" hidden>
                                                        折扣
                                                        <input id="view_txt_discount" type="text" class="form-control" readonly />
                                                    </div>

                                                    <div class="col-xs-2">
                                                        作业号
                                                        <input id="view_job_no" type="text" class="form-control" readonly />
                                                    </div>

                                                    <div class="col-xs-2">
                                                        账单月份
                                                        <select id="view_sel_month" class="form-control" disabled>
                                                            <option value="1月">1月</option>
                                                            <option value="2月">2月</option>
                                                            <option value="3月">3月</option>
                                                            <option value="4月">4月</option>
                                                            <option value="5月">5月</option>
                                                            <option value="6月">6月</option>
                                                            <option value="7月">7月</option>
                                                            <option value="8月">8月</option>
                                                            <option value="9月">9月</option>
                                                            <option value="10月">10月</option>
                                                            <option value="11月">11月</option>
                                                            <option value="12月">12月</option>
                                                        </select>
                                                    </div>

                                                    <div class="col-xs-4">
                                                        客户船长
                                                        <input id="view_customer_ship_length" type="text" class="form-control" readonly />

                                                        账单是否显示船长规则
                                                        <input id="view_ck_customer_ship_length" type="checkbox" disabled />
                                                    </div>


                                                    <div class="col-xs-4">
                                                        客户箱量
                                                        <input id="view_customer_ship_teus" type="text" class="form-control" readonly />
                                                        账单是否显示箱量规则
                                                        <input id="view_ck_customer_ship_teus" type="checkbox" disabled />
                                                    </div>

                                                    <div class="col-xs-12">
                                                        备注
                                                        <textarea id="view_remark" rows="3" class="form-control" readonly></textarea>
                                                    </div>

                                                </div>

                                                @*<div style="margin:8px;padding:0px; width:940px;height:1px;background-color:black;overflow:hidden;"></div>*@

                                                <div id="view_div_services" class="col-md-12">
                                                    <div class="col-md-2">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                        <p>服务项目:<br>SERVICE:</p>
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                    <div class="col-md-8">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                </div>

                                                @*<div style="margin: 8px; padding: 0px; width: 940px; height: 1px; background-color: black; overflow: hidden;"></div>*@

                                                <div id="view_div_detail">
                                                    <table id="view_tb_detail" class="table table-bordered table-condensed  table-hover table-responsive">
                                                        <thead>
                                                            <tr>
                                                                <th width="" rowspan="2" data-halign="center" data-align="center" data-valign="bottom" style="text-align:center;vertical-align:middle">拖轮</th>
                                                                <th width="" colspan="2" data-halign="center" data-align="center" data-valign="middle">泊码头</th>
                                                                <th width="" colspan="3" data-halign="center" data-align="center" data-valign="middle">离码头</th>
                                                                <th width="" colspan="1" data-halign="center" data-align="center" data-valign="middle">护航</th>
                                                            </tr>
                                                            <tr>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海发</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海泰</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海友</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td><input type="checkbox" class=""> 离厂时间</td>
                                                                <td>08:00</td>
                                                                <td>12:20</td>
                                                                <td>1</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 回厂时间
                                                                </td>
                                                                <td style="width:100px;">Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 工作时间
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 协议收费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 合计港币
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    工作耗时
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 燃油附加费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 拖缆费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 总数港币
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                        </tbody>
                                                        <tfoot>
                                                            <tr>
                                                                @*<td colspan="13" style="text-align:right">共&nbsp; 计&nbsp;港&nbsp;币：12333 <br> Grand Total HKS</td>*@
                                                                <td colspan="6" style="text-align:right"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>
                                                                <td style="text-align:center;"><strong>12345.67</strong></td>
                                                            </tr>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>

                                            <div class="tab-pane fade" id="box_tab2">

                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <!-- View Tab BOX -->
                                                        <div class="box border orange">
                                                            <div class="box-title">
                                                                <h4><i class="fa fa-bars"></i>@Resources.Language.Credit</h4>
                                                            </div>
                                                            <div id="jqGridContainerBox_view_tab" class="box-body">
                                                                @*<table id="jqGrid_view_tab"></table>
                                                                    <div id="jqGridPager_view_tab"></div>*@
                                                            </div>
                                                        </div>
                                                        <!-- / Edit Tab BOX -->
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">

                    <button type="button" class="btn btn-danger" data-dismiss="modal">@Resources.Language.Close</button>
                    <button id="view_btn_voice_preview" class="btn btn-success" onclick="InvoicePreview()">预览</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /View MODAL FORM-->

    <!-- Edit MODAL FORM-->
    <div class="modal fade" id="edit-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="model-dlg" class="modal-dialog" style="width: 1200px">
            <div class="modal-content modal-table">
                @*<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">拖轮选择</h4>
                    </div>*@
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box border blue">
                                <div class="box-title">
                                    <h4><i class="fa fa-windows"></i>编辑账单和回扣单&nbsp;<span id="edit_customer">123</span>-<span id="edit_customer_ship">1234</span></h4>
                                    <div class="tools hidden-xs">
                                        <a href="javascript:;" class="" onclick="$('#edit-modal').modal('hide');">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>

                                <div class="box-body big">

                                    <div class="tabbable header-tabs">
                                        <ul class="nav nav-tabs">
                                            <li id="edit_credit_tab"><a href="#edit_box_tab2" data-toggle="tab" onclick="editCreditTabClick()"><i class="fa fa-dollar"></i> <span class="hidden-inline-mobile">回扣单</span></a></li>
                                            <li id="edit_invoice_tab" class="active"><a href="#edit_box_tab1" data-toggle="tab" onclick="editInvoiceTabClick()"><i class="fa fa-credit-card"></i> <span class="hidden-inline-mobile">账单</span></a></li>
                                        </ul>
                                        <div class="tab-content">
                                            <div class="tab-pane fade in active" id="edit_box_tab1">

                                                <div id="edit_div_search" class="col-lg-12" style="padding-bottom:10px">

                                                    <div class="col-xs-4">
                                                        选择计费方案
                                                        <select id="edit_sel_billing_scheme" class="form-control" onchange="edit_billingSchemeChanged($(this).val())">
                                                            <option value="">1</option>
                                                            <option value="">2</option>
                                                            <option value="">3</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-xs-2">
                                                        账单类型
                                                        <input id="edit_sel_billing_type" type="text" class="form-control" readonly />
                                                    </div>
                                                    <div class="col-xs-2">
                                                        计时方式
                                                        <input id="edit_sel_time_type" type="text" class="form-control" readonly />
                                                    </div>

                                                    <div class="col-xs-2">
                                                        船长规则
                                                        <input id="edit_ship_length_rules" type="text" class="form-control" readonly />
                                                    </div>

                                                    <div class="col-xs-2">
                                                        箱量规则
                                                        <input id="edit_ship_teus_rules" type="text" class="form-control" readonly />
                                                    </div>

                                                    <div class="col-xs-3" hidden>
                                                        折扣
                                                        <textarea id="edit_txt_discount" rows="3" class="form-control" readonly></textarea>
                                                    </div>

                                                    <div class="col-xs-2">
                                                        作业号(Job No.)
                                                        <input id="edit_job_no" type="text" class="form-control" placeholder="请输入作业号" onfocus="$(this).parent().removeClass('has-error')"/>
                                                    </div>

                                                    <div class="col-xs-2">
                                                        账单月份
                                                        <select id="edit_sel_month" class="form-control">
                                                            <option value="1月">1月</option>
                                                            <option value="2月">2月</option>
                                                            <option value="3月">3月</option>
                                                            <option value="4月">4月</option>
                                                            <option value="5月">5月</option>
                                                            <option value="6月">6月</option>
                                                            <option value="7月">7月</option>
                                                            <option value="8月">8月</option>
                                                            <option value="9月">9月</option>
                                                            <option value="10月">10月</option>
                                                            <option value="11月">11月</option>
                                                            <option value="12月">12月</option>
                                                        </select>
                                                    </div>

                                                    <div class="col-xs-4">
                                                        客户船长
                                                        <input id="edit_customer_ship_length" type="text" class="form-control" readonly />

                                                        账单是否显示船长规则
                                                        <input id="edit_ck_customer_ship_length" type="checkbox" />
                                                    </div>


                                                    <div class="col-xs-4">
                                                        客户箱量
                                                        <input id="edit_customer_ship_teus" type="text" class="form-control" readonly />
                                                        账单是否显示箱量规则
                                                        <input id="edit_ck_customer_ship_teus" type="checkbox" />
                                                    </div>

                                                    <div class="col-xs-12">
                                                        备注
                                                        <textarea id="edit_remark" rows="3" class="form-control" placeholder="点击输入备注" onfocus="$(this).parent().removeClass('has-error')" ></textarea>
                                                    </div>


                                                    
                                                    </div>

                                                @*<div style="margin:8px;padding:0px; width:940px;height:1px;background-color:black;overflow:hidden;"></div>*@

                                                <div id="edit_div_services" class="col-md-12">
                                                    <div class="col-md-2">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                        <p>服务项目:<br>SERVICE:</p>
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                    <div class="col-md-8">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                </div>

                                                @*<div style="margin: 8px; padding: 0px; width: 940px; height: 1px; background-color: black; overflow: hidden;"></div>*@

                                                <div id="edit_div_detail">
                                                    <table id="edit_tb_detail" class="table table-bordered table-condensed  table-hover table-responsive">
                                                        <thead>
                                                            <tr>
                                                                <th width="" rowspan="2" data-halign="center" data-align="center" data-valign="bottom" style="text-align:center;vertical-align:middle">拖轮</th>
                                                                <th width="" colspan="2" data-halign="center" data-align="center" data-valign="middle">泊码头</th>
                                                                <th width="" colspan="3" data-halign="center" data-align="center" data-valign="middle">离码头</th>
                                                                <th width="" colspan="1" data-halign="center" data-align="center" data-valign="middle">护航</th>
                                                            </tr>
                                                            <tr>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海发</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海泰</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海友</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td><input type="checkbox" class=""> 离厂时间</td>
                                                                <td>08:00</td>
                                                                <td>12:20</td>
                                                                <td>1</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 回厂时间
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 工作时间
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 协议收费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 合计港币
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    工作耗时
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 燃油附加费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 拖缆费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 总数港币
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                        </tbody>
                                                        <tfoot>
                                                            <tr>
                                                                @*<td colspan="13" style="text-align:right">共&nbsp; 计&nbsp;港&nbsp;币：12333 <br> Grand Total HKS</td>*@
                                                                <td colspan="6" style="text-align:right"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>
                                                                <td style="text-align:center;"><strong>12345.67</strong></td>
                                                            </tr>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>

                                            <div class="tab-pane fade" id="edit_box_tab2">

                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <!-- Edit Tab BOX -->
                                                        <div class="box border orange">
                                                            <div class="box-title">
                                                                <h4><i class="fa fa-bars"></i>@Resources.Language.Credit</h4>
                                                            </div>
                                                            <div id="jqGridContainerBox_edit_tab" class="box-body">
                                                                <table id="jqGrid_edit_tab"></table>
                                                                <div id="jqGridPager_edit_tab"></div>
                                                            </div>
                                                        </div>
                                                        <!-- / Edit Tab BOX -->
                                                    </div>
                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div id="_edit_orderids" hidden></div>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">@Resources.Language.Close</button>
                    <button id="edit_btn_sumbit" type="button" class="btn btn-primary" onclick="submitEditVoiceModal()">@Resources.Language.Submit</button>
                    <button id="edit_btn_voice_preview" class="btn btn-success" onclick="InvoicePreview()">预览</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Edit MODAL FORM-->

    <!-- 提交审核 MODAL FORM-->
    <div class="modal fade" id="table-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="model-dlg" class="modal-dialog" style="width: 560px ;height:600px">
            <div class="modal-content modal-table">
                @*<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">拖轮选择</h4>
                    </div>*@
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <!-- BOX -->
                            <div class="box border orange">
                                <div class="box-title">
                                    <h4><i class="fa fa-bars"></i>创建流程</h4>
                                    <div class="tools hidden-xs">
                                        <a href="javascript:;" class="" onclick="$('#table-modal').modal('hide');">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="box-body" style="height:200px; overflow:auto;">
                                    <div id="flowtable" class="hot handsontable dataTable table-striped center-block">
                                    </div>
                                </div>
                            </div>
                            <!-- /BOX -->
                        </div>
                    </div>
                    <div id="childErrMsg" class="alert alert-block alert-warning fade in" hidden>
                        <i class="fa fa-exclamation-circle"></i><p style=""></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">@Resources.Language.Close</button>
                    <button id="btnflow" type="button" class="btn btn-primary" @*onclick="updateflowinfor()"*@>提交审核</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /提交审核 MODAL FORM-->


    <!-- Credit Add MODAL FORM-->
    <div class="modal fade" id="credit-add-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="child-model-dlg" class="modal-dialog" style="width:500px">
            <div class="modal-content modal-table">
                @*<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">拖轮选择</h4>
                    </div>*@
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box border blue">
                                <div class="box-title">
                                    <h4><i class="fa fa-windows"></i>新增回扣单</h4>
                                    <div class="tools hidden-xs">
                                        <a href="javascript:;" class="" onclick="$('#credit-add-modal').modal('hide');">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="box-body big">
                                    @*<h4 class="form-title">Supported controls</h4>*@
                                    <form class="form-horizontal" role="form">

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">*@Resources.Language.Credit_CreditContent</label>
                                            <div class="col-sm-9">
                                                <textarea id="_CreditContent" rows="3" class="form-control" placeholder="@Resources.Language.Credit_CreditContent" onfocus="$(this).parent().removeClass('has-error')"></textarea>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">*@Resources.Language.Credit_CreditAmount</label>
                                            <div class="col-sm-9">
                                                <input id="_CreditAmount" type="text" class="form-control" placeholder="@Resources.Language.Credit_CreditAmount" onfocus="$(this).parent().removeClass('has-error')" onkeyup="inputCheck(this)" />
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">@Resources.Language.Remark</label>
                                            <div class="col-sm-9">
                                                <textarea id="_Remark" rows="3" class="form-control" placeholder="@Resources.Language.Remark" onfocus="$(this).parent().removeClass('has-error')"></textarea>
                                            </div>
                                        </div>

                                    </form>
                                    <div id="creditErrMsg" class="alert alert-block alert-warning fade in" hidden>
                                        @*<a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>*@
                                        <i class="fa fa-exclamation-circle"></i><p style=""></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">@Resources.Language.Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitAddCreditModal()">@Resources.Language.Submit</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Credit Add MODAL FORM-->


    <div class="container">
        <div class="row">
            <div id="content" class="col-lg-12">
                <!-- PAGE HEADER-->
                <div class="row">
                    <div class="col-sm-12">
                        <div class="">
                            <!-- STYLER -->
                            <!-- /STYLER -->
                            <!-- BREADCRUMBS -->
                            <ul class="breadcrumb">
                                <li>
                                    <i class="fa fa-home"></i>
                                    <a href="#">@Resources.Language.HomePage</a>
                                </li>
                                <li>
                                    <i class="fa fa-usd"></i>
                                    <a href="#">@Resources.Language.Finance</a>
                                </li>
                                <li>
                                    @Resources.Language.InvoiceManage
                                </li>
                            </ul>
                            <!-- /BREADCRUMBS -->
                            @*<div class="clearfix">
                                    <h3 class="content-title pull-left">Grid Test</h3>
                                </div>
                                <div class="description">Table</div>*@
                            @*<div><button class="btn btn-danger" onclick="AddParent()">Add Parent</button></div>*@
                        </div>
                    </div>
                </div>
                <!-- /PAGE HEADER -->
                @*<div class="row">
                        <div class="col-md-12">
                            <div class="box border orange">
                                <div class="box-title">
                                </div>
                                <div class="box-body">
                                    <div>
                                        <ul>
                                            <li>@Model.Code</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>*@


                <!--Order Grid -->
                <div class="row">
                    <div class="col-md-12">
                        <!-- BOX -->
                        <div class="box border orange">
                            <div class="box-title">
                                <h4><i class="fa fa-bars"></i>@Resources.Language.Order</h4>
                            </div>
                            <div id="jqGridContainerBox_Order" class="box-body">
                                <table id="jqGrid_Order"></table>
                                <div id="jqGridPager_Order"></div>
                            </div>
                        </div>
                        <!-- /BOX -->
                    </div>
                </div>
                <!-- /Order Grid -->

                <!--Invoice Grid -->
                <div class="row">
                    <div class="col-md-12">
                        <!-- BOX -->
                        <div class="box border orange">
                            <div class="box-title">
                                <h4><i class="fa fa-bars"></i>@Resources.Language.InvoiceManage</h4>
                            </div>
                            <div id="jqGridContainerBox" class="box-body">
                                <table id="jqGrid"></table>
                                <div id="jqGridPager"></div>
                            </div>
                        </div>
                        <!-- /BOX -->
                    </div>
                </div>
                <!-- /Invoice Grid -->

            

                <div class="footer-tools">
                    <span class="go-top">
                        <i class="fa fa-chevron-up"></i> Top
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>


<!--全局变量-->
<script>
    var g_EditModalIsShown = false; //编辑模态框是否已经显示过
    var g_ViewModalIsShown = false; //查看模态框是否已经显示过
    var g_curRowId = ''; //主界面Grid当前选中的行号
    var g_curSelectedOrderRowIds = ''; //在新生成账单时，主界面订单Grid当前选中的可以生成账单的有效行号(已经校验过),以逗号分割
    var g_curSelectedBillingIds = ''; //主界面账单Grid当前选中的可以进行操作的有效账单ID(已经校验过),以逗号分割

</script>

<!--Main-->
<script>
    $(document).ready(function () {
        OrderGridInit();

        BillingGridInit();
    });
</script>


<!--订单Grid-->
<script>
    function OrderGridInit() {
        $("#jqGrid_Order").jqGrid({
            url: '@Url.Action("GetDataOfGenerateInvoicce", "OrderManage")',
            mtype: "GET",
            datatype: "json",
            colModel: [

                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_IDX', index: "IDX", name: "IDX", width: 80, editable: true, edittype: "text",
                    hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_CustomerID', name: "CustomerID", width: 100, editable: true, edittype: "text",
                    hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_CustomerName', name: "CustomerName", width: 300, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_ShipID', name: "ShipID", width: 100, editable: true, edittype: "text",
                    hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_ShipName', name: "ShipName", width: 200, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_BillingItemTemplate_ShipLength', name: "Length", width: 100,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "lt", "le", "gt", "ge"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.V_BillingItemTemplate_ShipTEUS', name: "TEUS", width: 100,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "lt", "le", "gt", "ge"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_IsGuest', name: "IsGuest", width: 120, editable: true, edittype: "checkbox",
                    //colmenu: false,
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    stype: 'select',

                    searchoptions: {
                        //sopt: ["ge", "le"],
                        value: "全部:全部;是:是;否:否",
                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    //alert(e);
                                    var grid = $('#jqGrid_Order')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }
                },


                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_OrdDate', name: "OrdDate", width: 160, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                timepicker: true
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid_Order')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    },
                },


                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_LinkMan', name: "LinkMan", width: 100, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_LinkPhone', name: "LinkPhone", width: 100, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_LinkEmail', name: "LinkEmail", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },

                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_WorkStateID', name: "WorkStateID", width: 100, editable: true, edittype: "text",
                    hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_WorkStateValue', name: "WorkStateValue", width: 100, editable: true, edittype: "text",
                    hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_WorkStateLabel', name: "WorkStateLabel", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    stype: "select",
                    searchoptions: {
                        dataUrl: '@Url.Action("GetOrderStateOfOrderSchedulingPage", "Base", new { CustomName = "OrderInfor.WorkStateID" })',
                    }
                },

                {
                    align: 'center', label: '@Resources.Language.Remark', name: "Remark", width: 200, editable: true, edittype: "textarea",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_Code', name: "Code", width: 120, editable: false, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.OwnerID', name: "OwnerID", width: 100, editable: true, edittype: "text",
                    hidden: true
                },
                {
                    align: 'center',
                    label: '@Resources.Language.CreateDate', name: "CreateDate", width: 120, editable: false, edittype: "text",
                    hidden: false,
                    //formatter: 'date',
                    //formatoptions: { srcformat: 'yyyy-mm-dd', newformat: 'yyyy-mm-dd' },
                    datefmt: 'yyyy-mm-dd',
                    sorttype: 'date',
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],

                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid_Order')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }
                },
                {
                    align: 'center', label: '@Resources.Language.UserID', name: "UserID", width: 100, editable: true, edittype: "text",
                    hidden: true
                },
                {
                    align: 'center',
                    label: '@Resources.Language.LastUpDate', name: "LastUpDate", width: 120, editable: false, edittype: "text",
                    hidden: false,
                    //formatter: 'date',
                    datefmt: 'yyyy-mm-dd',
                    sorttype: 'date',
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],

                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid_Order')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_HasInvoice', name: "HasInvoice", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_HasInFlow', name: "HasInFlow", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol1', name: "UserDefinedCol1", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol2', name: "UserDefinedCol2", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol3', name: "UserDefinedCol3", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol4', name: "UserDefinedCol4", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol5', name: "UserDefinedCol5", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "lt", "le", "gt", "ge"] }
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol6', name: "UserDefinedCol6", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "lt", "le", "gt", "ge"] }
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol7', name: "UserDefinedCol7", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "lt", "le", "gt", "ge"] }
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol8', name: "UserDefinedCol8", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "lt", "le", "gt", "ge"] }
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol9', name: "UserDefinedCol9", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    datefmt: 'yyyy-mm-dd',
                    sorttype: 'date',
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid_Order')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }
                },

                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol10', name: "UserDefinedCol10", width: 100, editable: true, edittype: "text",
                    hidden: true,
                    datefmt: 'yyyy-mm-dd',
                    sorttype: 'date',
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid_Order')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }
                },
                { align: 'center', label: 'Billing', name: "Billing", width: 100, editable: true, edittype: "text", hidden: true },
                { align: 'center', label: 'Scheduler', name: "Scheduler", width: 100, editable: true, edittype: "text", hidden: true }

            ],

            viewrecords: true,
            height: '100%', //'auto', //350,
            rowNum: 15,
            autowidth: true,
            editurl: null,
            pager: "#jqGridPager_Order",
            //loadonce: true,
            rowList: ['15', '20', '30', '40', '50'],
            rownumbers: true,
            shrinkToFit: false,     //指定各列宽度
            sortable: true,          //列可移动
            //footerrow: true,
            colMenu: true,          //列菜单

            multiselect: true,
            //multiboxonly: true,

            gridComplete: function () {
                var ids = $(this).getDataIDs();
                for (var i = 0; i < ids.length; i++) {
                    var hasInvoice = $(this).getCell(ids[i], 'HasInvoice');
                    var hasInFlow = $(this).getCell(ids[i], 'HasInFlow');

                    if (hasInvoice == null || hasInvoice == "" || hasInvoice == "否") { //没有账单
                        //$("#" + ids[i] + " td").css("background-color", "grey");
                    }
                    else {//有账单

                        if (hasInFlow == null || hasInFlow == "" || hasInFlow == "否") { //有账单，还没进入审批流程
                            $("#" + ids[i] + " td").css("background-color", "#CCFF99");
                        }
                        else { //有账单在审批流程中
                            $("#" + ids[i] + " td").css("background-color", "#FFDDAA");
                        }
                    }

                }
            },

        });


        $('#jqGrid_Order').jqGrid('filterToolbar', {
            searchResult: true,
            searchOperators: true,
            beforeSearch: function () {
                //alert(1);
                //alert($("#gs_Code").val());
                var util = new Util();

                //时间
                var ret = true;

                @*if ($("#gs_WorkTime").val() != null && $("#gs_WorkTime").val() != "")
                ret = ret && util.isTime('@Resources.Language.V_OrderInfor_WorkTime', $("#gs_WorkTime").val());
                if ($("#gs_EstimatedCompletionTime").val() != null && $("#gs_EstimatedCompletionTime").val() != "")
                    ret = ret && util.isTime('@Resources.Language.V_OrderInfor_EstimatedCompletionTime', $("#gs_EstimatedCompletionTime").val());*@

                //日期
                if ($("#gs_OrdDate").val() != null && $("#gs_OrdDate").val() != "")
                ret = ret && util.isDateTime('@Resources.Language.V_OrderInfor_OrdDate', $("#gs_OrdDate").val());
                @*if ($("#gs_WorkDate").val() != null && $("#gs_WorkDate").val() != "")
                ret = ret && util.isDate('@Resources.Language.V_OrderInfor_WorkDate', $("#gs_WorkDate").val());*@
            if ($("#gs_CreateDate").val() != null && $("#gs_CreateDate").val() != "")
                ret = ret && util.isDateTime('@Resources.Language.CreateDate', $("#gs_CreateDate").val());
                if ($("#gs_LastUpDate").val() != null && $("#gs_LastUpDate").val() != "")
                    ret = ret && util.isDateTime('@Resources.Language.LastUpDate', $("#gs_LastUpDate").val());


                @*if ($("#gs_BigTugNum").val() != null && $("#gs_BigTugNum").val() != "")
                ret = ret && util.isValidNaturalNumber('@Resources.Language.V_OrderInfor_BigTugNum', $("#gs_BigTugNum").val());
                if ($("#gs_MiddleTugNum").val() != null && $("#gs_MiddleTugNum").val() != "")
                    ret = ret && util.isValidNaturalNumber('@Resources.Language.V_OrderInfor_MiddleTugNum', $("#gs_MiddleTugNum").val());
                if ($("#gs_SmallTugNum").val() != null && $("#gs_SmallTugNum").val() != "")
                    ret = ret && util.isValidNaturalNumber('@Resources.Language.V_OrderInfor_SmallTugNum', $("#gs_SmallTugNum").val());*@

                //自定义字段
                if ($("#gs_UserDefinedCol5").val() != null && $("#gs_UserDefinedCol5").val() != "")
                ret = ret && util.isValidFloat('@Resources.Language.UserDefinedCol5', $("#gs_UserDefinedCol5").val());
                if ($("#gs_UserDefinedCol6").val() != null && $("#gs_UserDefinedCol6").val() != "")
                    ret = ret && util.isValidinteger('@Resources.Language.UserDefinedCol5', $("#gs_UserDefinedCol6").val());
                if ($("#gs_UserDefinedCol7").val() != null && $("#gs_UserDefinedCol7").val() != "")
                    ret = ret && util.isValidinteger('@Resources.Language.UserDefinedCol5', $("#gs_UserDefinedCol7").val());
                if ($("#gs_UserDefinedCol8").val() != null && $("#gs_UserDefinedCol8").val() != "")
                    ret = ret && util.isValidinteger('@Resources.Language.UserDefinedCol5', $("#gs_UserDefinedCol8").val());
                if ($("#gs_UserDefinedCol9").val() != null && $("#gs_UserDefinedCol9").val() != "")
                    ret = ret && util.isDateTime('@Resources.Language.UserDefinedCol5', $("#gs_UserDefinedCol9").val());
                if ($("#gs_UserDefinedCol10").val() != null && $("#gs_UserDefinedCol10").val() != "")
                    ret = ret && util.isDateTime('@Resources.Language.UserDefinedCol5', $("#gs_UserDefinedCol10").val());

                //alert(ret); //ret为true，说明验证客户端验证通过，需要进行搜索；反之，不进行搜索
                return !ret; //beforeSearch 返回true不触发搜索，false出发搜索
            }
        });


        $("#jqGrid_Order").jqGrid('bindKeys');  //光标可以控制上下移动

        $('#jqGridContainerBox_Order').resize(function () {
            var width = $('#jqGridContainerBox_Order').width();
            $("#jqGrid_Order").setGridWidth(width);
        });


        $('#jqGrid_Order').navGrid('#jqGridPager_Order', { edit: false, add: false, del: false, refresh: false, view: false, search: false })

                .navButtonAdd('#jqGridPager_Order', {
                    caption: "", title: '@Resources.Language.Refresh', buttonicon: "ui-icon-refresh",
                    onClickButton: function () {
                        $('#jqGrid_Order').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    }
                })
                .navButtonAdd('#jqGridPager_Order', {
                    caption: "", title: "'@Resources.Language.ClearSearchFilter'", buttonicon: "ui-icon-circle-minus",
                    onClickButton: function () {
                        var grid = $('#jqGrid_Order')[0];
                        grid.clearToolbar();
                        $('#jqGrid_Order').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    }
                })
                .navButtonAdd('#jqGridPager_Order', {
                    caption: "普通账单", title: "生成普通账单", buttonicon: "ui-icon-plus",
                    onClickButton: function () {
                        
                        //$('#jqGrid_Order').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                        @*$.ajax(
                            {
                                type: "post",
                                url: '@Url.Action("RejectBilling", "Finance")',
                                data: { 'billingId': 1},
                                dataType: 'json',
                                success: function (result) {
                                    alert(result.message);

                                    $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                                },

                            }
                            );*@


                        var selectedIDs = jQuery('#jqGrid_Order').getGridParam("selarrrow");
                        if (selectedIDs.length <= 0) {
                            alert("请至少选择一个订单!");
                            return;
                    }


                        var hasInvoceNotInFlowingResult = ""; //保存选择的已有账单，但不在流程中的记录
                        var inFlowingResult = ""; //保存选择的已有账单，但已处于流程中的账单的记录
                        var noinvoiceResult = ""; //保存选择的没有账单的记录

                        var selectedOrderIDs = "";
                        //var selectedRowNumbers = "";

                        var lastCustomerId = jQuery('#jqGrid_Order').jqGrid('getCell', selectedIDs[0], "CustomerID");
                        var lastShipId = jQuery('#jqGrid_Order').jqGrid('getCell', selectedIDs[0], "ShipID");
                        var thisCustomerId, thisShipId;

                        for (var i = 0; i < selectedIDs.length; ++i) {
                            thisCustomerId = jQuery('#jqGrid_Order').jqGrid('getCell', selectedIDs[i], "CustomerID"); //CustomerID
                            thisShipId = jQuery('#jqGrid_Order').jqGrid('getCell', selectedIDs[i], "ShipID"); //ShipID

                            if (thisCustomerId != lastCustomerId || thisShipId != lastShipId) {
                                alert("所选择的订单必须是相同的客户和相同的客户船!");
                                return;
                            }

                            var orderId = jQuery('#jqGrid_Order').jqGrid('getCell', selectedIDs[i], "IDX"); //OrderID
                            selectedOrderIDs += selectedIDs[i].toString() + ":" + orderId + ",";
                        }
                        if (selectedOrderIDs != "") {
                            selectedOrderIDs = selectedOrderIDs.substr(0, selectedOrderIDs.length - 1);
                        }

                        $.ajax({
                            url: '@Url.Action("CheckOrderInvoiceStatus", "Finance")',
                            type: "POST",
                            data: {
                                'selectedOrderIDs': selectedOrderIDs
                            },//"oper=delete&id=" + gr,
                            dataType: 'json',
                            success: function (result) {

                                for (key in result.dic_has_invoice_in_fow) {

                                    var value = result.dic_has_invoice_in_fow[key];
                                    inFlowingResult += key + ",";
                                }

                                if (inFlowingResult != "") {
                                    inFlowingResult = inFlowingResult.substr(0, inFlowingResult.length - 1);
                                    alert('所选的记录中，第' + inFlowingResult + '行订单已生成过账单且处于审核流程中，不能重复生成账单，请取消这些(张)账单！');
                                    return;
                                }

                                for (key in result.dic_has_invoice_not_in_flow) {
                                    var value = result.dic_has_invoice_not_in_flow[key];
                                    hasInvoceNotInFlowingResult += value + ",";
                                }

                                if (hasInvoceNotInFlowingResult != "") {
                                    hasInvoceNotInFlowingResult = hasInvoceNotInFlowingResult.substr(0, hasInvoceNotInFlowingResult.length - 1);
                                    alert('所选的记录中，第' + inFlowingResult + '行订单已生成过账单，不能重复生成账单，请取消这些(张)账单！');
                                    return;
                                }

                                for (key in result.dic_has_no_invoice) {
                                    var value = result.dic_has_no_invoice[key];
                                    noinvoiceResult += key + ",";
                                }

                                if (noinvoiceResult != "") {
                                    noinvoiceResult = noinvoiceResult.substr(0, noinvoiceResult.length - 1);
                                    //alert('所选的记录中，第' + noinvoiceResult + '行记录没有账单，无需删除，请取消这些(条)记录！');
                                    //return;
                                }

                                g_curSelectedOrderRowIds = noinvoiceResult;
                                AddParent();
                            },
                        });
                    }
                })
    }
</script>


<!--账单Grid-->
<script>
    function BillingGridInit() {
        $("#jqGrid").jqGrid({
            url: '@Url.Action("GetBillingDataForLoadOnce", "Finance")',
            mtype: "GET",
            datatype: "json",
            colModel: [

                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_BillingID', index: "IDX", name: "IDX", width: 80, editable: true, edittype: "text",
                    hidden: true,
                },

                {
                    align: 'center', label: '@Resources.Language.CustomerName', name: "CustomerName", width: 300, editable: true, edittype: "text",
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_ShipName', name: "ShipName", width: 200, editable: true, edittype: "text",
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_JobNo', name: "JobNo", width: 120, editable: true, edittype: "text",
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.V_Billing_BillingCode', name: "BillingCode", width: 120, editable: true, edittype: "text",
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.V_Billing_BillingTemplateName', name: "BillingTemplateName", width: 120, editable: true, edittype: "text",
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.V_BillingTemplate_BillingTemplateTypeID', name: "BillingTypeID", width: 100, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                },
                {
                    align: 'center', label: '@Resources.Language.V_BillingTemplate_BillingTemplateTypeValue', name: "BillingTemplateTypeValue", width: 100, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                },
                {
                    align: 'center', label: '@Resources.Language.V_Billing_BillingTemplateTypeLabel', name: "BillingTemplateTypeLabel", width: 100, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    stype: 'select',
                    searchoptions: {
                        dataUrl: '@Url.Action("GetCustomField", "Base", new { CustomName = "BillingTemplate.BillingTemplateType" })',
                    },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_TimeTypeValue', name: "TimeTypeValue", width: 100, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                },
                {
                    align: 'center', label: '@Resources.Language.V_Billing_TimeTypeLabel', name: "TimeTypeLabel", width: 100, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    stype: 'select',
                    searchoptions: {
                        dataUrl: '@Url.Action("GetCustomField", "Base", new { CustomName = "BillingTemplate.TimeTypeID" })',
                    },
                },
                {
                    align: 'center', label: '@Resources.Language.V_Billing_Amount', name: "Amount", width: 100, editable: true, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "lt", "le", "gt", "ge"] },
                },

                {
                    align: 'center', label: '@Resources.Language.V_Billing_Status', name: "Status", width: 120, editable: false, edittype: "text",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_Billing_Phase', name: "Phase", width: 120, editable: false, edittype: "text",
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.Remark', name: "Remark", width: 200, editable: true, edittype: "textarea",
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
                },

        {
                    align: 'center', label: '@Resources.Language.OwnerID', name: "OwnerID", width: 100, editable: true, edittype: "text",
                    hidden: true
                },
                {
                    align: 'center',
                    label: '@Resources.Language.CreateDate', name: "CreateDate", width: 120, editable: false, edittype: "text",
                    hidden: false,
                    //formatter: 'date',
                    //formatoptions: { srcformat: 'yyyy-mm-dd', newformat: 'yyyy-mm-dd' },
                    datefmt: 'yyyy-mm-dd',
                    sorttype: 'date',
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],

                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid')[0];
                                    grid.triggerToolbar();

            }
                            }
                        ]
                    }
                },
                {
                    align: 'center', label: '@Resources.Language.UserID', name: "UserID", width: 100, editable: true, edittype: "text",
                    hidden: true
                },
                {
                    align: 'center',
                    label: '@Resources.Language.LastUpDate', name: "LastUpDate", width: 120, editable: false, edittype: "text",
                    hidden: false,
                    //formatter: 'date',
                    datefmt: 'yyyy-mm-dd',
                    sorttype: 'date',
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],

                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }
                },

            ],

                viewrecords: true,
                height: '100%', //'auto', //350,
                rowNum: 15,
                autowidth: true,
                editurl: null,
                pager: "#jqGridPager",
                //loadonce: true,
                rowList: ['15', '20', '30', '40', '50'],
                rownumbers: true,
                shrinkToFit: false,     //指定各列宽度
                sortable: true,          //列可移动
                //footerrow: true,
                colMenu: true,          //列菜单

                multiselect: true,
                //multiboxonly: true,

                onSelectRow: function (rowid, status, e) {
                    var grid = $("#jqGrid");
                    var rowKey = grid.getGridParam("selrow");

                    if (!rowKey) {
                    //$('#jqGrid_ilAdd').addClass('ui-state-disabled');
                        $('#jqGrid_ilDelete').addClass('ui-state-disabled');
                        $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
                        $('#jqGrid_ilView').addClass('ui-state-disabled');
                        $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                        $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                    //$('#jqGrid_ilReport').addClass('ui-state-disabled');


                    }
                    else {

                        $('#jqGrid_ilDelete').removeClass('ui-state-disabled');
                        $('#jqGrid_ilSubmit').removeClass('ui-state-disabled');
                        var selectedIDs = grid.getGridParam("selarrrow");

                        if (selectedIDs.length != 1) {
                        //$('#jqGrid_ilAdd').addClass('ui-state-disabled');
                            $('#jqGrid_ilView').addClass('ui-state-disabled');
                            $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                            $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                        //$('#jqGrid_ilReport').addClass('ui-state-disabled');

                        }
                        else {

                        //$('#jqGrid_ilAdd').removeClass('ui-state-disabled');
                            $('#jqGrid_ilView').removeClass('ui-state-disabled');
                            $('#jqGrid_ilAddCredit').removeClass('ui-state-disabled');
                            $('#jqGrid_ilEdit').removeClass('ui-state-disabled');
                        //$('#jqGrid_ilReport').removeClass('ui-state-disabled');

                        }

                    }
                },


                gridComplete: function () {
                    var ids = $(this).getDataIDs();
                    for (var i = 0; i < ids.length; i++) {
                        var phase = $(this).getCell(ids[i], 'Phase');

                    {//有账单
                        if (phase == null || phase == "" || phase == "0") { //有账单，还没进入审批流程
                            //$("#" + ids[i] + " td").css("background-color", "#CCFF99");//CCFF99
                            //$('tr[id="' + ids[i] + '"]').css("background-color", "#FFDDAA");
                            //$(this).find('td').css("background-color", "#CCFF99");
                        }
                            else { //有账单在审批流程中
                            //$("#" + ids[i] + " td").css("background-color", "#FFDDAA");
                            $(this).find('td').css("background-color", "#FFDDAA");
                            }
                        }

                    }
                },

            });


        $('#jqGrid').jqGrid('filterToolbar', {
            searchResult: true,
            searchOperators: true,
                    beforeSearch: function () {
                        var util = new Util();

                //时间
                        var ret = true;

                @*if ($("#gs_WorkTime").val() != null && $("#gs_WorkTime").val() != "")
                            ret = ret && util.isTime('@Resources.Language.V_OrderInfor_WorkTime', $("#gs_WorkTime").val());
                        if ($("#gs_EstimatedCompletionTime").val() != null && $("#gs_EstimatedCompletionTime").val() != "")
                    ret = ret && util.isTime('@Resources.Language.V_OrderInfor_EstimatedCompletionTime', $("#gs_EstimatedCompletionTime").val());*@

                        //日期

                if ($("#gs_CreateDate").val() != null && $("#gs_CreateDate").val() != "")
                    ret = ret && util.isDateTime('@Resources.Language.CreateDate', $("#gs_CreateDate").val());
                if ($("#gs_LastUpDate").val() != null && $("#gs_LastUpDate").val() != "")
                    ret = ret && util.isDateTime('@Resources.Language.LastUpDate', $("#gs_LastUpDate").val());


                @*if ($("#gs_BigTugNum").val() != null && $("#gs_BigTugNum").val() != "")
                ret = ret && util.isValidNaturalNumber('@Resources.Language.V_OrderInfor_BigTugNum', $("#gs_BigTugNum").val());
                if ($("#gs_MiddleTugNum").val() != null && $("#gs_MiddleTugNum").val() != "")
                    ret = ret && util.isValidNaturalNumber('@Resources.Language.V_OrderInfor_MiddleTugNum', $("#gs_MiddleTugNum").val());*@
                if ($("#gs_Amount").val() != null && $("#gs_Amount").val() != "")
                    ret = ret && util.isValidCurrency('@Resources.Language.V_Billing_Amount', $("#gs_Amount").val());

                        //alert(ret); //ret为true，说明验证客户端验证通过，需要进行搜索；反之，不进行搜索
                        return !ret; //beforeSearch 返回true不触发搜索，false出发搜索
                    }
                });


            $("#jqGrid").jqGrid('bindKeys');  //光标可以控制上下移动

            $('#jqGridContainerBox').resize(function () {
                var width = $('#jqGridContainerBox').width();
                $("#jqGrid").setGridWidth(width);
            });

            $('#jqGrid').navGrid('#jqGridPager', { edit: false, add: false, del: false, refresh: false, view: false, search: false })

                .navButtonAdd('#jqGridPager', {
                    //id: 'jqGrid_ilRefresh',
                    caption: "", title: '@Resources.Language.Refresh', buttonicon: "ui-icon-refresh",
                    onClickButton: function () {
                        $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    }
                })
                .navButtonAdd('#jqGridPager', {
                    caption: "", title: "清空搜索", buttonicon: "ui-icon-circle-minus",
                    onClickButton: function () {
                        var grid = $('#jqGrid')[0];
                        grid.clearToolbar();
                        $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    }
                }).navSeparatorAdd("#jqGridPager", { sepclass: "ui-separator", sepcontent: '' })
                .navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilEdit',
                    caption: "", title: "编辑账单和回扣单", buttonicon: "ui-icon-pencil",
                    onClickButton: function () {

                        var selectedIDs = jQuery('#jqGrid').getGridParam("selarrrow");

                            var hasInvoceNotInFlowingResult = ""; //保存选择的已有账单，但不在流程中的记录
                            var inFlowingResult = ""; //保存选择的已有账单，但已处于流程中的账单的记录

                        var selectedBillingIDs = "";

                        for (var i = 0; i < selectedIDs.length; ++i) {
                            var billingId = jQuery('#jqGrid').jqGrid('getCell', selectedIDs[i], "IDX"); //BillingID
                            selectedBillingIDs += selectedIDs[i].toString() + ":" + billingId + ",";
                        }
                        if (selectedBillingIDs != "") {
                            selectedBillingIDs = selectedBillingIDs.substr(0, selectedBillingIDs.length - 1);
                        }

                            $.ajax({
                            url: '@Url.Action("CheckBillingStatus", "Finance")',
                                type: "POST",
                                data: {
                                'selectedBillingIDs': selectedBillingIDs
                                },//"oper=delete&id=" + gr,
                                dataType: 'json',
                                success: function (result) {

                                    for (key in result.dic_has_invoice_in_fow) {

                                        var value = result.dic_has_invoice_in_fow[key];
                                        inFlowingResult += key + ",";
                                    }

                                    if (inFlowingResult != "") {
                                        inFlowingResult = inFlowingResult.substr(0, inFlowingResult.length - 1);
                                    alert('所选的记录中，第' + inFlowingResult + '行账单处于审核流程中，不能编辑，请取消这些(张)账单！');
                                        return;
                                    }

                                for (key in result.dic_has_invoice_not_in_flow) {
                                    var value = result.dic_has_invoice_not_in_flow[key];
                                    hasInvoceNotInFlowingResult += value + ",";
                                }

                                if (hasInvoceNotInFlowingResult != "") {
                                    hasInvoceNotInFlowingResult = hasInvoceNotInFlowingResult.substr(0, hasInvoceNotInFlowingResult.length - 1);
                                }

                                g_curSelectedBillingIds = hasInvoceNotInFlowingResult;

                                //alert('弹出编辑框:' + g_curSelectedBillingIds);
                                    EditInvoice();
                                },
                            });
                        }
                })
                .navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilDelete',
                    caption: "", title: "删除账单", buttonicon: "ui-icon-trash",
                    onClickButton: function () {
                        var selectedIDs = jQuery('#jqGrid').getGridParam("selarrrow");
                        var hasInvoceNotInFlowingResult = ""; //保存选择的已有账单，但不在流程中的记录
                        var inFlowingResult = ""; //保存选择的已有账单，但已处于流程中的账单的记录

                var selectedBillingIDs = "";

                        for (var i = 0; i < selectedIDs.length; ++i) {
                    var billingId = jQuery('#jqGrid').jqGrid('getCell', selectedIDs[i], "IDX"); //BillingID
                    selectedBillingIDs += selectedIDs[i].toString() + ":" + billingId + ",";
                        }
                if (selectedBillingIDs != "") {
                    selectedBillingIDs = selectedBillingIDs.substr(0, selectedBillingIDs.length - 1);
                        }

                        $.ajax({
                    url: '@Url.Action("CheckBillingStatus", "Finance")',
                            type: "POST",
                            data: {
                        'selectedBillingIDs': selectedBillingIDs
                            },//"oper=delete&id=" + gr,
                            dataType: 'json',
                            success: function (result) {

                                for (key in result.dic_has_invoice_in_fow) {

                                    var value = result.dic_has_invoice_in_fow[key];
                                    inFlowingResult += key + ",";
                                }

                                if (inFlowingResult != "") {
                                    inFlowingResult = inFlowingResult.substr(0, inFlowingResult.length - 1);
                            alert('所选的记录中，第' + inFlowingResult + '行账单处于审核流程中，不能删除，请取消这些(张)账单！');
                                    return;
                                }

                                for (key in result.dic_has_invoice_not_in_flow) {
                                    var value = result.dic_has_invoice_not_in_flow[key];
                                    hasInvoceNotInFlowingResult += value + ",";
                                }

                                if (hasInvoceNotInFlowingResult != "") {
                                    hasInvoceNotInFlowingResult = hasInvoceNotInFlowingResult.substr(0, hasInvoceNotInFlowingResult.length - 1);
                                }

                        g_curSelectedBillingIds = hasInvoceNotInFlowingResult;
                        //AddParent();
                        //alert('弹出删除框:' + g_curSelectedBillingIds);

                        if (confirm('@Resources.Language.SureDelete')) {

                                    $.ajax(
                                        {
                                            type: "post",
                                    url: '@Url.Action("DeleteInvoice2", "Finance")',
                                    data: { 'billIds': g_curSelectedBillingIds },//"oper=delete&id=" + gr,
                                            dataType: 'json',
                                            success: function (result) {
                                                alert(result.message);
                                                //jQuery("#jqGrid").jqGrid('delRowData', rowid);
                                        //$('#jqGrid_ilAdd').addClass('ui-state-disabled');
                                                $('#jqGrid_ilDelete').addClass('ui-state-disabled');
                                                $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
                                                $('#jqGrid_ilView').addClass('ui-state-disabled');
                                                $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                                                $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                                        //$('#jqGrid_ilReport').addClass('ui-state-disabled');


                                                $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                                        $('#jqGrid_Order').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                                            },

                                        }
                                        );
                                }
                            },
                        });

                    },
                    position: "last"
        })
        .navButtonAdd('#jqGridPager', {
            id: 'jqGrid_ilAddCredit',
            caption: "回扣单", title: "新增回扣单", buttonicon: "ui-icon-plus",
                    onClickButton: function () {
                var selectedIDs = jQuery('#jqGrid').getGridParam("selarrrow");
                                var hasInvoceNotInFlowingResult = ""; //保存选择的已有账单，但不在流程中的记录
                                var inFlowingResult = ""; //保存选择的已有账单，但已处于流程中的账单的记录

                var selectedBillingIDs = "";

                for (var i = 0; i < selectedIDs.length; ++i) {
                    var billingId = jQuery('#jqGrid').jqGrid('getCell', selectedIDs[i], "IDX"); //BillingID
                    selectedBillingIDs += selectedIDs[i].toString() + ":" + billingId + ",";
                }
                if (selectedBillingIDs != "") {
                    selectedBillingIDs = selectedBillingIDs.substr(0, selectedBillingIDs.length - 1);
                }

                                $.ajax({
                    url: '@Url.Action("CheckBillingStatus", "Finance")',
                                    type: "POST",
                                    data: {
                        'selectedBillingIDs': selectedBillingIDs
                                    },//"oper=delete&id=" + gr,
                                    dataType: 'json',
                                    success: function (result) {

                                        for (key in result.dic_has_invoice_in_fow) {

                                            var value = result.dic_has_invoice_in_fow[key];
                                            inFlowingResult += key + ",";
                                        }

                                        if (inFlowingResult != "") {
                                            inFlowingResult = inFlowingResult.substr(0, inFlowingResult.length - 1);
                            alert('所选的记录中，第' + inFlowingResult + '行账单处于审核流程中，不能新增回扣单，请取消这些(张)账单！');
                                            return;
                                        }

                                        for (key in result.dic_has_invoice_not_in_flow) {
                                            var value = result.dic_has_invoice_not_in_flow[key];
                            hasInvoceNotInFlowingResult += value + ",";
                                        }

                                        if (hasInvoceNotInFlowingResult != "") {
                                            hasInvoceNotInFlowingResult = hasInvoceNotInFlowingResult.substr(0, hasInvoceNotInFlowingResult.length - 1);
                                    }

                        g_curSelectedBillingIds = hasInvoceNotInFlowingResult;

                        //alert('弹出新增回扣单:' + g_curSelectedBillingIds);
                                    AddCreditModal();
                                },
                            });

                    },

                    })
                .navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilSubmit',
                    caption: "审核", title: "提交审核", buttonicon: "ui-icon-circle-plus",
                    onClickButton: function () {
                        var selectedIDs = jQuery('#jqGrid').getGridParam("selarrrow");
                        var hasInvoceNotInFlowingResult = ""; //保存选择的已有账单，但不在流程中的记录
                        var inFlowingResult = ""; //保存选择的已有账单，但已处于流程中的账单的记录

                var selectedBillingIDs = "";

                        for (var i = 0; i < selectedIDs.length; ++i) {
                    var billingId = jQuery('#jqGrid').jqGrid('getCell', selectedIDs[i], "IDX"); //BillingID
                    selectedBillingIDs += selectedIDs[i].toString() + ":" + billingId + ",";
                        }
                if (selectedBillingIDs != "") {
                    selectedBillingIDs = selectedBillingIDs.substr(0, selectedBillingIDs.length - 1);
                        }

                        $.ajax({
                    url: '@Url.Action("CheckBillingStatus", "Finance")',
                            type: "POST",
                            data: {
                        'selectedBillingIDs': selectedBillingIDs
                            },//"oper=delete&id=" + gr,
                            dataType: 'json',
                            success: function (result) {

                                for (key in result.dic_has_invoice_in_fow) {

                                    var value = result.dic_has_invoice_in_fow[key];
                                    inFlowingResult += key + ",";
                                }

                                if (inFlowingResult != "") {
                                    inFlowingResult = inFlowingResult.substr(0, inFlowingResult.length - 1);
                            alert('所选的记录中，第' + inFlowingResult + '行账单处于审核流程中，不能编辑，请取消这些(张)账单！');
                                    return;
                                }

                                for (key in result.dic_has_invoice_not_in_flow) {
                                    var value = result.dic_has_invoice_not_in_flow[key];
                                    hasInvoceNotInFlowingResult += value + ",";
                                }

                                if (hasInvoceNotInFlowingResult != "") {
                                    hasInvoceNotInFlowingResult = hasInvoceNotInFlowingResult.substr(0, hasInvoceNotInFlowingResult.length - 1);
                                }

                        g_curSelectedBillingIds = hasInvoceNotInFlowingResult;


                                g_submit_billIds = hasInvoceNotInFlowingResult;

                                $('#table-modal').modal();
                            },
                        });


                    },

        })
        .navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilView',
                    caption: "查看", title: "查看账单和回扣单", buttonicon: "ui-icon-search",
                    onClickButton: function () {
                var selectedIDs = jQuery('#jqGrid').getGridParam("selarrrow");
                var hasInvoceNotInFlowingResult = ""; //保存选择的已有账单，但不在流程中的记录
                var inFlowingResult = ""; //保存选择的已有账单，但已处于流程中的账单的记录

                var selectedBillingIDs = "";

                for (var i = 0; i < selectedIDs.length; ++i) {
                    var billingId = jQuery('#jqGrid').jqGrid('getCell', selectedIDs[i], "IDX"); //BillingID
                    selectedBillingIDs += selectedIDs[i].toString() + ":" + billingId + ",";
                }
                if (selectedBillingIDs != "") {
                    selectedBillingIDs = selectedBillingIDs.substr(0, selectedBillingIDs.length - 1);
                                    }

                g_curSelectedBillingIds = hasInvoceNotInFlowingResult;

                                    //查看
                //alert("chakan:" + g_curSelectedBillingIds);
                                    ViewInvoice();

                               },

                            });


        $('#cb_jqGrid').change(function () {

            if (true == $('#cb_jqGrid').prop('checked')) {
                //alert('全选')
                var selectedIDs = jQuery('#jqGrid').getGridParam("selarrrow");

                if (selectedIDs.length == 0) {
                    $('#jqGrid_ilDelete').addClass('ui-state-disabled');
                    $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
                    $('#jqGrid_ilView').addClass('ui-state-disabled');
                    $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                    $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                }
                else {
                    if (selectedIDs.length != 1) {
                        //$('#jqGrid_ilAdd').addClass('ui-state-disabled');
                $('#jqGrid_ilDelete').removeClass('ui-state-disabled');
                $('#jqGrid_ilSubmit').removeClass('ui-state-disabled');
                $('#jqGrid_ilView').addClass('ui-state-disabled');
                $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                        //$('#jqGrid_ilReport').addClass('ui-state-disabled');

            }
            else {

                        //$('#jqGrid_ilAdd').removeClass('ui-state-disabled');
                        $('#jqGrid_ilDelete').removeClass('ui-state-disabled');
                        $('#jqGrid_ilSubmit').removeClass('ui-state-disabled');
                        $('#jqGrid_ilView').removeClass('ui-state-disabled');
                        $('#jqGrid_ilAddCredit').removeClass('ui-state-disabled');
                        $('#jqGrid_ilEdit').removeClass('ui-state-disabled');
                        //$('#jqGrid_ilReport').removeClass('ui-state-disabled');

                    }
                }
            }
            else {
                //alert('没有全选');
                //$('#jqGrid_ilAdd').addClass('ui-state-disabled');
                $('#jqGrid_ilDelete').addClass('ui-state-disabled');
                $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
                $('#jqGrid_ilView').addClass('ui-state-disabled');
                $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                //$('#jqGrid_ilReport').addClass('ui-state-disabled');

            }
        });

        $('#jqGrid_ilAdd').addClass('ui-state-disabled');
        $('#jqGrid_ilDelete').addClass('ui-state-disabled');
        $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
        $('#jqGrid_ilView').addClass('ui-state-disabled');
        $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
        $('#jqGrid_ilEdit').addClass('ui-state-disabled');
        $('#jqGrid_ilReport').addClass('ui-state-disabled');

    }
</script>



<!--提交审核模态框-->
<script type="text/javascript">

    var g_submit_billIds = ''; //保存需要提交审核的账单,如果有以','分割，如果没有就是空字符串""
    //$(document).ready(Init);
    //function Init() {}
        // Variables declaration & to make our life easier we set our HTML tags to variables too
        var
            $$ = function (id) { return document.getElementById(id); },
            container = $$('flowtable'),
            tjflow = $$('btnflow'),
            autosaveNotification,
            hot;

        hot = new Handsontable(container, {
            //data: getCarData(),
            startRows: 2,
            startCols: 4,
        colHeaders: ['流程节点', '人员', '起始日期', '结束日期'],
            columnSorting: true,
            contextMenu: true,
            minSpareRows: 1,
            rowHeaders: true,
            columnSorting: false,
            contextMenu: ['row_below', 'remove_row'],
            removeRowPlugin: true,
            heigth: 200,
            columns: [
              {
                  type: 'dropdown',
                  //source: ['创建', '校对', '审核', '会签'],
                  source: eval('@Html.Raw(@ViewBag.Nodes)'),
                  strict: false,
                  width: 100
              },
              {
                  type: 'dropdown',//'autocomplete',
                  //source: ['张三', '李四', '王五', '赵六'],
                  source: eval('@Html.Raw(@ViewBag.Persons)'),
                  @*source: function (request, response) {
                      this.xhr = $.ajax({
                          url: '@Url.Action("GetPersons", "Flow")',
                          data: request,
                          type: 'GET',
                          dataType: 'json',
                          success: function (data) {
                              response(data);
                          },

                          error: function (model, response, options) {
                              response([]);
                          }
                      });
                  },*@
                  strict: false,
                  width: 100
              },
              {
                  type: 'date',
                  dateFormat: 'MM/DD/YYYY',
                  correctFormat: true,
                  defaultDate: '@DateTime.Now.ToShortDateString()',
                  width: 120
              },
              {
                  type: 'date',
                  dateFormat: 'MM/DD/YYYY',
                  correctFormat: true,
                  //defaultDate: '@DateTime.Now.ToShortDateString()'
                  width: 120
              }
            ],
            afterChange: function (change, source) {
                //alert(change);
                //alert(source);

                if (source === 'loadData') {
                    return; //don't save this change
                }
                if (change != null) {
                    var chs = change[0];
                    //判断节点是否重复
                    var rct = hot.countRows();
                    //alert(rct);
                if (chs[1] == 0) {
                        //$('#childErrMsg p').html("");
                        //$('#childErrMsg').hide();
                        for (var i = 0; i < rct - 1; i++) {
                            if (i == chs[0]) continue;
                            var vlnode = hot.getDataAtCell(i, 0)
                        if (chs[3] == vlnode && chs[3] != "") {
                                alert("行流程节点重复! ");
                                hot.setDataAtRowProp(chs[0], 0, "");
                                return;
                            }
                        }
                    }
                    //判断人员是否存在
                    if (chs[1] == 1) {
                        var vlperson = hot.getDataAtCell(chs[0], 1);
                    if (vlperson != null && vlperson != "") {
                            jQuery.ajax({
                                url: '/Flow/UserValid',
                                type: "POST",
                                dataType: "json",
                                data: { 'vlperson': vlperson },//JSON.stringify(hot.getChangeData()),
                                success: function (result) {
                                    if (result.rvalid == false) {
                                        alert(vlperson + "不存在! ")
                                        hot.setDataAtRowProp(chs[0], 1, "");
                                    }
                                },
                                error: function (xhr) {
                                    //alert('error');
                                }
                            });
                        }
                    }
                }
                clearTimeout(autosaveNotification);
                jQuery.ajax({
                    url: '@Url.Action("")',
                    type: "POST",
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(hot.getData()),
                    async: true,
                    processData: false,
                    cache: false,
                    success: function (data) {
                        //exampleConsole.innerHTML = 'Changes will be autosaved';
                        autosaveNotification = setTimeout(function () {
                            //exampleConsole.innerHTML = 'Autosaved (' + change.length +
                            //' ' + 'cell' +
                            //(change.length > 1 ? 's' : '') + ')';
                        }, 1000);
                        //alert(data);
                    },
                    error: function (xhr) {
                        //exampleConsole.innerHTML = 'Autosave: No Response from Controller';
                        //alert('error');
                    }
                });
            }
        });
          //创建单元格只读
          hot.updateSettings({
              cells: function (row, col, prop) {
                  var cellProperties = {};

                  //if (hot.getData()[row][prop] === '创建') {
                  //    cellProperties.readOnly = true;
                  //}
                  if (row == 0 && (col == 0 || col == 1)) cellProperties.readOnly = true;
                  return cellProperties;
              }
          });
          //第一行不能被删除
          hot.updateSettings({
              contextMenu: {
                  //callback: function (key, options) {
                  //    if (key === 'about') {
                  //        setTimeout(function () {
                  //            //timeout is used to make sure the menu collapsed before alert is shown
                  //            alert("This is a context menu with default and custom options mixed");
                  //        }, 100);
                  //    }
                  //},
                  items: {
                      "row_below": {
                          //disabled: function () {
                          //    //if first row, disable this option
                          //    return (hot.getSelected() && hot.getSelected()[0] === 0)
                          //}
                      },
                      "remove_row": {
                          name: 'Remove row',
                          disabled: function () {
                              //if first row, disable this option
                              return (hot.getSelected() && hot.getSelected()[0] === 0)
                          }
                      }
                  }
              }
          })

          Handsontable.Dom.addEvent(tjflow, 'click', function () {
              var rct = hot.countRows();
              //alert(rct);
              for (var i = 0; i < rct - 1; i++) {
                  //alert(hot.getDataAtCell(i, 0));//[A1,B1]
                  var vlnode = hot.getDataAtCell(i, 0)
                  //alert(vlnode);
                  if (vlnode == null || vlnode == '' || vlnode == undefined) {
                      //alert("第" + (i + 1) + "行流程节点为空! ");
                      $('#childErrMsg p').html("第" + (i + 1) + "行流程节点为空! ");
                      //$('#_XX').parent().addClass("has-error");
                      $('#childErrMsg').show();
                      return;
                  }
                  var vlperson = hot.getDataAtCell(i, 1)
                  if (vlperson == null || vlperson == '' || vlperson == undefined) {
                      //alert("第" + (i + 1) + "行人员为空! ");
                      $('#childErrMsg p').html("第" + (i + 1) + "行人员为空! ");
                      //$('#_XX').parent().addClass("has-error");
                      $('#childErrMsg').show();
                      return;
                  }

              }
              jQuery.ajax({
                  url: '/Flow/SubmitFlow' + '?billids=' + g_submit_billIds,
                  type: "POST",
                  dataType: "json",
                  contentType: 'application/json; charset=utf-8',
                  data: JSON.stringify(hot.getSourceData()),
                  async: true,
                  processData: false,
                  cache: false,
                  success: function (result) {
                      $('#table-modal').modal('hide')
                      alert(result.message);
                  },
                  error: function (xhr) {
                      alert(xhr.responseText);
                      //exampleConsole.innerHTML = 'Save error';
                      //alert('error');
                  }
              });
          });

          //
          $('#table-modal').on('shown.bs.modal', function (e) {
              initChildModal();
          });

          function initChildModal() {
              $('#childErrMsg').hide();
              //$('#_xxx').parent().removeClass("has-error");

              jQuery.ajax({
                  url: '/Flow/GetInitData', //Controller to Get the
                  //JsonResult From -- Json(jsonData, JsonRequestBehavior.AllowGet);
                  type: "GET",
                  dataType: "json",
                  contentType: "application/json",
                  charset: "utf-8", // dataType and contentType should be json
                  async: true,
                  processData: false,
                  cache: false,
                  success: function (data) {      // on Success send the Json data
                      // to the table by using loaddata function""
                      //alert("ok");
                      hot.loadData(data);
                      //exampleConsole.innerHTML = 'Data loaded';
                  },
                  error: function (xhr) {
                      alert('error');
                  }
              });

              //var rct = hot.countRows();
              ////alert(rct);
              //for (var i = 0; i < rct - 1; i++) {
              //    hot.alter('remove_row',i);
              //}
              //hot.clear();

              //$('#_ServiceNatureLabel').empty();
              //$('#_ChooseTug').val("");
              //$("#_JobStateLabel option:first").prop("selected", 'selected');
              //$('#_RopeUsed input[type="checkbox"]').attr("checked", false);
          }
</script>



<!-- 新增模态框 -->
<script type="text/javascript">

    function AddParent() {
        $('#parent-modal').modal()

    }

    function initParentModal() {
        $('#parentErrMsg').hide();

        $('#add_job_no').parent().removeClass("has-error");
        $('#add_remark').parent().removeClass("has-error");
        //$("#sel_billing_scheme option:first").prop("selected", 'selected');
        //$("#sel_billing_type option:first").prop("selected", 'selected');
        //$("#sel_time_type option:first").prop("selected", 'selected');

        //$("input[name='serviceCheckbox']").each(function () {
        //    $(this).attr("checked", false);
        //});
        $('#sel_billing_type').attr('disabled', false);
        $('#sel_time_type').attr('disabled', false);

        $('#add_btn_sumbit').attr('disabled', false);
        $('#add_btn_voice_preview').attr('disabled', true);
        $('#add_btn_voice_preview').hide();

        var selectedOrderRowIds = '';
        var selectedOrderIds = '';
        var custId = '', customerName = '', orderIds = '', shipName = '', shipLength = '', shipTEUS = '';

        if (g_curSelectedOrderRowIds.length > 0) {
            selectedOrderRowIds = g_curSelectedOrderRowIds.split(',')
        }
        for (var i = 0; i < selectedOrderRowIds.length; ++i) {
            var dr = jQuery("#jqGrid_Order").jqGrid('getRowData', selectedOrderRowIds[i]);//得到该行的数据
            custId = dr.CustomerID;
            customerName = dr.CustomerName;
            shipLength = dr.Length;
            shipTEUS = dr.TEUS;
            shipName = dr.ShipName;
            selectedOrderIds += dr.IDX + ','
        }

        if (selectedOrderIds.length > 0) {
            orderIds = selectedOrderIds.substr(0, selectedOrderIds.length - 1);
        }

        //var dr = jQuery("#jqGrid_Order").jqGrid('getRowData', g_curRowId);//得到该行的数据

        var orderDate = dr.OrdDate;

        $('#add_customer').text(customerName);
        $('#add_customer_ship').text(shipName);
        $('#add_customer_ship_length').val(shipLength);
        $('#add_customer_ship_teus').val(shipTEUS);

        $('#add_ck_customer_ship_length').attr('checked', false);
        $('#add_ck_customer_ship_teus').attr('checked', false);
        $('#add_job_no').val("");


        $.ajax({
            type: "get",
            url: '@Url.Action("InitFilter2", "Finance")',
            data: {
                'custId': custId,
                'orderIds': orderIds,
                'shipLength': shipLength,
                'shipTEUS': shipTEUS,

            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {

                $('#sel_billing_scheme').empty();
                //$('#sel_billing_type').empty();
                //$('#sel_time_type').empty();
                $('#div_services').empty();
                $('#tb_detail').empty();

                for (var i = 0; i < result.customer_billing_schemes.length; i++) {

                    //计费方案ID~计费折扣~客户Code~船长规则~箱量规则%计费方案模板类型ID~计费方案模板类型Value~计费方案模板类型Label%计费方案模板计时方式ID~计费方案模板计时方式Value~计费方案模板计时方式Label
                    //客户Code如果是字符串-1，则表示是非會員客戶的计费方案

                    if (result.customer_billing_schemes[i].ShipLength == null) { result.customer_billing_schemes[i].ShipLength = "" };
                    if (result.customer_billing_schemes[i].ShipTEUS == null) { result.customer_billing_schemes[i].ShipTEUS = "" };

                    var v = result.customer_billing_schemes[i].BillingTemplateIDX + '~' + result.customer_billing_schemes[i].Discount + '~' + result.customer_billing_schemes[i].CustomerCode + '~' + result.customer_billing_schemes[i].ShipLength + '~' + result.customer_billing_schemes[i].ShipTEUS
                        + "%"
                        + result.customer_billing_schemes[i].BillingTemplateTypeID + "~" + result.customer_billing_schemes[i].BillingTemplateTypeValue + "~" + result.customer_billing_schemes[i].BillingTemplateTypeLabel
                        + "%"
                        + result.customer_billing_schemes[i].TimeTypeID + "~" + result.customer_billing_schemes[i].TimeTypeValue + "~" + result.customer_billing_schemes[i].TimeTypeLabel;

                    option = $('<option value="' + v + '">' + result.customer_billing_schemes[i].BillingTemplateName + '</option>')
                    $('#sel_billing_scheme').append(option);

                    //alert(v);

                }
                $("#sel_billing_scheme option:first").prop("selected", 'selected');

                var customerBillingScheme = $("#sel_billing_scheme").val().toString();

                $('#txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])
                $('#sel_billing_type').val(customerBillingScheme.split('%')[1].split('~')[2]);
                $('#sel_time_type').val(customerBillingScheme.split('%')[2].split('~')[2]);

                $('#add_ship_length_rules').val(customerBillingScheme.split('%')[0].split('~')[3]);
                $('#add_ship_teus_rules').val(customerBillingScheme.split('%')[0].split('~')[4]);

                var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
                var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
                var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

                var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
                var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
                var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

                var discount = $('#txt_discount').val();

                $('#add_sel_month').val(result.month);
                $('#add_remark').val(result.remark);

                //return;
                reGenerate2(orderIds, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount)

            },
        });
    }

    $('#parent-modal').on('show.bs.modal', function (e) {
        initParentModal();
    });

    $('#parent-modal').on('shown.bs.modal', function (e) {
    });
    $('#parent-modal').on('hide.bs.modal', function () {
        $('#div_services').empty();
        $('#tb_detail').empty();
        $('#tb_detail').empty()

        $(this).removeData("bs.modal");
        //alert("hide");
    });
    $('#parent-modal').on('hidden.bs.modal', function () {
        //jQuery("#jqGrid2").jqGrid('GridDestroy', 'jqGrid2');
        $(this).removeData("bs.modal");
        //alert("hidden");
    });

    function submitParentModal() {

        var maxTextLength = 50;
        var maxTextAreaLength = 500;

        $('#add_job_no').parent().removeClass("has-error");
        $('#add_remark').parent().removeClass("has-error");


        $('#parentErrMsg').hide();


        //提交数据库

        var selectedOrderRowIds = '';
        var selectedOrderIds = '';
        var orderIds = '';
        var custId = '', custShipId = '';

        if (g_curSelectedOrderRowIds.length > 0) {
            selectedOrderRowIds = g_curSelectedOrderRowIds.split(',')
        }
        for (var i = 0; i < selectedOrderRowIds.length; ++i) {
            var dr = jQuery("#jqGrid_Order").jqGrid('getRowData', selectedOrderRowIds[i]);//得到该行的数据
            custId = dr.CustomerID;
            //customerName = dr.CustomerName;
            custShipId = dr.ShipID;
            //shipLength = dr.Length;
            //shipTEUS = dr.TEUS;
            //shipName = dr.ShipName;
            selectedOrderIds += dr.IDX + ','
        }

        if (selectedOrderIds.length > 0) {
            orderIds = selectedOrderIds.substr(0, selectedOrderIds.length - 1);
        }

        var customerBillingScheme = $("#sel_billing_scheme").val().toString();

        var billingTemplateId = customerBillingScheme.split('%')[0].split('~')[0];

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        var discount = $('#txt_discount').val();
        var amount = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text()));

        var jobNo = $('#add_job_no').val().toString().trim();
        var remark = $('#add_remark').val().toString().trim();

        var month = $('#add_sel_month').val();

        var isShowShipLengthRule = "否";
        if (true == $('input[type="checkbox"][id="add_ck_customer_ship_length"]').is(":checked"))
            isShowShipLengthRule = "是";

        var isShowShipTEUSRule = "否";
        if (true == $('input[type="checkbox"][id="add_ck_customer_ship_teus"]').is(":checked"))
            isShowShipTEUSRule = "是";




        @*if (jobNo.length <= 0) {
            $('#add_job_no').parent().addClass("has-error");
            alert('@Resources.Language.V_OrderBilling_JobNo' + "必填");
            return;
        }*@
        if (jobNo.length > maxTextLength) {
            $('#add_job_no').parent().addClass("has-error");
            alert('@Resources.Language.V_OrderBilling_JobNo' + "长度不能超过" + maxTextLength);
            return;
        }

        if (remark.length > maxTextLength) {
            $('#add_remark').parent().addClass("has-error");
            alert('@Resources.Language.Remark' + "长度不能超过" + maxTextAreaLength);
            return;
        }

        var jsonArrayItems, jsonArraySummaryItems;
        if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
            var ret = CheckQuanBaoTBodyData();
            if (ret == false) {
                alert("存在无效数据，请检查是否有未输入的数据");
                return;
            }

            var array = GetQuanBaoTBodyData();
            jsonArrayItems = JSON.stringify(array);

            array = GetQuanBaoSummaryItems();
            jsonArraySummaryItems = JSON.stringify(array);

        }
        if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
            var ret = CheckBanBaoTBodyData();

            if (ret == false) {
                alert("存在无效数据，请检查是否有未输入的数据");
                return;
            }
            var array = GetBanBaoTBodyData();
            jsonArrayItems = JSON.stringify(array);

            array = GetBanBaoSummaryItems();
            jsonArraySummaryItems = JSON.stringify(array);
        }
        if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
            var ret = CheckTiaoKuanTBodyData();
            if (ret == false) {
                alert("存在无效数据，请检查是否有未输入的数据");
                return;
            }
            var array = GetTiaoKuanTBodyData();
            jsonArrayItems = JSON.stringify(array);

            array = GetTiaoKuanSummaryItems();
            jsonArraySummaryItems = JSON.stringify(array);
        }

        //alert(custId);
        //alert(custShipId);
        //alert(orderIds);
        //alert(billingTemplateId);
        //alert(billingTypeId);
        //alert(timeTypeId);
        //alert(jobNo);
        //alert(remark);
        //alert(discount);
        //alert(amount);
        //alert(month);
        //alert(isShowShipLengthRule);
        //alert(isShowShipTEUSRule);
        //alert(jsonArrayItems);
        //alert(jsonArraySummaryItems);

        $("#add_btn_sumbit").attr("disabled", true);


        $.ajax({
            url: '@Url.Action("AddInvoice2", "Finance")',
            type: "post",
            data: {
                'custId': custId,
                'custShipId':custShipId,
                'orderIds': orderIds,
                'billingTemplateId': billingTemplateId,
                'billingTypeId': billingTypeId,
                'timeTypeId': timeTypeId,
                'jobNo': jobNo,
                'remark':remark,
                'discount': discount,
                'amount': amount,
                'month': month,
                'isShowShipLengthRule': isShowShipLengthRule,
                'isShowShipTEUSRule':isShowShipTEUSRule,
                'jsonArrayItems': jsonArrayItems,
                'jsonArraySummaryItems': jsonArraySummaryItems
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {
                alert(result.message);

                $('#parent-modal').modal('hide')

                if (result.code == '@Resources.Common.SUCCESS_CODE') {
                    $('#add_btn_voice_preview').attr('disabled', false);

                    $('#jqGrid_Order').jqGrid('setGridParam',
                    {
                        datatype: 'json',
                        url: '@Url.Action("GetDataOfGenerateInvoicce", "OrderManage")',
                    }).trigger('reloadGrid');

                    $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');

                }
                else {
                    $("#add_btn_sumbit").attr("disabled", false);
                    $('#add_btn_voice_preview').attr('disabled', true);
                }
            },

            error: function (xhr) {
                $("#add_btn_sumbit").attr("disabled", false);
            }
        });
    }
</script>

<!--新增模态框里的生成报表-->
<script type="text/javascript">

    function reGenerate2(orderIds, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount) {

        $('#tb_detail').empty();

        $.ajax({
            type: "post",
            url: '@Url.Action("NewInvoice2", "Finance")',
            data: {
                'orderIds': orderIds,
                'customerBillingScheme': customerBillingScheme,
                'billingTypeId': billingTypeId,
                'billingTypeValue': billingTypeValue,
                'billingTypeLabel': billingTypeLabel,
                'timeTypeId': timeTypeId,
                'timeTypeValue': timeTypeValue,
                'timeTypeLabel': timeTypeLabel,
                'discount': discount
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {
                //$('#tb_detail').empty();
                $('#div_services').empty();

                var div1 = $('<div class="col-md-2"><p>服务项目:<br>SERVICE:</p></div>');
                var div2 = $('<div class="col-md-2"></div>');
                var div3 = $('<div class="col-md-3"></div>');
                var div4 = $('<div class="col-md-5"></div>')
                for (key in result.invoice.ServiceNature) {
                    var value = result.invoice.ServiceNature[key];
                    var p = $('<p>' + value.ServiceName + '</p>')
                    div2.append(p);

                    p = $('<p>' + value.ServiceWorkDate + '</p>');
                    div3.append(p)

                    p = $('<p>' + value.ServiceWorkPlace + '</p>');
                    div4.append(p)

                }

                $('#div_services').append(div1).append(div2).append(div3).append(div4);

                //----生成表格

                //1.表头
                {
                    var thead = $('<thead></thead>');
                    var tr1 = $('<tr></tr>');
                    var tr2 = $('<tr></tr>');
                    var th = $('<th width="10%" rowspan="2" style="text-align:center;vertical-align:middle">拖轮</th>');
                    tr1.append(th);

                    for (key in result.invoice.ServiceNature) {
                        var value = result.invoice.ServiceNature[key];
                        //alert(result.invoice.Schedulers[key].length);
                        var th = $('<th width="" style="text-align:center;vertical-align:middle" colspan=' + result.invoice.Schedulers[key].length + '>' + value.ServiceName + '</th>');
                        tr1.append(th)
                    }
                    thead.append(tr1);

                    var colspan = 0;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {
                            var th = $('<th width="" style="text-align:center;vertical-align:middle">' + value[i].TugCnName + '</th>');

                            var span1 = $('<span hidden>' + value[i].SchedulerID + '</span>');
                            th.append(span1);

                            tr2.append(th);
                            colspan++;
                        }
                    }

                    thead.append(tr2);
                    $('#tb_detail').append(thead);
                }

                //2.表体
                DynamicGenerateTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);

                //3.表尾
                {
                    var tfoot = $('<tfoot></tfoot>')
                    var tr = $('<tr></tr>')

                    if (colspan == 0) {
                        var td = $('<td colspan=' + colspan + ' style="text-align:center;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：&nbsp;&nbsp;&nbsp;&nbsp;' + GetFloatStr(result.invoice.GrandTotalHKS) + '<br> Grand Total HKS</strong></td>');
                        tr.append(td);
                    }
                    else {
                        var td1 = $('<td colspan=' + colspan + ' style="text-align:right;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>');
                        var td2 = $('<td id="GrandTotalHKS" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(result.invoice.GrandTotalHKS)) + '</strong></td>');

                        tr.append(td1);
                        tr.append(td2);
                    }
                    tfoot.append(tr);

                    $('#tb_detail').append(tfoot);
                }
            },
        });
    }

    function DynamicGenerateTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //使用计费方案
        var customerCode = customerBillingScheme.split('%')[0].split('~')[2];
        if (customerCode == "-1") {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                DefaultQuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
                DefaultBanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
                DefaultTiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }
        else {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                //QuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
                DefaultQuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
                //BanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
                DefaultBanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
                //TiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
                DefaultTiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }

    }

    function QuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].UnitPrice)) + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].DiscountSubTotalHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);
        }
    }

    function BanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "半包") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + GetFloatStr(value[i].Price) + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)" ></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoTopCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].SubTotaHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)" ></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price * -1) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="BanbaoMidCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" ></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>拖缆费单价(每小时)</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" ></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }



            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].TotalHKs) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);

        }
    }

    function TiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "计时") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="每小时收费" value="' + GetFloatStr(value[i].UnitPrice) + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)" ></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(value[i].Price) + '</td>');

                        //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="正常收费" value="' + value[i].Price + '"></input>');
                        //td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanTopCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].SubTotaHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="TiaoKuanMidCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" ></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>拖缆费单价(每小时)</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" ></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }



            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].TotalHKs) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);

        }

    }

    function DefaultQuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //缺省全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;"  id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].UnitPrice)) + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].DiscountSubTotalHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);
        }
    }

    function DefaultBanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //缺省半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "半包") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //style = "min-width:100px;"
            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td style="text-align:center;vertical-align:middle;width:100px;">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {


                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].Price)) + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6 25%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B10' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="港外附加费20" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="Banbao20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7 50%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B11' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="18时至22时附加费50" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "121" + '_' + "E82";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="0" type="text" name="18时至22时附加费50耗时" onkeyup="DefaultBanbao_18时至22时附加费50_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8 100%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B12' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="22时至08时附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "122" + '_' + "E83";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="0" type="text" name="22时至08时附加费100耗时" onkeyup="DefaultBanbao_22时至08时附加费100_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //9 100% 假日附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B13' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%假日附加费" onchange="BanbaoAll100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="假日附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="Banbao100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 100% 台风附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B14' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%台风附加费" onchange="BanbaoAll100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="台风附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="Banbao100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">折扣</td>')

                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var input = $('<input style="width:100px;" id="' + element_id + '" type="text" name="折扣" value="' + FormatPrice(GetFloatStr(price)) + '" onkeyup="DefaultBanbao_ZheKou_InputChanged(this)"></input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9 3600BHP以上
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_3600BHP附加费" onchange="BanbaoAll3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="3600BHP附加费15" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');
                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="Banbao3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'E80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')

                    var span = $('<br><span>燃油附加费</span>');
                    td.append(span);
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            //var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var unit_price_p = $('<p></p>');
                            var span = $('<span>单价(每小时):</span>');
                            unit_price_p.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费单价">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee)) + '</span>');
                            unit_price_p.append(span);
                            td.append(unit_price_p);

                            var p1 = $('<p>燃油附加费折扣</p>')
                            var input1 = $('<input style="width:100px;" type="text" name="燃油附加费折扣" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_119_C83' + '" value="' + FormatPrice(GetFloatStr(value[i].DiscoutPriceOfFeulFee)) + '" onkeyup="DefaultBanbao_RanYouDiscout_InputChanged(this)">')
                            td.append(p1).append(input1);

                            var p2 = $('<p></p>')
                            span = $('<span>燃油附加费折扣后价格:</span>');
                            p2.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费折扣后价格">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee + value[i].DiscoutPriceOfFeulFee)) + '</span>');
                            p2.append(span);
                            td.append(p2);

                            var p3 = $('<p>燃油附加费额外费用</p>')
                            var input2 = $('<input style="width:100px;" type="text" name="燃油附加费额外费用" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_120_E81' + '" value="' + FormatPrice(GetFloatStr(value[i].PriceOfFeulFee - value[i].UnitPriceOfFeulFee)) + '" onkeyup="DefaultBanbao_RanYouExtra_InputChanged(this)">')
                            td.append(p3).append(input2);

                            var p4 = $('<p><strong>燃油附加费</strong><p>')

                            var feul_fee = parseFloat(ConvertToRealPrice($(span).text())) + parseFloat(ConvertToRealPrice($(input2).val()));
                            var price_p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_22_E80' + '" name="燃油附加费">' + FormatPrice(GetFloatStr(feul_fee)) + '</p>');
                            td.append(p4).append(price_p);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_拖缆费" onchange="BanbaoAllTuoLanFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(price)) + '</td>');

                            tr.append(td);
                        }
                    }

                }

                tbody.append(tr);
            }



            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);

        }
    }

    function DefaultTiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "计时") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5 每小时收费
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {


                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="每小时收费" value="' + FormatPrice(GetFloatStr(value[i].UnitPrice)) + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5 正常收费
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(value[i].Price)) + '</td>');

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6 25%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B10' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="TiaoKuanAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="港外附加费20" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="TiaoKuan20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7 50%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B11' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                    var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="18时至22时附加费50" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "121" + '_' + "E82";

                            var input = $('<input style="width:100px;" id="' + element_id + '" value="0" type="text" name="18时至22时附加费50耗时" onkeyup="DefaultTiaoKuan_18时至22时附加费50_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8 100%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B12' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="22时至08时附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "122" + '_' + "E83";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="0" type="text" name="22时至08时附加费100耗时" onkeyup="DefaultTiaoKuan_22时至08时附加费100_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                            tr.append(td);
                    }
                }
                }

                tbody.append(tr);
            }

            //9 100% 假日附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B13' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%假日附加费" onchange="TiaoKuanAll100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="假日附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input style="width:100px;" id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="TiaoKuan100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 100% 台风附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B14' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%台风附加费" onchange="TiaoKuanAll100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="台风附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="TiaoKuan100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">折扣</td>')

                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    //input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    //td.append(input);

                    tr.append(td);



                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var input = $('<input style="width:100px;" id="' + element_id + '" type="text" name="折扣" value="' + FormatPrice(GetFloatStr(price)) + '" onkeyup="DefaultTiaoKuan_ZheKou_InputChanged(this)"></input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9 3600BHP以上
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_3600BHP附加费" onchange="TiaoKuanAll3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="3600BHP附加费15" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');
                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="TiaoKuan3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'E80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')

                    var span = $('<br><span>燃油附加费</span>');
                    td.append(span);
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            //var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var unit_price_p = $('<p></p>');
                            var span = $('<span>单价(每小时):</span>');
                            unit_price_p.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费单价">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee)) + '</span>');
                            unit_price_p.append(span);
                            td.append(unit_price_p);

                            var p1 = $('<p>燃油附加费折扣</p>')
                            var input1 = $('<input style="width:100px;" type="text" name="燃油附加费折扣" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_119_C83' + '" value="' + FormatPrice(GetFloatStr(value[i].DiscoutPriceOfFeulFee)) + '" onkeyup="DefaultTiaoKuan_RanYouDiscout_InputChanged(this)">')
                            td.append(p1).append(input1);

                            var p2 = $('<p></p>')
                            span = $('<span>燃油附加费折扣后价格:</span>');
                            p2.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费折扣后价格">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee + value[i].DiscoutPriceOfFeulFee)) + '</span>');
                            p2.append(span);
                            td.append(p2);

                            var p3 = $('<p>燃油附加费额外费用</p>')
                            var input2 = $('<input style="width:100px;" type="text" name="燃油附加费额外费用" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_120_E81' + '" value="' + FormatPrice(GetFloatStr(value[i].PriceOfFeulFee - value[i].UnitPriceOfFeulFee)) + '" onkeyup="DefaultTiaoKuan_RanYouExtra_InputChanged(this)">')
                            td.append(p3).append(input2);

                            var p4 = $('<p><strong>燃油附加费</strong><p>')

                            var feul_fee = parseFloat(ConvertToRealPrice($(span).text())) + parseFloat(ConvertToRealPrice($(input2).val()));
                            var price_p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_22_E80' + '" name="燃油附加费">' + FormatPrice(GetFloatStr(feul_fee)) + '</p>');
                            td.append(p4).append(price_p);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_拖缆费" onchange="BanbaoAllTuoLanFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(price)) + '</td>');

                            tr.append(td);
                        }
                    }

                }

                tbody.append(tr);
            }



            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);

        }
    }

    function billingSchemeChanged(selectedValue) {

        $('#sel_billing_type').val(selectedValue.split('%')[1].split('~')[2]);

        $('#sel_time_type').val(selectedValue.split('%')[2].split('~')[2]);

        $('#add_ship_length_rules').val(selectedValue.split('%')[0].split('~')[3]);
        $('#add_ship_teus_rules').val(selectedValue.split('%')[0].split('~')[4]);

        btnClick();
    }

    function inputCheck(obj) {
        //return value.replace(/[^\d.]/g, '');
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //if (obj.value.trim().length == 0) {
        //    obj.value = 0;
        //}
        //obj.value;

    }

    function btnClick() {

        var selectedOrderRowIds = '', selectedOrderIds = '', orderIds = '';

        if (g_curSelectedOrderRowIds.length > 0) {
            selectedOrderRowIds = g_curSelectedOrderRowIds.split(',')
        }
        for (var i = 0; i < selectedOrderRowIds.length; ++i) {
            var dr = jQuery("#jqGrid_Order").jqGrid('getRowData', selectedOrderRowIds[i]);//得到该行的数据
            selectedOrderIds += dr.IDX + ','
        }

        if (selectedOrderIds.length > 0) {
            orderIds = selectedOrderIds.substr(0, selectedOrderIds.length - 1);
        }

        //var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据

        var customerBillingScheme = $("#sel_billing_scheme").val().toString();

        $('#txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        //alert(billingTypeId + " --- " + billingTypeValue + ' --- ' + billingTypeLabel);

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        //alert(timeTypeId + " --- " + timeTypeValue + ' --- ' + timeTypeLabel);

        var discount = $('#txt_discount').val();

        reGenerate2(orderIds, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount);
    }
</script>



<!--查看模态框-->
<script type="text/javascript">

    function ViewInvoice() {
        $('#view-modal').modal()
    }

    function initViewInvoiceModal() {
        $('#parentErrMsg').hide();

        g_view_cur_selected_tab = 0; //初始显示Tab 1，账单Tab
        $('#view_invoice_tab').addClass("active");
        $('#view_credit_tab').removeClass("active");

        $('#box_tab1').addClass("in active");
        $('#box_tab2').removeClass("in active");


        $('#view_sel_billing_scheme').attr('disabled', true);
        $('#view_sel_billing_type').attr('disabled', false);
        $('#view_sel_time_type').attr('disabled', false);

        $('#view_sel_billing_type').val("");
        $('#view_sel_time_type').val("");
        $('#view_sel_billing_scheme').empty();
        $('#view_div_services').empty();
        $('#view_tb_detail').empty();

        //var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据
        var rowid = $('#jqGrid').jqGrid('getGridParam', 'selrow');
        var dr = jQuery("#jqGrid").jqGrid('getRowData', rowid);//得到该行的数据
        var billingId = dr.IDX;  //账单ID

        $('#view_btn_voice_preview').show();

        //$('#view_customer').text(dr.CustomerName);
        //$('#view_customer_ship').text(dr.ShipName);


        $.ajax({
            type: "get",
            url: '@Url.Action("GetInvoice2", "Finance")',
            data: {
                'billingId': billingId
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {

                $('#view_sel_billing_scheme').empty();
                //$('#sel_billing_type').empty();
                //$('#sel_time_type').empty();
                $('#view_div_services').empty();
                $('#view_tb_detail').empty();

                $('#view_customer').text(result.invoice.CustomerName);
                $('#view_customer_ship').text(result.invoice.CustomerShipName);

                for (var i = 0; i < result.customer_billing_schemes.length; i++) {

                    if (result.customer_billing_schemes[i].ShipLength == null) { result.customer_billing_schemes[i].ShipLength = "" };
                    if (result.customer_billing_schemes[i].ShipTEUS == null) { result.customer_billing_schemes[i].ShipTEUS = "" };


                    //计费方案ID~计费折扣~客户Code~船长规则~箱量规则%计费方案模板类型ID~计费方案模板类型Value~计费方案模板类型Label%计费方案模板计时方式ID~计费方案模板计时方式Value~计费方案模板计时方式Label
                    //客户Code如果是字符串-1，则表示是非會員客戶的计费方案
                    var v = result.customer_billing_schemes[i].BillingTemplateIDX + '~' + result.customer_billing_schemes[i].Discount + '~' + result.customer_billing_schemes[i].CustomerCode + '~' + result.customer_billing_schemes[i].ShipLength + '~' + result.customer_billing_schemes[i].ShipTEUS
                        + "%"
                        + result.customer_billing_schemes[i].BillingTemplateTypeID + "~" + result.customer_billing_schemes[i].BillingTemplateTypeValue + "~" + result.customer_billing_schemes[i].BillingTemplateTypeLabel
                        + "%"
                        + result.customer_billing_schemes[i].TimeTypeID + "~" + result.customer_billing_schemes[i].TimeTypeValue + "~" + result.customer_billing_schemes[i].TimeTypeLabel;

                    option = $('<option value="' + v + '">' + result.customer_billing_schemes[i].BillingTemplateName + '</option>')
                    $('#view_sel_billing_scheme').append(option);

                    //alert(v)
                }

                if (result.billing_template.ShipLength == null) { result.billing_template.ShipLength = "" };
                if (result.billing_template.ShipTEUS == null) { result.billing_template.ShipTEUS = "" };
                var v = result.billing_template.BillingTemplateIDX + '~' + result.billing_template.Discount + '~' + result.billing_template.CustomerCode + '~' + result.billing_template.ShipLength + '~' + result.billing_template.ShipTEUS
                        + "%"
                        + result.billing_template.BillingTemplateTypeID + "~" + result.billing_template.BillingTemplateTypeValue + "~" + result.billing_template.BillingTemplateTypeLabel
                        + "%"
                        + result.billing_template.TimeTypeID + "~" + result.billing_template.TimeTypeValue + "~" + result.billing_template.TimeTypeLabel;

                //alert(v);
                $("#view_sel_billing_scheme").val(v);

                var customerBillingScheme = $("#view_sel_billing_scheme").val().toString();

                $('#view_txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])
                $('#view_sel_billing_type').val(customerBillingScheme.split('%')[1].split('~')[2]);
                $('#view_sel_time_type').val(customerBillingScheme.split('%')[2].split('~')[2]);

                $('#view_ship_length_rules').val(customerBillingScheme.split('%')[0].split('~')[3]);
                $('#view_ship_teus_rules').val(customerBillingScheme.split('%')[0].split('~')[4]);

                var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
                var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
                var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

                var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
                var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
                var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

                var discount = $('#view_txt_discount').val();

                $('#view_sel_month').val(result.invoice.Month);

                if (result.invoice.CustomerShipLength == 0) {
                    $('#view_customer_ship_length').val("");
                }
                else {
                    $('#view_customer_ship_length').val(result.invoice.CustomerShipLength);
                }

                if (result.invoice.CustomerShipTEUS == 0) {
                    $('#view_customer_ship_teus').val("");
                }
                else {
                    $('#view_customer_ship_teus').val(result.invoice.CustomerShipTEUS);
                }

                $('#view_job_no').val(result.invoice.JobNo);
                $('#view_remark').val(result.invoice.Rmark);

                if (result.invoice.IsShowShipLengthRule == "是") {
                    $('#view_ck_customer_ship_length').attr('checked', true);
                }
                else {
                    $('#view_ck_customer_ship_length').attr('checked', false);
                }

                if (result.invoice.IsShowShipTEUSRule == "是") {
                    $('#view_ck_customer_ship_teus').attr('checked', true);
                }
                else {
                    $('#view_ck_customer_ship_teus').attr('checked', false);
                }


                //alert(1);
                reGenerateViewTable(billingId, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel,
                    timeTypeId, timeTypeValue, timeTypeLabel, discount, result);

                //alert(dr.BillingID);
                initViewTabCredit(billingId);
            },
        });
    }

    $('#view-modal').on('show.bs.modal', function (e) {
        initViewInvoiceModal();


    });
    $('#view-modal').on('shown.bs.modal', function (e) {

    });
    $('#view-modal').on('hide.bs.modal', function () {

        $('#view_div_services').empty();
        $('#view_tb_detail').empty();
        $('#view_tb_detail').empty()

        $(this).removeData("bs.modal");
    });
    $('#view-modal').on('hidden.bs.modal', function () {
        $(this).removeData("bs.modal");
    });

</script>

<!--查看模态框里的生成报表-->
<script type="text/javascript">

    function reGenerateViewTable(orderId, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount, result) {

        $('#view_tb_detail').empty();

        {
            //$('#tb_detail').empty();
            $('#view_div_services').empty();

            var div1 = $('<div class="col-md-2"><p>服务项目:<br>SERVICE:</p></div>');
            var div2 = $('<div class="col-md-2"></div>');
            var div3 = $('<div class="col-md-3"></div>');
            var div4 = $('<div class="col-md-5"></div>')
            for (key in result.invoice.ServiceNature) {
                var value = result.invoice.ServiceNature[key];
                var p = $('<p>' + value.ServiceName + '</p>')
                div2.append(p);

                p = $('<p>' + value.ServiceWorkDate + '</p>');
                div3.append(p)

                p = $('<p>' + value.ServiceWorkPlace + '</p>');
                div4.append(p)

            }

            $('#view_div_services').append(div1).append(div2).append(div3).append(div4);

            //----生成表格

            //1.表头
            {
                var thead = $('<thead></thead>');
                var tr1 = $('<tr></tr>');
                var tr2 = $('<tr></tr>');
                var th = $('<th width="20%" rowspan="2" style="text-align:center;vertical-align:middle">拖轮</th>');
                tr1.append(th);

                for (key in result.invoice.ServiceNature) {
                    var value = result.invoice.ServiceNature[key];
                    //alert(result.invoice.Schedulers[key].length);
                    var th = $('<th width="" style="text-align:center;vertical-align:middle" colspan=' + result.invoice.Schedulers[key].length + '>' + value.ServiceName + '</th>');
                    tr1.append(th)
                }
                thead.append(tr1);

                var colspan = 0;
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        var th = $('<th width="" style="text-align:center;vertical-align:middle">' + value[i].TugCnName + '</th>');

                        var span1 = $('<span hidden>' + value[i].SchedulerID + '</span>');
                        th.append(span1);

                        tr2.append(th);
                        colspan++;
                    }
                }

                thead.append(tr2);
                $('#view_tb_detail').append(thead);
            }

            //2.表体
            DynamicGenerateViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);

            //3.表尾
            {
                var tfoot = $('<tfoot></tfoot>')
                var tr = $('<tr></tr>')

                if (colspan == 0) {
                    var td = $('<td colspan=' + colspan + ' style="text-align:center;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：&nbsp;&nbsp;&nbsp;&nbsp;' + GetFloatStr(result.invoice.GrandTotalHKS) + '<br> Grand Total HKS</strong></td>');
                    tr.append(td);
                }
                else {
                    var td1 = $('<td colspan=' + colspan + ' style="text-align:right;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>');
                    var td2 = $('<td id="GrandTotalHKS" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(result.invoice.GrandTotalHKS) + '</strong></td>');

                    tr.append(td1);
                    tr.append(td2);
                }
                tfoot.append(tr);

                $('#view_tb_detail').append(tfoot);
            }
        }
    }

    function DynamicGenerateViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //使用计费方案
        var customerCode = customerBillingScheme.split('%')[0].split('~')[2];
        if (customerCode == "-1") {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                DefaultQuanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
                DefaultBanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
                DefaultTiaoKuanViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }
        else {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                DefaultQuanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
                DefaultBanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
                DefaultTiaoKuanViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }

    }

    function QuanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + GetFloatStr(value[i].UnitPrice) + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].SubTotaHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].TotalHKs) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#view_tb_detail').append(tbody);
        }
    }

    function BanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "半包") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + GetFloatStr(value[i].Price) + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoTopCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    tr.append(td);


                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].SubTotaHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var checkbox = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="BanbaoMidCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                            td.append(checkbox);

                            //检查调度是否具有此收费项目
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if ((result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue)
                                    && value[i].BillingItems[j].Price != 0) {
                                    $(checkbox).attr('checked', true);
                                }
                            }

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>拖缆费单价(每小时)</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }



            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].TotalHKs) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#view_tb_detail').append(tbody);

        }
    }

    function TiaoKuanViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "计时") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="每小时收费" value="' + GetFloatStr(value[i].UnitPrice) + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(value[i].Price) + '</td>');

                        //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="正常收费" value="' + value[i].Price + '"></input>');
                        //td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanTopCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].SubTotaHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var checkbox = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="TiaoKuanMidCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                            td.append(checkbox);

                            //检查调度是否具有此收费项目
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if ((result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue)
                                    && value[i].BillingItems[j].Price != 0) {
                                    $(checkbox).attr('checked', true);
                                }
                            }

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>拖缆费单价(每小时)</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }



            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].TotalHKs) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#view_tb_detail').append(tbody);

        }

    }

    function DefaultQuanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //缺省全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].UnitPrice)) + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].DiscountSubTotalHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#view_tb_detail').append(tbody);
        }
    }

    function DefaultBanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "半包") {
            var tbody = $('<tbody></tbody>')

            //1离厂时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2回厂时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3工作时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4 换算耗时(h)
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5 协议收费
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {


                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].Price)) + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6 25%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B10' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="港外附加费20" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            //alert(price);
                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="Banbao20FuJiaFeiCheckboxChanged(this)" disabled checked>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="Banbao20FuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                        }
                    }
                }

                tbody.append(tr);
            }


            //7 50%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if ((result.items[ii].CustomValue == 'B11' && result.items[ii].FormulaStr.charAt(1) == '1')) {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            var consume_hour = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (121 == value[i].BillingItems[j].ItemID || "E82" == value[i].BillingItems[j].ItemValue) {
                                    consume_hour = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="18时至22时附加费50" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p);

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "121" + '_' + "E82";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="' + consume_hour + '" type="text" name="18时至22时附加费50耗时" onkeyup="DefaultBanbao_18时至22时附加费50_InputChanged(this)" placeholder="请输入小时数" disabled></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //8 100%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B12' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            var consume_hour = 0;
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                    }
                                }

                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (122 == value[i].BillingItems[j].ItemID || "E83" == value[i].BillingItems[j].ItemValue) {
                                    consume_hour = value[i].BillingItems[j].Price;
                            }
                        }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="22时至08时附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "122" + '_' + "E83";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="' + consume_hour + '" type="text" name="22时至08时附加费100耗时" onkeyup="DefaultBanbao_22时至08时附加费100_InputChanged(this)" placeholder="请输入小时数" disabled></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //9 100% 假日附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B13' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%假日附加费" onchange="BanbaoAll100JiaRiFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="假日附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="Banbao100JiaRiFuJiaFeiCheckboxChanged(this)" checked disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                            tr.append(td);
                        }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="Banbao100JiaRiFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                    }
                }
                    }
                }

                tbody.append(tr);
            }


            //10 100% 台风附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B14' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%台风附加费" onchange="BanbaoAll100TaiFengFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="台风附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="Banbao100TaiFengFuJiaFeiCheckboxChanged(this)" checked disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="Banbao100TaiFengFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                        }
                    }
                }

                tbody.append(tr);
            }

            //11 合计港币
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">折扣</td>')

                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var input = $('<input style="width:100px;" id="' + element_id + '" type="text" name="折扣" value="' + FormatPrice(GetFloatStr(price)) + '" onkeyup="DefaultBanbao_ZheKou_InputChanged(this)" disabled></input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //13 折扣后合计港币
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            //14 3600BHP以上
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_3600BHP附加费" onchange="BanbaoAll3600BHPFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="3600BHP附加费15" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');
                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="Banbao3600BHPFuJiaFeiCheckboxChanged(this)" checked disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                            tr.append(td);
                        }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="Banbao3600BHPFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                    }
                }
                    }
                }

                tbody.append(tr);
            }


            //15 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'E80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')

                    var span = $('<br><span>燃油附加费</span>');
                    td.append(span);
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var feulFee = 0;
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    feulFee = value[i].BillingItems[j].Price;
                                    }
                                }

                            //var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var unit_price_p = $('<p></p>');
                            var span = $('<span>单价(每小时):</span>');
                            unit_price_p.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费单价">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee)) + '</span>');
                            unit_price_p.append(span);
                            td.append(unit_price_p);


                            var feulFeeDiscount = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (119 == value[i].BillingItems[j].ItemID || "C83" == value[i].BillingItems[j].ItemValue) {
                                    feulFeeDiscount = value[i].BillingItems[j].Price;
                            }
                        }

                            var p1 = $('<p>燃油附加费折扣</p>')
                            var input1 = $('<input style="width:100px;" type="text" name="燃油附加费折扣" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_119_C83' + '" value="' + FormatPrice(GetFloatStr(feulFeeDiscount)) + '" onkeyup="DefaultBanbao_RanYouDiscout_InputChanged(this)" disabled>')
                            td.append(p1).append(input1);

                            var p2 = $('<p></p>')
                            span = $('<span>燃油附加费折扣后价格:</span>');
                            p2.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费折扣后价格">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee + parseFloat(ConvertToRealPrice($(input1).val())))) + '</span>');
                            p2.append(span);
                            td.append(p2);


                            var feulFeeExra = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (120 == value[i].BillingItems[j].ItemID || "E81" == value[i].BillingItems[j].ItemValue) {
                                    feulFeeExra = value[i].BillingItems[j].Price;
                                }
                            }
                            var p3 = $('<p>燃油附加费额外费用</p>')
                            var input2 = $('<input style="width:100px;" type="text" name="燃油附加费额外费用" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_120_E81' + '" value="' + FormatPrice(GetFloatStr(feulFeeExra)) + '" onkeyup="DefaultBanbao_RanYouExtra_InputChanged(this)" disabled>')
                            td.append(p3).append(input2);

                            var p4 = $('<p><strong>燃油附加费</strong><p>')

                            //var feul_fee = parseFloat(ConvertToRealPrice($(span).text())) + parseFloat(ConvertToRealPrice($(input2).val()));
                            var price_p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_22_E80' + '" name="燃油附加费">' + FormatPrice(GetFloatStr(feulFee)) + '</p>');
                            td.append(p4).append(price_p);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //16拖缆数量
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //17 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_拖缆费" onchange="BanbaoAllTuoLanFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(price)) + '</td>');

                            tr.append(td);
                        }
                    }

                }

                tbody.append(tr);
            }


            //18 总计港币
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            $('#view_tb_detail').append(tbody);

        }
    }

    function DefaultTiaoKuanViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //计时
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "计时") {
            var tbody = $('<tbody></tbody>')

            //1离厂时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2回厂时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3工作时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4 换算耗时(h)
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            ////5 协议收费
            //{
            //    var tr = $('<tr></tr>')
            //    var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
            //    tr.append(td);
            //    for (key in result.invoice.Schedulers) {

            //        var price = 0;

            //        var value = result.invoice.Schedulers[key];
            //        for (var i = 0; i < value.length; ++i) {


            //            td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

            //            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].Price)) + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)"></input>');

            //            td.append(input);

            //            tr.append(td)
            //        }
            //    }
            //    tbody.append(tr);
            //}



            //5 每小时收费
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {


                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="每小时收费" value="' + FormatPrice(GetFloatStr(value[i].UnitPrice)) + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5 正常收费
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(value[i].Price)) + '</td>');

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }



            //6 25%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B10' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="港外附加费20" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            //alert(price);
                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="Banbao20FuJiaFeiCheckboxChanged(this)" checked disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="Banbao20FuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                        }
                    }
                }

                tbody.append(tr);
            }


            //7 50%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if ((result.items[ii].CustomValue == 'B11' && result.items[ii].FormulaStr.charAt(1) == '1')) {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            var consume_hour = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (121 == value[i].BillingItems[j].ItemID || "E82" == value[i].BillingItems[j].ItemValue) {
                                    consume_hour = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="18时至22时附加费50" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p);

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "121" + '_' + "E82";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="' + consume_hour + '" type="text" name="18时至22时附加费50耗时" onkeyup="DefaultBanbao_18时至22时附加费50_InputChanged(this)" placeholder="请输入小时数" disabled></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //8 100%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B12' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            var consume_hour = 0;
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                    }
                                }

                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (122 == value[i].BillingItems[j].ItemID || "E83" == value[i].BillingItems[j].ItemValue) {
                                    consume_hour = value[i].BillingItems[j].Price;
                            }
                        }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="22时至08时附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "122" + '_' + "E83";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="' + consume_hour + '" type="text" name="22时至08时附加费100耗时" onkeyup="DefaultBanbao_22时至08时附加费100_InputChanged(this)" placeholder="请输入小时数" disabled></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //9 100% 假日附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B13' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%假日附加费" onchange="BanbaoAll100JiaRiFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="假日附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="Banbao100JiaRiFuJiaFeiCheckboxChanged(this)" checked disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                            tr.append(td);
                        }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="Banbao100JiaRiFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                    }
                }
                    }
                }

                tbody.append(tr);
            }


            //10 100% 台风附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B14' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%台风附加费" onchange="BanbaoAll100TaiFengFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="台风附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="Banbao100TaiFengFuJiaFeiCheckboxChanged(this)" checked disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="Banbao100TaiFengFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                        }
                    }
                }

                tbody.append(tr);
            }

            //11 合计港币
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">折扣</td>')

                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var input = $('<input style="width:100px;" id="' + element_id + '" type="text" name="折扣" value="' + FormatPrice(GetFloatStr(price)) + '" onkeyup="DefaultBanbao_ZheKou_InputChanged(this)" disabled></input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //13 折扣后合计港币
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            //14 3600BHP以上
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_3600BHP附加费" onchange="BanbaoAll3600BHPFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="3600BHP附加费15" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');
                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="Banbao3600BHPFuJiaFeiCheckboxChanged(this)" checked disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="Banbao3600BHPFuJiaFeiCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                            tr.append(td);
                        }
                    }
                }
                }

                tbody.append(tr);
            }


            //15 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'E80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')

                    var span = $('<br><span>燃油附加费</span>');
                    td.append(span);
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var feulFee = 0;
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    feulFee = value[i].BillingItems[j].Price;
                                    }
                                }

                            //var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var unit_price_p = $('<p></p>');
                            var span = $('<span>单价(每小时):</span>');
                            unit_price_p.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费单价">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee)) + '</span>');
                            unit_price_p.append(span);
                            td.append(unit_price_p);


                            var feulFeeDiscount = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (119 == value[i].BillingItems[j].ItemID || "C83" == value[i].BillingItems[j].ItemValue) {
                                    feulFeeDiscount = value[i].BillingItems[j].Price;
                            }
                        }

                            var p1 = $('<p>燃油附加费折扣</p>')
                            var input1 = $('<input style="width:100px;" type="text" name="燃油附加费折扣" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_119_C83' + '" value="' + FormatPrice(GetFloatStr(feulFeeDiscount)) + '" onkeyup="DefaultBanbao_RanYouDiscout_InputChanged(this)" disabled>')
                            td.append(p1).append(input1);

                            var p2 = $('<p></p>')
                            span = $('<span>燃油附加费折扣后价格:</span>');
                            p2.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费折扣后价格">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee + parseFloat(ConvertToRealPrice($(input1).val())))) + '</span>');
                            p2.append(span);
                            td.append(p2);


                            var feulFeeExra = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (120 == value[i].BillingItems[j].ItemID || "E81" == value[i].BillingItems[j].ItemValue) {
                                    feulFeeExra = value[i].BillingItems[j].Price;
                                }
                            }
                            var p3 = $('<p>燃油附加费额外费用</p>')
                            var input2 = $('<input style="width:100px;" type="text" name="燃油附加费额外费用" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_120_E81' + '" value="' + FormatPrice(GetFloatStr(feulFeeExra)) + '" onkeyup="DefaultBanbao_RanYouExtra_InputChanged(this)" disabled>')
                            td.append(p3).append(input2);

                            var p4 = $('<p><strong>燃油附加费</strong><p>')

                            //var feul_fee = parseFloat(ConvertToRealPrice($(span).text())) + parseFloat(ConvertToRealPrice($(input2).val()));
                            var price_p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_22_E80' + '" name="燃油附加费">' + FormatPrice(GetFloatStr(feulFee)) + '</p>');
                            td.append(p4).append(price_p);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //16拖缆数量
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //17 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_拖缆费" onchange="BanbaoAllTuoLanFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(price)) + '</td>');

                            tr.append(td);
                        }
                    }

                }

                tbody.append(tr);
            }


            //18 总计港币
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            $('#view_tb_detail').append(tbody);

        }
    }

    function view_billingSchemeChanged(selectedValue) {

        $('#view_sel_billing_type').val(selectedValue.split('%')[1].split('~')[2]);

        $('#view_sel_time_type').val(selectedValue.split('%')[2].split('~')[2]);

        view_btnClick();
    }

    function inputCheck(obj) {
        //return value.replace(/[^\d.]/g, '');
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //if (obj.value.trim().length == 0) {
        //    obj.value = 0;
        //}
        //obj.value;

    }

    function view_btnClick() {
        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据
        var customerBillingScheme = $("#sel_billing_scheme").val().toString();

        var orderDate = dr.OrdDate;

        $('#txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        //alert(billingTypeId + " --- " + billingTypeValue + ' --- ' + billingTypeLabel);

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        //alert(timeTypeId + " --- " + timeTypeValue + ' --- ' + timeTypeLabel);

        var discount = $('#txt_discount').val();

        reGenerate(dr.OrderID, orderDate, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount);
    }
</script>



<!--编辑模态框-->
<script type="text/javascript">
    var g_curRowId = '';

    function EditInvoice() {
        $('#edit-modal').modal()
    }

    function initEditInvoiceModal() {

        g_edit_cur_selected_tab = 0; //初始显示Tab 1，账单Tab
        $('#edit_invoice_tab').addClass("active");
        $('#edit_credit_tab').removeClass("active");

        $('#edit_box_tab1').addClass("in active");
        $('#edit_box_tab2').removeClass("in active");

        $('#parentErrMsg').hide();
        $('#edit_job_no').parent().removeClass("has-error");
        $('#edit_remark').parent().removeClass("has-error");

        $('#edit_sel_billing_scheme').attr('disabled', false);
        $('#edit_sel_billing_type').attr('disabled', false);
        $('#edit_sel_time_type').attr('disabled', false);

        $('#edit_btn_sumbit').attr('disabled', false);
        $('#edit_btn_sumbit').show();
        $('#edit_btn_voice_preview').attr('disabled', false);
        $('#edit_btn_voice_preview').show();

        $('#edit_sel_billing_type').val("");
        $('#edit_sel_time_type').val("");
        $('#edit_sel_billing_scheme').empty();
        $('#edit_div_services').empty();
        $('#edit_tb_detail').empty();

        var rowid = $('#jqGrid').jqGrid('getGridParam', 'selrow');
        var dr = jQuery("#jqGrid").jqGrid('getRowData', rowid);//得到该行的数据
        var billingId = dr.IDX;  //账单ID

        //$('#edit_customer').text(dr.CustomerName);
        //$('#edit_customer_ship').text(dr.ShipName);

        //$('#edit_customer_ship_length').val(dr.ShipLength);
        //$('#edit_customer_ship_teus').val(dr.ShipTEUS);

        //$('#edit_job_no').val(dr.JobNo);
        //$('#edit_remark').val(dr.BillingRemark);


        $.ajax({
            type: "get",
            url: '@Url.Action("GetInvoice2", "Finance")',
            data: {
                'billingId': billingId
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {

                $('#edit_sel_billing_scheme').empty();
                //$('#sel_billing_type').empty();
                //$('#sel_time_type').empty();
                $('#edit_div_services').empty();
                $('#edit_tb_detail').empty();

                //alert(result.invoice.OrderIDs);
                $('#_edit_orderids').text(result.invoice.OrderIDs);

                $('#edit_customer').text(result.invoice.CustomerName);
                $('#edit_customer_ship').text(result.invoice.CustomerShipName);

                for (var i = 0; i < result.customer_billing_schemes.length; i++) {

                    //计费方案ID~计费折扣~客户Code~船长规则~箱量规则%计费方案模板类型ID~计费方案模板类型Value~计费方案模板类型Label%计费方案模板计时方式ID~计费方案模板计时方式Value~计费方案模板计时方式Label
                    //客户Code如果是字符串-1，则表示是非會員客戶的计费方案

                    if (result.customer_billing_schemes[i].ShipLength == null) { result.customer_billing_schemes[i].ShipLength = "" };
                    if (result.customer_billing_schemes[i].ShipTEUS == null) { result.customer_billing_schemes[i].ShipTEUS = "" };

                    var v = result.customer_billing_schemes[i].BillingTemplateIDX + '~' + result.customer_billing_schemes[i].Discount + '~' + result.customer_billing_schemes[i].CustomerCode + '~' + result.customer_billing_schemes[i].ShipLength + '~' + result.customer_billing_schemes[i].ShipTEUS
                        + "%"
                        + result.customer_billing_schemes[i].BillingTemplateTypeID + "~" + result.customer_billing_schemes[i].BillingTemplateTypeValue + "~" + result.customer_billing_schemes[i].BillingTemplateTypeLabel
                        + "%"
                        + result.customer_billing_schemes[i].TimeTypeID + "~" + result.customer_billing_schemes[i].TimeTypeValue + "~" + result.customer_billing_schemes[i].TimeTypeLabel;

                    option = $('<option value="' + v + '">' + result.customer_billing_schemes[i].BillingTemplateName + '</option>')
                    $('#edit_sel_billing_scheme').append(option);

                }

                if (result.billing_template.ShipLength == null) { result.billing_template.ShipLength = "" };
                if (result.billing_template.ShipTEUS == null) { result.billing_template.ShipTEUS = "" };
                var v = result.billing_template.BillingTemplateIDX + '~' + result.billing_template.Discount + '~' + result.billing_template.CustomerCode + '~' + result.billing_template.ShipLength + '~' + result.billing_template.ShipTEUS
                        + "%"
                        + result.billing_template.BillingTemplateTypeID + "~" + result.billing_template.BillingTemplateTypeValue + "~" + result.billing_template.BillingTemplateTypeLabel
                        + "%"
                        + result.billing_template.TimeTypeID + "~" + result.billing_template.TimeTypeValue + "~" + result.billing_template.TimeTypeLabel;

                $("#edit_sel_billing_scheme").val(v);

                var customerBillingScheme = $("#edit_sel_billing_scheme").val().toString();

                $('#edit_txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])
                $('#edit_sel_billing_type').val(customerBillingScheme.split('%')[1].split('~')[2]);
                $('#edit_sel_time_type').val(customerBillingScheme.split('%')[2].split('~')[2]);

                $('#edit_ship_length_rules').val(result.billing_template.ShipLength);
                $('#edit_ship_teus_rules').val(result.billing_template.ShipTEUS);

                var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
                var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
                var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

                var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
                var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
                var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

                var discount = $('#edit_txt_discount').val();

                $('#edit_sel_month').val(result.invoice.Month);

                if (result.invoice.CustomerShipLength == 0) {
                    $('#edit_customer_ship_length').val("");
                }
                else {
                    $('#edit_customer_ship_length').val(result.invoice.CustomerShipLength);
                }

                if (result.invoice.CustomerShipTEUS == 0) {
                    $('#edit_customer_ship_teus').val("");
                }
                else {
                    $('#edit_customer_ship_teus').val(result.invoice.CustomerShipTEUS);
                }

                $('#edit_job_no').val(result.invoice.JobNo);
                $('#edit_remark').val(result.invoice.Rmark);

                if (result.invoice.IsShowShipLengthRule == "是") {
                    $('#edit_ck_customer_ship_length').attr('checked', true);
                }
                else {
                    $('#edit_ck_customer_ship_length').attr('checked', false);
                }

                if (result.invoice.IsShowShipTEUSRule == "是") {
                    $('#edit_ck_customer_ship_teus').attr('checked', true);
                }
                else {
                    $('#edit_ck_customer_ship_teus').attr('checked', false);
                }

                initGenerateEditTable(billingId, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel,
                    timeTypeId, timeTypeValue, timeTypeLabel, discount, result);

                //alert(dr.BillingID);
                initEditTabCredit(billingId);
            },
        });
    }

    $('#edit-modal').on('show.bs.modal', function (e) {
        initEditInvoiceModal();
    });
    $('#edit-modal').on('shown.bs.modal', function (e) {

    });
    $('#edit-modal').on('hide.bs.modal', function () {

        $('#edit_div_services').empty();
        $('#edit_tb_detail').empty();
        $('#edit_tb_detail').empty();

        $(this).removeData("bs.modal");
    });
    $('#edit-modal').on('hidden.bs.modal', function () {
        $(this).removeData("bs.modal");
    });

    function submitEditVoiceModal() {
        $('#parentErrMsg').hide();


        if (g_edit_cur_selected_tab == 0) {
            $('#edit_job_no').parent().removeClass("has-error");
            $('#edit_remark').parent().removeClass("has-error");
            submitEditInvoice();
        }
        else {
            submitEditCredit();
        }

    }


    function submitEditInvoice() {
        //提交数据库

        var maxTextLength = 50;
        var maxTextAreaLength = 500;

        var rowid = $('#jqGrid').jqGrid('getGridParam', 'selrow');
        var dr = jQuery("#jqGrid").jqGrid('getRowData', rowid);//得到该行的数据
        var billingId = dr.IDX;  //账单ID


        var customerBillingScheme = $("#edit_sel_billing_scheme").val().toString();

        var billingTemplateId = customerBillingScheme.split('%')[0].split('~')[0];

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        var discount = $('#edit_txt_discount').val();
        var amount = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text()));


        var jobNo = $('#edit_job_no').val().toString().trim();
        var remark = $('#edit_remark').val().toString().trim();

        var isShowShipLengthRule = "否";
        if (true == $('input[type="checkbox"][id="add_ck_customer_ship_length"]').is(":checked"))
            isShowShipLengthRule = "是";

        var isShowShipTEUSRule = "否";
        if (true == $('input[type="checkbox"][id="add_ck_customer_ship_teus"]').is(":checked"))
            isShowShipTEUSRule = "是";

        var month = $('#edit_sel_month').val();

        @*if (jobNo.length <= 0) {
            $('#edit_job_no').parent().addClass("has-error");
            alert('@Resources.Language.V_OrderBilling_JobNo' + "必填");
            return;
        }*@
        if (jobNo.length > maxTextLength) {
            $('#edit_job_no').parent().addClass("has-error");
            alert('@Resources.Language.V_OrderBilling_JobNo' + "长度不能超过" + maxTextLength);
            return;
        }

        if (remark.length > maxTextLength) {
            $('#edit_remark').parent().addClass("has-error");
            alert('@Resources.Language.Remark' + "长度不能超过" + maxTextAreaLength);
            return;
        }


        var jsonArrayItems, jsonArraySummaryItems;
        if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
            var ret = CheckQuanBaoTBodyData();
            if (ret == false) {
                alert("存在无效数据，请检查是否有未输入的数据");
                return;
            }

            var array = GetQuanBaoTBodyData();
            jsonArrayItems = JSON.stringify(array);

            array = GetQuanBaoSummaryItems();
            jsonArraySummaryItems = JSON.stringify(array);

        }
        if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
            var ret = CheckBanBaoTBodyData();

            if (ret == false) {
                alert("存在无效数据，请检查是否有未输入的数据");
                return;
            }
            var array = GetBanBaoTBodyData();
            jsonArrayItems = JSON.stringify(array);

            array = GetBanBaoSummaryItems();
            jsonArraySummaryItems = JSON.stringify(array);
        }
        if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
            var ret = CheckTiaoKuanTBodyData();
            if (ret == false) {
                alert("存在无效数据，请检查是否有未输入的数据");
                return;
            }
            var array = GetTiaoKuanTBodyData();
            jsonArrayItems = JSON.stringify(array);

            array = GetTiaoKuanSummaryItems();
            jsonArraySummaryItems = JSON.stringify(array);
        }
        $("#edit_btn_sumbit").attr("disabled", true);

        $.ajax({
            url: '@Url.Action("EditInvoice2", "Finance")',
            type: "POST",
            data: {
                'billingId': billingId,
                'billingTemplateId': billingTemplateId,
                'billingTypeId': billingTypeId,
                'timeTypeId': timeTypeId,
                'jobNo': jobNo,
                'remark': remark,
                'discount': discount,
                'amount': amount,
                'month': month,
                'isShowShipLengthRule': isShowShipLengthRule,
                'isShowShipTEUSRule':isShowShipTEUSRule,
                'jsonArrayItems': jsonArrayItems,
                'jsonArraySummaryItems': jsonArraySummaryItems
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {
                //$('#edit-modal').modal('hide')
                alert(result.message);

                $("#edit_btn_sumbit").attr("disabled", false);

                if (result.code == '@Resources.Common.SUCCESS_CODE') {

                    $('#jqGrid_Order').jqGrid('setGridParam',
                {
                    datatype: 'json',
                        url: '@Url.Action("GetDataOfGenerateInvoicce", "OrderManage")',
                }).trigger('reloadGrid');

                    $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');


                    //$('#jqGrid_ilAdd').addClass('ui-state-disabled');
                    $('#jqGrid_ilDelete').addClass('ui-state-disabled');
                    $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
                    $('#jqGrid_ilView').addClass('ui-state-disabled');
                    $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                    $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                    //$('#jqGrid_ilReport').addClass('ui-state-disabled');

                    $("#edit_btn_sumbit").attr("disabled", true);
                }
                else {
                    $("#edit_btn_sumbit").attr("disabled", false);
                }
            },

            error: function (xhr) {
                $("#edit_btn_sumbit").attr("disabled", false);
            }
        });
    }


    function submitEditCredit() {
        $('#edit-modal').modal('hide');
    }


</script>

<!--编辑模态框里的生成报表-->
<script type="text/javascript">

    function initGenerateEditTable(billingId, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount, result) {

        $('#edit_tb_detail').empty();

        {

                //$('#tb_detail').empty();
                $('#edit_div_services').empty();

                var div1 = $('<div class="col-md-2"><p>服务项目:<br>SERVICE:</p></div>');
                var div2 = $('<div class="col-md-2"></div>');
                var div3 = $('<div class="col-md-3"></div>');
                var div4 = $('<div class="col-md-5"></div>')
                for (key in result.invoice.ServiceNature) {
                    var value = result.invoice.ServiceNature[key];
                    var p = $('<p>' + value.ServiceName + '</p>')
                    div2.append(p);

                    p = $('<p>' + value.ServiceWorkDate + '</p>');
                    div3.append(p)

                    p = $('<p>' + value.ServiceWorkPlace + '</p>');
                    div4.append(p)

                }

                $('#edit_div_services').append(div1).append(div2).append(div3).append(div4);

                //----生成表格

                //1.表头
                {
                    var thead = $('<thead></thead>');
                    var tr1 = $('<tr></tr>');
                    var tr2 = $('<tr></tr>');
                    var th = $('<th width="20%" rowspan="2" style="text-align:center;vertical-align:middle">拖轮</th>');
                    tr1.append(th);

                    for (key in result.invoice.ServiceNature) {
                        var value = result.invoice.ServiceNature[key];
                        //alert(result.invoice.Schedulers[key].length);
                        var th = $('<th width="" style="text-align:center;vertical-align:middle" colspan=' + result.invoice.Schedulers[key].length + '>' + value.ServiceName + '</th>');
                        tr1.append(th)
                    }
                    thead.append(tr1);

                    var colspan = 0;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {
                            var th = $('<th width="" style="text-align:center;vertical-align:middle">' + value[i].TugCnName + '</th>');

                            var span1 = $('<span hidden>' + value[i].SchedulerID + '</span>');
                            th.append(span1);

                            tr2.append(th);
                            colspan++;
                        }
                    }

                    thead.append(tr2);
                    $('#edit_tb_detail').append(thead);
                }

                //2.表体
                DynamicGenerateEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);

                //3.表尾
                {
                    var tfoot = $('<tfoot></tfoot>')
                    var tr = $('<tr></tr>')

                    if (colspan == 0) {
                        var td = $('<td colspan=' + colspan + ' style="text-align:center;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：&nbsp;&nbsp;&nbsp;&nbsp;' + GetFloatStr(result.invoice.GrandTotalHKS) + '<br> Grand Total HKS</strong></td>');
                        tr.append(td);
                    }
                    else {
                        var td1 = $('<td colspan=' + colspan + ' style="text-align:right;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>');
                        var td2 = $('<td id="GrandTotalHKS" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(result.invoice.GrandTotalHKS) + '</strong></td>');

                        tr.append(td1);
                        tr.append(td2);
                    }
                    tfoot.append(tr);

                    $('#edit_tb_detail').append(tfoot);
                }
        }

    }

    function reGenerateEditTable(orderIds, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount, result) {

        $('#edit_tb_detail').empty();


        $.ajax({
            type: "post",
            url: '@Url.Action("NewInvoice2", "Finance")',
            data: {
                'orderIds': orderIds,
                'customerBillingScheme': customerBillingScheme,
                'billingTypeId': billingTypeId,
                'billingTypeValue': billingTypeValue,
                'billingTypeLabel': billingTypeLabel,
                'timeTypeId': timeTypeId,
                'timeTypeValue': timeTypeValue,
                'timeTypeLabel': timeTypeLabel,
                'discount': discount
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {

            //$('#tb_detail').empty();
            $('#edit_div_services').empty();

        var div1 = $('<div class="col-md-2"><p>服务项目:<br>SERVICE:</p></div>');
        var div2 = $('<div class="col-md-2"></div>');
        var div3 = $('<div class="col-md-3"></div>');
        var div4 = $('<div class="col-md-5"></div>')
        for (key in result.invoice.ServiceNature) {
            var value = result.invoice.ServiceNature[key];
            var p = $('<p>' + value.ServiceName + '</p>')
            div2.append(p);

            p = $('<p>' + value.ServiceWorkDate + '</p>');
            div3.append(p)

            p = $('<p>' + value.ServiceWorkPlace + '</p>');
            div4.append(p)

        }

        $('#edit_div_services').append(div1).append(div2).append(div3).append(div4);

        //----生成表格

        //1.表头
        {
            var thead = $('<thead></thead>');
            var tr1 = $('<tr></tr>');
            var tr2 = $('<tr></tr>');
            var th = $('<th width="20%" rowspan="2" style="text-align:center;vertical-align:middle">拖轮</th>');
            tr1.append(th);

            for (key in result.invoice.ServiceNature) {
                var value = result.invoice.ServiceNature[key];
                //alert(result.invoice.Schedulers[key].length);
                var th = $('<th width="" style="text-align:center;vertical-align:middle" colspan=' + result.invoice.Schedulers[key].length + '>' + value.ServiceName + '</th>');
                tr1.append(th)
            }
            thead.append(tr1);

            var colspan = 0;
            for (key in result.invoice.Schedulers) {

                var value = result.invoice.Schedulers[key];
                for (var i = 0; i < value.length; ++i) {
                    var th = $('<th width="" style="text-align:center;vertical-align:middle">' + value[i].TugCnName + '</th>');

                    var span1 = $('<span hidden>' + value[i].SchedulerID + '</span>');
                    th.append(span1);

                    tr2.append(th);
                    colspan++;
                }
            }

            thead.append(tr2);
            $('#edit_tb_detail').append(thead);
        }

        //2.表体
                DynamicGenerateEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);

        //3.表尾
        {
            var tfoot = $('<tfoot></tfoot>')
            var tr = $('<tr></tr>')

            if (colspan == 0) {
                var td = $('<td colspan=' + colspan + ' style="text-align:center;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：&nbsp;&nbsp;&nbsp;&nbsp;' + GetFloatStr(result.invoice.GrandTotalHKS) + '<br> Grand Total HKS</strong></td>');
                tr.append(td);
            }
            else {
                var td1 = $('<td colspan=' + colspan + ' style="text-align:right;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>');
                var td2 = $('<td id="GrandTotalHKS" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(result.invoice.GrandTotalHKS) + '</strong></td>');

                tr.append(td1);
                tr.append(td2);
            }
            tfoot.append(tr);

            $('#edit_tb_detail').append(tfoot);
        }
            },
        });

    }

    function DynamicGenerateEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //使用计费方案
        var customerCode = customerBillingScheme.split('%')[0].split('~')[2];
        if (customerCode == "-1") {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                DefaultQuanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
                DefaultBanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
                DefaultTiaoKuanEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }
        else {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                DefaultQuanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
                DefaultBanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
                DefaultTiaoKuanEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }

    }

    function DynamicGenerateEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //使用计费方案
        var customerCode = customerBillingScheme.split('%')[0].split('~')[2];
        if (customerCode == "-1") {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                QuanBaoEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
                BanBaoEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
                TiaoKuanEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }
        else {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                //QuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
                QuanBaoEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
                //BanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
                BanBaoEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
                //TiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
                TiaoKuanEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }

    }


    



    function QuanBaoEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //缺省全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].UnitPrice)) + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].DiscountSubTotalHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#edit_tb_detail').append(tbody);
        }
    }

    function BanBaoEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //缺省半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "半包") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {


                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].Price)) + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6 25%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B10' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="港外附加费20" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="Banbao20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7 50%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B11' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="18时至22时附加费50" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "121" + '_' + "E82";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="0" type="text" name="18时至22时附加费50耗时" onkeyup="DefaultBanbao_18时至22时附加费50_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                    tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8 100%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B12' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="22时至08时附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "122" + '_' + "E83";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="0" type="text" name="22时至08时附加费100耗时" onkeyup="DefaultBanbao_22时至08时附加费100_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //9 100% 假日附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B13' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%假日附加费" onchange="BanbaoAll100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="假日附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="Banbao100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                                    }
                                }
                            }

                tbody.append(tr);
                        }

            //10 100% 台风附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B14' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%台风附加费" onchange="BanbaoAll100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="台风附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="Banbao100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">折扣</td>')

                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var input = $('<input style="width:100px;" id="' + element_id + '" type="text" name="折扣" value="' + FormatPrice(GetFloatStr(price)) + '" onkeyup="DefaultBanbao_ZheKou_InputChanged(this)"></input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9 3600BHP以上
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_3600BHP附加费" onchange="BanbaoAll3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="3600BHP附加费15" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');
                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="Banbao3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'E80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')

                    var span = $('<br><span>燃油附加费</span>');
                    td.append(span);
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            //var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var unit_price_p = $('<p></p>');
                            var span = $('<span>单价(每小时):</span>');
                            unit_price_p.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费单价">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee)) + '</span>');
                            unit_price_p.append(span);
                            td.append(unit_price_p);

                            var p1 = $('<p>燃油附加费折扣</p>')
                            var input1 = $('<input style="width:100px;" type="text" name="燃油附加费折扣" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_119_C83' + '" value="' + FormatPrice(GetFloatStr(value[i].DiscoutPriceOfFeulFee)) + '" onkeyup="DefaultBanbao_RanYouDiscout_InputChanged(this)">')
                            td.append(p1).append(input1);

                            var p2 = $('<p></p>')
                            span = $('<span>燃油附加费折扣后价格:</span>');
                            p2.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费折扣后价格">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee + value[i].DiscoutPriceOfFeulFee)) + '</span>');
                            p2.append(span);
                            td.append(p2);

                            var p3 = $('<p>燃油附加费额外费用</p>')
                            var input2 = $('<input style="width:100px;" type="text" name="燃油附加费额外费用" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_120_E81' + '" value="' + FormatPrice(GetFloatStr(value[i].PriceOfFeulFee - value[i].UnitPriceOfFeulFee)) + '" onkeyup="DefaultBanbao_RanYouExtra_InputChanged(this)">')
                            td.append(p3).append(input2);

                            var p4 = $('<p><strong>燃油附加费</strong><p>')

                            var feul_fee = parseFloat(ConvertToRealPrice($(span).text())) + parseFloat(ConvertToRealPrice($(input2).val()));
                            var price_p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_22_E80' + '" name="燃油附加费">' + FormatPrice(GetFloatStr(feul_fee)) + '</p>');
                            td.append(p4).append(price_p);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_拖缆费" onchange="BanbaoAllTuoLanFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(price)) + '</td>');

                            tr.append(td);
                        }
                    }

                }

                tbody.append(tr);
            }



            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#edit_tb_detail').append(tbody);

        }
    }

    function TiaoKuanEditTableNewTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "计时") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5 每小时收费
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {


                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="每小时收费" value="' + FormatPrice(GetFloatStr(value[i].UnitPrice)) + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5 正常收费
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(value[i].Price)) + '</td>');

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6 25%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B10' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="TiaoKuanAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="港外附加费20" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="TiaoKuan20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7 50%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B11' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="18时至22时附加费50" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "121" + '_' + "E82";

                            var input = $('<input style="width:100px;" id="' + element_id + '" value="0" type="text" name="18时至22时附加费50耗时" onkeyup="DefaultTiaoKuan_18时至22时附加费50_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                    tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8 100%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B12' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="22时至08时附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "122" + '_' + "E83";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="0" type="text" name="22时至08时附加费100耗时" onkeyup="DefaultTiaoKuan_22时至08时附加费100_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //9 100% 假日附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B13' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%假日附加费" onchange="TiaoKuanAll100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="假日附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="TiaoKuan100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                                    }
                                }
                            }

                tbody.append(tr);
                        }

            //10 100% 台风附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B14' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%台风附加费" onchange="TiaoKuanAll100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="台风附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="TiaoKuan100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">折扣</td>')

                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    //input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + GetFloatStr(unitPrice) + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    //td.append(input);

                    tr.append(td);



                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(price) + '</td>');

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var input = $('<input style="width:100px;" id="' + element_id + '" type="text" name="折扣" value="' + FormatPrice(GetFloatStr(price)) + '" onkeyup="DefaultTiaoKuan_ZheKou_InputChanged(this)"></input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9 3600BHP以上
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_3600BHP附加费" onchange="TiaoKuanAll3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="3600BHP附加费15" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');
                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="TiaoKuan3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'E80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')

                    var span = $('<br><span>燃油附加费</span>');
                    td.append(span);
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            //var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var unit_price_p = $('<p></p>');
                            var span = $('<span>单价(每小时):</span>');
                            unit_price_p.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费单价">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee)) + '</span>');
                            unit_price_p.append(span);
                            td.append(unit_price_p);

                            var p1 = $('<p>燃油附加费折扣</p>')
                            var input1 = $('<input style="width:100px;" type="text" name="燃油附加费折扣" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_119_C83' + '" value="' + FormatPrice(GetFloatStr(value[i].DiscoutPriceOfFeulFee)) + '" onkeyup="DefaultTiaoKuan_RanYouDiscout_InputChanged(this)">')
                            td.append(p1).append(input1);

                            var p2 = $('<p></p>')
                            span = $('<span>燃油附加费折扣后价格:</span>');
                            p2.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费折扣后价格">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee + value[i].DiscoutPriceOfFeulFee)) + '</span>');
                            p2.append(span);
                            td.append(p2);

                            var p3 = $('<p>燃油附加费额外费用</p>')
                            var input2 = $('<input style="width:100px;" type="text" name="燃油附加费额外费用" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_120_E81' + '" value="' + FormatPrice(GetFloatStr(value[i].PriceOfFeulFee - value[i].UnitPriceOfFeulFee)) + '" onkeyup="DefaultTiaoKuan_RanYouExtra_InputChanged(this)">')
                            td.append(p3).append(input2);

                            var p4 = $('<p><strong>燃油附加费</strong><p>')

                            var feul_fee = parseFloat(ConvertToRealPrice($(span).text())) + parseFloat(ConvertToRealPrice($(input2).val()));
                            var price_p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_22_E80' + '" name="燃油附加费">' + FormatPrice(GetFloatStr(feul_fee)) + '</p>');
                            td.append(p4).append(price_p);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_拖缆费" onchange="BanbaoAllTuoLanFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(price)) + '</td>');

                            tr.append(td);
                        }
                    }

                }

                tbody.append(tr);
            }



            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#edit_tb_detail').append(tbody);

        }
    }





    function DefaultQuanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //缺省全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].UnitPrice)) + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].DiscountSubTotalHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#edit_tb_detail').append(tbody);
        }
    }

    function DefaultBanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "半包") {
            var tbody = $('<tbody></tbody>')

            //1离厂时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2回厂时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3工作时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4 换算耗时(h)
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5 协议收费
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {


                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].Price)) + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6 25%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B10' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="港外附加费20" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            //alert(price);
                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="Banbao20FuJiaFeiCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="Banbao20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                        }
                    }
                }

                tbody.append(tr);
            }


            //7 50%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if ((result.items[ii].CustomValue == 'B11' && result.items[ii].FormulaStr.charAt(1) == '1')) {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            var consume_hour = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (121 == value[i].BillingItems[j].ItemID || "E82" == value[i].BillingItems[j].ItemValue) {
                                    consume_hour = value[i].BillingItems[j].Price;
                                }
                            }                       

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="18时至22时附加费50" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p);

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "121" + '_' + "E82";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="' + consume_hour + '" type="text" name="18时至22时附加费50耗时" onkeyup="DefaultBanbao_18时至22时附加费50_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //8 100%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B12' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            var consume_hour = 0;
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                    }
                                }

                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (122 == value[i].BillingItems[j].ItemID || "E83" == value[i].BillingItems[j].ItemValue) {
                                    consume_hour = value[i].BillingItems[j].Price;
                            }
                        }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="22时至08时附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "122" + '_' + "E83";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="' + consume_hour + '" type="text" name="22时至08时附加费100耗时" onkeyup="DefaultBanbao_22时至08时附加费100_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //9 100% 假日附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B13' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%假日附加费" onchange="BanbaoAll100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="假日附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="Banbao100JiaRiFuJiaFeiCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                            tr.append(td);
                        }
                            else{
                                var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="Banbao100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                    }
                }
                    }
                }

                tbody.append(tr);
            }


            //10 100% 台风附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B14' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%台风附加费" onchange="BanbaoAll100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="台风附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="Banbao100TaiFengFuJiaFeiCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="Banbao100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                        }
                    }
                }

                tbody.append(tr);
            }

            //11 合计港币
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">折扣</td>')

                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var input = $('<input style="width:100px;" id="' + element_id + '" type="text" name="折扣" value="' + FormatPrice(GetFloatStr(price)) + '" onkeyup="DefaultBanbao_ZheKou_InputChanged(this)"></input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //13 折扣后合计港币
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            //14 3600BHP以上
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_3600BHP附加费" onchange="BanbaoAll3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="3600BHP附加费15" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');
                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="Banbao3600BHPFuJiaFeiCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                            tr.append(td);
                        }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="Banbao3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                    }
                }
                    }
                }

                tbody.append(tr);
            }


            //15 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'E80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')

                    var span = $('<br><span>燃油附加费</span>');
                    td.append(span);
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var feulFee = 0;
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    feulFee = value[i].BillingItems[j].Price;
                                    }
                                }

                            //var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var unit_price_p = $('<p></p>');
                            var span = $('<span>单价(每小时):</span>');
                            unit_price_p.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费单价">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee)) + '</span>');
                            unit_price_p.append(span);
                            td.append(unit_price_p);


                            var feulFeeDiscount = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (119 == value[i].BillingItems[j].ItemID || "C83" == value[i].BillingItems[j].ItemValue) {
                                    feulFeeDiscount = value[i].BillingItems[j].Price;
                            }
                        }

                            var p1 = $('<p>燃油附加费折扣</p>')
                            var input1 = $('<input style="width:100px;" type="text" name="燃油附加费折扣" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_119_C83' + '" value="' + FormatPrice(GetFloatStr(feulFeeDiscount)) + '" onkeyup="DefaultBanbao_RanYouDiscout_InputChanged(this)">')
                            td.append(p1).append(input1);

                            var p2 = $('<p></p>')
                            span = $('<span>燃油附加费折扣后价格:</span>');
                            p2.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费折扣后价格">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee + parseFloat(ConvertToRealPrice($(input1).val())))) + '</span>');
                            p2.append(span);
                            td.append(p2);


                            var feulFeeExra = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (120 == value[i].BillingItems[j].ItemID || "E81" == value[i].BillingItems[j].ItemValue) {
                                    feulFeeExra = value[i].BillingItems[j].Price;
                                }
                            }
                            var p3 = $('<p>燃油附加费额外费用</p>')
                            var input2 = $('<input style="width:100px;" type="text" name="燃油附加费额外费用" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_120_E81' + '" value="' + FormatPrice(GetFloatStr(feulFeeExra)) + '" onkeyup="DefaultBanbao_RanYouExtra_InputChanged(this)">')
                            td.append(p3).append(input2);

                            var p4 = $('<p><strong>燃油附加费</strong><p>')

                            //var feul_fee = parseFloat(ConvertToRealPrice($(span).text())) + parseFloat(ConvertToRealPrice($(input2).val()));
                            var price_p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_22_E80' + '" name="燃油附加费">' + FormatPrice(GetFloatStr(feulFee)) + '</p>');
                            td.append(p4).append(price_p);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //16拖缆数量
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //17 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_拖缆费" onchange="BanbaoAllTuoLanFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(price)) + '</td>');

                            tr.append(td);
                        }
                    }

                }

                tbody.append(tr);
            }


            //18 总计港币
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            $('#edit_tb_detail').append(tbody);

        }
    }

    function DefaultTiaoKuanEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        
        //计时
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "计时") {
            var tbody = $('<tbody></tbody>')

            //1离厂时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2回厂时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3工作时间
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4 换算耗时(h)
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            ////5 协议收费
            //{
            //    var tr = $('<tr></tr>')
            //    var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
            //    tr.append(td);
            //    for (key in result.invoice.Schedulers) {

            //        var price = 0;

            //        var value = result.invoice.Schedulers[key];
            //        for (var i = 0; i < value.length; ++i) {


            //            td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

            //            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="协议收费" value="' + FormatPrice(GetFloatStr(value[i].Price)) + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)"></input>');

            //            td.append(input);

            //            tr.append(td)
            //        }
            //    }
            //    tbody.append(tr);
            //}



            //5 每小时收费
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {


                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input style="width:100px;" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" type="text" name="每小时收费" value="' + FormatPrice(GetFloatStr(value[i].UnitPrice)) + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5 正常收费
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(value[i].Price)) + '</td>');

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }



            //6 25%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B10' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_20%港外附加费" onchange="BanbaoAll20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="港外附加费20" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            //alert(price);
                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="Banbao20FuJiaFeiCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="港外附加费20" onchange="Banbao20FuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                        }
                    }
                }

                tbody.append(tr);
            }


            //7 50%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if ((result.items[ii].CustomValue == 'B11' && result.items[ii].FormulaStr.charAt(1) == '1')) {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            var consume_hour = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (121 == value[i].BillingItems[j].ItemID || "E82" == value[i].BillingItems[j].ItemValue) {
                                    consume_hour = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="18时至22时附加费50" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p);

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "121" + '_' + "E82";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="' + consume_hour + '" type="text" name="18时至22时附加费50耗时" onkeyup="DefaultBanbao_18时至22时附加费50_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //8 100%港外附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B12' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            var consume_hour = 0;
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                    }
                                }

                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (122 == value[i].BillingItems[j].ItemID || "E83" == value[i].BillingItems[j].ItemValue) {
                                    consume_hour = value[i].BillingItems[j].Price;
                            }
                        }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="22时至08时附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(0) + '</p>');

                            td.append(p)

                            element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + "122" + '_' + "E83";
                            var input = $('<input style="width:100px;" id="' + element_id + '" value="' + consume_hour + '" type="text" name="22时至08时附加费100耗时" onkeyup="DefaultBanbao_22时至08时附加费100_InputChanged(this)" placeholder="请输入小时数"></input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //9 100% 假日附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B13' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%假日附加费" onchange="BanbaoAll100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="假日附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="Banbao100JiaRiFuJiaFeiCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                            tr.append(td);
                        }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="假日附加费100" onchange="Banbao100JiaRiFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                    }
                }
                    }
                }

                tbody.append(tr);
            }


            //10 100% 台风附加费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue == 'B14' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_100%台风附加费" onchange="BanbaoAll100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="台风附加费100" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');

                            td.append(p)
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="Banbao100TaiFengFuJiaFeiCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="台风附加费100" onchange="Banbao100TaiFengFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                            }
                        }
                    }
                }

                tbody.append(tr);
            }

            //11 合计港币
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].SubTotaHKS)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">折扣</td>')

                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var input = $('<input style="width:100px;" id="' + element_id + '" type="text" name="折扣" value="' + FormatPrice(GetFloatStr(price)) + '" onkeyup="DefaultBanbao_ZheKou_InputChanged(this)"></input>');
                            td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //13 折扣后合计港币
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + GetFloatStr(value[i].DiscountSubTotalHKS) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            //14 3600BHP以上
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_3600BHP附加费" onchange="BanbaoAll3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            //alert(element_id);

                            td = $('<td id="' + element_id + '" name="3600BHP附加费15" width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + element_id + '" name="real_price" >' + GetFloatStr(price) + '</p>');
                            td.append(p);
                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + GetFloatStr(0) + '</td>');

                            if (price != 0) {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="Banbao3600BHPFuJiaFeiCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                            tr.append(td);
                        }
                            else {
                                var input = $('<input id="' + element_id + '" type="checkbox" name="3600BHP附加费15" onchange="Banbao3600BHPFuJiaFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                                td.append(input);
                                tr.append(td);
                    }
                }
                    }
                }

                tbody.append(tr);
            }


            //15 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'E80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }


                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')

                    var span = $('<br><span>燃油附加费</span>');
                    td.append(span);
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var feulFee = 0;
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    feulFee = value[i].BillingItems[j].Price;
                                    }
                                }

                            //var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var unit_price_p = $('<p></p>');
                            var span = $('<span>单价(每小时):</span>');
                            unit_price_p.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费单价">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee)) + '</span>');
                            unit_price_p.append(span);
                            td.append(unit_price_p);


                            var feulFeeDiscount = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (119 == value[i].BillingItems[j].ItemID || "C83" == value[i].BillingItems[j].ItemValue) {
                                    feulFeeDiscount = value[i].BillingItems[j].Price;
                            }
                        }

                            var p1 = $('<p>燃油附加费折扣</p>')
                            var input1 = $('<input style="width:100px;" type="text" name="燃油附加费折扣" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_119_C83' + '" value="' + FormatPrice(GetFloatStr(feulFeeDiscount)) + '" onkeyup="DefaultBanbao_RanYouDiscout_InputChanged(this)">')
                            td.append(p1).append(input1);

                            var p2 = $('<p></p>')
                            span = $('<span>燃油附加费折扣后价格:</span>');
                            p2.append(span);
                            span = $('<span id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="燃油附加费折扣后价格">' + FormatPrice(GetFloatStr(value[i].UnitPriceOfFeulFee + parseFloat(ConvertToRealPrice($(input1).val())))) + '</span>');
                            p2.append(span);
                            td.append(p2);


                            var feulFeeExra = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (120 == value[i].BillingItems[j].ItemID || "E81" == value[i].BillingItems[j].ItemValue) {
                                    feulFeeExra = value[i].BillingItems[j].Price;
                                }
                            }
                            var p3 = $('<p>燃油附加费额外费用</p>')
                            var input2 = $('<input style="width:100px;" type="text" name="燃油附加费额外费用" id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_120_E81' + '" value="' + FormatPrice(GetFloatStr(feulFeeExra)) + '" onkeyup="DefaultBanbao_RanYouExtra_InputChanged(this)">')
                            td.append(p3).append(input2);

                            var p4 = $('<p><strong>燃油附加费</strong><p>')

                            //var feul_fee = parseFloat(ConvertToRealPrice($(span).text())) + parseFloat(ConvertToRealPrice($(input2).val()));
                            var price_p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_22_E80' + '" name="燃油附加费">' + FormatPrice(GetFloatStr(feulFee)) + '</p>');
                            td.append(p4).append(price_p);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }


            //16拖缆数量
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //17 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle">' + result.items[ii].CustomLabel + '</td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="all_拖缆费" onchange="BanbaoAllTuoLanFeiCheckboxChanged(this)">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            var element_id = key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue;

                            td = $('<td id="' + element_id + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + FormatPrice(GetFloatStr(price)) + '</td>');

                            tr.append(td);
                        }
                    }

                }

                tbody.append(tr);
            }


            //18 总计港币
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + value[i].ServiceNatureID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + FormatPrice(GetFloatStr(value[i].TotalHKs)) + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }


            $('#edit_tb_detail').append(tbody);

        }
    }

    function edit_billingSchemeChanged(selectedValue) {


        $('#edit_sel_billing_type').val(selectedValue.split('%')[1].split('~')[2]);

        $('#edit_sel_time_type').val(selectedValue.split('%')[2].split('~')[2]);

        $('#edit_ship_length_rules').val(selectedValue.split('%')[0].split('~')[3]);
        $('#edit_ship_teus_rules').val(selectedValue.split('%')[0].split('~')[4]);

        edit_btnClick();
    }

    function inputCheck(obj) {
        //return value.replace(/[^\d.]/g, '');
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //if (obj.value.trim().length == 0) {
        //    obj.value = 0;
        //}
        //obj.value;

    }

    function edit_btnClick() {
        //var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据
        var orderIds = $('#_edit_orderids').text();

        var customerBillingScheme = $("#edit_sel_billing_scheme").val().toString();


        $('#edit_txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        //alert(billingTypeId + " --- " + billingTypeValue + ' --- ' + billingTypeLabel);

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        //alert(timeTypeId + " --- " + timeTypeValue + ' --- ' + timeTypeLabel);

        var discount = $('#edit_txt_discount').val();

        reGenerateEditTable(orderIds, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount);
    }
</script>





<!--价格编辑框输入改变-->
<script>
    //全包协议价改变
    function DefaultQuanbao_XieYiShouFei_InputChanged(obj) {

        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        $('input[name="协议收费"]').each(function () {
            if ($(this).attr("id").split('_')[2] == $(obj).attr("id").split('_')[2])
                $(this).val(((obj.value)));
        });

        var value = ConvertToRealPrice(obj.value);

        $('td[name="合计港币"]').each(function () {
            if ( $(this).attr("id").split('_')[2] == $(obj).attr("id").split('_')[2]) {
                var v = parseFloat(value);
                //$(this).css('fontWeight', 'bold').text(v.toFixed(2));
                $(this).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v)));
            }
        });

        //$('td[name="折扣后合计港币"]').each(function () {
        //    if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
        //        //var v = parseFloat($('#txt_discount').val()) * parseFloat(obj.value);
        //        var v = parseFloat(value);
        //        $(this).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v)));
        //    }
        //});

        $('td[name="总计港币"]').each(function () {
            if ( $(this).attr("id").split('_')[2] == $(obj).attr("id").split('_')[2]) {
                //var v = parseFloat($('#txt_discount').val()) * parseFloat(obj.value);
                var v = parseFloat(parseFloat(value));
                $(this).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v)));
            }
        });

        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            {
                var v = parseFloat(ConvertToRealPrice($(this).text()));
                grand_total += v;
            }
        });
        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total)));

    }

    //半包
    function DefaultBanbao_XieYiShouFei_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        $('input[name="协议收费"]').each(function () {
            if ($(this).attr("id").split('_')[2] == $(obj).attr("id").split('_')[2])
                $(this).val(((obj.value)));
        });

        $('input[name="港外附加费20"][type="checkbox"]').each(function () {
            var element_id = $(this).attr("id");
            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];
            var itemId = element_id.split('_')[3];
            var itemValue = element_id.split('_')[4];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                if (true == $(this).is(':checked')) {
                    var v = parseFloat(obj.value * 0.25).toFixed(2);
                    $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(v)));
                }
            }
        });

        $('input[name="18时至22时附加费50耗时"][type="text"]').each(function () {
            var element_id = $(this).attr("id");
            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];
            var itemId = element_id.split('_')[3];
            var itemValue = element_id.split('_')[4];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                    {
                    var v = (parseFloat(obj.value * 0.5) * parseFloat($(this).val())).toFixed(2);
                    $('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_17_B11' + '"]').text(FormatPrice(GetFloatStr(v)));
                }
                    }
        });

        $('input[name="22时至08时附加费100耗时"][type="text"]').each(function () {
            var element_id = $(this).attr("id");
            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];
            var itemId = element_id.split('_')[3];
            var itemValue = element_id.split('_')[4];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                    {
                    var v = (parseFloat(obj.value) * parseFloat($(this).val())).toFixed(2);
                    $('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_18_B12' + '"]').text(FormatPrice(GetFloatStr(v)));
                }
                    }
        });

        $('input[name="假日附加费100"][type="checkbox"]').each(function () {
            var element_id = $(this).attr("id");

            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];
            var itemId = element_id.split('_')[3];
            var itemValue = element_id.split('_')[4];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                if (true == $(this).is(':checked')) {
                    var v = parseFloat(obj.value).toFixed(2);
                    $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(v)));
                }
            }
        });

        $('input[name="台风附加费100"][type="checkbox"]').each(function () {
            var element_id = $(this).attr("id");

            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];
            var itemId = element_id.split('_')[3];
            var itemValue = element_id.split('_')[4];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                if (true == $(this).is(':checked')) {
                    var v = parseFloat(obj.value).toFixed(2);
                    $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(v)));
                }
            }
        });

        //合计港币
        $('td[name="合计港币"]').each(function () {
            var td_id = $(this).attr("id");

            var orderServiceId = td_id.split('_')[0];
            var schedulerId = td_id.split('_')[1];
            var serviceNatureId = td_id.split('_')[2];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                var total = 0;

                //1.协议收费
                total += parseFloat(obj.value);

                //2. 港外附加费25%
                if ($('input[name="港外附加费20"][type="checkbox"]').length > 0) {
                    var ele = $('input[name="港外附加费20"][type="checkbox"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));

                }

                //3.18时至22时附加费50%
                if ($('input[name="18时至22时附加费50耗时"][type="text"]').length > 0) {
                    //var ele = $('input[name="18时至22时附加费50耗时"][type="text"]')[0];
                    //var itemId = $(ele).attr("id").split('_')[3];
                    //var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_17_B11';
                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                }

                //4.22时至08时附加费100%
                if ($('input[name="22时至08时附加费100耗时"][type="text"]').length > 0) {
                    //var ele = $('input[name="22时至08时附加费100耗时"][type="text"]')[0];
                    //var itemId = $(ele).attr("id").split('_')[3];
                    //var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_18_B12';
                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                }

                //5.假日附加费100%
                if ($('input[name="假日附加费100"][type="checkbox"]').length > 0) {
                    var ele = $('input[name="假日附加费100"][type="checkbox"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                }

                //6.台风附加费100% 
                if ($('input[name="台风附加费100"][type="checkbox"]').length > 0) {
                    var ele = $('input[name="台风附加费100"][type="checkbox"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                }

                $(this).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total).toFixed(2))));
            }

                        });

        //总计港币
        $('td[name="总计港币"]').each(function () {
            var td_id = $(this).attr("id");

            var orderServiceId = td_id.split('_')[0];
            var schedulerId = td_id.split('_')[1];
            var serviceNatureId = td_id.split('_')[2];
            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                var total = 0;

                //1.合计港币
                total += parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + td_id + '"]').text()));

                //2.折扣
                if ($('input[name="折扣"][type="text"]').length > 0) {
                    var ele = $('input[name="折扣"][type="text"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                    total += parseFloat(ConvertToRealPrice($('input[name="折扣"][type="text"][id="' + element_id + '"]').val()));

                }

                //3. 3600BHP附加费15%
                if ($('input[name="3600BHP附加费15"][type="checkbox"]').length > 0) {
                    var ele = $('input[name="3600BHP附加费15"][type="checkbox"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                    }

                //4.燃油附加费
                total += parseFloat(ConvertToRealPrice($('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' + '"]').text()));

                //5. 拖缆费
                if ($('td[name="拖缆费"]').length > 0) {
                    var ele = $('td[name="拖缆费"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                    total += parseFloat(ConvertToRealPrice($('td[name="拖缆费"][id="' + element_id + '"]').text()));
                }

                $(this).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total).toFixed(2))));
            }
        });

        //共计港币
        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            var v = parseFloat(ConvertToRealPrice($(this).text()));
            grand_total += v;
        });

        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));

    }

    function DefaultBanbao_18时至22时附加费50_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        element_id = $(obj).attr("id");
        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyijiage = parseFloat(ConvertToRealPrice($('input[name="协议收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val()));

        var old_price = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_17_B11' + '"]').text()));
        var new_price = parseFloat(obj.value) * parseFloat(xieyijiage * 0.5);
        if (isNaN(new_price)) new_price = 0;

        $('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_17_B11' + '"]').text(FormatPrice(GetFloatStr(new_price.toFixed(2))));

        var sub_total = parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
        var total = parseFloat(ConvertToRealPrice($('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
        var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text()));

        $('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(sub_total - old_price + new_price).toFixed(2))));
        $('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total - old_price + new_price).toFixed(2))));
        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(grand_total - old_price + new_price).toFixed(2))));
            }

    function DefaultBanbao_22时至08时附加费100_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        element_id = $(obj).attr("id");
        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyijiage = parseFloat(ConvertToRealPrice($('input[name="协议收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val()));

        var old_price = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_18_B12' + '"]').text()));
        var new_price = parseFloat(obj.value) * parseFloat(xieyijiage);
        if (isNaN(new_price)) new_price = 0;

        $('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_18_B12' + '"]').text(FormatPrice(GetFloatStr(new_price.toFixed(2))));

        var sub_total = parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
        var total = parseFloat(ConvertToRealPrice($('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
        var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text()));

        $('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(sub_total - old_price + new_price).toFixed(2))));
        $('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total - old_price + new_price).toFixed(2))));
        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(grand_total - old_price + new_price).toFixed(2))));

    }

    function DefaultBanbao_ZheKou_InputChanged(obj) {
        var t = obj.value.charAt(0);

        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //如果第一位是负号，则允许添加   如果不允许添加负号 可以把这块注释掉
        if (t == '-') {
            obj.value = '-' + obj.value;
                    }

        var element_id = $(obj).attr("id");
        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        //var itemId = element_id.split('_')[3];
        //var itemValue = element_id.split('_')[4];

        //总计港币
        {
            var total = 0;

            //1.合计港币
            total += parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
            //alert(total);

            //2.折扣
            var discount = parseFloat(obj.value);
            if(isNaN(discount) || discount == "")
                discount = 0;
            total += discount;
            //alert(total);

            //3. 3600BHP附加费15%
            if ($('input[name="3600BHP附加费15"][type="checkbox"]').length > 0) {
                var ele = $('input[name="3600BHP附加费15"][type="checkbox"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                    }
            //alert(total);

            //4.燃油附加费
            total += parseFloat(ConvertToRealPrice($('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' + '"]').text()));
            //alert(total);

            //5. 拖缆费
            if ($('td[name="拖缆费"]').length > 0) {
                var ele = $('td[name="拖缆费"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('td[name="拖缆费"][id="' + element_id + '"]').text()));
            }
            //alert(total);

            $('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total).toFixed(2))));

            }

        //共计港币
        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            var v = parseFloat(ConvertToRealPrice($(this).text()));
            grand_total += v;
        });

        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));

    }

    function DefaultBanbao_RanYouDiscout_InputChanged(obj) {
        var t = obj.value.charAt(0);

        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //如果第一位是负号，则允许添加   如果不允许添加负号 可以把这块注释掉
        if (t == '-') {
            obj.value = '-' + obj.value;
        }

        var element_id = $(obj).attr("id");
        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        //燃油附加费折扣后价格 和 燃油附加费
        {
            var ranyou_unit_price = parseFloat(ConvertToRealPrice($('span[name="燃油附加费单价"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
            var ranyou_discout = parseFloat(obj.value);
            if (isNaN(ranyou_discout) || ranyou_discout == "")
                ranyou_discout = 0;

            var ranyou_after_discount_price = parseFloat(ranyou_unit_price) + parseFloat(ranyou_discout);
            $('span[name="燃油附加费折扣后价格"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text(FormatPrice(GetFloatStr(ranyou_after_discount_price.toFixed(2))));

            var ranyou_extra_price = parseFloat(ConvertToRealPrice($('input[name="燃油附加费额外费用"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_120_E81' + '"]').val()));
            var ranyou_price = parseFloat(ranyou_after_discount_price) + parseFloat(ranyou_extra_price);
            $('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' +'"]').text(FormatPrice(GetFloatStr(ranyou_price.toFixed(2))));
        }


        //总计港币
                {
            var total = 0;

            //1.合计港币
            total += parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
            //alert(total);

            //2.折扣
            if ($('input[name="折扣"][type="text"]').length > 0) {
                var ele = $('input[name="折扣"][type="text"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                total += parseFloat(ConvertToRealPrice($('input[name="折扣"][type="text"][id="' + element_id + '"]').val()));

                        }
            //alert(total);

            //3. 3600BHP附加费15%
            if ($('input[name="3600BHP附加费15"][type="checkbox"]').length > 0) {
                var ele = $('input[name="3600BHP附加费15"][type="checkbox"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
            }
            //alert(total);

            //4.燃油附加费
            total += parseFloat(ConvertToRealPrice($('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' + '"]').text()));
            //alert(total);

            //5. 拖缆费
            if ($('td[name="拖缆费"]').length > 0) {
                var ele = $('td[name="拖缆费"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('td[name="拖缆费"][id="' + element_id + '"]').text()));
                        }
            //alert(total);

            $('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total).toFixed(2))));

        }

        //共计港币
        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            var v = parseFloat(ConvertToRealPrice($(this).text()));
                    grand_total += v;
            });

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

    function DefaultBanbao_RanYouExtra_InputChanged(obj) {

        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        var element_id = $(obj).attr("id");
        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        //燃油附加费
        {
            var ranyou_after_discount_price = parseFloat(ConvertToRealPrice($('span[name="燃油附加费折扣后价格"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));            

            var ranyou_extra_price = parseFloat(ConvertToRealPrice(obj.value));
            if (isNaN(ranyou_extra_price) || ranyou_extra_price == "")
                ranyou_extra_price = 0;

            var ranyou_price = parseFloat(ranyou_after_discount_price) + parseFloat(ranyou_extra_price);
            $('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' + '"]').text(FormatPrice(GetFloatStr(ranyou_price.toFixed(2))));
        }


        //总计港币
                {
            var total = 0;

            //1.合计港币
            total += parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
            //alert(total);

            //2.折扣
            if ($('input[name="折扣"][type="text"]').length > 0) {
                var ele = $('input[name="折扣"][type="text"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                total += parseFloat(ConvertToRealPrice($('input[name="折扣"][type="text"][id="' + element_id + '"]').val()));

                        }
            //alert(total);

            //3. 3600BHP附加费15%
            if ($('input[name="3600BHP附加费15"][type="checkbox"]').length > 0) {
                var ele = $('input[name="3600BHP附加费15"][type="checkbox"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
            }
            //alert(total);

            //4.燃油附加费
            total += parseFloat(ConvertToRealPrice($('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' + '"]').text()));
            //alert(total);

            //5. 拖缆费
            if ($('td[name="拖缆费"]').length > 0) {
                var ele = $('td[name="拖缆费"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('td[name="拖缆费"][id="' + element_id + '"]').text()));
                        }
            //alert(total);

            $('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total).toFixed(2))));

        }

        //共计港币
        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            var v = parseFloat(ConvertToRealPrice($(this).text()));
                    grand_total += v;
            });

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }


    //条款计时服务单价改变
    function DefaultTiaoKuan_UnitPrice_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        $('input[name="每小时收费"]').each(function () {
            if ($(this).attr("id").split('_')[2] == $(obj).attr("id").split('_')[2])
                $(this).val(((obj.value)));
        });

        $('td[name="正常收费"]').each(function () {

            var element_id = $(this).attr("id");
            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];

            if ($(this).attr("id").split('_')[2] == $(obj).attr("id").split('_')[2]) {

                var consume_time = parseFloat($('td[name="换算耗时"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());
                var unit_price = parseFloat(ConvertToRealPrice(obj.value));
                var price = parseFloat(consume_time) * parseFloat(unit_price);
                $(this).text(FormatPrice(GetFloatStr(parseFloat(price).toFixed(2))));
            }
        });

        $('input[name="港外附加费20"][type="checkbox"]').each(function () {
            var element_id = $(this).attr("id");
            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];
            var itemId = element_id.split('_')[3];
            var itemValue = element_id.split('_')[4];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                if (true == $(this).is(':checked')) {
                    var price = parseFloat(ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));//获取正常收费
                    var v = parseFloat(price * 0.25).toFixed(2);
                    $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(v)));
                }
            }
            });

        $('input[name="18时至22时附加费50耗时"][type="text"]').each(function () {
            var element_id = $(this).attr("id");
            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];
            var itemId = element_id.split('_')[3];
            var itemValue = element_id.split('_')[4];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                {
                    var price = parseFloat(ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));//获取正常收费
                    var v = (parseFloat(price * 0.5) * parseFloat($(this).val())).toFixed(2);
                    $('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_17_B11' + '"]').text(FormatPrice(GetFloatStr(v)));
                }
            }
        });

        $('input[name="22时至08时附加费100耗时"][type="text"]').each(function () {
            var element_id = $(this).attr("id");
            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];
            var itemId = element_id.split('_')[3];
            var itemValue = element_id.split('_')[4];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                {
                    var price = parseFloat(ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));//获取正常收费
                    var v = (parseFloat(price) * parseFloat($(this).val())).toFixed(2);
                    $('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_18_B12' + '"]').text(FormatPrice(GetFloatStr(v)));
                }
            }
        });

        $('input[name="假日附加费100"][type="checkbox"]').each(function () {
            var element_id = $(this).attr("id");

            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];
            var itemId = element_id.split('_')[3];
            var itemValue = element_id.split('_')[4];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                if (true == $(this).is(':checked')) {
                    var price = parseFloat(ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));//获取正常收费
                    var v = parseFloat(price).toFixed(2);
                    $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(v)));
                }
            }
                            });

        $('input[name="台风附加费100"][type="checkbox"]').each(function () {
            var element_id = $(this).attr("id");

            var orderServiceId = element_id.split('_')[0];
            var schedulerId = element_id.split('_')[1];
            var serviceNatureId = element_id.split('_')[2];
            var itemId = element_id.split('_')[3];
            var itemValue = element_id.split('_')[4];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                if (true == $(this).is(':checked')) {
                    var price = parseFloat(ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));//获取正常收费
                    var v = parseFloat(price).toFixed(2);
                    $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(v)));
                }
                }
        });

        //合计港币
        $('td[name="合计港币"]').each(function () {
            var td_id = $(this).attr("id");

            var orderServiceId = td_id.split('_')[0];
            var schedulerId = td_id.split('_')[1];
            var serviceNatureId = td_id.split('_')[2];

            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                var total = 0;

                //1.正常收费
                var price = parseFloat(ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));//获取正常收费
                total += parseFloat(price);

                //2. 港外附加费25%
                if ($('input[name="港外附加费20"][type="checkbox"]').length > 0) {
                    var ele = $('input[name="港外附加费20"][type="checkbox"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));

                }

                //3.18时至22时附加费50%
                if ($('input[name="18时至22时附加费50耗时"][type="text"]').length > 0) {
                    //var ele = $('input[name="18时至22时附加费50耗时"][type="text"]')[0];
                    //var itemId = $(ele).attr("id").split('_')[3];
                    //var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_17_B11';
                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                }

                //4.22时至08时附加费100%
                if ($('input[name="22时至08时附加费100耗时"][type="text"]').length > 0) {
                    var ele = $('input[name="22时至08时附加费100耗时"][type="text"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_18_B12';
                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                }

                //5.假日附加费100%
                if ($('input[name="假日附加费100"][type="checkbox"]').length > 0) {
                    var ele = $('input[name="假日附加费100"][type="checkbox"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                }

                //6.台风附加费100% 
                if ($('input[name="台风附加费100"][type="checkbox"]').length > 0) {
                    var ele = $('input[name="台风附加费100"][type="checkbox"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                }

                $(this).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total).toFixed(2))));
                        }

        });

        //总计港币
        $('td[name="总计港币"]').each(function () {
            var td_id = $(this).attr("id");

            var orderServiceId = td_id.split('_')[0];
            var schedulerId = td_id.split('_')[1];
            var serviceNatureId = td_id.split('_')[2];
            if (serviceNatureId == $(obj).attr("id").split('_')[2]) {
                var total = 0;

                //1.合计港币
                total += parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + td_id + '"]').text()));

                //2.折扣
                if ($('input[name="折扣"][type="text"]').length > 0) {
                    var ele = $('input[name="折扣"][type="text"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                    total += parseFloat(ConvertToRealPrice($('input[name="折扣"][type="text"][id="' + element_id + '"]').val()));

                        }

                //3. 3600BHP附加费15%
                if ($('input[name="3600BHP附加费15"][type="checkbox"]').length > 0) {
                    var ele = $('input[name="3600BHP附加费15"][type="checkbox"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                    total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                }

                //4.燃油附加费
                total += parseFloat(ConvertToRealPrice($('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' + '"]').text()));

                //5. 拖缆费
                if ($('td[name="拖缆费"]').length > 0) {
                    var ele = $('td[name="拖缆费"]')[0];
                    var itemId = $(ele).attr("id").split('_')[3];
                    var itemValue = $(ele).attr("id").split('_')[4];
                    var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                    total += parseFloat(ConvertToRealPrice($('td[name="拖缆费"][id="' + element_id + '"]').text()));
                }

                $(this).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total).toFixed(2))));
                }
            });

        //共计港币
        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            var v = parseFloat(ConvertToRealPrice($(this).text()));
            grand_total += v;
        });

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));

    }

    function DefaultTiaoKuan_18时至22时附加费50_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        element_id = $(obj).attr("id");
        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyijiage = parseFloat(ConvertToRealPrice($('input[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val()));

        var old_price = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_17_B11' + '"]').text()));
        var new_price = parseFloat(obj.value) * parseFloat(xieyijiage * 0.5);
        if (isNaN(new_price)) new_price = 0;

        $('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_17_B11' + '"]').text(FormatPrice(GetFloatStr(new_price.toFixed(2))));

        var sub_total = parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
        var total = parseFloat(ConvertToRealPrice($('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
        var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text()));

        $('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(sub_total - old_price + new_price).toFixed(2))));
        $('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total - old_price + new_price).toFixed(2))));
        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(grand_total - old_price + new_price).toFixed(2))));
            }

    function DefaultTiaoKuan_22时至08时附加费100_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        element_id = $(obj).attr("id");
        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyijiage = parseFloat(ConvertToRealPrice($('input[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val()));

        var old_price = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_18_B12' + '"]').text()));
        var new_price = parseFloat(obj.value) * parseFloat(xieyijiage);
        if (isNaN(new_price)) new_price = 0;

        $('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_18_B12' + '"]').text(FormatPrice(GetFloatStr(new_price.toFixed(2))));

        var sub_total = parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
        var total = parseFloat(ConvertToRealPrice($('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
        var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text()));

        $('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(sub_total - old_price + new_price).toFixed(2))));
        $('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total - old_price + new_price).toFixed(2))));
        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(grand_total - old_price + new_price).toFixed(2))));
                    }

    function DefaultTiaoKuan_ZheKou_InputChanged(obj) {
        var t = obj.value.charAt(0);

        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //如果第一位是负号，则允许添加   如果不允许添加负号 可以把这块注释掉
        if (t == '-') {
            obj.value = '-' + obj.value;
        }

        var element_id = $(obj).attr("id");
        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        //var itemId = element_id.split('_')[3];
        //var itemValue = element_id.split('_')[4];

        //总计港币
                    {
            var total = 0;

            //1.合计港币
            total += parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
            //alert(total);

            //2.折扣
            var discount = parseFloat(obj.value);
            if (isNaN(discount) || discount == "")
                discount = 0;
            total += discount;
            //alert(total);

            //3. 3600BHP附加费15%
            if ($('input[name="3600BHP附加费15"][type="checkbox"]').length > 0) {
                var ele = $('input[name="3600BHP附加费15"][type="checkbox"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
            }
            //alert(total);

            //4.燃油附加费
            total += parseFloat(ConvertToRealPrice($('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId  + '_22_E80' + '"]').text()));
            //alert(total);

            //5. 拖缆费
            if ($('td[name="拖缆费"]').length > 0) {
                var ele = $('td[name="拖缆费"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('td[name="拖缆费"][id="' + element_id + '"]').text()));
            }
            //alert(total);

            $('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total).toFixed(2))));

        }

        //共计港币
        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            var v = parseFloat(ConvertToRealPrice($(this).text()));
            grand_total += v;
                        });

        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
                    }

    function DefaultTiaoKuan_RanYouDiscout_InputChanged(obj) {
        var t = obj.value.charAt(0);

        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //如果第一位是负号，则允许添加   如果不允许添加负号 可以把这块注释掉
        if (t == '-') {
            obj.value = '-' + obj.value;
        }

        var element_id = $(obj).attr("id");
        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        //var itemId = element_id.split('_')[3];
        //var itemValue = element_id.split('_')[4];

        //燃油附加费折扣后价格 和 燃油附加费
        {
            var ranyou_unit_price = parseFloat(ConvertToRealPrice($('span[name="燃油附加费单价"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
            var ranyou_discout = parseFloat(obj.value);
            if (isNaN(ranyou_discout) || ranyou_discout == "")
                ranyou_discout = 0;

            var ranyou_after_discount_price = parseFloat(ranyou_unit_price) + parseFloat(ranyou_discout);
            $('span[name="燃油附加费折扣后价格"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text(FormatPrice(GetFloatStr(ranyou_after_discount_price.toFixed(2))));

            var ranyou_extra_price = parseFloat(ConvertToRealPrice($('input[name="燃油附加费额外费用"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_120_E81' + '"]').val()));
            var ranyou_price = parseFloat(ranyou_after_discount_price) + parseFloat(ranyou_extra_price);
            $('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' + '"]').text(FormatPrice(GetFloatStr(ranyou_price.toFixed(2))));
            }


        //总计港币
        {
            var total = 0;

            //1.合计港币
            total += parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
            //alert(total);

            //2.折扣
            if ($('input[name="折扣"][type="text"]').length > 0) {
                var ele = $('input[name="折扣"][type="text"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                total += parseFloat(ConvertToRealPrice($('input[name="折扣"][type="text"][id="' + element_id + '"]').val()));

            }
            //alert(total);

            //3. 3600BHP附加费15%
            if ($('input[name="3600BHP附加费15"][type="checkbox"]').length > 0) {
                var ele = $('input[name="3600BHP附加费15"][type="checkbox"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                    }
            //alert(total);

            //4.燃油附加费
            total += parseFloat(ConvertToRealPrice($('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' + '"]').text()));
            //alert(total);

            //5. 拖缆费
            if ($('td[name="拖缆费"]').length > 0) {
                var ele = $('td[name="拖缆费"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('td[name="拖缆费"][id="' + element_id + '"]').text()));
            }
            //alert(total);

            $('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total).toFixed(2))));

        }

        //共计港币
        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            var v = parseFloat(ConvertToRealPrice($(this).text()));
            grand_total += v;
        });

        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
    }

    function DefaultTiaoKuan_RanYouExtra_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        var element_id = $(obj).attr("id");
        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        //var itemId = element_id.split('_')[3];
        //var itemValue = element_id.split('_')[4];

        //燃油附加费
        {
            var ranyou_after_discount_price = parseFloat(ConvertToRealPrice($('span[name="燃油附加费折扣后价格"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));

            var ranyou_extra_price = parseFloat(ConvertToRealPrice(obj.value));
            if (isNaN(ranyou_extra_price) || ranyou_extra_price == "")
                ranyou_extra_price = 0;

            var ranyou_price = parseFloat(ranyou_after_discount_price) + parseFloat(ranyou_extra_price);
            $('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' + '"]').text(FormatPrice(GetFloatStr(ranyou_price.toFixed(2))));
        }


        //总计港币
        {
            var total = 0;

            //1.合计港币
            total += parseFloat(ConvertToRealPrice($('td[name="合计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
            //alert(total);

            //2.折扣
            if ($('input[name="折扣"][type="text"]').length > 0) {
                var ele = $('input[name="折扣"][type="text"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                total += parseFloat(ConvertToRealPrice($('input[name="折扣"][type="text"][id="' + element_id + '"]').val()));

            }
            //alert(total);

            //3. 3600BHP附加费15%
            if ($('input[name="3600BHP附加费15"][type="checkbox"]').length > 0) {
                var ele = $('input[name="3600BHP附加费15"][type="checkbox"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                    }
            //alert(total);

            //4.燃油附加费
            total += parseFloat(ConvertToRealPrice($('p[name="燃油附加费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_22_E80' + '"]').text()));
            //alert(total);

            //5. 拖缆费
            if ($('td[name="拖缆费"]').length > 0) {
                var ele = $('td[name="拖缆费"]')[0];
                var itemId = $(ele).attr("id").split('_')[3];
                var itemValue = $(ele).attr("id").split('_')[4];
                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                total += parseFloat(ConvertToRealPrice($('td[name="拖缆费"][id="' + element_id + '"]').text()));
            }
            //alert(total);

            $('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(parseFloat(total).toFixed(2))));

            }

        //共计港币
        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            var v = parseFloat(ConvertToRealPrice($(this).text()));
            grand_total += v;
        });

        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
    }

</script>

<!--提交表单时，检查表格中的数据是否有空或NaN-->
<script>
    function CheckQuanBaoTBodyData() {

        var ret = true;
        $('input[name="协议收费"]').each(function () {

            if ($(this).val().trim().length <= 0) {
                ret = false;
                return;
            }
        });

        return ret;
    }

    function CheckBanBaoTBodyData() {
        var ret = true;

        var elements = $('input[name="协议收费"][type="text"]');
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));
            //alert(input_value)
            if (isNaN(input_value) || input_value == null) {
                ret = false;
                return ret;
            }
        }

        elements = $('input[name="18时至22时附加费50耗时"][type="text"]')
        //alert(elements.length)
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));
            if (isNaN(input_value) || input_value == null) {
                //alert(input_value)

                ret = false;
                return ret;
            }
        }

        elements = $('input[name="22时至08时附加费100耗时"][type="text"]');
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));

            if (isNaN(input_value) || input_value == null) {
                ret = false;
                return ret;
            }
        }

        elements = $('input[name="折扣"][type="text"]')
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));

            if (isNaN(input_value) || input_value == null) {
                ret = false;
                return ret;
            }
        }


        elements = $('input[name="燃油附加费折扣"][type="text"]');
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));

            if (isNaN(input_value) || input_value == null) {
                ret = false;
        return ret;
    }
        }

        elements = $('input[name="燃油附加费额外费用"][type="text"]');
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));

            if (isNaN(input_value) || input_value == null) {
                ret = false;
                return ret;
            }
        }
                
        return ret;
    }

    function CheckTiaoKuanTBodyData() {
        var ret = true;

        var elements = $('input[name="每小时收费"][type="text"]');
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));
            //alert(input_value)
            if (isNaN(input_value) || input_value == null) {
                ret = false;
                return ret;
            }
        }

        elements = $('input[name="18时至22时附加费50耗时"][type="text"]')
        //alert(elements.length)
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));
            if (isNaN(input_value) || input_value == null) {
                //alert(input_value)

                ret = false;
                return ret;
            }
        }

        elements = $('input[name="22时至08时附加费100耗时"][type="text"]');
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));

            if (isNaN(input_value) || input_value == null) {
                ret = false;
                return ret;
            }
        }

        elements = $('input[name="折扣"][type="text"]')
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));

            if (isNaN(input_value) || input_value == null) {
                ret = false;
                return ret;
            }
        }


        elements = $('input[name="燃油附加费折扣"][type="text"]');
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));

            if (isNaN(input_value) || input_value == null) {
                ret = false;
        return ret;
    }
        }

        elements = $('input[name="燃油附加费额外费用"][type="text"]');
        for (var i = 0; i < elements.length; i++) {
            var input_value = parseFloat(ConvertToRealPrice($(elements[i]).val().trim()));

            if (isNaN(input_value) || input_value == null) {
                ret = false;
                return ret;
            }
        }

        return ret;
    }
</script>

<!--提交表单时，获取表格中的数据-->
<script>

    function GetQuanBaoTBodyData() {
        var array = new Array();

        $('input[name="协议收费"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id

            var itemId = $(this).attr("id").split('_')[2]; //item id
            var unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
            var currency = "港币";
            //var isVisible = "是";

            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
            array.push(bi);
        });

        
        
        return array;

    }

    function GetBanBaoTBodyData() {
        var array = new Array();

        //0.服务费
        $('input[name="协议收费"]').each(function () {

            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id

            var itemId = $(this).attr("id").split('_')[2]; //item id
            //alert(itemId);
            var unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
            var currency = "港币";

            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
            array.push(bi);
        });

        //1.25%港外附加费
        $('input[name="港外附加费20"][type="checkbox"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            if ($(this).is(":checked") == true) {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                var currency = "港币";
                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //2.50%港外附加费
        $('input[name="18时至22时附加费50耗时"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            //if ($(this).is(":checked") == true) 
            {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_17_B11' + '"]').text()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                        var currency = "港币";
                var bi = new BillingItem(schedulerId, 17, unitPrice, currency);
                array.push(bi);

                unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
                bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
        });

        //3.100%港外附加费
        $('input[name="22时至08时附加费100耗时"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            //if ($(this).is(":checked") == true) 
            {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_18_B12' + '"]').text()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                var currency = "港币";
                var bi = new BillingItem(schedulerId, 18, unitPrice, currency);
                array.push(bi);

                unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
                bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
                }
        });

        //4.100%假日附加费
        $('input[name="假日附加费100"][type="checkbox"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            if ($(this).is(":checked") == true) {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                var currency = "港币";
                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //5.100%台风附加费
        $('input[name="台风附加费100"][type="checkbox"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            if ($(this).is(":checked") == true) {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
            var currency = "港币";
                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //6.折扣
        $('input[name="折扣"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                var currency = "港币";
            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
            array.push(bi);
            }
        });

        //7.使用3600BHP以上的拖轮+15%
        $('input[name="3600BHP附加费15"][type="checkbox"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            if ($(this).is(":checked") == true) {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                var currency = "港币";
                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //8.燃油附加费折扣
        $('input[name="燃油附加费折扣"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                        var currency = "港币";
                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //9.燃油附加费额外费用
        $('input[name="燃油附加费额外费用"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                var currency = "港币";
                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
        });

        //10.燃油附加费
        $('p[name="燃油附加费"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var unitPrice = parseFloat(ConvertToRealPrice($(this).text()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                        var currency = "港币";
                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
        });

        //11.拖缆费
        $('td[name="拖缆费"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var unitPrice = parseFloat(ConvertToRealPrice($(this).text()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                        var currency = "港币";
                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
        });


        return array;
    }

    function GetTiaoKuanTBodyData() {
        var array = new Array();

        //0.服务费单价
        $('input[name="每小时收费"][type="text"]').each(function () {

            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id

            var unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
            var currency = "港币";

            var bi = new BillingItem(schedulerId, serviceNatureId, unitPrice, currency);
            array.push(bi);
        });

        //1.25%港外附加费
        $('input[name="港外附加费20"][type="checkbox"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            if ($(this).is(":checked") == true) {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                var currency = "港币";
            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
            array.push(bi);
            }
        });

        //2.50%港外附加费
        $('input[name="18时至22时附加费50耗时"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            //if ($(this).is(":checked") == true) 
            {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_17_B11' + '"]').text()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                var currency = "港币";
                var bi = new BillingItem(schedulerId, 17, unitPrice, currency);
                array.push(bi);

                unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
                bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //3.100%港外附加费
        $('input[name="22时至08时附加费100耗时"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            //if ($(this).is(":checked") == true) 
            {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_18_B12' + '"]').text()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                        var currency = "港币";
                var bi = new BillingItem(schedulerId, 18, unitPrice, currency);
                array.push(bi);

                unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
                bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //4.100%假日附加费
        $('input[name="假日附加费100"][type="checkbox"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            if ($(this).is(":checked") == true) {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                var currency = "港币";
                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
        });

        //5.100%台风附加费
        $('input[name="台风附加费100"][type="checkbox"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            if ($(this).is(":checked") == true) {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
            var currency = "港币";
                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //6.折扣
        $('input[name="折扣"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                var currency = "港币";
            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
            array.push(bi);
            }
        });

        //7.使用3600BHP以上的拖轮+15%
        $('input[name="3600BHP附加费15"][type="checkbox"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            if ($(this).is(":checked") == true) {
                var unitPrice = parseFloat(ConvertToRealPrice($('p[name="real_price"][id="' + element_id + '"]').text()));
                var currency = "港币";
                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //8.燃油附加费折扣
        $('input[name="燃油附加费折扣"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                        var currency = "港币";
                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //9.燃油附加费额外费用
        $('input[name="燃油附加费额外费用"][type="text"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var unitPrice = parseFloat(ConvertToRealPrice($(this).val()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                var currency = "港币";
                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
        });

        //10.燃油附加费
        $('p[name="燃油附加费"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var unitPrice = parseFloat(ConvertToRealPrice($(this).text()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                        var currency = "港币";
                var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                array.push(bi);
            }
        });

        //11.拖缆费
        $('td[name="拖缆费"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var unitPrice = parseFloat(ConvertToRealPrice($(this).text()));
                if (isNaN(unitPrice) || unitPrice == "") unitPrice = 0;
                var currency = "港币";
                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
        });

        return array;
            }

    //获取汇总项
    function GetQuanBaoSummaryItems() {
        var array = new Array();

        //10.燃油附加费
        $('td[name="换算耗时"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id

            {
                var currency = "港币";
                var amount = parseFloat(ConvertToRealPrice($('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
                var fuelPrice = 0;
                var hours = parseFloat($(this).text());

                var si = new SummaryItem(schedulerId, amount, fuelPrice, currency, hours)

                array.push(si);
        }
        });

        return array;
    };

    function GetBanBaoSummaryItems() {

        var array = new Array();

        //10.燃油附加费
        $('p[name="燃油附加费"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                        var currency = "港币";
                var amount = parseFloat(ConvertToRealPrice($('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
                var fuelPrice = parseFloat(ConvertToRealPrice($(this).text()));
                var hours = parseFloat($('td[name="换算耗时"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());

                var si = new SummaryItem(schedulerId, amount, fuelPrice, currency, hours)

                array.push(si);
        }
        });

        return array;
    };

    function GetTiaoKuanSummaryItems() {
        var array = new Array();

        //10.燃油附加费
        $('p[name="燃油附加费"]').each(function () {
            var orderServiceId = $(this).attr("id").split('_')[0]; //订单服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var serviceNatureId = $(this).attr("id").split('_')[2]; //服务id
            var itemId = $(this).attr("id").split('_')[3]; //收费项id
            var itemValue = $(this).attr("id").split('_')[4]; //收费项id

            var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

            {
                var currency = "港币";
                var amount = parseFloat(ConvertToRealPrice($('td[name="总计港币"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text()));
                var fuelPrice = parseFloat(ConvertToRealPrice($(this).text()));
                var hours = parseFloat($('td[name="换算耗时"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());

                var si = new SummaryItem(schedulerId, amount, fuelPrice, currency, hours)

                array.push(si);
    }
        });

        return array;
    };
</script>

<!--复选框勾选改变-->
<script>
    function BanbaoTopCheckboxChanged(obj) {

        //alert($(obj).is(':checked'));

        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //25%港外附加费
        if (itemId == 17 || itemValue == "B10") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val()) * 0.25;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + parseFloat(v);

                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val()) * 0.25;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = parseFloat($('td[name="百分比"][id="' + td_id + '"]').text());

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - parseFloat(old_v);
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //50% 18时至22时附加费
        if (itemId == 18 || itemValue == "B11") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val()) * 0.5;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val()) * 0.5;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100% 22时至08时附加费
        if (itemId == 19 || itemValue == "B12") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100%假日附加费
        if (itemId == 20 || itemValue == "B13") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100%台风附加费
        if (itemId == 21 || itemValue == "B14") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

    }

    function BanbaoMidCheckboxChanged(obj) {
        var serviceId = $(obj).attr("id").split('_')[0];
        var schedulerId = $(obj).attr("id").split('_')[1];;
        var itemId = $(obj).attr("id").split('_')[2];
        var itemValue = $(obj).attr("id").split('_')[3];

        //使用3600BHP以上的拖轮+15%
        {
            var grand_total = 0;

            {

                if ($(obj).is(':checked') == true) {

                    var input = $('input[name="协议收费"][id="' + serviceId + "_" + schedulerId + "_" + serviceId + '"]');
                    var v = $(input).val() * 0.15;

                    var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                    $(p).text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                }
                else {
                    var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');

                    var old_v = parseFloat($(p).text());

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    var v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    $(p).text(GetFloatStr(0));
                }

            }

            $('td[name="总计港币"]').each(function () {
                grand_total += parseFloat($(this).text());
            })

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

    }

    function BanbaoBottomCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //燃油附加费
        if (itemId == 23 || itemValue == "C80") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt燃油附加费"]').val();
                    var time_consum = $('td[name="换算耗时"][id="' + serviceId + '_' + schedulerId + '"]').text();
                    var v = parseFloat(unit_price) * parseFloat(time_consum);

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="燃油附加费"][id="' + td_id + '"]').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="燃油附加费"][id="' + td_id + '"]').text();

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="燃油附加费"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

        //拖缆费
        if (itemId == 24 || itemValue == "C81") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt拖缆费"]').val();
                    var rope_num = $('td[name="拖缆数量"][id="' + serviceId + '_' + schedulerId + '"]').text();
                    var v = parseFloat(unit_price) * parseFloat(rope_num);

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="拖缆费"][id="' + td_id + '"]').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="拖缆费"][id="' + td_id + '"]').text();

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="拖缆费"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }
        }

        //折扣
        if (itemId == 43 || itemValue == "C82") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt折扣"]').val();

                    var v = parseFloat(unit_price) * -1;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="折扣"][id="' + td_id + '"]').text(v.toFixed(2));

                    var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(discount_sub_total_total).text()) + v;
                    $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    v = parseFloat(unit_price) * -1;
                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="折扣"][id="' + td_id + '"]').text();

                    var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(discount_sub_total_total).text()) - old_v;
                    $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="折扣"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

    }

    function TiaoKuanTopCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //25%港外附加费
        if (itemId == 17 || itemValue == "B10") {

            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).text()) * 0.25;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text()) * 0.25;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //50% 18时至22时附加费
        if (itemId == 18 || itemValue == "B11") {
            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).text()) * 0.5;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text()) * 0.5;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100% 22时至08时附加费
        if (itemId == 19 || itemValue == "B12") {
            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).text());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100%假日附加费
        if (itemId == 20 || itemValue == "B13") {
            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).text());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100%台风附加费
        if (itemId == 21 || itemValue == "B14") {
            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).text());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
    }

    function TiaoKuanMidCheckboxChanged(obj) {
        var serviceId = $(obj).attr("id").split('_')[0];
        var schedulerId = $(obj).attr("id").split('_')[1];;
        var itemId = $(obj).attr("id").split('_')[2];
        var itemValue = $(obj).attr("id").split('_')[3];

        //使用3600BHP以上的拖轮+15%
        {
            var grand_total = 0;

            {

                if ($(obj).is(':checked') == true) {

                    var td = $('td[name="正常收费"][id="' + serviceId + "_" + schedulerId + "_" + serviceId + '"]');
                    var v = parseFloat($(td).text()) * 0.15;

                    var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                    $(p).text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                }
                else {
                    var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');

                    var old_v = parseFloat($(p).text());

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    var v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    $(p).text(GetFloatStr(0));
                }

            }

            $('td[name="总计港币"]').each(function () {
                grand_total += parseFloat($(this).text());
            })

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
    }

    function TiaoKuanBottomCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //燃油附加费
        if (itemId == 23 || itemValue == "C80") {

            var grand_total = 0;
            var inputs = $('input[name="每小时收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt燃油附加费"]').val();
                    var time_consum = $('td[name="换算耗时"][id="' + serviceId + '_' + schedulerId + '"]').text();
                    var v = parseFloat(unit_price) * parseFloat(time_consum);

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="燃油附加费"][id="' + td_id + '"]').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="燃油附加费"][id="' + td_id + '"]').text();

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="燃油附加费"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

        //拖缆费
        if (itemId == 24 || itemValue == "C81") {

            var grand_total = 0;
            var inputs = $('input[name="每小时收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt拖缆费"]').val();
                    var rope_num = $('td[name="拖缆数量"][id="' + serviceId + '_' + schedulerId + '"]').text();
                    var v = parseFloat(unit_price) * parseFloat(rope_num);

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="拖缆费"][id="' + td_id + '"]').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="拖缆费"][id="' + td_id + '"]').text();

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="拖缆费"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

        //折扣
        if (itemId == 43 || itemValue == "C82") {

            var grand_total = 0;
            var inputs = $('input[name="每小时收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt折扣"]').val();

                    var v = parseFloat(unit_price) * -1;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="折扣"][id="' + td_id + '"]').text(v.toFixed(2));

                    var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(discount_sub_total_total).text()) + v;
                    $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    v = parseFloat(unit_price) * -1;
                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="折扣"][id="' + td_id + '"]').text();

                    var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(discount_sub_total_total).text()) - old_v;
                    $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="折扣"][id="' + td_id + '"]').text(GetFloatStr(0));
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

    }

    //-- Start 半包 ---
    //25%港外附加费
    function BanbaoAll20FuJiaFeiCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //alert(($(obj).is(':checked')));
        //25%港外附加费
        if (itemId == 16 || itemValue == "B10") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var orderServiceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];
                var serviceNatureId = $(inputs[i]).attr("id").split("_")[2];

                var xieyishoufei = ConvertToRealPrice($('input[name="协议收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val());
                var gangwaifujiafei25 = parseFloat(xieyishoufei * 0.25).toFixed(2);

                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                if ($(obj).is(':checked') == true) {

                    //alert(element_id);

                    var ck = $('input[name="港外附加费20"][type="checkbox"][id="' + element_id + '"]');
                    if (ck.is(':checked') == false) {
                        ck.prop('checked', true);

                        $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(gangwaifujiafei25)));
                        ///alert($('input[name="港外附加费20"][type="checkbox"][id="' + element_id + '"]').text());

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(gangwaifujiafei25);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(gangwaifujiafei25);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //grand_total += parseFloat($(total_total).text());
                    }
                }
                else {

                    //var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                    var ck = $('input[name="港外附加费20"][type="checkbox"][id="' + element_id + '"]');

                    if (ck.is(':checked') == true) {
                        ck.prop('checked', false);

                        $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(gangwaifujiafei25);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(gangwaifujiafei25);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));
                    }
                }

                grand_total += parseFloat(ConvertToRealPrice($(total_total).text()));
            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
        }
    }

    function Banbao20FuJiaFeiCheckboxChanged(obj) {
        var element_id = $(obj).attr("id");

        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyishoufei = ConvertToRealPrice($('input[name="协议收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val());
        var gangwaifujiafei25 = parseFloat(xieyishoufei * 0.25).toFixed(2);

        
        //25%港外附加费
        if (itemId == 16 || itemValue == "B10") {
            if ($(obj).is(':checked') == true) {

                $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(gangwaifujiafei25)));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(gangwaifujiafei25);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(gangwaifujiafei25);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) + parseFloat(gangwaifujiafei25);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
            else
            {
                var ck = $('input[name="all_20%港外附加费"][type="checkbox"][id="ckItem_' + itemId + '_' + itemValue + '"]');
                ck.prop('checked', false);

                $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(gangwaifujiafei25);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));


                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(gangwaifujiafei25);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) - parseFloat(gangwaifujiafei25);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }

        }
    }


    //100%假日附加费
    function BanbaoAll100JiaRiFuJiaFeiCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //alert(($(obj).is(':checked')));

        if (itemId == 19 || itemValue == "B13") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var orderServiceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];
                var serviceNatureId = $(inputs[i]).attr("id").split("_")[2];

                var xieyishoufei = ConvertToRealPrice($('input[name="协议收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val());
                var jiarifujiafei100 = parseFloat(xieyishoufei).toFixed(2);

                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                if ($(obj).is(':checked') == true) {

                    var ck = $('input[name="假日附加费100"][type="checkbox"][id="' + element_id + '"]');
                    if (ck.is(':checked') == false) {
                        ck.prop('checked', true);

                        $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(jiarifujiafei100)));

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(jiarifujiafei100);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(jiarifujiafei100);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                    }
                }
                else {

                    //var element_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var ck = $('input[name="假日附加费100"][type="checkbox"][id="' + element_id + '"]');

                    if (ck.is(':checked') == true) {
                        ck.prop('checked', false);

                        $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(jiarifujiafei100);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(jiarifujiafei100);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));
                    }
                }
                grand_total += parseFloat(ConvertToRealPrice($(total_total).text()));
            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
        }
    }

    function Banbao100JiaRiFuJiaFeiCheckboxChanged(obj) {

        var element_id = $(obj).attr("id");

        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyishoufei = ConvertToRealPrice($('input[name="协议收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val());
        var jiarifujiafei100 = parseFloat(xieyishoufei).toFixed(2);

        

        if (itemId == 19 || itemValue == "B13") {
            if ($(obj).is(':checked') == true) {

                $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(jiarifujiafei100)));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(jiarifujiafei100);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(jiarifujiafei100);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) + parseFloat(jiarifujiafei100);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
            else {
                var ck = $('input[name="all_100%假日附加费"][type="checkbox"][id="ckItem_' + itemId + '_' + itemValue + '"]');
                ck.prop('checked', false);

                $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(jiarifujiafei100);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(jiarifujiafei100);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) - parseFloat(jiarifujiafei100);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
        }
    }


    //100%台风附加费
    function BanbaoAll100TaiFengFuJiaFeiCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        if (itemId == 20 || itemValue == "B14") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var orderServiceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];
                var serviceNatureId = $(inputs[i]).attr("id").split("_")[2];

                var xieyishoufei = ConvertToRealPrice($('input[name="协议收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val());
                var taifengfujiafei100 = parseFloat(xieyishoufei).toFixed(2);

                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                if ($(obj).is(':checked') == true) {
                    

                    var ck = $('input[name="台风附加费100"][type="checkbox"][id="' + element_id + '"]');
                    if (ck.is(':checked') == false) {
                        ck.prop('checked', true);

                        $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(taifengfujiafei100)));

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(taifengfujiafei100);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(taifengfujiafei100);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                    }
                }
                else {

                    //var element_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var ck = $('input[name="台风附加费100"][type="checkbox"][id="' + element_id + '"]');

                    if (ck.is(':checked') == true) {
                        ck.prop('checked', false);

                        $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(taifengfujiafei100);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(taifengfujiafei100);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));
                    }
                }
                grand_total += parseFloat(ConvertToRealPrice($(total_total).text()));
            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
        }
    }

    function Banbao100TaiFengFuJiaFeiCheckboxChanged(obj) {

        var element_id = $(obj).attr("id");

        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyishoufei = ConvertToRealPrice($('input[name="协议收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val());
        var taifengfujiafei100 = parseFloat(xieyishoufei).toFixed(2);


        if (itemId == 20 || itemValue == "B14") {
            if ($(obj).is(':checked') == true) {

                $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(taifengfujiafei100)));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(taifengfujiafei100);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(taifengfujiafei100);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) + parseFloat(taifengfujiafei100);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
            else {
                var ck = $('input[name="all_100%台风附加费"][type="checkbox"][id="ckItem_' + itemId + '_' + itemValue + '"]');
                ck.prop('checked', false);

                $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(taifengfujiafei100);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(taifengfujiafei100);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) - parseFloat(taifengfujiafei100);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
        }
    }


    //3600BHP以上 15%附加费
    function BanbaoAll3600BHPFuJiaFeiCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        if (itemId == 21 || itemValue == "C15") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var orderServiceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];
                var serviceNatureId = $(inputs[i]).attr("id").split("_")[2];

                var xieyishoufei = ConvertToRealPrice($('input[name="协议收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val());
                var fujiafei3600bhp = parseFloat(xieyishoufei * 0.15).toFixed(2);

                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                if ($(obj).is(':checked') == true) {

                    var ck = $('input[name="3600BHP附加费15"][type="checkbox"][id="' + element_id + '"]');
                    if (ck.is(':checked') == false) {
                        ck.prop('checked', true);

                        $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(fujiafei3600bhp)));

                        //合计港币变化
                        //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(fujiafei3600bhp);
                        //$(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(fujiafei3600bhp);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));
                    }
                }
                else {

                    //var element_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var ck = $('input[name="3600BHP附加费15"][type="checkbox"][id="' + element_id + '"]');

                    if (ck.is(':checked') == true) {
                        ck.prop('checked', false);

                        $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                        //合计港币变化
                        //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(fujiafei3600bhp);
                        //$(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(fujiafei3600bhp);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));
                    }
                }
                grand_total += parseFloat(ConvertToRealPrice($(total_total).text()));
            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
        }
    }

    function Banbao3600BHPFuJiaFeiCheckboxChanged(obj) {
        var element_id = $(obj).attr("id");

        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyishoufei = ConvertToRealPrice($('input[name="协议收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').val());
        var fujiafei3600bhp = parseFloat(xieyishoufei * 0.15).toFixed(2);

        if (itemId == 21 || itemValue == "C15") {
            if ($(obj).is(':checked') == true) {

                $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(fujiafei3600bhp)));

                //合计港币变化
                //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                //var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(fujiafei3600bhp);
                //$(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(fujiafei3600bhp);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) + parseFloat(fujiafei3600bhp);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
            else {
                var ck = $('input[name="all_3600BHP附加费"][type="checkbox"][id="ckItem_' + itemId + '_' + itemValue + '"]');
                ck.prop('checked', false);

                $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                //合计港币变化
                //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                //var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(fujiafei3600bhp);
                //$(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(fujiafei3600bhp);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) - parseFloat(fujiafei3600bhp);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
        }
    }


    //拖缆费
    function BanbaoAllTuoLanFeiCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //alert(($(obj).is(':checked')));

        if (itemId == 23 || itemValue == "C81") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    //var v = parseFloat($(inputs[i]).val()) * 0.25;

                    //var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    //$('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //v = parseFloat($(sub_total).text()) + parseFloat(v);

                    //$(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    //var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    ////$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    //var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val()) * 0.25;
                    //$(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    //grand_total += parseFloat($(total_total).text());

                    var element_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;

                    //alert(element_id);

                    var ck = $('input[name="拖缆费"][type="checkbox"][id="' + element_id + '"]');
                    if (ck.is(':checked') == false) {
                        ck.prop('checked', true);

                        $('p[name="real_price"][id="' + element_id + '"]').text($('p[name="tmp_price"][id="' + element_id + '"]').text());
                        ///alert($('input[name="港外附加费20"][type="checkbox"][id="' + element_id + '"]').text());

                        //合计港币变化
                        //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //var v = parseFloat($(sub_total).text()) + parseFloat($('p[name="tmp_price"][id="' + element_id + '"]').text());
                        //$(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));


                        //var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                        //var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val()) * 0.25;
                        //$(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                        //grand_total += parseFloat($(total_total).text());
                    }
                }
                else {
                    //var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    //var old_v = parseFloat($('td[name="百分比"][id="' + td_id + '"]').text());

                    //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //var v = parseFloat($(sub_total).text()) - parseFloat(old_v);
                    //$(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    //var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    ////$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    //var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //v = parseFloat($(total_total).text()) - old_v;
                    //$(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    //grand_total += parseFloat($(total_total).text());

                    //$('td[name="百分比"][id="' + td_id + '"]').text(GetFloatStr(0));

                    var element_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var ck = $('input[name="拖缆费"][type="checkbox"][id="' + element_id + '"]');

                    if (ck.is(':checked') == true) {
                        ck.prop('checked', false);

                        $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                        //合计港币变化
                        //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //var v = parseFloat($(sub_total).text()) - parseFloat($('p[name="tmp_price"][id="' + element_id + '"]').text());
                        //$(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));
                    }
                }

            }

            //$('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
    }

    function BanbaoTuoLanFeiCheckboxChanged(obj) {
        var serviceId = $(obj).attr("id").split('_')[0];
        var schedulerId = $(obj).attr("id").split('_')[1];
        var itemId = $(obj).attr("id").split('_')[2];
        var itemValue = $(obj).attr("id").split('_')[3];

        var element_id = $(obj).attr("id");

        if (itemId == 23 || itemValue == "C81") {
            if ($(obj).is(':checked') == true) {

                $('p[name="real_price"][id="' + element_id + '"]').text($('p[name="tmp_price"][id="' + element_id + '"]').text());

                //合计港币变化
                //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                //var v = parseFloat($(sub_total).text()) + parseFloat($('p[name="tmp_price"][id="' + element_id + '"]').text());
                //$(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));
            }
            else {
                var ck = $('input[name="all_拖缆费"][type="checkbox"][id="ckItem_' + itemId + '_' + itemValue + '"]');
                ck.prop('checked', false);

                $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                //合计港币变化
                //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                //var v = parseFloat($(sub_total).text()) - parseFloat($('p[name="tmp_price"][id="' + element_id + '"]').text());
                //$(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));
            }
        }
    }

    //--End 半包 ---


    //-- Start 条款 ---
    //25%港外附加费
    function TiaoKuanAll20FuJiaFeiCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //alert(($(obj).is(':checked')));
        //25%港外附加费
        if (itemId == 16 || itemValue == "B10") {

            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var orderServiceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];
                var serviceNatureId = $(inputs[i]).attr("id").split("_")[2];

                var xieyishoufei = ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());
                var gangwaifujiafei25 = parseFloat(xieyishoufei * 0.25).toFixed(2);

                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                if ($(obj).is(':checked') == true) {

                    //alert(element_id);

                    var ck = $('input[name="港外附加费20"][type="checkbox"][id="' + element_id + '"]');
                    if (ck.is(':checked') == false) {
                        ck.prop('checked', true);

                        $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(gangwaifujiafei25)));
                        ///alert($('input[name="港外附加费20"][type="checkbox"][id="' + element_id + '"]').text());

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(gangwaifujiafei25);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(gangwaifujiafei25);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //grand_total += parseFloat($(total_total).text());
                    }
                }
                else {

                    //var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;
                    var ck = $('input[name="港外附加费20"][type="checkbox"][id="' + element_id + '"]');

                    if (ck.is(':checked') == true) {
                        ck.prop('checked', false);

                        $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(gangwaifujiafei25);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(gangwaifujiafei25);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));
                    }
                }

                grand_total += parseFloat(ConvertToRealPrice($(total_total).text()));
            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
        }
    }
    function TiaoKuan20FuJiaFeiCheckboxChanged(obj) {
        var element_id = $(obj).attr("id");

        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyishoufei = ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());
        var gangwaifujiafei25 = parseFloat(xieyishoufei * 0.25).toFixed(2);


        //25%港外附加费
        if (itemId == 16 || itemValue == "B10") {
            if ($(obj).is(':checked') == true) {

                $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(gangwaifujiafei25)));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(gangwaifujiafei25);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(gangwaifujiafei25);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) + parseFloat(gangwaifujiafei25);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
            else {
                var ck = $('input[name="all_20%港外附加费"][type="checkbox"][id="ckItem_' + itemId + '_' + itemValue + '"]');
                ck.prop('checked', false);

                $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(gangwaifujiafei25);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));


                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(gangwaifujiafei25);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) - parseFloat(gangwaifujiafei25);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }

        }
    }

    //100%假日附加费
    function TiaoKuanAll100JiaRiFuJiaFeiCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //alert(($(obj).is(':checked')));

        if (itemId == 19 || itemValue == "B13") {

            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var orderServiceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];
                var serviceNatureId = $(inputs[i]).attr("id").split("_")[2];

                var xieyishoufei = ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());
                var jiarifujiafei100 = parseFloat(xieyishoufei).toFixed(2);

                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                if ($(obj).is(':checked') == true) {

                    var ck = $('input[name="假日附加费100"][type="checkbox"][id="' + element_id + '"]');
                    if (ck.is(':checked') == false) {
                        ck.prop('checked', true);

                        $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(jiarifujiafei100)));

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(jiarifujiafei100);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(jiarifujiafei100);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                    }
                }
                else {

                    //var element_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var ck = $('input[name="假日附加费100"][type="checkbox"][id="' + element_id + '"]');

                    if (ck.is(':checked') == true) {
                        ck.prop('checked', false);

                        $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(jiarifujiafei100);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(jiarifujiafei100);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));
                    }
                }
                grand_total += parseFloat(ConvertToRealPrice($(total_total).text()));
            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
        }
    }
    function TiaoKuan100JiaRiFuJiaFeiCheckboxChanged(obj) {

        var element_id = $(obj).attr("id");

        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyishoufei = ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());
        var jiarifujiafei100 = parseFloat(xieyishoufei).toFixed(2);



        if (itemId == 19 || itemValue == "B13") {
            if ($(obj).is(':checked') == true) {

                $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(jiarifujiafei100)));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(jiarifujiafei100);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(jiarifujiafei100);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) + parseFloat(jiarifujiafei100);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
    }
            else {
                var ck = $('input[name="all_100%假日附加费"][type="checkbox"][id="ckItem_' + itemId + '_' + itemValue + '"]');
                ck.prop('checked', false);

                $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(jiarifujiafei100);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(jiarifujiafei100);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) - parseFloat(jiarifujiafei100);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
        }
    }

    //100%台风附加费
    function TiaoKuanAll100TaiFengFuJiaFeiCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        if (itemId == 20 || itemValue == "B14") {

            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var orderServiceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];
                var serviceNatureId = $(inputs[i]).attr("id").split("_")[2];

                var xieyishoufei = ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());
                var taifengfujiafei100 = parseFloat(xieyishoufei).toFixed(2);

                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                if ($(obj).is(':checked') == true) {


                    var ck = $('input[name="台风附加费100"][type="checkbox"][id="' + element_id + '"]');
                    if (ck.is(':checked') == false) {
                        ck.prop('checked', true);

                        $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(taifengfujiafei100)));

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(taifengfujiafei100);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(taifengfujiafei100);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                    }
                }
                else {

                    //var element_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var ck = $('input[name="台风附加费100"][type="checkbox"][id="' + element_id + '"]');

                    if (ck.is(':checked') == true) {
                        ck.prop('checked', false);

                        $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                        //合计港币变化
                        var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(taifengfujiafei100);
                        $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(taifengfujiafei100);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));
                    }
                }
                grand_total += parseFloat(ConvertToRealPrice($(total_total).text()));
            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
        }
    }
    function TiaoKuan100TaiFengFuJiaFeiCheckboxChanged(obj) {

        var element_id = $(obj).attr("id");

        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyishoufei = ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());
        var taifengfujiafei100 = parseFloat(xieyishoufei).toFixed(2);


        if (itemId == 20 || itemValue == "B14") {
            if ($(obj).is(':checked') == true) {

                $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(taifengfujiafei100)));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(taifengfujiafei100);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(taifengfujiafei100);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) + parseFloat(taifengfujiafei100);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
            else {
                var ck = $('input[name="all_100%台风附加费"][type="checkbox"][id="ckItem_' + itemId + '_' + itemValue + '"]');
                ck.prop('checked', false);

                $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                //合计港币变化
                var sub_total = $('td[name="合计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(taifengfujiafei100);
                $(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(taifengfujiafei100);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) - parseFloat(taifengfujiafei100);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
        }
    }

    //3600BHP以上 15%附加费
    function TiaoKuanAll3600BHPFuJiaFeiCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        if (itemId == 21 || itemValue == "C15") {

            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var orderServiceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];
                var serviceNatureId = $(inputs[i]).attr("id").split("_")[2];

                var xieyishoufei = ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());
                var fujiafei3600bhp = parseFloat(xieyishoufei * 0.15).toFixed(2);

                var element_id = orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '_' + itemId + '_' + itemValue;

                if ($(obj).is(':checked') == true) {

                    var ck = $('input[name="3600BHP附加费15"][type="checkbox"][id="' + element_id + '"]');
                    if (ck.is(':checked') == false) {
                        ck.prop('checked', true);

                        $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(fujiafei3600bhp)));

                        //合计港币变化
                        //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(fujiafei3600bhp);
                        //$(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(fujiafei3600bhp);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));
                    }
                }
                else {

                    //var element_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var ck = $('input[name="3600BHP附加费15"][type="checkbox"][id="' + element_id + '"]');

                    if (ck.is(':checked') == true) {
                        ck.prop('checked', false);

                        $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                        //合计港币变化
                        //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                        //var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(fujiafei3600bhp);
                        //$(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                        //总计港币
                        var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                        v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(fujiafei3600bhp);
                        $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));
                    }
                }
                grand_total += parseFloat(ConvertToRealPrice($(total_total).text()));
            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
        }
    }
    function TiaoKuan3600BHPFuJiaFeiCheckboxChanged(obj) {
        var element_id = $(obj).attr("id");

        var orderServiceId = element_id.split('_')[0];
        var schedulerId = element_id.split('_')[1];
        var serviceNatureId = element_id.split('_')[2];
        var itemId = element_id.split('_')[3];
        var itemValue = element_id.split('_')[4];

        var xieyishoufei = ConvertToRealPrice($('td[name="正常收费"][id="' + orderServiceId + '_' + schedulerId + '_' + serviceNatureId + '"]').text());
        var fujiafei3600bhp = parseFloat(xieyishoufei * 0.15).toFixed(2);

        if (itemId == 21 || itemValue == "C15") {
            if ($(obj).is(':checked') == true) {

                $('p[name="real_price"][id="' + element_id + '"]').text(FormatPrice(GetFloatStr(fujiafei3600bhp)));

                //合计港币变化
                //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                //var v = parseFloat(ConvertToRealPrice($(sub_total).text())) + parseFloat(fujiafei3600bhp);
                //$(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) + parseFloat(fujiafei3600bhp);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) + parseFloat(fujiafei3600bhp);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
            else {
                var ck = $('input[name="all_3600BHP附加费"][type="checkbox"][id="ckItem_' + itemId + '_' + itemValue + '"]');
                ck.prop('checked', false);

                $('p[name="real_price"][id="' + element_id + '"]').text(GetFloatStr(0));

                //合计港币变化
                //var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                //var v = parseFloat(ConvertToRealPrice($(sub_total).text())) - parseFloat(fujiafei3600bhp);
                //$(sub_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //总计港币
                var total_total = $('td[name="总计港币"][id="' + orderServiceId + "_" + schedulerId + '_' + serviceNatureId + '"]');
                v = parseFloat(ConvertToRealPrice($(total_total).text())) - parseFloat(fujiafei3600bhp);
                $(total_total).css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(v.toFixed(2))));

                //共计港币
                var grand_total = parseFloat(ConvertToRealPrice($('td[id="GrandTotalHKS"]').text())) - parseFloat(fujiafei3600bhp);
                $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(FormatPrice(GetFloatStr(grand_total.toFixed(2))));
            }
        }
    }
    //--End 条款 ---
</script>



<!--报表预览-->
<script>

    function InvoicePreview() {

        var rowid = jQuery('#jqGrid').jqGrid('getGridParam', 'selrow');
        //var rowid = g_curRowId;

        var billingId = jQuery('#jqGrid').jqGrid('getCell', rowid, "IDX"); //BillingID
        var timeTypeId = jQuery('#jqGrid').jqGrid('getCell', rowid, "TimeTypeID"); //TimeTypeID
        var timeTypeValue = jQuery('#jqGrid').jqGrid('getCell', rowid, "TimeTypeValue"); //TimeTypeValue
        var billingTypeId = jQuery('#jqGrid').jqGrid('getCell', rowid, "BillingTypeID"); //BillingTypeID
        var billingTypeValue = jQuery('#jqGrid').jqGrid('getCell', rowid, "BillingTemplateTypeValue"); //BillingTypeValue
        var billingTypeLabel = jQuery('#jqGrid').jqGrid('getCell', rowid, "BillingTemplateTypeLabel"); //BillingTypeLabel

        if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包"
            || billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "半包") {
            //alert("全包或半包报表预览");
            //location.href = '/Report/Invoice_qborbb' + '?OrderID=' + orderId + '&TimeTypeValue=' + timeTypeId
            //open('/Report/Invoice_qborbb' + '?OrderID=' + orderId + '&TimeTypeValue=' + timeTypeValue)
            open('/Report/Invoice_qborbb' + '?BillingID=' + billingId + '&TimeTypeValue=' + timeTypeValue)
        }

        else if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "计时") {
            //alert("计时报表预览");
            //open('/Report/Invoice_tk' + '?OrderID=' + orderId + '&TimeTypeValue=' + timeTypeValue)
            open('/Report/Invoice_tk' + '?BillingID=' + billingId + '&TimeTypeValue=' + timeTypeValue)
        }
    }

    function CreditPreview() {
        //jqGrid_view_tab

        var rowid = jQuery('#jqGrid_view_tab').jqGrid('getGridParam', 'selrow');
        var creditId = jQuery('#jqGrid_view_tab').jqGrid('getCell', rowid, "IDX"); //CreditId
        var billingId = jQuery('#jqGrid_view_tab').jqGrid('getCell', rowid, "BillingID"); //BillingID
        //open('/Report/CreditNotePage' + '?OrderID=' + orderId + '&CreditID=' + creditId)
        open('/Report/CreditNotePage' + '?BillingID=' + billingId + '&CreditID=' + creditId)
        //alert("orderId = " + orderId + "  creditId = " + creditId +"  弹出回扣单报表");
    }

</script>


<!--Tab 点击-->
<script>
    var g_view_cur_selected_tab = 0; //0:账单， 1：回扣单

    var g_edit_cur_selected_tab = 0; //0:账单， 1：回扣单

    //查看账单界面，点击账单Tab
    function viewInvoiceTabClick() {
        g_view_cur_selected_tab = 0;

        //$('#edit_btn_sumbit').show();
        $('#view_btn_voice_preview').show();
        //alert("账单Tab 点击" + "---" + g_edit_cur_selected_tab);
    }

    //查看账单界面，点击回扣单Tab
    function viewCreditTabClick() {

        g_view_cur_selected_tab = 1;

        //$('#edit_btn_sumbit').hide();
        $('#view_btn_voice_preview').hide();
        //alert("回扣单Tab 点击" + "---" + g_edit_cur_selected_tab);
        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据

        //initViewTabCredit(dr.BillingID);
    }

    //编辑账单界面，点击账单Tab
    function editInvoiceTabClick() {
        g_edit_cur_selected_tab = 0;

        $('#edit_btn_sumbit').show();
        $('#edit_btn_voice_preview').show();
        //alert("账单Tab 点击" + "---" + g_edit_cur_selected_tab);
    }

    //编辑账单界面，点击回扣单Tab
    function editCreditTabClick() {

        g_edit_cur_selected_tab = 1;

        $('#edit_btn_sumbit').hide();
        $('#edit_btn_voice_preview').hide();
        //alert("回扣单Tab 点击" + "---" + g_edit_cur_selected_tab);

        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据

        //initEditTabCredit(dr.BillingID);
    }


</script>


<!--Edit Tab 回扣单-->
<script>
    function initEditTabCredit(billingId) {


        $('#jqGridContainerBox_edit_tab').empty();

        var table = $('<table id="jqGrid_edit_tab"></table>');
        var div = $('<div id="jqGridPager_edit_tab"></div>');

        $('#jqGridContainerBox_edit_tab').append(table).append(div);

        $("#jqGrid_edit_tab").jqGrid({
            url: '@Url.Action("GetCreditData", "Finance")' + '?billingId=' + billingId,
            mtype: "GET",
            datatype: "json",
            colModel: [
                
                {
                    align: 'center', label: '@Resources.Language.Credit_BillingID', name: "BillingID", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.Credit_IDX', name: "IDX", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.Credit_CreditCode', name: "CreditCode", width: 200, editable: false, edittype: "text",
                    editrules: { required: true }, hidden: false,
                },
                {
                    align: 'center', label: '@Resources.Language.Credit_CreditContent', name: "CreditContent", width: 200, editable: true, edittype: "textarea",
                    editrules: { required: true }, hidden: false,
                },
                {
                    align: 'center', label: '@Resources.Language.Credit_CreditAmount', name: "CreditAmount", width: 100, editable: true, edittype: "text",
                    editrules: {
                        required: true,
                        custom_func: function (value, column) {
                            var re = /^\d+\.?\d{0,2}$/;
                            if (!re.test(value)) {
                                return [false, '@Resources.Language.Credit_CreditAmount' + ": 请输入两位正小数!"];
                            }
                            else
                                return [true, ""];

                        },
                        custom: true
                    },
                    hidden: false,
                    editoptions: {
                        defaultValue: 1000
                    }
                },
                {
                    align: 'center', label: '@Resources.Language.Remark', name: "Remark", width: 200, editable: true, edittype: "textarea",
                    editrules: { required: false }, hidden: false,
                },
                {
                    align: 'center', label: '@Resources.Language.OwnerID', name: "OwnerID", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                    editoptions: {
                        defaultValue: -1
                    }
                },
                {
                    align: 'center',
                    label: '@Resources.Language.CreateDate', name: "CreateDate", width: 150, editable: false, edittype: "text",
                    editrules: { required: false, date: true }, hidden: false,
                    sorttype: 'date',
                },
                {
                    align: 'center', label: '@Resources.Language.UserID', name: "UserID", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                    editoptions: {
                        defaultValue: -1
                    }
                },
                {
                    align: 'center',
                    label: '@Resources.Language.LastUpDate', name: "LastUpDate", width: 150, editable: false, edittype: "text",
                    editrules: { required: false, date: true }, hidden: false,
                },
                @*{
                    align: 'center', label: '@Resources.Language.UserDefinedCol1', name: "UserDefinedCol1", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol2', name: "UserDefinedCol2", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol3', name: "UserDefinedCol3", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol4', name: "UserDefinedCol4", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol5', name: "UserDefinedCol5", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, number: true }, hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol6', name: "UserDefinedCol6", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, integer: true }, hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol7', name: "UserDefinedCol7", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, integer: true }, hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol8', name: "UserDefinedCol8", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, integer: true }, hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol9', name: "UserDefinedCol9", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, date: true }, hidden: true,
                },

                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol10', name: "UserDefinedCol10", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, date: true }, hidden: true,
                },

                {
                    align: 'center', label: 'Billing', name: "Billing", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, date: true }, hidden: true,
                }*@

            ],
            viewrecords: true,
            height: '100%',
            rowNum: 15,
            autowidth: true,
            editurl: '@Url.Action("AddEditCredit", "Finance")',
            pager: "#jqGridPager_edit_tab",
            //loadonce: true,
            rowList: ['15', '20', '30', '40', '50'],
            rownumbers: true,
            shrinkToFit: false,     //指定各列宽度
            sortable: true,          //列可移动
            colMenu: false,         //列菜单

        });


        $("#jqGrid_edit_tab").jqGrid('bindKeys');  //光标可以控制上下移动

        $('#jqGridContainerBox_edit_tab').resize(function () {
            var width = $('#jqGridContainerBox_edit_tab').width();
            $("#jqGrid_edit_tab").setGridWidth(width);
        });


        {
            $('#jqGrid_edit_tab').navGrid('#jqGridPager_edit_tab', { edit: false, add: false, del: false, refresh: false, view: false, search: false })

                    .navButtonAdd('#jqGridPager_edit_tab', {
                        //id: 'jqGrid_ilrefresh',
                        caption: "", title: '@Resources.Language.Refresh', buttonicon: "ui-icon-refresh",
                        onClickButton: function () {
                            $('#jqGrid_edit_tab').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                        }
                    })

                    .navButtonAdd('#jqGridPager_edit_tab', {
                        //id: 'jqGrid_ildelete',
                        caption: "", title: '@Resources.Language.DeleteSelectedRows', buttonicon: "ui-icon-trash",
                        onClickButton: function () {
                            var rowid = jQuery('#jqGrid_edit_tab').jqGrid('getGridParam', 'selrow');
                            var dr = jQuery("#jqGrid_edit_tab").jqGrid('getRowData', rowid);//得到该行的数据
                            var creditId = dr.IDX;
                            if (rowid != null) {
                                if (confirm('@Resources.Language.SureDelete')) {
                                    $.ajax(
                                        {
                                            type: "post",
                                            url: '@Url.Action("DeleteCredit", "Finance")',
                                            data: { 'creditId': creditId },
                                            dataType: 'json',
                                            success: function (result) {
                                                alert(result.message);
                                                //jQuery("#jqGrid").jqGrid('delRowData', rowid);
                                                $('#jqGrid_edit_tab').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                                            },

                                        }
                                        );
                                }
                            }
                            else {
                                alert('选中一行');
                            }
                        },
                        position: "last"
                    });
        }

        $('#jqGrid_edit_tab').inlineNav('#jqGridPager_edit_tab',
            {
                refresh:false,
                edit: true,
                add: false,
                del: false,
                cancel: true,
                editParams: {
                    keys: true,
                    successfunc: function (val) {
                        if (val.responseText != "") {
                            var ret = $.parseJSON(val.responseText);
                            alert(ret.message);
                            $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                        }
                    },
                    url: null, //'/api/values',
                    mtype: 'POST'
                },

                addParams: {
                    keys: true,
                    successfunc: function (val) {
                        if (val.responseText != "") {
                            var ret = $.parseJSON(val.responseText);
                            alert(ret.message);
                            $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                        }
                    },
                    errorfunc: function (rowid, xhr) {
                        alert(xhr.responseText);
                        $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    }
                }
            });

        g_EditModalIsShown = true;
    }

</script>


<!--View Tab 回扣单-->
<script>
    function initViewTabCredit(billingId) {

        $('#jqGridContainerBox_view_tab').empty();

        var table = $('<table id="jqGrid_view_tab"></table>');
        var div = $('<div id="jqGridPager_view_tab"></div>');

        $('#jqGridContainerBox_view_tab').append(table).append(div);

        $("#jqGrid_view_tab").jqGrid({
            url: '@Url.Action("GetCreditData", "Finance")' + '?billingId=' + billingId,
            mtype: "GET",
            datatype: "json",
            colModel: [
                {
                    align: 'center', label: '@Resources.Language.Credit_IDX', index: "IDX", name: "IDX", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.Credit_BillingID', name: "BillingID", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },

                {
                    align: 'center', label: '@Resources.Language.Credit_CreditCode', name: "CreditCode", width: 200, editable: false, edittype: "text",
                    editrules: { required: true }, hidden: false,
                },
                {
                    align: 'center', label: '@Resources.Language.Credit_CreditContent', name: "CreditContent", width: 200, editable: true, edittype: "textarea",
                    editrules: { required: true }, hidden: false,
                },
                {
                    align: 'center', label: '@Resources.Language.Credit_CreditAmount', name: "CreditAmount", width: 100, editable: true, edittype: "text",
                    editrules: {
                        required: true,
                        custom_func: function (value, column) {
                            var re = /^\d+\.?\d{0,2}$/;
                            if (!re.test(value)) {
                                return [false, '@Resources.Language.Credit_CreditAmount' + ": 请输入两位正小数!"];
                            }
                            else
                                return [true, ""];

                        },
                        custom: true
                    },
                    hidden: false,
                    editoptions: {
                        defaultValue: 1000
                    }
                },
                {
                    align: 'center', label: '@Resources.Language.Remark', name: "Remark", width: 200, editable: true, edittype: "textarea",
                    editrules: { required: false }, hidden: false,
                },
                {
                    align: 'center', label: '@Resources.Language.OwnerID', name: "OwnerID", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                    editoptions: {
                        defaultValue: -1
                    }
                },
                {
                    align: 'center',
                    label: '@Resources.Language.CreateDate', name: "CreateDate", width: 150, editable: false, edittype: "text",
                    editrules: { required: false, date: true }, hidden: false,
                    sorttype: 'date',
                },
                {
                    align: 'center', label: '@Resources.Language.UserID', name: "UserID", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                    editoptions: {
                        defaultValue: -1
                    }
                },
                {
                    align: 'center',
                    label: '@Resources.Language.LastUpDate', name: "LastUpDate", width: 150, editable: false, edittype: "text",
                    editrules: { required: false, date: true }, hidden: false,
                },
                @*{
                    align: 'center', label: '@Resources.Language.UserDefinedCol1', name: "UserDefinedCol1", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol2', name: "UserDefinedCol2", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol3', name: "UserDefinedCol3", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol4', name: "UserDefinedCol4", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol5', name: "UserDefinedCol5", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, number: true }, hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol6', name: "UserDefinedCol6", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, integer: true }, hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol7', name: "UserDefinedCol7", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, integer: true }, hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol8', name: "UserDefinedCol8", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, integer: true }, hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol9', name: "UserDefinedCol9", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, date: true }, hidden: true,
                },

                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol10', name: "UserDefinedCol10", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, date: true }, hidden: true,
                }*@

            ],
            viewrecords: true,
            height: '100%',
            rowNum: 15,
            autowidth: true,
            editurl: '@Url.Action("AddEditCredit", "Finance")',
            pager: "#jqGridPager_view_tab",
            //loadonce: true,
            rowList: ['15', '20', '30', '40', '50'],
            rownumbers: true,
            shrinkToFit: false,     //指定各列宽度
            sortable: true,          //列可移动
            colMenu: false,         //列菜单

        });

        $("#jqGrid_view_tab").jqGrid('bindKeys');  //光标可以控制上下移动

        $('#jqGridContainerBox_view_tab').resize(function () {
            var width = $('#jqGridContainerBox_view_tab').width();
            $("#jqGrid_view_tab").setGridWidth(width);
        });

        /*if (g_ViewModalIsShown == false)*/ {

            $('#jqGrid_view_tab').navGrid('#jqGridPager_view_tab', { edit: false, add: false, del: false, refresh: true, view: false, search: false })
            .navButtonAdd('#jqGridPager_view_tab', {
                //id: 'jqGrid_ilAdd',
                caption: "预览", title: "预览回扣单", buttonicon: "ui-icon-document",
                onClickButton: function () {
                    var rowid = jQuery('#jqGrid_view_tab').jqGrid('getGridParam', 'selrow');
                    //alert(rowid);
                    if (rowid != null) {

                        //var cell = jQuery('#jqGrid_view_tab').jqGrid('getCell', rowid, "BillingID"); //BillingID
                        //if (cell == null || cell == "")
                        //    AddParent();
                        //else {
                        //    //编辑
                        //    alert('所选记录已有账单，无需重复生成！');
                        //}
                        CreditPreview();
                    }
                    else {
                        alert('选中一行');
                    }
                },

            });
        }

        g_ViewModalIsShown = true;
    }
</script>


<!--新增回扣单模态框-->
<script>

    //保存Grid当前选择的行号
    var g_curRowId = '';

    function AddCreditModal() {
        $('#credit-add-modal').modal()
    }

    function initAddCreditModal() {

        $('#creditErrMsg').hide();

        $('#_CreditContent').parent().removeClass("has-error");
        $('#_CreditAmount').parent().removeClass("has-error");
        $('#_Remark').parent().removeClass("has-error");

        $('#_CreditContent').val("");
        $('#_CreditAmount').val("");
        $('#_Remark').val("");
    }

    $('#credit-add-modal').on('show.bs.modal', function (e) {
        initAddCreditModal();
    });
    $('#credit-add-modal').on('shown.bs.modal', function (e) {

    });
    $('#credit-add-modal').on('hide.bs.modal', function () {
        $(this).removeData("bs.modal");
    });
    $('#credit-add-modal').on('hidden.bs.modal', function () {
        $(this).removeData("bs.modal");
    });

    function submitAddCreditModal() {
        var maxTextLength = 50;
        var maxTextAreaLength = 500;

        var g_curRowId = jQuery("#jqGrid").jqGrid('getGridParam', 'selrow');//得到该行的数据
        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据


        var billingId = dr.IDX;
        var billingCode = dr.BillingCode;
        var creditContent = $('#_CreditContent').val().trim();
        var creditAmount = $('#_CreditAmount').val().trim();
        var remark = $('#_Remark').val().trim();


        //校验
        if ($("#_CreditContent").val().toString().trim().length <= 0) {
            $('#creditErrMsg p').html('@Resources.Language.Credit_CreditContent' + "必填");
            $('#_CreditContent').parent().addClass("has-error");
            $('#creditErrMsg').show();
            return;
        }
        else if ($("#_CreditContent").val().toString().trim().length > maxTextAreaLength) {
            $('#creditErrMsg p').html('@Resources.Language.Credit_CreditContent' + "长度不能超过" + maxTextAreaLength);
            $('#_CreditContent').parent().addClass("has-error");
            $('#creditErrMsg').show();
            return;
        }

        else if ($("#_CreditAmount").val().toString().trim().length <= 0) {
            $('#creditErrMsg p').html('@Resources.Language.Credit_CreditAmount' + "必填");
            $('#_CreditAmount').parent().addClass("has-error");
            $('#creditErrMsg').show();
            return;
        }

        else if ($("#_Remark").val().toString().trim().length > maxTextAreaLength) {
            $('#creditErrMsg p').html('@Resources.Language.Remark' + "长度不能超过" + maxTextAreaLength);
            $('#_Remark').parent().addClass("has-error");
            $('#creditErrMsg').show();
            return;
        }

        //提交数据库
        $.ajax({
            type: "post",
            url: '@Url.Action("AddCredit", "Finance")',
            data: {
                'billingId': billingId,
                'billingCode':billingCode,
                'creditContent': creditContent,
                'creditAmount':creditAmount,
                'remark': remark
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {
                $('#credit-add-modal').modal('hide')
                alert(result.message);
            },
        });
    }
</script>


<script>
    //将传入数据转换为字符串,并清除字符串中非数字与.的字符
    //按数字格式补全字符串
    function GetFloatStr(num) {

        var isMinus = false;
        if (num < 0) {
            isMinus = true;
        }
        num += '';
        num = num.replace(/[^0-9|\.]/g, ''); //清除字符串中的非数字非.字符

        if (/^0+/) //清除字符串开头的0
            num = num.replace(/^0+/, '');
        if (!/\./.test(num)) //为整数字符串在末尾添加.00
            num += '.00';
        if (/^\./.test(num)) //字符以.开头时,在开头添加0
            num = '0' + num;
        num += '00';        //在字符串末尾补零
        num = num.match(/\d+\.\d{2}/)[0];

        if (isMinus == true) {
            num = "-" + num;
        }

        return num;
    };


    function FormatPrice(strNum) {
        var part1 = strNum.split('.')[0]; //整数部分
        var part2 = strNum.split('.')[1]; //小数部分


        if (part1.length <= 3) {
            return part1.toString() + "." + part2.toString();
        }
        if (!/^(\+|-)?(\d+)(\.\d+)?$/.test(part1)) {
            return part1.toString() + "." + part2.toString();
        }
        var a = RegExp.$1, b = RegExp.$2, c = RegExp.$3;
        var re = new RegExp();
        re.compile("(\\d)(\\d{3})(,|$)");
        while (re.test(b)) {
            b = b.replace(re, "$1,$2$3");
        }
        return a + "" + b + "" + c + "." + part2.toString();
    }

    function ConvertToRealPrice(number) {

        number = number.replace(/\,/g, "");
        return parseFloat(number);
        //if (isNaN(number) || number == "") return ;
        //number = Math.round(number * 100) / 100;
        //if (number < 0)
        //    return '-' + outputdollars(Math.floor(Math.abs(number) - 0) + '') + outputcents(Math.abs(number) - 0);
        //else
        //    return outputdollars(Math.floor(number - 0) + '') + outputcents(number - 0);
    }
    //格式化金额
    function outputdollars(number) {
        if (number.length <= 3)
            return (number == '' ? '0' : number);
        else {
            var mod = number.length % 3;
            var output = (mod == 0 ? '' : (number.substring(0, mod)));
            for (i = 0; i < Math.floor(number.length / 3) ; i++) {
                if ((mod == 0) && (i == 0))
                    output += number.substring(mod + 3 * i, mod + 3 * i + 3);
                else
                    output += ',' + number.substring(mod + 3 * i, mod + 3 * i + 3);
            }
            return (output);
        }
    }
    function outputcents(amount) {
        amount = Math.round(((amount) - Math.floor(amount)) * 100);
        return (amount < 10 ? '.0' + amount : '.' + amount);
    }
</script>