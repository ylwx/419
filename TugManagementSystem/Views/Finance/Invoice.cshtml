@{
    ViewBag.Title = @Resources.Language.InvoiceManage;
    ViewBag.MenuId = "menu6";
    ViewBag.SubMenuIndex = 0;
    Layout = "~/Views/Shared/_ContentLayout.cshtml";
}

<script src="~/Resources/handsontable-master/dist/handsontable.full.min.js"></script>
<link href="~/Resources/handsontable-master/dist/handsontable.full.css" rel="stylesheet" />
<script src="~/Resources/handsontable-master/demo/js/moment/moment.js"></script>
<script src="~/Resources/handsontable-master/demo/js/pikaday/pikaday.js"></script>
<script src="~/Resources/handsontable-master/demo/js/pikaday/css/pikaday.css"></script>

<div id="main-content">
    <!-- Add MODAL FORM-->
    <div class="modal fade" id="parent-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="model-dlg" class="modal-dialog" style="width:1024px">
            <div class="modal-content modal-table">
                @*<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">拖轮选择</h4>
                    </div>*@
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box border blue">
                                <div class="box-title">
                                    <h4><i class="fa fa-windows"></i>生成账单</h4>
                                    <div class="tools hidden-xs">
                                        <a href="javascript:;" class="" onclick="$('#parent-modal').modal('hide');">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>

                                <div class="box-body big">

                                    <div id="div_search" class="col-lg-12" style="padding-bottom:10px">

                                        <div class="col-xs-3">
                                            选择计费方案
                                            <select id="sel_billing_scheme" class="form-control" onchange="billingSchemeChanged($(this).val())">
                                                <option value="">1</option>
                                                <option value="">2</option>
                                                <option value="">3</option>
                                            </select>
                                        </div>
                                        <div class="col-xs-3">
                                            账单类型
                                            @*<select id="sel_billing_type" class="form-control" onchange="btnClick()">
                                                <option value="">1</option>
                                                <option value="">2</option>
                                                <option value="">3</option>
                                            </select>*@

                                            <input id="sel_billing_type" type="text" class="form-control" readonly />
                                        </div>
                                        <div class="col-xs-3">
                                            计时方式
                                            @*<select id="sel_time_type" class="form-control" onchange="btnClick()">
                                                <option value="">1</option>
                                                <option value="">2</option>
                                                <option value="">3</option>
                                            </select>*@
                                            <input id="sel_time_type" type="text" class="form-control" readonly />
                                        </div>

                                        <div class="col-xs-3" hidden>
                                            折扣
                                            <input id="txt_discount" type="text" class="form-control" readonly />
                                        </div>
                                        
                                        @*<div class="col-xs-3">
                                            <button type="submit" class="btn btn-pink" style="margin-top:17px" onclick="btnClick()">
                                                重新生成
                                            </button>
                                        </div>*@
                                    </div>

                                    <div style="margin:8px;padding:0px; width:940px;height:1px;background-color:black;overflow:hidden;"></div>

                                    <div id="div_services" class="col-md-12">
                                        <div class="col-md-2">
                                            <p>服务项目:<br>SERVICE:</p>
                                        </div>
                                        <div class="col-md-2">
                                            <p>服务项目:<br>SERVICE:</p>
                                            <p>服务项目:<br>SERVICE:</p>
                                            <p>服务项目:<br>SERVICE:</p>
                                        </div>
                                        <div class="col-md-8">
                                            <p>服务项目:<br>SERVICE:</p>
                                        </div>
                                    </div>

                                    <div style="margin: 8px; padding: 0px; width: 940px; height: 1px; background-color: black; overflow: hidden;"></div>

                                    <div id="div_detail">
                                        <table id="tb_detail" class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th width="" rowspan="2" data-halign="center" data-align="center" data-valign="bottom" style="text-align:center;vertical-align:middle">拖轮</th>
                                                    <th width="" colspan="2" data-halign="center" data-align="center" data-valign="middle">泊码头</th>
                                                    <th width="" colspan="3" data-halign="center" data-align="center" data-valign="middle">离码头</th>
                                                    <th width="" colspan="1" data-halign="center" data-align="center" data-valign="middle">护航</th>
                                                </tr>
                                                <tr>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">海发</th>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">海泰</th>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">海友</th>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                    <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><input type="checkbox" class=""> 离厂时间</td>
                                                    <td>08:00</td>
                                                    <td>12:20</td>
                                                    <td>1</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 回厂时间
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 工作时间
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 协议收费
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 合计港币
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        工作耗时
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 燃油附加费
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 拖缆费
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" class=""> 总数港币
                                                    </td>
                                                    <td>Item 2</td>
                                                    <td>￥3.00</td>
                                                    <td>2</td>
                                                </tr>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    @*<td colspan="13" style="text-align:right">共&nbsp; 计&nbsp;港&nbsp;币：12333 <br> Grand Total HKS</td>*@
                                                    <td colspan="6" style="text-align:right"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>
                                                    <td style="text-align:center;"><strong>12345.67</strong></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>

                                    <div id="parentErrMsg" class="alert alert-block alert-warning fade in" hidden>
                                        @*<a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>*@
                                        <i class="fa fa-exclamation-circle"></i><p style=""></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div id="_CustomerID" hidden>-1</div>
                    <div id="_ShipID" hidden>-1</div>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">关闭</button>
                    <button id="add_btn_sumbit" type="button" class="btn btn-primary" onclick="submitParentModal()">提交</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Add MODAL FORM-->


    <!-- View MODAL FORM-->
    <div class="modal fade" id="view-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="model-dlg" class="modal-dialog" style="width:1024px">
            <div class="modal-content modal-table">
                @*<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">拖轮选择</h4>
                    </div>*@
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box border blue">
                                <div class="box-title">
                                    <h4><i class="fa fa-windows"></i>查看账单和回扣单</h4>
                                    <div class="tools hidden-xs">
                                        <a href="javascript:;" class="" onclick="$('#view-modal').modal('hide');">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>

                                <div class="box-body big">

                                    <div class="tabbable header-tabs">
                                        <ul class="nav nav-tabs">
                                            <li><a href="#box_tab2" data-toggle="tab"><i class="fa fa-dollar"></i> <span class="hidden-inline-mobile">回扣单</span></a></li>
                                            <li class="active"><a href="#box_tab1" data-toggle="tab"><i class="fa fa-credit-card"></i> <span class="hidden-inline-mobile">账单</span></a></li>
                                        </ul>
                                        <div class="tab-content">
                                            <div class="tab-pane fade in active" id="box_tab1">

                                                <div id="view_div_search" class="col-lg-12" style="padding-bottom:10px">

                                                    <div class="col-xs-3">
                                                        选择计费方案
                                                        <select id="view_sel_billing_scheme" class="form-control" onchange="view_billingSchemeChanged($(this).val())">
                                                            <option value="">1</option>
                                                            <option value="">2</option>
                                                            <option value="">3</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-xs-3">
                                                        账单类型
                                                        @*<select id="sel_billing_type" class="form-control" onchange="btnClick()">
                                    <option value="">1</option>
                                    <option value="">2</option>
                                    <option value="">3</option>
                                </select>*@

                                                        <input id="view_sel_billing_type" type="text" class="form-control" readonly />
                                                    </div>
                                                    <div class="col-xs-3">
                                                        计时方式
                                                        @*<select id="sel_time_type" class="form-control" onchange="btnClick()">
                                    <option value="">1</option>
                                    <option value="">2</option>
                                    <option value="">3</option>
                                </select>*@
                                                        <input id="view_sel_time_type" type="text" class="form-control" readonly />
                                                    </div>

                                                    <div class="col-xs-3" hidden>
                                                        折扣
                                                        <input id="view_txt_discount" type="text" class="form-control" readonly />
                                                    </div>
                                                </div>

                                                <div style="margin:8px;padding:0px; width:940px;height:1px;background-color:black;overflow:hidden;"></div>

                                                <div id="view_div_services" class="col-md-12">
                                                    <div class="col-md-2">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                        <p>服务项目:<br>SERVICE:</p>
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                    <div class="col-md-8">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                </div>

                                                <div style="margin: 8px; padding: 0px; width: 940px; height: 1px; background-color: black; overflow: hidden;"></div>

                                                <div id="view_div_detail">
                                                    <table id="view_tb_detail" class="table table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th width="" rowspan="2" data-halign="center" data-align="center" data-valign="bottom" style="text-align:center;vertical-align:middle">拖轮</th>
                                                                <th width="" colspan="2" data-halign="center" data-align="center" data-valign="middle">泊码头</th>
                                                                <th width="" colspan="3" data-halign="center" data-align="center" data-valign="middle">离码头</th>
                                                                <th width="" colspan="1" data-halign="center" data-align="center" data-valign="middle">护航</th>
                                                            </tr>
                                                            <tr>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海发</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海泰</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海友</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td><input type="checkbox" class=""> 离厂时间</td>
                                                                <td>08:00</td>
                                                                <td>12:20</td>
                                                                <td>1</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 回厂时间
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 工作时间
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 协议收费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 合计港币
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    工作耗时
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 燃油附加费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 拖缆费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 总数港币
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                        </tbody>
                                                        <tfoot>
                                                            <tr>
                                                                @*<td colspan="13" style="text-align:right">共&nbsp; 计&nbsp;港&nbsp;币：12333 <br> Grand Total HKS</td>*@
                                                                <td colspan="6" style="text-align:right"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>
                                                                <td style="text-align:center;"><strong>12345.67</strong></td>
                                                            </tr>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>

                                            <div class="tab-pane fade" id="box_tab2">
                                                <p>Content #2</p>
                                                <p> There were flying cantaloupes, rainbows and songs of happiness near by, I mean I was a little frightened by the flying fruit but I'll take this any day over prison inmates. I skipped closer and closer to the festivities and when I arrived I seen all my friends I had went to high school with there were holding hands and singing Kumbayah around the camp ice.. Yes It was a giant block of ice situated on three wood logs. </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /View MODAL FORM-->


    <!-- Edit MODAL FORM-->
    <div class="modal fade" id="edit-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="model-dlg" class="modal-dialog" style="width:1024px">
            <div class="modal-content modal-table">
                @*<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">拖轮选择</h4>
                    </div>*@
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box border blue">
                                <div class="box-title">
                                    <h4><i class="fa fa-windows"></i>编辑账单和回扣单</h4>
                                    <div class="tools hidden-xs">
                                        <a href="javascript:;" class="" onclick="$('#view-modal').modal('hide');">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>

                                <div class="box-body big">

                                    <div class="tabbable header-tabs">
                                        <ul class="nav nav-tabs">
                                            <li><a href="#edit_box_tab2" data-toggle="tab"><i class="fa fa-dollar"></i> <span class="hidden-inline-mobile">回扣单</span></a></li>
                                            <li class="active"><a href="#edit_box_tab1" data-toggle="tab"><i class="fa fa-credit-card"></i> <span class="hidden-inline-mobile">账单</span></a></li>
                                        </ul>
                                        <div class="tab-content">
                                            <div class="tab-pane fade in active" id="edit_box_tab1">

                                                <div id="edit_div_search" class="col-lg-12" style="padding-bottom:10px">

                                                    <div class="col-xs-3">
                                                        选择计费方案
                                                        <select id="edit_sel_billing_scheme" class="form-control" onchange="edit_billingSchemeChanged($(this).val())">
                                                            <option value="">1</option>
                                                            <option value="">2</option>
                                                            <option value="">3</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-xs-3">
                                                        账单类型
                                                        @*<select id="sel_billing_type" class="form-control" onchange="btnClick()">
                                    <option value="">1</option>
                                    <option value="">2</option>
                                    <option value="">3</option>
                                </select>*@

                                                        <input id="edit_sel_billing_type" type="text" class="form-control" readonly />
                                                    </div>
                                                    <div class="col-xs-3">
                                                        计时方式
                                                        @*<select id="sel_time_type" class="form-control" onchange="btnClick()">
                                    <option value="">1</option>
                                    <option value="">2</option>
                                    <option value="">3</option>
                                </select>*@
                                                        <input id="edit_sel_time_type" type="text" class="form-control" readonly />
                                                    </div>

                                                    <div class="col-xs-3" hidden>
                                                        折扣
                                                        <input id="edit_txt_discount" type="text" class="form-control" readonly />
                                                    </div>
                                                </div>

                                                <div style="margin:8px;padding:0px; width:940px;height:1px;background-color:black;overflow:hidden;"></div>

                                                <div id="edit_div_services" class="col-md-12">
                                                    <div class="col-md-2">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                        <p>服务项目:<br>SERVICE:</p>
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                    <div class="col-md-8">
                                                        <p>服务项目:<br>SERVICE:</p>
                                                    </div>
                                                </div>

                                                <div style="margin: 8px; padding: 0px; width: 940px; height: 1px; background-color: black; overflow: hidden;"></div>

                                                <div id="edit_div_detail">
                                                    <table id="edit_tb_detail" class="table table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th width="" rowspan="2" data-halign="center" data-align="center" data-valign="bottom" style="text-align:center;vertical-align:middle">拖轮</th>
                                                                <th width="" colspan="2" data-halign="center" data-align="center" data-valign="middle">泊码头</th>
                                                                <th width="" colspan="3" data-halign="center" data-align="center" data-valign="middle">离码头</th>
                                                                <th width="" colspan="1" data-halign="center" data-align="center" data-valign="middle">护航</th>
                                                            </tr>
                                                            <tr>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海发</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海泰</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">海友</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                                <th width="" data-halign="center" data-align="center" data-valign="middle">#REF</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td><input type="checkbox" class=""> 离厂时间</td>
                                                                <td>08:00</td>
                                                                <td>12:20</td>
                                                                <td>1</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 回厂时间
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 工作时间
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 协议收费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 合计港币
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    工作耗时
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 燃油附加费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 拖缆费
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class=""> 总数港币
                                                                </td>
                                                                <td>Item 2</td>
                                                                <td>￥3.00</td>
                                                                <td>2</td>
                                                            </tr>
                                                        </tbody>
                                                        <tfoot>
                                                            <tr>
                                                                @*<td colspan="13" style="text-align:right">共&nbsp; 计&nbsp;港&nbsp;币：12333 <br> Grand Total HKS</td>*@
                                                                <td colspan="6" style="text-align:right"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>
                                                                <td style="text-align:center;"><strong>12345.67</strong></td>
                                                            </tr>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>

                                            <div class="tab-pane fade" id="edit_box_tab2">
                                                <p>Content #2</p>
                                                <p> There were flying cantaloupes, rainbows and songs of happiness near by, I mean I was a little frightened by the flying fruit but I'll take this any day over prison inmates. I skipped closer and closer to the festivities and when I arrived I seen all my friends I had went to high school with there were holding hands and singing Kumbayah around the camp ice.. Yes It was a giant block of ice situated on three wood logs. </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">关闭</button>
                    <button id ="edit_btn_sumbit" type="button" class="btn btn-primary" onclick="submitEditVoiceModal()">提交</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Edit MODAL FORM-->


    <!-- 提交审核 MODAL FORM-->
    <div class="modal fade" id="table-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="model-dlg" class="modal-dialog" style="width: 560px ;height:600px">
            <div class="modal-content modal-table">
                @*<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">拖轮选择</h4>
                    </div>*@
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <!-- BOX -->
                            <div class="box border orange">
                                <div class="box-title">
                                    <h4><i class="fa fa-bars"></i>创建流程</h4>
                                </div>
                                <div class="box-body">
                                    <div id="flowtable" class="hot handsontable dataTable table-striped center-block">
                                    </div>
                                </div>
                            </div>
                            <!-- /BOX -->
                        </div>
                    </div>
                    <div id="childErrMsg" class="alert alert-block alert-warning fade in" hidden>
                        <i class="fa fa-exclamation-circle"></i><p style=""></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">关闭</button>
                    <button id="btnflow" type="button" class="btn btn-primary" @*onclick="updateflowinfor()"*@>提交审核</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /提交审核 MODAL FORM-->

    <div class="container">
        <div class="row">
            <div id="content" class="col-lg-12">
                <!-- PAGE HEADER-->
                <div class="row">
                    <div class="col-sm-12">
                        <div class="">
                            <!-- STYLER -->
                            <!-- /STYLER -->
                            <!-- BREADCRUMBS -->
                            <ul class="breadcrumb">
                                <li>
                                    <i class="fa fa-home"></i>
                                    <a href="#">@Resources.Language.HomePage</a>
                                </li>
                                <li>
                                    <i class="fa fa-usd"></i>
                                    <a href="#">@Resources.Language.Finance</a>
                                </li>
                                <li>
                                    @Resources.Language.InvoiceManage
                                </li>
                            </ul>
                            <!-- /BREADCRUMBS -->
                            @*<div class="clearfix">
                                    <h3 class="content-title pull-left">Grid Test</h3>
                                </div>
                                <div class="description">Table</div>*@
                            @*<div><button class="btn btn-danger" onclick="AddParent()">Add Parent</button></div>*@
                        </div>
                    </div>
                </div>
                <!-- /PAGE HEADER -->
                @*<div class="row">
                        <div class="col-md-12">
                            <div class="box border orange">
                                <div class="box-title">
                                </div>
                                <div class="box-body">
                                    <div>
                                        <ul>
                                            <li>@Model.Code</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>*@
                <!-- SAMPLE -->
                <div class="row">
                    <div class="col-md-12">
                        <!-- BOX -->
                        <div class="box border orange">
                            <div class="box-title">
                                <h4><i class="fa fa-bars"></i>@Resources.Language.InvoiceManage</h4>
                            </div>
                            <div id="jqGridContainerBox" class="box-body">
                                <table id="jqGrid"></table>
                                <div id="jqGridPager"></div>
                            </div>
                        </div>
                        <!-- /BOX -->
                    </div>
                </div>
                <!-- /SAMPLE -->
                <div class="footer-tools">
                    <span class="go-top">
                        <i class="fa fa-chevron-up"></i> Top
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 父Grid -->
<script type="text/javascript">
    var tableConfig = null;

    $(document).ready(Init);

    function Init() {
        {
            if (tableConfig == null) {
                GetTableConfig();
            }

            $("#jqGrid").jqGrid({
                url: '@Url.Action("GetInvoiceData", "Finance")',
                mtype: "GET",
                datatype: "json",
                colModel: tableConfig.columns,
                viewrecords: true,
                //width: 780,
                height: '100%', //'auto', //350,
                rowNum: 15,
                autowidth: true,
                editurl: null,
                pager: "#jqGridPager",
                //loadonce: true,
                rowList: ['15', '20', '30', '40', '50'],
                rownumbers: true,
                shrinkToFit: false,     //指定各列宽度
                sortable: true,          //列可移动
                //footerrow: true,
                colMenu: true,          //列菜单

                multiselect: true,
                //multiboxonly: true,

                onSelectRow: function (rowid, status, e) {
                    //alert(rowid)
                    //alert(status);
                    var grid = $("#jqGrid");
                    var rowKey = grid.getGridParam("selrow");

                    if (!rowKey) {
                        $('#jqGrid_ilAdd').addClass('ui-state-disabled');
                        $('#jqGrid_ilDelete').addClass('ui-state-disabled');
                        $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
                        $('#jqGrid_ilView').addClass('ui-state-disabled');
                        $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                        $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                        $('#jqGrid_ilReport').addClass('ui-state-disabled');
                        
                        
                    }
                    else {

                        $('#jqGrid_ilDelete').removeClass('ui-state-disabled');
                        $('#jqGrid_ilSubmit').removeClass('ui-state-disabled');
                        var selectedIDs = grid.getGridParam("selarrrow");

                        if (selectedIDs.length != 1) {
                            $('#jqGrid_ilAdd').addClass('ui-state-disabled');
                            $('#jqGrid_ilView').addClass('ui-state-disabled');
                            $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                            $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                            $('#jqGrid_ilReport').addClass('ui-state-disabled');
                            
                        }
                        else {

                            $('#jqGrid_ilAdd').removeClass('ui-state-disabled');
                            $('#jqGrid_ilView').removeClass('ui-state-disabled');
                            $('#jqGrid_ilAddCredit').removeClass('ui-state-disabled');
                            $('#jqGrid_ilEdit').removeClass('ui-state-disabled');
                            $('#jqGrid_ilReport').removeClass('ui-state-disabled');
                            
                        }

                    }
                },

                //subGrid: true,
                //subGridRowExpanded: showChildGrid,
                //isHasSubGrid: function (rowid) {
                //    // if custommerid begin with B, do not use subgrid
                //    var checkbox_id = 'jqg_jqGrid_' + rowid.toString();

                //    var cell = $(this).jqGrid('getCell', rowid, "BillingID"); //BillingID
                //    if (cell == null || cell == "") {
                //        return false;
                //    }
                //    return true;
                //},

                subGridOptions: {
                    "plusicon": "ui-icon-triangle-1-e",
                    "minusicon": "ui-icon-triangle-1-s",
                    "openicon": "ui-icon-arrowreturn-1-e"
                },
            });

            $('#jqGrid').jqGrid('filterToolbar',
                {
                    searchResult: true, searchOperators: true,
                    beforeSearch: function () {
                        //alert(1);
                        //alert($("#gs_Code").val());
                        var util = new Util();

                        var ret = true;

                        //价格
                        if ($("#gs_Amount").val() != null && $("#gs_Amount").val() != "")
                            ret = ret && util.isValidCurrency('@Resources.Language.V_OrderBilling_Amount', $("#gs_Amount").val());

                        //时间
                        if ($("#gs_WorkTime").val() != null && $("#gs_WorkTime").val() != "")
                            ret = ret && util.isTime('@Resources.Language.V_OrderInfor_WorkTime', $("#gs_WorkTime").val());
                        if ($("#gs_EstimatedCompletionTime").val() != null && $("#gs_EstimatedCompletionTime").val() != "")
                            ret = ret && util.isTime('@Resources.Language.V_OrderInfor_EstimatedCompletionTime', $("#gs_EstimatedCompletionTime").val());

                        //日期
                        if ($("#gs_WorkDate").val() != null && $("#gs_WorkDate").val() != "")
                            ret = ret && util.isDate('@Resources.Language.V_OrderInfor_WorkDate', $("#gs_WorkDate").val());
                        if ($("#gs_BillingCreateDate").val() != null && $("#gs_BillingCreateDate").val() != "")
                            ret = ret && util.isDateTime('@Resources.Language.CreateDate', $("#gs_BillingCreateDate").val());
                        if ($("#gs_BillingLastUpDate").val() != null && $("#gs_BillingLastUpDate").val() != "")
                            ret = ret && util.isDateTime('@Resources.Language.LastUpDate', $("#gs_BillingLastUpDate").val());

                        //alert(ret); //ret为true，说明验证客户端验证通过，需要进行搜索；反之，不进行搜索
                        return !ret; //beforeSearch 返回true不触发搜索，false出发搜索
                    }
                });

            $("#jqGrid").jqGrid('bindKeys');  //光标可以控制上下移动

            $('#jqGridContainerBox').resize(function () {
                var width = $('#jqGridContainerBox').width();
                $("#jqGrid").setGridWidth(width);
            });

            $('#jqGrid').navGrid('#jqGridPager', { edit: false, add: false, del: false, refresh: false, view: false, search: false })

                .navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilRefresh',
                    caption: "", title: "刷新", buttonicon: "ui-icon-refresh",
                    onClickButton: function () {
                        $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    }
                })
                .navButtonAdd('#jqGridPager', {
                    caption: "", title: "清除搜索项", buttonicon: "ui-icon-circle-minus",
                    onClickButton: function () {
                        var grid = $('#jqGrid')[0];
                        grid.clearToolbar();
                        $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    }
                })
                .navSeparatorAdd("#jqGridPager", { sepclass: "ui-separator", sepcontent: '' })
                .navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilDelete',
                    caption: "删除", title: "删除账单", buttonicon: "ui-icon-trash",
                    onClickButton: function () {

                        var selectedIDs = jQuery('#jqGrid').getGridParam("selarrrow");
                        var result = ""; //保存需要删除的账单ID
                        for (var i = 0; i < selectedIDs.length; i++) {

                            var cell = jQuery('#jqGrid').jqGrid('getCell', selectedIDs[i], "BillingID"); //BillingID
                            if (cell != null && cell != "")
                                result += cell + ",";
                        }
                        if (result != "")
                            result = result.substr(0, result.length - 1);
                        else {
                            alert('所选记录暂无账单，无需删除！');
                            return;
                        }

                        if (confirm('确定要删除所选的记录吗?')) {

                            $.ajax(
                                {
                                    type: "post",
                                    url: '@Url.Action("DeleteInvoice", "Finance")',
                                    data: { 'oper': 'delete', 'billIds': result },//"oper=delete&id=" + gr,
                                    dataType: 'json',
                                    success: function (result) {
                                        alert(result.message);
                                        //jQuery("#jqGrid").jqGrid('delRowData', rowid);
                                        $('#jqGrid_ilAdd').addClass('ui-state-disabled');
                                        $('#jqGrid_ilDelete').addClass('ui-state-disabled');
                                        $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
                                        $('#jqGrid_ilView').addClass('ui-state-disabled');
                                        $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                                        $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                                        $('#jqGrid_ilReport').addClass('ui-state-disabled');
                                        

                                        $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                                    },

                                }
                                );
                        }

                    },
                    position: "last"
                }).navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilAdd',
                    caption: "账单", title: "新增账单", buttonicon: "ui-icon-plus",
                    onClickButton: function () {
                        var rowid = jQuery('#jqGrid').jqGrid('getGridParam', 'selrow');
                        //alert(rowid);
                        if (rowid != null) {
                            g_curRowId = rowid;

                            var cell = $(this).jqGrid('getCell', rowid, "BillingID"); //BillingID
                            if (cell == null || cell == "")
                                AddParent();
                            else {
                                //编辑
                                alert('所选记录已有账单，无需重复生成！');
                            }
                        }
                        else {
                            alert('选中一行');
                        }
                    },

                }).navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilAddCredit',
                    caption: "回扣单", title: "新增回扣单", buttonicon: "ui-icon-plus",
                    onClickButton: function () {
                        var rowid = jQuery('#jqGrid').jqGrid('getGridParam', 'selrow');
                        //alert(rowid);
                        if (rowid != null) {
                            g_curRowId = rowid;

                            var cell = $(this).jqGrid('getCell', rowid, "BillingID"); //BillingID
                            if (cell == null || cell == "") {
                                alert('所选记录暂无账单，无法新增回扣单，请先生成账单！');
                                return;
                            }
                            else {
                                //编辑
                                alert('弹出新增回扣单');
                                //AddParent();
                            }
                        }
                        else {
                            alert('选中一行');
                        }
                    },

                }).navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilEdit',
                    caption: "编辑", title: "编辑账单和回扣单", buttonicon: "ui-icon-pencil",
                    onClickButton: function () {
                        var rowid = jQuery('#jqGrid').jqGrid('getGridParam', 'selrow');
                        //alert(rowid);
                        if (rowid != null) {
                            g_curRowId = rowid;

                            var cell = $(this).jqGrid('getCell', rowid, "BillingID"); //BillingID
                            if (cell == null || cell == "") {
                                alert('所选记录暂无账单，无法编辑，请先生成账单！');
                                return;
                            }
                            else {
                                //编辑
                                //alert('弹出编辑账单和回扣单');
                                //AddParent();
                                EditInvoice();
                            }
                        }
                        else {
                            alert('选中一行');
                        }
                    },

                })
                .navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilSubmit',
                    caption: "审核", title: "提交审核", buttonicon: "ui-icon-circle-plus",
                    onClickButton: function () {
                        var selectedIDs = jQuery('#jqGrid').getGridParam("selarrrow");
                        var result = "";
                        for (var i = 0; i < selectedIDs.length; i++) {

                            var cell = jQuery('#jqGrid').jqGrid('getCell', selectedIDs[i], "BillingID"); //BillingID
                            if (cell != null && cell != "")
                                result += cell + ",";
                        }

                        if (result != "")
                            result = result.substr(0, result.length - 1);
                        else {
                            alert('所选记录暂无账单，无需提交审核！');
                            return;
                        }

                        g_submit_billIds = result;

                        $('#table-modal').modal();
                    },

                }).navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilView',
                    caption: "查看", title: "查看账单和回扣单", buttonicon: "ui-icon-search",
                    onClickButton: function () {
                      
                        var rowid = jQuery('#jqGrid').jqGrid('getGridParam', 'selrow');
                        //alert(rowid);
                        if (rowid != null) {
                            g_curRowId = rowid;

                            var cell = $(this).jqGrid('getCell', rowid, "BillingID"); //BillingID
                            if (cell == null || cell == "") {
                                alert('所选记录暂无账单，无法查看！');
                                return;
                            }
                            else {
                                //查看
                                ViewInvoice();
                            }
                        }
                        else {
                            alert('选中一行');
                        }
                    },

                }).navButtonAdd('#jqGridPager', {
                    id: 'jqGrid_ilReport',
                    caption: "预览", title: "报表预览", buttonicon: "ui-icon-document",
                    onClickButton: function () {

                        var rowid = jQuery('#jqGrid').jqGrid('getGridParam', 'selrow');
                        //alert(rowid);
                        if (rowid != null) {
                            g_curRowId = rowid;

                            var cell = $(this).jqGrid('getCell', rowid, "BillingID"); //BillingID
                            if (cell == null || cell == "") {
                                alert('所选记录暂无账单，无法预览！');
                                return;
                            }
                            else {
                                //查看
                                var orderId = $(this).jqGrid('getCell', rowid, "OrderID"); //OrderID
                                var timeTypeId = $(this).jqGrid('getCell', rowid, "TimeTypeID"); //TimeTypeID
                                var billingTypeId = $(this).jqGrid('getCell', rowid, "BillingTypeID"); //BillingTypeID
                                var billingTypeValue = $(this).jqGrid('getCell', rowid, "BillingTypeValue"); //BillingTypeValue
                                var billingTypeLabel = $(this).jqGrid('getCell', rowid, "BillingTypeLabel"); //BillingTypeLabel

                                ReportPreViewInvoice(orderId, timeTypeId, billingTypeId, billingTypeValue, billingTypeLabel);
                            }
                        }
                        else {
                            alert('选中一行');
                        }
                    },

                });

            //最后调用，冻结列
            //$("#jqGrid").jqGrid("setFrozenColumns");
        }

        $('#cb_jqGrid').change(function () {

            if (true == $('#cb_jqGrid').prop('checked')) {
                //alert('全选')
                $('#jqGrid_ilAdd').addClass('ui-state-disabled');
                $('#jqGrid_ilDelete').removeClass('ui-state-disabled');
                $('#jqGrid_ilSubmit').removeClass('ui-state-disabled');
                $('#jqGrid_ilView').addClass('ui-state-disabled');
                $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                $('#jqGrid_ilReport').addClass('ui-state-disabled');
                
            }
            else {
                //alert('没有全选');
                $('#jqGrid_ilAdd').addClass('ui-state-disabled');
                $('#jqGrid_ilDelete').addClass('ui-state-disabled');
                $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
                $('#jqGrid_ilView').addClass('ui-state-disabled');
                $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                $('#jqGrid_ilReport').addClass('ui-state-disabled');
                
            }
        });

        $('#jqGrid_ilAdd').addClass('ui-state-disabled');
        $('#jqGrid_ilDelete').addClass('ui-state-disabled');
        $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
        $('#jqGrid_ilView').addClass('ui-state-disabled');
        $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
        $('#jqGrid_ilEdit').addClass('ui-state-disabled');
        $('#jqGrid_ilReport').addClass('ui-state-disabled');
        
    }

    function GetTableConfig() {
        tableConfig = {
            columns: [
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_CustomerID', name: "CustomerID", width: 100,
                    hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_CustomerName', name: "CustomerName", width: 120,
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] }
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_IDX', index: "OrderID", name: "OrderID", width: 100,
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_Code', name: "OrderCode", width: 120,
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] }
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_WorkDate', name: "WorkDate", width: 120,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],

                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d',
                                step: 1,
                                timepicker: false
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_WorkTime', name: "WorkTime", width: 100,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'H:i',
                                step: 1,
                                datepicker: false
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_EstimatedCompletionTime', name: "EstimatedCompletionTime", width: 120,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'H:i',
                                step: 1,
                                datepicker: false
                            });
                        },
                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }

                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_ShipID', name: "ShipID", width: 100,
                    hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_ShipName', name: "ShipName", width: 120,
                    editrules: { required: true }, hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] },

                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_ServiceNatureIDS', name: "ServiceNatureIDS", width: 100,
                    hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_ServiceNatureNames', name: "ServiceNatureNames", width: 260,
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_WorkStateID', name: "WorkStateID", width: 100,
                    hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_WorkStateValue', name: "WorkStateValue", width: 100,
                    hidden: true,

                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderInfor_WorkStateLabel', name: "WorkStateLabel", width: 120,
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    stype: "select",
                    searchoptions: {
                        dataUrl: '@Url.Action("GetOrderStateOfInvoicePage", "Base", new { CustomName = "OrderInfor.WorkStateID" })',
                    }
                },

                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_BillingID', name: "BillingID", width: 100,
                    hidden: true,
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_BillingCode', name: "BillingCode", width: 100,
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_BillingName', name: "BillingName", width: 100,
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_BillingTypeID', name: "BillingTypeID", width: 100,
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_BillingTypeValue', name: "BillingTypeValue", width: 100,
                    hidden: true,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] },
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_BillingTypeLabel', name: "BillingTypeLabel", width: 100,
                    hidden: false,
                    stype: "select",
                    searchoptions: {
                        dataUrl: '@Url.Action("GetCustomField", "Base", new { CustomName = "BillingTemplate.BillingTemplateType" })',
                    }
                },

                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_TimeTypeID', name: "TimeTypeID", width: 100,
                    hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_TimeTypeValue', name: "TimeTypeValue", width: 100,
                    hidden: true
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_TimeTypeLabel', name: "TimeTypeLabel", width: 100,
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    stype: "select",
                    searchoptions: {
                        dataUrl: '@Url.Action("GetCustomField", "Base", new { CustomName = "BillingTemplate.TimeTypeID" })',
                    }
                },

                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_Amount', name: "Amount", width: 100, 
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "lt", "le", "gt", "ge"] },
                    hidden: false
                },

                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_BillingRemark', name: "BillingRemark", width: 200,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_Month', name: "Month", width: 100,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] },
                    hidden: false
                },

                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_TimesNo', name: "TimesNo", width: 100,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "lt", "le", "gt", "ge"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_Status', name: "Status", width: 100,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "cn", "bw", "ew"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.V_OrderBilling_Phase', name: "Phase", width: 100,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: { sopt: ["eq", "lt", "le", "gt", "ge"] },
                    hidden: false
                },
                {
                    align: 'center', label: '@Resources.Language.OwnerID', name: "BillingOwnerID", width: 100,
                    hidden: true
                },

                {
                    align: 'center',
                    label: '@Resources.Language.CreateDate', name: "BillingCreateDate", width: 200,
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],

                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }
                },
                {
                    align: 'center', label: '@Resources.Language.UserID', name: "BillingUserID", width: 100,
                    hidden: true
                },
                {
                    align: 'center',
                    label: '@Resources.Language.LastUpDate', name: "BillingLastUpDate", width: 200,
                    hidden: false,
                    coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: true, freeze: false },
                    searchoptions: {
                        sopt: ["eq", "lt", "le", "gt", "ge"],

                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        },

                        dataEvents: [
                            {
                                type: 'change',
                                fn: function (e) {
                                    var grid = $('#jqGrid')[0];
                                    grid.triggerToolbar();

                                }
                            }
                        ]
                    }
                },

            ]
        };
    }
</script>

<!-- 子Grid -->
<script>

    // the event handler on expanding parent row receives two parameters
    // the ID of the grid tow  and the primary key of the row
    function showChildGrid(parentRowID, parentRowKey) {
        var childGridID = parentRowID + "_table";
        var childGridPagerID = parentRowID + "_pager";

        var dr = jQuery("#jqGrid").jqGrid('getRowData', parentRowKey);
        var childGridURL = '@Url.Action("ViewInvoice", "Finance")' + "?lan=" + '@ViewBag.Language' + "&orderId=" + dr.OrderID;

        //var html = '<div><input type="text" value="123" /></div>'

        $.ajax({
            url: childGridURL,//parentRowKey + ".html",
            type: "GET",
            success: function (html) {
                $("#" + parentRowID).append(html);
            }
        });

    }
</script>

<!--提交审核模态框-->
<script type="text/javascript">

    var g_submit_billIds = ''; //保存需要提交审核的账单,如果有以','分割，如果没有就是空字符串""
    //$(document).ready(Init);
    //function Init() {}
        // Variables declaration & to make our life easier we set our HTML tags to variables too
        var
            $$ = function (id) { return document.getElementById(id); },
            container = $$('flowtable'),
            tjflow = $$('btnflow'),
            autosaveNotification,
            hot;

        hot = new Handsontable(container, {
            //data: getCarData(),
            startRows: 2,
            startCols: 4,
        colHeaders: ['流程节点', '人员', '起始日期', '结束日期'],
            columnSorting: true,
            contextMenu: true,
            minSpareRows: 1,
            rowHeaders: true,
            columnSorting: false,
            contextMenu: ['row_below', 'remove_row'],
            removeRowPlugin: true,
            heigth: 500,
            columns: [
              {
                  type: 'dropdown',
                  //source: ['创建', '校对', '审核', '会签'],
                  source: function (query, process) {
                      $.ajax({
                          //url: 'php/cars.php', // commented out because our website is hosted on static GitHub Pages
                          url: '@Url.Action("GetNodes", "Flow")',
                          dataType: 'json',
                          data: {
                              query: query
                          },
                          success: function (response) {
                              console.log("response", response);
                              //process(JSON.parse(response.data)); // JSON.parse takes string as a argument
                              process(response);

                          }
                      });
                  },
                  strict: false,
                  width: 120
              },
              {
                  type: 'dropdown',//'autocomplete',
                  //source: ['张三', '李四', '王五', '赵六'],
                  source: function (query, process) {
                      $.ajax({
                          //url: 'php/cars.php', // commented out because our website is hosted on static GitHub Pages
                          url: '@Url.Action("GetPersons", "Flow")',
                          dataType: 'json',
                          data: {
                              query: query
                          },
                          success: function (response) {
                              console.log("response", response);
                              //process(JSON.parse(response.data)); // JSON.parse takes string as a argument
                              process(response);

                          }
                      });
                  },
                  @*source: function (request, response) {
                      this.xhr = $.ajax({
                          url: '@Url.Action("GetPersons", "Flow")',
                          data: request,
                          type: 'GET',
                          dataType: 'json',
                          success: function (data) {
                              response(data);
                          },

                          error: function (model, response, options) {
                              response([]);
                          }
                      });
                  },*@
                  strict: false,
                  width: 120
              },
              {
                  type: 'date',
                  dateFormat: 'MM/DD/YYYY',
                  correctFormat: true,
                  defaultDate: '@DateTime.Now.ToShortDateString()',
                  width: 120
              },
              {
                  type: 'date',
                  dateFormat: 'MM/DD/YYYY',
                  correctFormat: true,
                  //defaultDate: '@DateTime.Now.ToShortDateString()'
                  width: 120
              }
            ],
            afterChange: function (change, source) {
                //alert(change);
                //alert(source);

                if (source === 'loadData') {
                    return; //don't save this change
                }
                if (change != null) {
                    var chs = change[0];
                    //判断节点是否重复
                    var rct = hot.countRows();
                    //alert(rct);
                if (chs[1] == 0) {
                        //$('#childErrMsg p').html("");
                        //$('#childErrMsg').hide();
                        for (var i = 0; i < rct - 1; i++) {
                            if (i == chs[0]) continue;
                            var vlnode = hot.getDataAtCell(i, 0)
                        if (chs[3] == vlnode && chs[3] != "") {
                                alert("行流程节点重复! ");
                                hot.setDataAtRowProp(chs[0], 0, "");
                                return;
                            }
                        }
                    }
                    //判断人员是否存在
                    if (chs[1] == 1) {
                        var vlperson = hot.getDataAtCell(chs[0], 1);
                    if (vlperson != null && vlperson != "") {
                            jQuery.ajax({
                                url: '/Flow/UserValid',
                                type: "POST",
                                dataType: "json",
                                data: { 'vlperson': vlperson },//JSON.stringify(hot.getChangeData()),
                                success: function (result) {
                                    if (result.rvalid == false) {
                                        alert(vlperson + "不存在! ")
                                        hot.setDataAtRowProp(chs[0], 1, "");
                                    }
                                },
                                error: function (xhr) {
                                    //alert('error');
                                }
                            });
                        }
                    }
                }
                clearTimeout(autosaveNotification);
                jQuery.ajax({
                    url: '@Url.Action("")',
                    type: "POST",
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(hot.getData()),
                    async: true,
                    processData: false,
                    cache: false,
                    success: function (data) {
                        //exampleConsole.innerHTML = 'Changes will be autosaved';
                        autosaveNotification = setTimeout(function () {
                            //exampleConsole.innerHTML = 'Autosaved (' + change.length +
                            //' ' + 'cell' +
                            //(change.length > 1 ? 's' : '') + ')';
                        }, 1000);
                        //alert(data);
                    },
                    error: function (xhr) {
                        //exampleConsole.innerHTML = 'Autosave: No Response from Controller';
                        //alert('error');
                    }
                });
            }
        });
          //创建单元格只读
          hot.updateSettings({
              cells: function (row, col, prop) {
                  var cellProperties = {};

                  //if (hot.getData()[row][prop] === '创建') {
                  //    cellProperties.readOnly = true;
                  //}
                  if (row == 0 && (col == 0 || col == 1)) cellProperties.readOnly = true;
                  return cellProperties;
              }
          });
          //第一行不能被删除
          hot.updateSettings({
              contextMenu: {
                  //callback: function (key, options) {
                  //    if (key === 'about') {
                  //        setTimeout(function () {
                  //            //timeout is used to make sure the menu collapsed before alert is shown
                  //            alert("This is a context menu with default and custom options mixed");
                  //        }, 100);
                  //    }
                  //},
                  items: {
                      "row_below": {
                          //disabled: function () {
                          //    //if first row, disable this option
                          //    return (hot.getSelected() && hot.getSelected()[0] === 0)
                          //}
                      },
                      "remove_row": {
                          name: 'Remove row',
                          disabled: function () {
                              //if first row, disable this option
                              return (hot.getSelected() && hot.getSelected()[0] === 0)
                          }
                      }
                  }
              }
          })

          Handsontable.Dom.addEvent(tjflow, 'click', function () {
              var rct = hot.countRows();
              //alert(rct);
              for (var i = 0; i < rct - 1; i++) {
                  //alert(hot.getDataAtCell(i, 0));//[A1,B1]
                  var vlnode = hot.getDataAtCell(i, 0)
                  //alert(vlnode);
                  if (vlnode == null || vlnode == '' || vlnode == undefined) {
                      //alert("第" + (i + 1) + "行流程节点为空! ");
                      $('#childErrMsg p').html("第" + (i + 1) + "行流程节点为空! ");
                      //$('#_XX').parent().addClass("has-error");
                      $('#childErrMsg').show();
                      return;
                  }
                  var vlperson = hot.getDataAtCell(i, 1)
                  if (vlperson == null || vlperson == '' || vlperson == undefined) {
                      //alert("第" + (i + 1) + "行人员为空! ");
                      $('#childErrMsg p').html("第" + (i + 1) + "行人员为空! ");
                      //$('#_XX').parent().addClass("has-error");
                      $('#childErrMsg').show();
                      return;
                  }

              }
              jQuery.ajax({
                  url: '/Flow/SubmitFlow' + '?billids=' + g_submit_billIds,
                  type: "POST",
                  dataType: "json",
                  contentType: 'application/json; charset=utf-8',
                  data: JSON.stringify(hot.getSourceData()),
                  async: true,
                  processData: false,
                  cache: false,
                  success: function (result) {
                      $('#table-modal').modal('hide')

                      //exampleConsole.innerHTML = 'Data saved';
                      //alert(result.message);
                  },
                  error: function (xhr) {
                      //exampleConsole.innerHTML = 'Save error';
                      //alert('error');
                  }
              });
          });

          //
          $('#table-modal').on('shown.bs.modal', function (e) {
              initChildModal();
          });

          function initChildModal() {
              $('#childErrMsg').hide();
              //$('#_xxx').parent().removeClass("has-error");

              jQuery.ajax({
                  url: '/Flow/GetInitData', //Controller to Get the
                  //JsonResult From -- Json(jsonData, JsonRequestBehavior.AllowGet);
                  type: "GET",
                  dataType: "json",
                  contentType: "application/json",
                  charset: "utf-8", // dataType and contentType should be json
                  async: true,
                  processData: false,
                  cache: false,
                  success: function (data) {      // on Success send the Json data
                      // to the table by using loaddata function""
                      //alert("ok");
                      hot.loadData(data);
                      //exampleConsole.innerHTML = 'Data loaded';
                  },
                  error: function (xhr) {
                      alert('error');
                  }
              });

              //var rct = hot.countRows();
              ////alert(rct);
              //for (var i = 0; i < rct - 1; i++) {
              //    hot.alter('remove_row',i);
              //}
              //hot.clear();

              //$('#_ServiceNatureLabel').empty();
              //$('#_ChooseTug').val("");
              //$("#_JobStateLabel option:first").prop("selected", 'selected');
              //$('#_RopeUsed input[type="checkbox"]').attr("checked", false);
          }
</script>

<!-- 新增模态框 -->
<script type="text/javascript">
    var g_curRowId = '';

    function AddParent() {
        $('#parent-modal').modal()

    }

    function initParentModal() {
        $('#parentErrMsg').hide();

        //$("#sel_billing_scheme option:first").prop("selected", 'selected');
        //$("#sel_billing_type option:first").prop("selected", 'selected');
        //$("#sel_time_type option:first").prop("selected", 'selected');

        //$("input[name='serviceCheckbox']").each(function () {
        //    $(this).attr("checked", false);
        //});
        $('#sel_billing_type').attr('disabled', false);
        $('#sel_time_type').attr('disabled', false);
        $('#add_btn_sumbit').attr('disabled', false);

        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据

        $.ajax({
            type: "get",
            url: '@Url.Action("InitFilter", "Finance")',
            data: {
                'custId': dr.CustomerID,
                'orderId': dr.OrderID
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {

                $('#sel_billing_scheme').empty();
                //$('#sel_billing_type').empty();
                //$('#sel_time_type').empty();
                $('#div_services').empty();
                $('#tb_detail').empty();

                for (var i = 0; i < result.customer_billing_schemes.length; i++) {

                    //计费方案ID~计费折扣~客户Code%计费方案模板类型ID~计费方案模板类型Value~计费方案模板类型Label%计费方案模板计时方式ID~计费方案模板计时方式Value~计费方案模板计时方式Label
                    //客户Code如果是字符串-1，则表示是非会员客户的计费方案
                    var v = result.customer_billing_schemes[i].BillingTemplateIDX + '~' + result.customer_billing_schemes[i].Discount + '~' + result.customer_billing_schemes[i].CustomerCode
                        + "%"
                        + result.customer_billing_schemes[i].BillingTemplateTypeID + "~" + result.customer_billing_schemes[i].BillingTemplateTypeValue + "~" + result.customer_billing_schemes[i].BillingTemplateTypeLabel
                        + "%"
                        + result.customer_billing_schemes[i].TimeTypeID + "~" + result.customer_billing_schemes[i].TimeTypeValue + "~" + result.customer_billing_schemes[i].TimeTypeLabel;

                    option = $('<option value="' + v + '">' + result.customer_billing_schemes[i].BillingTemplateName + '</option>')
                    $('#sel_billing_scheme').append(option);

                }
                $("#sel_billing_scheme option:first").prop("selected", 'selected');

                //for (var i = 0; i < result.billing_template_types.length; ++i) {
                //    var option = $('<option value="' + result.billing_template_types[i].IDX + '~' + result.billing_template_types[i].CustomValue + '~' + result.billing_template_types[i].CustomLabel + '">' + result.billing_template_types[i].CustomLabel + '</option>')
                //    $('#sel_billing_type').append(option);
                //}
                //for (var i = 0; i < result.time_types.length; i++) {
                //    var option = $('<option value="' + result.time_types[i].IDX + '~' + result.time_types[i].CustomValue + '~' + result.time_types[i].CustomLabel + '">' + result.time_types[i].CustomLabel + '</option>')
                //    $('#sel_time_type').append(option);
                //}

                //$("#sel_billing_type option:first").prop("selected", 'selected');
                //$("#sel_time_type option:first").prop("selected", 'selected');

                var customerBillingScheme = $("#sel_billing_scheme").val().toString();

                $('#txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])
                $('#sel_billing_type').val(customerBillingScheme.split('%')[1].split('~')[2]);
                $('#sel_time_type').val(customerBillingScheme.split('%')[2].split('~')[2]);

                var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
                var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
                var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

                var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
                var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
                var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

                var discount = $('#txt_discount').val();

                reGenerate(dr.OrderID, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount)

            },
        });
    }

    $('#parent-modal').on('show.bs.modal', function (e) {
        initParentModal();

        //var invoker = $(e.relatedTarget);
        //alert(invoker.html());
    });

    $('#parent-modal').on('shown.bs.modal', function (e) {
        //var invoker = $(e.relatedTarget);
        //alert(invoker.html());

    });
    $('#parent-modal').on('hide.bs.modal', function () {
        $('#div_services').empty();
        $('#tb_detail').empty();
        $('#tb_detail').empty()

        $(this).removeData("bs.modal");
        //alert("hide");
    });
    $('#parent-modal').on('hidden.bs.modal', function () {
        //jQuery("#jqGrid2").jqGrid('GridDestroy', 'jqGrid2');
        $(this).removeData("bs.modal");
        //alert("hidden");
    });

    function submitParentModal() {

         $('#parentErrMsg').hide();

        //var hasChecked = false;
        //var serviceNatureIds = '', serviceNatureNames = '';
        //$("input[name='bill_items']").each(function () {
        //    if ($(this).is(':checked')) {

        //        hasChecked = true;
        //        alert($(this).html());
        //    }
        //});

        //提交数据库

        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据

        var customerBillingScheme = $("#sel_billing_scheme").val().toString();

        var billingTemplateId = customerBillingScheme.split('%')[0].split('~')[0];

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        var discount = $('#txt_discount').val();
        var amount = $('td[id="GrandTotalHKS"]').text();

        var jsonArrayItems;
        if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
            var ret = CheckQuanBaoTBodyData();
            if (ret == false) {
                alert("存在无效数据，请检查价格输入");
                return;
            }

            var array = GetQuanBaoTBodyData();
            jsonArrayItems = JSON.stringify(array);

        }
        if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "全包加特别条款") {
            var ret = CheckBanBaoTBodyData();

            if (ret == false) {
                alert("存在无效数据，请检查价格输入");
                return;
            }
            var array = GetBanBaoTBodyData();
            jsonArrayItems = JSON.stringify(array);
        }
        if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "条款") {
            var ret = CheckTiaoKuanTBodyData();
            if (ret == false) {
                alert("存在无效数据，请检查价格输入");
                return;
            }
            var array = GetTiaoKuanTBodyData();
            jsonArrayItems = JSON.stringify(array);
        }
        $("#add_btn_sumbit").attr("disabled", true);

        $.ajax({
            url: '@Url.Action("AddBill", "Finance")',
            type: "POST",
            data: {
                'orderId': dr.OrderID,
                'billingTemplateId': billingTemplateId,
                'billingTypeId': billingTypeId,
                'timeTypeId': timeTypeId,
                'discount': discount,
                'amount': amount,
                'jsonArrayItems': jsonArrayItems
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {
                $('#parent-modal').modal('hide')

                alert(result.message);

                $('#jqGrid').jqGrid('setGridParam',
                {
                    datatype: 'json',
                    url: '@Url.Action("GetInvoiceData", "Finance")',
                }).trigger('reloadGrid');

                $('#jqGrid_ilAdd').addClass('ui-state-disabled');
                $('#jqGrid_ilDelete').addClass('ui-state-disabled');
                $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
                $('#jqGrid_ilView').addClass('ui-state-disabled');
                $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                $('#jqGrid_ilReport').addClass('ui-state-disabled');
                
               // $("#jqGrid").jqGrid('setGridParam', { editurl: '@Url.Action("AddEdit", "Finance")' });
            },

            error: function (xhr) {
                $("#add_btn_sumbit").attr("disabled", false);
            }
        });
    }
</script>

<!--新增模态框里的生成报表-->
<script type="text/javascript">

    function reGenerate(orderId, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount) {

        $('#tb_detail').empty();

        $.ajax({
            type: "post",
            url: '@Url.Action("NewInvoice", "Finance")',
            data: {
                'orderId': orderId,
                'customerBillingScheme': customerBillingScheme,
                'billingTypeId': billingTypeId,
                'billingTypeValue': billingTypeValue,
                'billingTypeLabel': billingTypeLabel,
                'timeTypeId': timeTypeId,
                'timeTypeValue': timeTypeValue,
                'timeTypeLabel': timeTypeLabel,
                'discount': discount
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {
                //$('#tb_detail').empty();
                $('#div_services').empty();

                var div1 = $('<div class="col-md-2"><p>服务项目:<br>SERVICE:</p></div>');
                var div2 = $('<div class="col-md-2"></div>');
                var div3 = $('<div class="col-md-3"></div>');
                var div4 = $('<div class="col-md-5"></div>')
                for (key in result.invoice.ServiceNature) {
                    var value = result.invoice.ServiceNature[key];
                    var p = $('<p>' + value.ServiceName + '</p>')
                    div2.append(p);

                    p = $('<p>' + value.ServiceWorkDate + '</p>');
                    div3.append(p)

                    p = $('<p>' + value.ServiceWorkPlace + '</p>');
                    div4.append(p)

                }

                $('#div_services').append(div1).append(div2).append(div3).append(div4);

                //----生成表格

                //1.表头
                {
                    var thead = $('<thead></thead>');
                    var tr1 = $('<tr></tr>');
                    var tr2 = $('<tr></tr>');
                    var th = $('<th width="20%" rowspan="2" style="text-align:center;vertical-align:middle">拖轮</th>');
                    tr1.append(th);

                    for (key in result.invoice.ServiceNature) {
                        var value = result.invoice.ServiceNature[key];
                        //alert(result.invoice.Schedulers[key].length);
                        var th = $('<th width="" style="text-align:center;vertical-align:middle" colspan=' + result.invoice.Schedulers[key].length + '>' + value.ServiceName + '</th>');
                        tr1.append(th)
                    }
                    thead.append(tr1);

                    var colspan = 0;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {
                            var th = $('<th width="" style="text-align:center;vertical-align:middle">' + value[i].TugCnName + '</th>');

                            var span1 = $('<span hidden>' + value[i].SchedulerID + '</span>');
                            th.append(span1);

                            tr2.append(th);
                            colspan++;
                        }
                    }

                    thead.append(tr2);
                    $('#tb_detail').append(thead);
                }

                //2.表体
                DynamicGenerateTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);

                //3.表尾
                {
                    var tfoot = $('<tfoot></tfoot>')
                    var tr = $('<tr></tr>')

                    if (colspan == 0) {
                        var td = $('<td colspan=' + colspan + ' style="text-align:center;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：&nbsp;&nbsp;&nbsp;&nbsp;' + result.invoice.GrandTotalHKS + '<br> Grand Total HKS</strong></td>');
                        tr.append(td);
                    }
                    else {
                        var td1 = $('<td colspan=' + colspan + ' style="text-align:right;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>');
                        var td2 = $('<td id="GrandTotalHKS" style="text-align:center;vertical-align:middle"><strong>' + result.invoice.GrandTotalHKS + '</strong></td>');

                        tr.append(td1);
                        tr.append(td2);
                    }
                    tfoot.append(tr);

                    $('#tb_detail').append(tfoot);
                }
            },
        });
    }

    function DynamicGenerateTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //使用计费方案
        var customerCode = customerBillingScheme.split('%')[0].split('~')[2];
        if (customerCode == "-1") {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                DefaultQuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "全包加特别条款") {
                DefaultBanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "条款") {
                DefaultTiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }
        else {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                QuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "全包加特别条款") {
                BanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "条款") {
                TiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }

    }

    function QuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);
        }
    }

    function BanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "全包加特别条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].Price + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoTopCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="BanbaoMidCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);

        }
    }

    function TiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="每小时收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + value[i].Price + '</td>');

                        //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="正常收费" value="' + value[i].Price + '"></input>');
                        //td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanTopCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="TiaoKuanMidCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);

        }

    }

    function DefaultQuanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //缺省全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);
        }
    }

    function DefaultBanBaoTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "全包加特别条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].Price + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoTopCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="BanbaoMidCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);

        }
    }

    function DefaultTiaoKuanTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="每小时收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + value[i].Price + '</td>');

                        //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="正常收费" value="' + value[i].Price + '"></input>');
                        //td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanTopCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="TiaoKuanMidCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                            td.append(input);

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" checked>' + result.items[ii].CustomLabel + '</input>');
                    td.append(input)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#tb_detail').append(tbody);

        }
    }

    function billingSchemeChanged(selectedValue) {

        $('#sel_billing_type').val(selectedValue.split('%')[1].split('~')[2]);

        $('#sel_time_type').val(selectedValue.split('%')[2].split('~')[2]);

        btnClick();
    }

    function inputCheck(obj) {
        //return value.replace(/[^\d.]/g, '');
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //if (obj.value.trim().length == 0) {
        //    obj.value = 0;
        //}
        //obj.value;

    }

    function btnClick() {
        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据
        var customerBillingScheme = $("#sel_billing_scheme").val().toString();

        $('#txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        //alert(billingTypeId + " --- " + billingTypeValue + ' --- ' + billingTypeLabel);

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        //alert(timeTypeId + " --- " + timeTypeValue + ' --- ' + timeTypeLabel);

        var discount = $('#txt_discount').val();

        reGenerate(dr.OrderID, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount);
    }
</script>



<!--查看模态框-->
<script type="text/javascript">
    var g_curRowId = '';

    function ViewInvoice() {
        $('#view-modal').modal()
    }

    function initViewInvoiceModal() {
        $('#parentErrMsg').hide();

        $('#view_sel_billing_scheme').attr('disabled', true);
        $('#view_sel_billing_type').attr('disabled', false);
        $('#view_sel_time_type').attr('disabled', false);

        $('#view_sel_billing_type').val("");
        $('#view_sel_time_type').val("");
        $('#view_sel_billing_scheme').empty();
        $('#view_div_services').empty();
        $('#view_tb_detail').empty();

        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据

        $.ajax({
            type: "get",
            url: '@Url.Action("GetInvoice", "Finance")',
            data: {
                'custId': dr.CustomerID,
                'orderId': dr.OrderID
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {

                $('#view_sel_billing_scheme').empty();
                //$('#sel_billing_type').empty();
                //$('#sel_time_type').empty();
                $('#view_div_services').empty();
                $('#view_tb_detail').empty();

                for (var i = 0; i < result.customer_billing_schemes.length; i++) {

                    //计费方案ID~计费折扣~客户Code%计费方案模板类型ID~计费方案模板类型Value~计费方案模板类型Label%计费方案模板计时方式ID~计费方案模板计时方式Value~计费方案模板计时方式Label
                    //客户Code如果是字符串-1，则表示是非会员客户的计费方案
                    var v = result.customer_billing_schemes[i].BillingTemplateIDX + '~' + result.customer_billing_schemes[i].Discount + '~' + result.customer_billing_schemes[i].CustomerCode
                        + "%"
                        + result.customer_billing_schemes[i].BillingTemplateTypeID + "~" + result.customer_billing_schemes[i].BillingTemplateTypeValue + "~" + result.customer_billing_schemes[i].BillingTemplateTypeLabel
                        + "%"
                        + result.customer_billing_schemes[i].TimeTypeID + "~" + result.customer_billing_schemes[i].TimeTypeValue + "~" + result.customer_billing_schemes[i].TimeTypeLabel;

                    option = $('<option value="' + v + '">' + result.customer_billing_schemes[i].BillingTemplateName + '</option>')
                    $('#view_sel_billing_scheme').append(option);

                }

                var v = result.billing_template.BillingTemplateIDX + '~' + result.billing_template.Discount + '~' + result.billing_template.CustomerCode
                        + "%"
                        + result.billing_template.BillingTemplateTypeID + "~" + result.billing_template.BillingTemplateTypeValue + "~" + result.billing_template.BillingTemplateTypeLabel
                        + "%"
                        + result.billing_template.TimeTypeID + "~" + result.billing_template.TimeTypeValue + "~" + result.billing_template.TimeTypeLabel;

                $("#view_sel_billing_scheme").val(v);

                var customerBillingScheme = $("#view_sel_billing_scheme").val().toString();

                $('#view_txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])
                $('#view_sel_billing_type').val(customerBillingScheme.split('%')[1].split('~')[2]);
                $('#view_sel_time_type').val(customerBillingScheme.split('%')[2].split('~')[2]);

                var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
                var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
                var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

                var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
                var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
                var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

                var discount = $('#view_txt_discount').val();

                reGenerateViewTable(dr.OrderID, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel,
                    timeTypeId, timeTypeValue, timeTypeLabel, discount, result);

            },
        });
    }

    $('#view-modal').on('show.bs.modal', function (e) {
        initViewInvoiceModal();
    });
    $('#view-modal').on('shown.bs.modal', function (e) {

    });
    $('#view-modal').on('hide.bs.modal', function () {

        $('#view_div_services').empty();
        $('#view_tb_detail').empty();
        $('#view_tb_detail').empty()

        $(this).removeData("bs.modal");
    });
    $('#view-modal').on('hidden.bs.modal', function () {
        $(this).removeData("bs.modal");
    });

</script>

<!--查看模态框里的生成报表-->
<script type="text/javascript">

    function reGenerateViewTable(orderId, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount, result) {

        $('#view_tb_detail').empty();

        {
            //$('#tb_detail').empty();
            $('#view_div_services').empty();

            var div1 = $('<div class="col-md-2"><p>服务项目:<br>SERVICE:</p></div>');
            var div2 = $('<div class="col-md-2"></div>');
            var div3 = $('<div class="col-md-3"></div>');
            var div4 = $('<div class="col-md-5"></div>')
            for (key in result.invoice.ServiceNature) {
                var value = result.invoice.ServiceNature[key];
                var p = $('<p>' + value.ServiceName + '</p>')
                div2.append(p);

                p = $('<p>' + value.ServiceWorkDate + '</p>');
                div3.append(p)

                p = $('<p>' + value.ServiceWorkPlace + '</p>');
                div4.append(p)

            }

            $('#view_div_services').append(div1).append(div2).append(div3).append(div4);

            //----生成表格

            //1.表头
            {
                var thead = $('<thead></thead>');
                var tr1 = $('<tr></tr>');
                var tr2 = $('<tr></tr>');
                var th = $('<th width="20%" rowspan="2" style="text-align:center;vertical-align:middle">拖轮</th>');
                tr1.append(th);

                for (key in result.invoice.ServiceNature) {
                    var value = result.invoice.ServiceNature[key];
                    //alert(result.invoice.Schedulers[key].length);
                    var th = $('<th width="" style="text-align:center;vertical-align:middle" colspan=' + result.invoice.Schedulers[key].length + '>' + value.ServiceName + '</th>');
                    tr1.append(th)
                }
                thead.append(tr1);

                var colspan = 0;
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        var th = $('<th width="" style="text-align:center;vertical-align:middle">' + value[i].TugCnName + '</th>');

                        var span1 = $('<span hidden>' + value[i].SchedulerID + '</span>');
                        th.append(span1);

                        tr2.append(th);
                        colspan++;
                    }
                }

                thead.append(tr2);
                $('#view_tb_detail').append(thead);
            }

            //2.表体
            DynamicGenerateViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);

            //3.表尾
            {
                var tfoot = $('<tfoot></tfoot>')
                var tr = $('<tr></tr>')

                if (colspan == 0) {
                    var td = $('<td colspan=' + colspan + ' style="text-align:center;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：&nbsp;&nbsp;&nbsp;&nbsp;' + result.invoice.GrandTotalHKS + '<br> Grand Total HKS</strong></td>');
                    tr.append(td);
                }
                else {
                    var td1 = $('<td colspan=' + colspan + ' style="text-align:right;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>');
                    var td2 = $('<td id="GrandTotalHKS" style="text-align:center;vertical-align:middle"><strong>' + result.invoice.GrandTotalHKS + '</strong></td>');

                    tr.append(td1);
                    tr.append(td2);
                }
                tfoot.append(tr);

                $('#view_tb_detail').append(tfoot);
            }
        }
    }

    function DynamicGenerateViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //使用计费方案
        var customerCode = customerBillingScheme.split('%')[0].split('~')[2];
        if (customerCode == "-1") {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                DefaultQuanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "全包加特别条款") {
                DefaultBanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "条款") {
                DefaultTiaoKuanViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }
        else {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                QuanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "全包加特别条款") {
                BanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "条款") {
                TiaoKuanViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }

    }

    function QuanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#view_tb_detail').append(tbody);
        }
    }

    function BanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "全包加特别条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].Price + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoTopCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    tr.append(td);

                    
                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var checkbox = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="BanbaoMidCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                            td.append(checkbox);

                            //检查调度是否具有此收费项目
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if ((result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue)
                                    && value[i].BillingItems[j].Price != 0) {
                                    $(checkbox).attr('checked', true);
                                }
                            }

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#view_tb_detail').append(tbody);

        }
    }

    function TiaoKuanViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="每小时收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + value[i].Price + '</td>');

                        //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="正常收费" value="' + value[i].Price + '"></input>');
                        //td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanTopCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var checkbox = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="TiaoKuanMidCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                            td.append(checkbox);

                            //检查调度是否具有此收费项目
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if ((result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue)
                                    && value[i].BillingItems[j].Price != 0) {
                                    $(checkbox).attr('checked', true);
                                }
                            }

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#view_tb_detail').append(tbody);

        }

    }

    function DefaultQuanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //缺省全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#view_tb_detail').append(tbody);
        }
    }

    function DefaultBanBaoViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "全包加特别条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].Price + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    tr.append(td);

                    
                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

 
                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }
                                            

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }



                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var checkbox = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="BanbaoMidCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                            td.append(checkbox);

                            //检查调度是否具有此收费项目
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if ((result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue)
                                    && value[i].BillingItems[j].Price != 0) {
                                    $(checkbox).attr('checked', true);
                                }
                            }

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);


                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#view_tb_detail').append(tbody);

        }
    }

    function DefaultTiaoKuanViewTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="每小时收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + value[i].Price + '</td>');

                        //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="正常收费" value="' + value[i].Price + '"></input>');
                        //td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanTopCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var checkbox = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="TiaoKuanMidCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                            td.append(checkbox);

                            //检查调度是否具有此收费项目
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if ((result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue)
                                    && value[i].BillingItems[j].Price != 0) {
                                    $(checkbox).attr('checked', true);
                                }
                            }

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#view_tb_detail').append(tbody);

        }
    }

    function view_billingSchemeChanged(selectedValue) {

        $('#view_sel_billing_type').val(selectedValue.split('%')[1].split('~')[2]);

        $('#view_sel_time_type').val(selectedValue.split('%')[2].split('~')[2]);

        view_btnClick();
    }

    function inputCheck(obj) {
        //return value.replace(/[^\d.]/g, '');
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //if (obj.value.trim().length == 0) {
        //    obj.value = 0;
        //}
        //obj.value;

    }

    function view_btnClick() {
        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据
        var customerBillingScheme = $("#sel_billing_scheme").val().toString();

        $('#txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        //alert(billingTypeId + " --- " + billingTypeValue + ' --- ' + billingTypeLabel);

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        //alert(timeTypeId + " --- " + timeTypeValue + ' --- ' + timeTypeLabel);

        var discount = $('#txt_discount').val();

        reGenerate(dr.OrderID, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount);
    }
</script>



<!--编辑模态框-->
<script type="text/javascript">
    var g_curRowId = '';

    function EditInvoice() {
        $('#edit-modal').modal()
    }

    function initEditInvoiceModal() {
        $('#parentErrMsg').hide();

        $('#edit_sel_billing_scheme').attr('disabled', false);
        $('#edit_sel_billing_type').attr('disabled', false);
        $('#edit_sel_time_type').attr('disabled', false);

        $('#edit_btn_sumbit').attr('disabled', false);

        $('#edit_sel_billing_type').val("");
        $('#edit_sel_time_type').val("");
        $('#edit_sel_billing_scheme').empty();
        $('#edit_div_services').empty();
        $('#edit_tb_detail').empty();

        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据

        $.ajax({
            type: "get",
            url: '@Url.Action("GetInvoice", "Finance")',
            data: {
                'custId': dr.CustomerID,
                'orderId': dr.OrderID
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {

                $('#edit_sel_billing_scheme').empty();
                //$('#sel_billing_type').empty();
                //$('#sel_time_type').empty();
                $('#edit_div_services').empty();
                $('#edit_tb_detail').empty();

                for (var i = 0; i < result.customer_billing_schemes.length; i++) {

                    //计费方案ID~计费折扣~客户Code%计费方案模板类型ID~计费方案模板类型Value~计费方案模板类型Label%计费方案模板计时方式ID~计费方案模板计时方式Value~计费方案模板计时方式Label
                    //客户Code如果是字符串-1，则表示是非会员客户的计费方案
                    var v = result.customer_billing_schemes[i].BillingTemplateIDX + '~' + result.customer_billing_schemes[i].Discount + '~' + result.customer_billing_schemes[i].CustomerCode
                        + "%"
                        + result.customer_billing_schemes[i].BillingTemplateTypeID + "~" + result.customer_billing_schemes[i].BillingTemplateTypeValue + "~" + result.customer_billing_schemes[i].BillingTemplateTypeLabel
                        + "%"
                        + result.customer_billing_schemes[i].TimeTypeID + "~" + result.customer_billing_schemes[i].TimeTypeValue + "~" + result.customer_billing_schemes[i].TimeTypeLabel;

                    option = $('<option value="' + v + '">' + result.customer_billing_schemes[i].BillingTemplateName + '</option>')
                    $('#edit_sel_billing_scheme').append(option);

                }

                var v = result.billing_template.BillingTemplateIDX + '~' + result.billing_template.Discount + '~' + result.billing_template.CustomerCode
                        + "%"
                        + result.billing_template.BillingTemplateTypeID + "~" + result.billing_template.BillingTemplateTypeValue + "~" + result.billing_template.BillingTemplateTypeLabel
                        + "%"
                        + result.billing_template.TimeTypeID + "~" + result.billing_template.TimeTypeValue + "~" + result.billing_template.TimeTypeLabel;

                $("#edit_sel_billing_scheme").val(v);

                var customerBillingScheme = $("#edit_sel_billing_scheme").val().toString();

                $('#edit_txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])
                $('#edit_sel_billing_type').val(customerBillingScheme.split('%')[1].split('~')[2]);
                $('#edit_sel_time_type').val(customerBillingScheme.split('%')[2].split('~')[2]);

                var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
                var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
                var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

                var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
                var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
                var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

                var discount = $('#edit_txt_discount').val();

                reGenerateEditTable(dr.OrderID, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel,
                    timeTypeId, timeTypeValue, timeTypeLabel, discount, result);

            },
        });
    }

    $('#edit-modal').on('show.bs.modal', function (e) {
        initEditInvoiceModal();
    });
    $('#edit-modal').on('shown.bs.modal', function (e) {

    });
    $('#edit-modal').on('hide.bs.modal', function () {

        $('#edit_div_services').empty();
        $('#edit_tb_detail').empty();
        $('#edit_tb_detail').empty()

        $(this).removeData("bs.modal");
    });
    $('#edit-modal').on('hidden.bs.modal', function () {
        $(this).removeData("bs.modal");
    });

    function submitEditVoiceModal() {
        $('#parentErrMsg').hide();


        //提交数据库

        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据

        var customerBillingScheme = $("#edit_sel_billing_scheme").val().toString();

        var billingTemplateId = customerBillingScheme.split('%')[0].split('~')[0];

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        var discount = $('#edit_txt_discount').val();
        var amount = $('td[id="GrandTotalHKS"]').text();

        var jsonArrayItems;
        if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
            var ret = CheckQuanBaoTBodyData();
            if (ret == false) {
                alert("存在无效数据，请检查价格输入");
                return;
            }

            var array = GetQuanBaoTBodyData();
            jsonArrayItems = JSON.stringify(array);

        }
        if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "全包加特别条款") {
            var ret = CheckBanBaoTBodyData();

            if (ret == false) {
                alert("存在无效数据，请检查价格输入");
                return;
            }
            var array = GetBanBaoTBodyData();
            jsonArrayItems = JSON.stringify(array);
        }
        if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "条款") {
            var ret = CheckTiaoKuanTBodyData();
            if (ret == false) {
                alert("存在无效数据，请检查价格输入");
                return;
            }
            var array = GetTiaoKuanTBodyData();
            jsonArrayItems = JSON.stringify(array);
        }
        $("#edit_btn_sumbit").attr("disabled", true);

        $.ajax({
            url: '@Url.Action("EditBill", "Finance")',
            type: "POST",
            data: {
                'orderId': dr.OrderID,
                'billingTemplateId': billingTemplateId,
                'billingTypeId': billingTypeId,
                'timeTypeId': timeTypeId,
                'discount': discount,
                'amount': amount,
                'jsonArrayItems': jsonArrayItems
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {
                $('#edit-modal').modal('hide')

                alert(result.message);

                $('#jqGrid').jqGrid('setGridParam',
                {
                    datatype: 'json',
                    url: '@Url.Action("GetInvoiceData", "Finance")',
                }).trigger('reloadGrid');

                $('#jqGrid_ilAdd').addClass('ui-state-disabled');
                $('#jqGrid_ilDelete').addClass('ui-state-disabled');
                $('#jqGrid_ilSubmit').addClass('ui-state-disabled');
                $('#jqGrid_ilView').addClass('ui-state-disabled');
                $('#jqGrid_ilAddCredit').addClass('ui-state-disabled');
                $('#jqGrid_ilEdit').addClass('ui-state-disabled');
                $('#jqGrid_ilReport').addClass('ui-state-disabled');
                

                // $("#jqGrid").jqGrid('setGridParam', { editurl: '@Url.Action("AddEdit", "Finance")' });
            },

            error: function (xhr) {
                $("#edit_btn_sumbit").attr("disabled", false);
            }
        });
    }

</script>

<!--编辑模态框里的生成报表-->
<script type="text/javascript">

    function reGenerateEditTable(orderId, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount) {

        $('#edit_tb_detail').empty();


        $.ajax({
            type: "post",
            url: '@Url.Action("NewInvoice", "Finance")',
            data: {
                'orderId': orderId,
                'customerBillingScheme': customerBillingScheme,
                'billingTypeId': billingTypeId,
                'billingTypeValue': billingTypeValue,
                'billingTypeLabel': billingTypeLabel,
                'timeTypeId': timeTypeId,
                'timeTypeValue': timeTypeValue,
                'timeTypeLabel': timeTypeLabel,
                'discount': discount
            },//"oper=delete&id=" + gr,
            dataType: 'json',
            success: function (result) {

                //$('#tb_detail').empty();
                $('#edit_div_services').empty();

                var div1 = $('<div class="col-md-2"><p>服务项目:<br>SERVICE:</p></div>');
                var div2 = $('<div class="col-md-2"></div>');
                var div3 = $('<div class="col-md-3"></div>');
                var div4 = $('<div class="col-md-5"></div>')
                for (key in result.invoice.ServiceNature) {
                    var value = result.invoice.ServiceNature[key];
                    var p = $('<p>' + value.ServiceName + '</p>')
                    div2.append(p);

                    p = $('<p>' + value.ServiceWorkDate + '</p>');
                    div3.append(p)

                    p = $('<p>' + value.ServiceWorkPlace + '</p>');
                    div4.append(p)

                }

                $('#edit_div_services').append(div1).append(div2).append(div3).append(div4);

                //----生成表格

                //1.表头
                {
                    var thead = $('<thead></thead>');
                    var tr1 = $('<tr></tr>');
                    var tr2 = $('<tr></tr>');
                    var th = $('<th width="20%" rowspan="2" style="text-align:center;vertical-align:middle">拖轮</th>');
                    tr1.append(th);

                    for (key in result.invoice.ServiceNature) {
                        var value = result.invoice.ServiceNature[key];
                        //alert(result.invoice.Schedulers[key].length);
                        var th = $('<th width="" style="text-align:center;vertical-align:middle" colspan=' + result.invoice.Schedulers[key].length + '>' + value.ServiceName + '</th>');
                        tr1.append(th)
                    }
                    thead.append(tr1);

                    var colspan = 0;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {
                            var th = $('<th width="" style="text-align:center;vertical-align:middle">' + value[i].TugCnName + '</th>');

                            var span1 = $('<span hidden>' + value[i].SchedulerID + '</span>');
                            th.append(span1);

                            tr2.append(th);
                            colspan++;
                        }
                    }

                    thead.append(tr2);
                    $('#edit_tb_detail').append(thead);
                }

                //2.表体
                DynamicGenerateEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);

                //3.表尾
                {
                    var tfoot = $('<tfoot></tfoot>')
                    var tr = $('<tr></tr>')

                    if (colspan == 0) {
                        var td = $('<td colspan=' + colspan + ' style="text-align:center;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：&nbsp;&nbsp;&nbsp;&nbsp;' + result.invoice.GrandTotalHKS + '<br> Grand Total HKS</strong></td>');
                        tr.append(td);
                    }
                    else {
                        var td1 = $('<td colspan=' + colspan + ' style="text-align:right;vertical-align:middle"><strong>共&nbsp;计&nbsp;港&nbsp;币：<br> Grand Total HKS</strong></td>');
                        var td2 = $('<td id="GrandTotalHKS" style="text-align:center;vertical-align:middle"><strong>' + result.invoice.GrandTotalHKS + '</strong></td>');

                        tr.append(td1);
                        tr.append(td2);
                    }
                    tfoot.append(tr);

                    $('#edit_tb_detail').append(tfoot);
                }
            },
        });
       
    }

    function DynamicGenerateEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //使用计费方案
        var customerCode = customerBillingScheme.split('%')[0].split('~')[2];
        if (customerCode == "-1") {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                DefaultQuanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "全包加特别条款") {
                DefaultBanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "条款") {
                DefaultTiaoKuanEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }
        else {
            if (billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包") {
                QuanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
            if (billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "全包加特别条款") {
                BanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result)
            }
            if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "条款") {
                TiaoKuanEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result);
            }
        }

    }

    function QuanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#edit_tb_detail').append(tbody);
        }
    }

    function BanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "全包加特别条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].Price + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoTopCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    tr.append(td);


                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);

                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var checkbox = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="BanbaoMidCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                            td.append(checkbox);

                            //检查调度是否具有此收费项目
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if ((result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue)
                                    && value[i].BillingItems[j].Price != 0) {
                                    $(checkbox).attr('checked', true);
                                }
                            }

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#edit_tb_detail').append(tbody);

        }
    }

    function TiaoKuanEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="每小时收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)" disabled></input>');

                            td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + value[i].Price + '</td>');

                        //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="正常收费" value="' + value[i].Price + '"></input>');
                        //td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanTopCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var checkbox = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="TiaoKuanMidCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                            td.append(checkbox);

                            //检查调度是否具有此收费项目
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if ((result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue)
                                    && value[i].BillingItems[j].Price != 0) {
                                    $(checkbox).attr('checked', true);
                                }
                            }

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)"></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#edit_tb_detail').append(tbody);

        }

    }

    function DefaultQuanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        //缺省全包方式
        {

            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultQuanbao_XieYiShouFei_InputChanged(this)"></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="折扣后合计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="总计港币" width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#edit_tb_detail').append(tbody);
        }
    }

    function DefaultBanBaoEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {

        //半包
        if (billingTypeId == 7 || billingTypeValue == 1 || billingTypeLabel == "全包加特别条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">协议收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="协议收费" value="' + value[i].Price + '" onkeyup="DefaultBanbao_XieYiShouFei_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    tr.append(td);


                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];


                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }



                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var checkbox = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="BanbaoMidCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                            td.append(checkbox);

                            //检查调度是否具有此收费项目
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if ((result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue)
                                    && value[i].BillingItems[j].Price != 0) {
                                    $(checkbox).attr('checked', true);
                                }
                            }

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);


                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="BanbaoBottomCheckboxChanged(this)"  disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            $('#edit_tb_detail').append(tbody);

        }
    }

    function DefaultTiaoKuanEditTableTBody(customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, discount, result) {
        if (billingTypeId == 8 || billingTypeValue == 2 || billingTypeLabel == "条款") {
            var tbody = $('<tbody></tbody>')

            //1
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">离厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].DepartBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //2
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">回厂时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].ArrivalBaseTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //3
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">工作时间</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTime + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //4
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">换算耗时(h)</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="换算耗时" width="" style="text-align:center;vertical-align:middle">' + value[i].WorkTimeConsumption + '</td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">每小时收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td width="" style="text-align:center;vertical-align:middle"></td>');

                        var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="每小时收费" value="' + value[i].UnitPrice + '" onkeyup="DefaultTiaoKuan_UnitPrice_InputChanged(this)" disabled></input>');

                        td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //5
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">正常收费</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var price = 0;

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {

                        //for (var j = 0; j < result.customer_scheme.length; ++j) {
                        //    if (key == result.customer_scheme[j].ItemID) {
                        //        price = result.customer_scheme[j].UnitPrice;
                        //    }
                        //}

                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + key + '" name="正常收费" width="" style="text-align:center;vertical-align:middle">' + value[i].Price + '</td>');

                        //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + key + '" type="text" name="正常收费" value="' + value[i].Price + '"></input>');
                        //td.append(input);

                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //6
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.charAt(0) == 'B' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanTopCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //7
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].SubTotaHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //8
            {
                var tr = $('<tr hidden></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>折扣后合计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="折扣后合计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].DiscountSubTotalHKS + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //9
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C15' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    //var input = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" checked="checked">' + result.items[ii].CustomLabel + '</input>');
                    //td.append(input)
                    tr.append(td);
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];
                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            //td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比' + result.items[ii].IDX + '" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');
                            td = $('<td "width="" style="text-align:center;vertical-align:middle"></td>');

                            var p = $('<p id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="百分比" width="" style="text-align:center;vertical-align:middle">' + price + '</p>');
                            //alert(key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue);
                            td.append(p);

                            var checkbox = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem3600" onchange="TiaoKuanMidCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                            td.append(checkbox);

                            //检查调度是否具有此收费项目
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if ((result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue)
                                    && value[i].BillingItems[j].Price != 0) {
                                    $(checkbox).attr('checked', true);
                                }
                            }

                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //10 燃油附加费

            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C80' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;

                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>燃油附加费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt燃油附加费" value="' + unitPrice + '" onkeyup="DefaultBanbao_RanYou_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }

                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="燃油附加费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //11
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle">拖缆数量</td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="拖缆数量"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].RopeNum + '</strong></td>');
                        tr.append(td)
                    }
                }
                tbody.append(tr);
            }

            //12 拖缆费
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C81' && result.items[ii].FormulaStr.charAt(2) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    var span = $('<br><span>拖缆费单价(每小时)</span>');
                    td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt拖缆费" value="' + unitPrice + '" onkeyup="DefaultBanbao_TuoLan_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="拖缆费" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //13 折扣
            for (var ii = 0; ii < result.items.length; ii++) {
                var tr = $('<tr></tr>')

                if (result.items[ii].CustomValue.substr(0, 3) == 'C82' && result.items[ii].FormulaStr.charAt(1) == '1') {

                    var unitPrice = 0;
                    for (var j = 0; j < result.customer_scheme.length; ++j) {
                        if (result.items[ii].IDX == result.customer_scheme[j].ItemID) {
                            unitPrice = result.customer_scheme[j].UnitPrice;
                        }
                    }

                    var td = $('<td width="" style="text-align:center;vertical-align:middle"></td>')
                    var checkbox = $('<input id="ckItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="checkbox" name="ckItem" onchange="TiaoKuanBottomCheckboxChanged(this)" disabled>' + result.items[ii].CustomLabel + '</input>');
                    td.append(checkbox)
                    //var span = $('<br><span>折扣费</span>');
                    //td.append(span);
                    var input = $('<input id="txtItem_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" type="text" name="txt折扣" value="' + unitPrice + '" onkeyup="DefaultBanbao_DiscountPrice_InputChanged(this)" disabled></input>');
                    td.append(input);
                    tr.append(td);

                    var flag = true;
                    for (key in result.invoice.Schedulers) {

                        var value = result.invoice.Schedulers[key];

                        //检查调度是否具有此收费项目
                        for (var i = 0; i < value.length; ++i) {
                            if (flag == true) {
                                for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                    if (result.items[ii].IDX == value[i].BillingItems[j].ItemID || result.items[ii].CustomValue == value[i].BillingItems[j].ItemValue) {
                                        $(checkbox).attr('checked', true);
                                        flag = false;
                                    }
                                }
                            }
                        }


                        for (var i = 0; i < value.length; ++i) {

                            var price = 0;
                            for (var j = 0; j < value[i].BillingItems.length; ++j) {
                                if (result.items[ii].IDX == value[i].BillingItems[j].ItemID) {
                                    price = value[i].BillingItems[j].Price;
                                }
                            }

                            td = $('<td id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '_' + result.items[ii].CustomValue + '" name="折扣" width="" style="text-align:center;vertical-align:middle">' + price + '</td>');

                            //var input = $('<input id="' + key + '_' + value[i].SchedulerID + '_' + result.items[ii].IDX + '" type="text" name="' + result.items[ii].IDX + '" value="' + price + '" onkeyup="inputCheck(this)"></input>');
                            //td.append(input);
                            tr.append(td);
                        }
                    }
                }

                tbody.append(tr);
            }

            //14
            {
                var tr = $('<tr></tr>')
                var td = $('<td width="" style="text-align:center;vertical-align:middle"><strong>总计港币</strong></td>')
                tr.append(td);
                for (key in result.invoice.Schedulers) {

                    var value = result.invoice.Schedulers[key];
                    for (var i = 0; i < value.length; ++i) {
                        td = $('<td id="' + key + '_' + value[i].SchedulerID + '" name="总计港币"  width="" style="text-align:center;vertical-align:middle"><strong>' + value[i].TotalHKs + '</strong></td>');
                        tr.append(td)
                    }
        }
                tbody.append(tr);
    }

            $('#edit_tb_detail').append(tbody);

        }
    }

    function edit_billingSchemeChanged(selectedValue) {


        $('#edit_sel_billing_type').val(selectedValue.split('%')[1].split('~')[2]);

        $('#edit_sel_time_type').val(selectedValue.split('%')[2].split('~')[2]);

        edit_btnClick();
    }

    function inputCheck(obj) {
        //return value.replace(/[^\d.]/g, '');
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        //if (obj.value.trim().length == 0) {
        //    obj.value = 0;
        //}
        //obj.value;

    }

    function edit_btnClick() {
        var dr = jQuery("#jqGrid").jqGrid('getRowData', g_curRowId);//得到该行的数据
        var customerBillingScheme = $("#edit_sel_billing_scheme").val().toString();

        alert(customerBillingScheme);
        $('#edit_txt_discount').val(customerBillingScheme.split('%')[0].split('~')[1])

        var billingTypeId = customerBillingScheme.split('%')[1].split('~')[0];
        var billingTypeValue = customerBillingScheme.split('%')[1].split('~')[1];
        var billingTypeLabel = customerBillingScheme.split('%')[1].split('~')[2];

        //alert(billingTypeId + " --- " + billingTypeValue + ' --- ' + billingTypeLabel);

        var timeTypeId = customerBillingScheme.split('%')[2].split('~')[0];
        var timeTypeValue = customerBillingScheme.split('%')[2].split('~')[1];
        var timeTypeLabel = customerBillingScheme.split('%')[2].split('~')[2];

        //alert(timeTypeId + " --- " + timeTypeValue + ' --- ' + timeTypeLabel);

        var discount = $('#edit_txt_discount').val();

        reGenerateEditTable(dr.OrderID, customerBillingScheme, billingTypeId, billingTypeValue, billingTypeLabel, timeTypeId, timeTypeValue, timeTypeLabel, discount);
    }
</script>





<!--价格编辑框输入改变-->
<script>

    function DefaultQuanbao_XieYiShouFei_InputChanged(obj) {
        //return value.replace(/[^\d.]/g, '');
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        $('input[name="协议收费"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0])
                $(this).val(obj.value);
        });

        $('td[name="合计港币"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
                var v = parseFloat(obj.value);
                $(this).css('fontWeight', 'bold').text(v.toFixed(2));
            }
        });

        $('td[name="折扣后合计港币"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
                //var v = parseFloat($('#txt_discount').val()) * parseFloat(obj.value);
                var v = parseFloat(obj.value);
                $(this).css('fontWeight', 'bold').text(v.toFixed(2));
            }
        });

        $('td[name="总计港币"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
                //var v = parseFloat($('#txt_discount').val()) * parseFloat(obj.value);
                var v = parseFloat(parseFloat(obj.value));
                $(this).css('fontWeight', 'bold').text(v.toFixed(2));
            }
        });

        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            {
                var v = parseFloat($(this).text());
                grand_total += v;
            }
        });
        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));

    }

    function DefaultBanbao_XieYiShouFei_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        $('input[name="协议收费"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0])
                $(this).val(obj.value);
        });

        $('td[name="百分比"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                var itemId = $(this).attr("id").split('_')[2];
                var itemValue = $(this).attr("id").split('_')[3];

                var checkbox_id = "ckItem_" + itemId + "_" + itemValue;

                //前面的复选框是否选中
                if ($('input[type="checkbox"][name="ckItem"][id="' + checkbox_id + '"]').is(':checked') == true) {
                    if ($(this).attr("id").split('_')[2] == 17 || $(this).attr("id").split('_')[3] == "B10") //25%港外附加费
                    {
                        var v = parseFloat($(obj).val()) * 0.25;
                        $(this).text(v.toFixed(2));
                    }

                    if ($(this).attr("id").split('_')[2] == 18 || $(this).attr("id").split('_')[3] == "B11") //50% 18时至22时附加费
                    {
                        var v = parseFloat($(obj).val()) * 0.5;
                        $(this).text(v.toFixed(2));
                    }

                    if ($(this).attr("id").split('_')[2] == 19 || $(this).attr("id").split('_')[3] == "B12") //100% 22时至08时附加费
                    {
                        var v = parseFloat($(obj).val());
                        $(this).text(v.toFixed(2));
                    }

                    if ($(this).attr("id").split('_')[2] == 20 || $(this).attr("id").split('_')[3] == "B13") //100% 22时至08时附加费
                    {
                        var v = parseFloat($(obj).val());
                        $(this).text(v.toFixed(2));
                    }

                    if ($(this).attr("id").split('_')[2] == 21 || $(this).attr("id").split('_')[3] == "B14") //100% 22时至08时附加费
                    {
                        var v = parseFloat($(obj).val());
                        $(this).text(v.toFixed(2));
                    }
                }
            }
        });

        $('p[name="百分比"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                var serviceId = $(this).attr("id").split('_')[0];
                var schedulerId = $(this).attr("id").split('_')[1];
                var itemId = $(this).attr("id").split('_')[2];
                var itemValue = $(this).attr("id").split('_')[3];

                var checkbox_id = serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue;

                //前面的复选框是否选中
                if ($('input[type="checkbox"][name="ckItem3600"][id="' + checkbox_id + '"]').is(':checked') == true) {
                    if ($(this).attr("id").split('_')[2] == 22 || $(this).attr("id").split('_')[3] == "C15") //使用3600BHP以上的拖轮+15%
                    {
                        var v = parseFloat($(obj).val()) * 0.15;
                        $(this).text(v.toFixed(2));
                    }
                }
            }
        });

        $('td[name="合计港币"]').each(function () {
            var top_total = 0, mid_total = 0, bottom_total = 0;

            var self = this;

            top_total = parseFloat(obj.value);

            if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                var serviceId = $(obj).attr("id").split('_')[0];
                var schedulerId = $(obj).attr("id").split('_')[1];

                //获取界面上勾选中的复选框
                $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                    //alert($(this).is(":checked"));
                    var itemId = $(this).attr("id").split('_')[1];
                    var itemValue = $(this).attr("id").split('_')[2];

                    if (itemValue.charAt(0) == "B") {

                        var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[id="' + id + '"]').each(function () {

                            mid_total += parseFloat($(this).text());
                        });
                    }

                    //alert(itemValue);
                })

                //获取界面上勾选中的复选框3600BHP
                $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                    //alert($(this).is(":checked"));
                    var itemId = $(this).attr("id").split('_')[2];
                    var itemValue = $(this).attr("id").split('_')[3];

                    if (itemValue.charAt(0) == "B") {

                        var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('p[id="' + id + '"]').each(function () {

                            mid_total += parseFloat($(this).text());
                        });
                    }
                })

                var v = top_total + mid_total;

                $(this).css('fontWeight', 'bold').text(v.toFixed(2));
            }
        });

        $('td[name="折扣后合计港币"]').each(function () {
            var self = this;
            var discount_price = 0;

            if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
                var serviceId = $(obj).attr("id").split('_')[0];
                var schedulerId = $(obj).attr("id").split('_')[1];


                //var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) * parseFloat($('input[id="txt_discount"]').val());

                //获取界面上勾选中的折扣
                var discount_price_id;
                $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                    //alert($(this).is(":checked"));
                    var itemId = $(this).attr("id").split('_')[1];
                    var itemValue = $(this).attr("id").split('_')[2];

                    if (itemValue.substr(0, 3) == "C82") {
                        discount_price_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    }
                })

                discount_price = parseFloat($('td[name="折扣"][id="' + discount_price_id + '"]').text());

                var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) + discount_price;

                $(this).css('fontWeight', 'bold').text(v.toFixed(2));
            }

        });

        $('td[name="总计港币"]').each(function () {
            var topAndmid_total = 0, _3600bhp = 0, ranyo_and_tuolan = 0, bottom_total = 0;

            var self = this;

            if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                var serviceId = $(obj).attr("id").split('_')[0];
                var schedulerId = $(obj).attr("id").split('_')[1];

                topAndmid_total = parseFloat($('td[name="折扣后合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text());

                //获取界面上勾选中的复选框3600BHP
                $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                    //alert($(this).is(":checked"));
                    var itemId = $(this).attr("id").split('_')[2];
                    var itemValue = $(this).attr("id").split('_')[3];

                    if (itemValue.charAt(0) == "C") {

                        var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('p[id="' + id + '"]').each(function () {

                            _3600bhp = parseFloat($(this).text());
                        });
                    }
                })

                //获取界面上勾选中的复选框燃油费和拖缆费
                $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                    //alert($(this).is(":checked"));
                    var itemId = $(this).attr("id").split('_')[1];
                    var itemValue = $(this).attr("id").split('_')[2];

                    if (itemValue.charAt(0) == "C" && itemValue.substr(0, 3) != "C82") {

                        var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[id="' + id + '"]').each(function () {

                            ranyo_and_tuolan += parseFloat($(this).text());
                        });
                    }

                    //alert(itemValue);
                })

                bottom_total = _3600bhp + ranyo_and_tuolan;

                var v = topAndmid_total + bottom_total;
                
                $(this).css('fontWeight', 'bold').text(v.toFixed(2));
            }
        });

        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            var v = parseFloat($(this).text());
            grand_total += v;
        });

        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        
    }

    function DefaultBanbao_RanYou_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        var checkbox_id = "ckItem_" + itemId + "_" + itemValue;

        //如果燃油附加费复选框选中
        if ($('input[type="checkbox"][name="ckItem"][id="' + checkbox_id + '"]').is(':checked') == true) {

            $('td[name="燃油附加费"]').each(function () {

                var serviceId = $(this).attr("id").split('_')[0]
                var schedulerId = $(this).attr("id").split('_')[1];
                var id = serviceId + '_' + schedulerId;

                var time_consume = $('td[name="换算耗时"][id="' + id + '"]').text();

                var v = parseFloat($(obj).val()) * parseFloat(time_consume);

                $(this).text(v.toFixed(2));
            });

            var grand_total = 0;
            $('td[name="总计港币"]').each(function () {
                var topAndmid_total = 0, _3600bhp = 0, ranyo_and_tuolan = 0, bottom_total = 0;

                var self = this;

                {
                    var serviceId = $(self).attr("id").split('_')[0];
                    var schedulerId = $(self).attr("id").split('_')[1];

                    topAndmid_total = parseFloat($('td[name="折扣后合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text());
                    //alert(topAndmid_total);
 
                    //获取界面上勾选中的复选框3600BHP
                    $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var self2 = this;
                        
                        var itemId = $(self2).attr("id").split('_')[2];
                        var itemValue = $(self2).attr("id").split('_')[3];

                        if (itemValue.charAt(0) == "C") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            
                            _3600bhp = parseFloat($('p[id="' + id + '"]').text());

                        }
                    })

                    //获取界面上勾选中的复选框燃油费和拖缆费
                    $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[1];
                        var itemValue = $(this).attr("id").split('_')[2];

                        if (itemValue.charAt(0) == "C" && itemValue.substr(0,3) != "C82") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('td[id="' + id + '"]').each(function () {

                                ranyo_and_tuolan += parseFloat($(this).text());
                            });
                        }
                    })

                    bottom_total = _3600bhp + ranyo_and_tuolan;

                    var v = topAndmid_total + bottom_total;

                    grand_total += v;

                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }
            });

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
    }

    function DefaultBanbao_TuoLan_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        var checkbox_id = "ckItem_" + itemId + "_" + itemValue;

        //如果拖缆费复选框选中
        if ($('input[type="checkbox"][name="ckItem"][id="' + checkbox_id + '"]').is(':checked') == true) {

            $('td[name="拖缆费"]').each(function () {

                var serviceId = $(this).attr("id").split('_')[0]
                var schedulerId = $(this).attr("id").split('_')[1];
                var id = serviceId + '_' + schedulerId;

                var rope_num = $('td[name="拖缆数量"][id="' + id + '"]').text();

                var v = parseFloat($(obj).val()) * parseInt(rope_num);

                $(this).text(v.toFixed(2));
            });

            var grand_total = 0;
            $('td[name="总计港币"]').each(function () {
                var topAndmid_total = 0, _3600bhp = 0, ranyo_and_tuolan = 0, bottom_total = 0;

                var self = this;

                {
                    var serviceId = $(self).attr("id").split('_')[0];
                    var schedulerId = $(self).attr("id").split('_')[1];

                    topAndmid_total = parseFloat($('td[name="折扣后合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text());
                    //alert(topAndmid_total);

                    //获取界面上勾选中的复选框3600BHP
                    $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var self2 = this;

                        var itemId = $(self2).attr("id").split('_')[2];
                        var itemValue = $(self2).attr("id").split('_')[3];

                        if (itemValue.charAt(0) == "C") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;

                            _3600bhp = parseFloat($('p[id="' + id + '"]').text());

                        }
                    })

                    //获取界面上勾选中的复选框燃油费和拖缆费
                    $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[1];
                        var itemValue = $(this).attr("id").split('_')[2];

                        if (itemValue.charAt(0) == "C" && itemValue.substr(0,3) != "C82") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('td[id="' + id + '"]').each(function () {

                                ranyo_and_tuolan += parseFloat($(this).text());
                            });
                        }
                    })

                    bottom_total = _3600bhp + ranyo_and_tuolan;

                    var v = topAndmid_total + bottom_total;

                    grand_total += v;

                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }
            });

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
    }

    function DefaultBanbao_DiscountPrice_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        var checkbox_id = "ckItem_" + itemId + "_" + itemValue;

        //如果拖缆费复选框选中
        if ($('input[type="checkbox"][name="ckItem"][id="' + checkbox_id + '"]').is(':checked') == true) {

            $('td[name="折扣"]').each(function () {

                var serviceId = $(this).attr("id").split('_')[0]
                var schedulerId = $(this).attr("id").split('_')[1];
                var id = serviceId + '_' + schedulerId;

                var v = parseFloat($(obj).val()) * -1;

                $(this).text(v.toFixed(2));
            });

            $('td[name="折扣后合计港币"]').each(function () {
                var self = this;
                var discount_price = 0;

                 {
                    var serviceId = $(self).attr("id").split('_')[0];
                    var schedulerId = $(self).attr("id").split('_')[1];

                    //var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) * parseFloat($('input[id="txt_discount"]').val());

                    //获取界面上勾选中的折扣
                    $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[1];
                        var itemValue = $(this).attr("id").split('_')[2];

                        if (itemValue.substr(0, 3) == "C82") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('td[id="' + id + '"]').each(function () {

                                discount_price = parseFloat($(this).text());
                            });
                        }
                    })

                    var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) + discount_price;

                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }

            });

            var grand_total = 0;
            $('td[name="总计港币"]').each(function () {
                var topAndmid_total = 0, _3600bhp = 0, ranyo_and_tuolan = 0, bottom_total = 0;

                var self = this;

                {
                    var serviceId = $(self).attr("id").split('_')[0];
                    var schedulerId = $(self).attr("id").split('_')[1];

                    topAndmid_total = parseFloat($('td[name="折扣后合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text());
                    //alert(topAndmid_total);

                    //获取界面上勾选中的复选框3600BHP
                    $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var self2 = this;

                        var itemId = $(self2).attr("id").split('_')[2];
                        var itemValue = $(self2).attr("id").split('_')[3];

                        if (itemValue.charAt(0) == "C") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;

                            _3600bhp = parseFloat($('p[id="' + id + '"]').text());

                        }
                    })

                    //获取界面上勾选中的复选框燃油费和拖缆费
                    $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                        //alert($(this).is(":checked"));
                        var itemId = $(this).attr("id").split('_')[1];
                        var itemValue = $(this).attr("id").split('_')[2];

                        if (itemValue.charAt(0) == "C" && itemValue.substr(0,3) != "C82") {

                            var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                            $('td[id="' + id + '"]').each(function () {

                                ranyo_and_tuolan += parseFloat($(this).text());
                            });
                        }
                    })

                    bottom_total = _3600bhp + ranyo_and_tuolan;

                    var v = topAndmid_total + bottom_total;

                    grand_total += v;

                    $(this).css('fontWeight', 'bold').text(v.toFixed(2));
                }
            });

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
    }

    function DefaultTiaoKuan_UnitPrice_InputChanged(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g, ""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数

        $('input[name="每小时收费"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0])
                $(this).val(obj.value);
        });

        $('td[name="正常收费"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                var serviceId = $(this).attr("id").split('_')[0];
                var schedulerId = $(this).attr("id").split('_')[1];
                var itemId = $(this).attr("id").split('_')[2];

                var td = $('td[name="换算耗时"][id="' + serviceId + "_" + schedulerId + '"]');
             
                var v = parseFloat($(td).text()) * obj.value
                $(this).text(v.toFixed(2));
            }
        });

        $('td[name="百分比"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                var itemId = $(this).attr("id").split('_')[2];
                var itemValue = $(this).attr("id").split('_')[3];

                var checkbox_id = "ckItem_" + itemId + "_" + itemValue;

                //前面的复选框是否选中
                if ($('input[type="checkbox"][name="ckItem"][id="' + checkbox_id + '"]').is(':checked') == true) {
                    if ($(this).attr("id").split('_')[2] == 17 || $(this).attr("id").split('_')[3] == "B10") //25%港外附加费
                    {
                        var v = parseFloat($(obj).val()) * 0.25;
                        $(this).text(v.toFixed(2));
                    }

                    if ($(this).attr("id").split('_')[2] == 18 || $(this).attr("id").split('_')[3] == "B11") //50% 18时至22时附加费
                    {
                        var v = parseFloat($(obj).val()) * 0.5;
                        $(this).text(v.toFixed(2));
                    }

                    if ($(this).attr("id").split('_')[2] == 19 || $(this).attr("id").split('_')[3] == "B12") //100% 22时至08时附加费
                    {
                        var v = parseFloat($(obj).val());
                        $(this).text(v.toFixed(2));
                    }

                    if ($(this).attr("id").split('_')[2] == 20 || $(this).attr("id").split('_')[3] == "B13") //100% 22时至08时附加费
                    {
                        var v = parseFloat($(obj).val());
                        $(this).text(v.toFixed(2));
                    }

                    if ($(this).attr("id").split('_')[2] == 21 || $(this).attr("id").split('_')[3] == "B14") //100% 22时至08时附加费
                    {
                        var v = parseFloat($(obj).val());
                        $(this).text(v.toFixed(2));
                    }
                }
            }
        });

        $('p[name="百分比"]').each(function () {
            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                var serviceId = $(this).attr("id").split('_')[0];
                var schedulerId = $(this).attr("id").split('_')[1];
                var itemId = $(this).attr("id").split('_')[2];
                var itemValue = $(this).attr("id").split('_')[3];

                var checkbox_id = serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue;

                //前面的复选框是否选中
                if ($('input[type="checkbox"][name="ckItem3600"][id="' + checkbox_id + '"]').is(':checked') == true) {
                    if ($(this).attr("id").split('_')[2] == 22 || $(this).attr("id").split('_')[3] == "C15") //使用3600BHP以上的拖轮+15%
                    {
                        var v = parseFloat($(obj).val()) * 0.15;
                        $(this).text(v.toFixed(2));
                    }
                }
            }
        });

        $('td[name="合计港币"]').each(function () {
            var top_total = 0, mid_total = 0, bottom_total = 0, _3600bhp = 0;

            var serviceId = $(obj).attr("id").split('_')[0];
            var schedulerId = $(obj).attr("id").split('_')[1];

            top_total = parseFloat($('td[name="正常收费"][id="' + serviceId + "_" + schedulerId + "_" + serviceId + '"]').text());

            if ($(this).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                //获取界面上勾选中的复选框
                $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                    //alert($(this).is(":checked"));
                    var itemId = $(this).attr("id").split('_')[1];
                    var itemValue = $(this).attr("id").split('_')[2];

                    if (itemValue.charAt(0) == "B") {

                        var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[id="' + id + '"]').each(function () {

                            mid_total += parseFloat($(this).text());
                        });
                    }
                })

                //获取界面上勾选中的复选框3600BHP
                //$('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                //    //alert($(this).is(":checked"));
                //    var itemId = $(this).attr("id").split('_')[2];
                //    var itemValue = $(this).attr("id").split('_')[3];

                //    if (itemValue.charAt(0) == "B") {

                //        var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                //        $('p[id="' + id + '"]').each(function () {

                //            mid_total += parseFloat($(this).text());
                //        });
                //    }
                //})

                var v = top_total + mid_total;

                //alert(v);
                $(this).css('fontWeight', 'bold').text(v.toFixed(2)); //v.toFixed(2)
            }
        });

        $('td[name="折扣后合计港币"]').each(function () {
            var self = this;

            if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {
                var serviceId = $(obj).attr("id").split('_')[0];
                var schedulerId = $(obj).attr("id").split('_')[1];

                //var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) * parseFloat($('input[id="txt_discount"]').val());

                //获取界面上勾选中的折扣
                $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                    //alert($(this).is(":checked"));
                    var itemId = $(this).attr("id").split('_')[1];
                    var itemValue = $(this).attr("id").split('_')[2];

                    if (itemValue.substr(0, 3) == "C82") {

                        var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[id="' + id + '"]').each(function () {

                            discount_price = parseFloat($(this).text());
                        });
                    }
                });

                var v = parseFloat($('td[name="合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text()) + discount_price;

                $(this).css('fontWeight', 'bold').text(v.toFixed(2));
            }

        });

        $('td[name="总计港币"]').each(function () {
            var topAndmid_total = 0, _3600bhp = 0, ranyo_and_tuolan = 0, bottom_total = 0;

            var self = this;

            if ($(self).attr("id").split('_')[0] == $(obj).attr("id").split('_')[0]) {

                var serviceId = $(obj).attr("id").split('_')[0];
                var schedulerId = $(obj).attr("id").split('_')[1];

                topAndmid_total = parseFloat($('td[name="折扣后合计港币"][id="' + serviceId + '_' + schedulerId + '"]').text());

                //获取界面上勾选中的复选框3600BHP
                $('input[type="checkbox"][name="ckItem3600"]:checked').each(function () {
                    //alert($(this).is(":checked"));
                    var itemId = $(this).attr("id").split('_')[2];
                    var itemValue = $(this).attr("id").split('_')[3];

                    if (itemValue.charAt(0) == "C") {

                        var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('p[id="' + id + '"]').each(function () {

                            _3600bhp = parseFloat($(this).text());
                        });
                    }
                })

                //获取界面上勾选中的复选框燃油费和拖缆费
                $('input[type="checkbox"][name="ckItem"]:checked').each(function () {
                    //alert($(this).is(":checked"));
                    var itemId = $(this).attr("id").split('_')[1];
                    var itemValue = $(this).attr("id").split('_')[2];

                    if (itemValue.charAt(0) == "C" && itemValue.substr(0,3) != "C82") {

                        var id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                        $('td[id="' + id + '"]').each(function () {

                            ranyo_and_tuolan += parseFloat($(this).text());
                        });
                    }

                    //alert(itemValue);
                })
                bottom_total = _3600bhp + ranyo_and_tuolan;

                var v = topAndmid_total + bottom_total;

                $(this).css('fontWeight', 'bold').text(v.toFixed(2));
            }
        });

        var grand_total = 0;
        $('td[name="总计港币"]').each(function () {
            var v = parseFloat($(this).text());
            grand_total += v;
        });

        $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
    }
</script>

<!--提交表单时，检查表格中的数据是否有空或NAN-->
<script>
    function CheckQuanBaoTBodyData() {

        var ret = true;
        $('input[name="协议收费"]').each(function () {
            
            if ($(this).val().trim().length <= 0) {
                ret = false;
                return;
            }
        });

        return ret;
    }

    function CheckBanBaoTBodyData() {
        var ret = true;
        $('input[name="协议收费"]').each(function () {

            if ($(this).val().trim().length <= 0) {
                ret = false;
                return;
            }
        });

        //每个checkbox的元素的id = "ckItem_" + item的id + "_" + item的CustomValue
        if (true == $('input[type="checkbox"][name="ckItem"][id="ckItem_' + 23 + "_" + "C80" + '"]').is(':checked')) {
            
            if ($('input[name="txt燃油附加费"]').val().length <= 0) {
                ret = false;
            }
        }

        if (true == $('input[type="checkbox"][name="ckItem"][id="ckItem_' + 24 + "_" + "C81" + '"]').is(':checked')) {
            if ($('input[name="txt拖缆费"]').val().length <= 0) {
                ret = false;
            }
        }

        if (true == $('input[type="checkbox"][name="ckItem"][id="ckItem_' + 24 + "_" + "C82" + '"]').is(':checked')) {
            if ($('input[name="txt折扣"]').val().length <= 0) {
                ret = false;
            }
        }
        
        return ret;
    }

    function CheckTiaoKuanTBodyData() {
        var ret = true;
        $('input[name="每小时收费"]').each(function () {

            if ($(this).val().trim().length <= 0) {
                ret = false;
                return;
            }
        });

        //每个checkbox的元素的id = "ckItem_" + item的id + "_" + item的CustomValue
        if (true == $('input[type="checkbox"][name="ckItem"][id="ckItem_' + 23 + "_" + "C80" + '"]').is(':checked')) {
            if ($('input[name="txt燃油附加费"]').val().length <= 0) {
                ret = false;
            }
        }

        if (true == $('input[type="checkbox"][name="ckItem"][id="ckItem_' + 24 + "_" + "C81" + '"]').is(':checked')) {
            if ($('input[name="txt拖缆费"]').val().length <= 0) {
                ret = false;
            }
        }

        if (true == $('input[type="checkbox"][name="ckItem"][id="ckItem_' + 24 + "_" + "C82" + '"]').is(':checked')) {
            if ($('input[name="txt折扣"]').val().length <= 0) {
                ret = false;
            }
        }

        return ret;
    }
</script>

<!--提交表单时，获取表格中的数据-->
<script>
    function GetQuanBaoTBodyData() {
        var array = new Array();

        $('input[name="协议收费"]').each(function () {

            var serviceNatureId = $(this).attr("id").split('_')[0]; //服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var itemId = $(this).attr("id").split('_')[2]; //item id
            var unitPrice = $(this).val();
            var currency = "港币";
            //var typeID = ;

            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
            array.push(bi);
        });

        return array;

    }

    function GetBanBaoTBodyData() {
        var array = new Array();

        $('input[name="协议收费"]').each(function () {

            var serviceNatureId = $(this).attr("id").split('_')[0]; //服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var itemId = $(this).attr("id").split('_')[2]; //item id
            var unitPrice = $(this).val();
            var currency = "港币";
            //var typeID = ;

            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
            array.push(bi);
        });

        var inputs = $('input[name="协议收费"]');

        //1
        for (var i = 0; i < inputs.length; ++i) {
            var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
            var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

            var checkboxes = $('input[name="ckItem"]');
            for (var j = 0; j < checkboxes.length; ++j) {
                if (true == $(checkboxes[j]).is(':checked')) {
                    var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                    var itemValue = $(checkboxes[j]).attr("id").split('_')[2];
                    if (itemValue.charAt(0) == "B") {

                        var td = $('td[name="百分比"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                        var unitPrice = parseFloat($(td).text());
                        var currency = "港币";

                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
                }
            }
        }

        //2
        $('input[name="ckItem3600"]').each(function () {
            var serviceNatureId = $(this).attr("id").split('_')[0];
            var schedulerId = $(this).attr("id").split('_')[1];
            var itemId = $(this).attr("id").split('_')[2];
            var itemValue = $(this).attr("id").split('_')[3];

            var p = $('p[name="百分比"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
            var unitPrice = parseFloat($(p).text());
            var currency = "港币";

            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
            array.push(bi);
        });

        //3 燃油和拖缆费
        for (var i = 0; i < inputs.length; ++i) {
            var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
            var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

            var checkboxes = $('input[name="ckItem"]');
            for (var j = 0; j < checkboxes.length; ++j) {
                if (true == $(checkboxes[j]).is(':checked')) {
                    var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                    var itemValue = $(checkboxes[j]).attr("id").split('_')[2];
                    
                    if (itemValue.substr(0, 3) == "C80") {
                        
                        var input = $('input[name="txt燃油附加费"][id="txtItem_' + itemId + "_" + itemValue + '"]');
                        //var td = $('td[id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                        var unitPrice = parseFloat($(input).val());
                        var currency = "港币";
                        //alert(unitPrice);

                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }

                    if (itemValue.substr(0, 3) == "C81") {
                        var input = $('input[name="txt拖缆费"][id="txtItem_' + itemId + "_" + itemValue + '"]');
                        //var td = $('td[id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                        var unitPrice = parseFloat($(input).val());
                        var currency = "港币";
                        //alert(unitPrice);

                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
                }
            }
        }

        //4 折扣
        for (var i = 0; i < inputs.length; ++i) {
            var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
            var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

            var checkboxes = $('input[name="ckItem"]');
            for (var j = 0; j < checkboxes.length; ++j) {
                if (true == $(checkboxes[j]).is(':checked')) {
                    var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                    var itemValue = $(checkboxes[j]).attr("id").split('_')[2];

                    if (itemValue.substr(0, 3) == "C82") {
                        var td = $('td[name="折扣"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                        var unitPrice = parseFloat($(td).text());
                        var currency = "港币";
                        //alert(unitPrice);

                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
                }
            }
        }

        return array;
    }

    function GetTiaoKuanTBodyData() {
        var array = new Array();

        $('input[name="每小时收费"]').each(function () {

            var serviceNatureId = $(this).attr("id").split('_')[0]; //服务id
            var schedulerId = $(this).attr("id").split('_')[1]; //调度id
            var itemId = $(this).attr("id").split('_')[2]; //item id
            var unitPrice = $(this).val();
            var currency = "港币";
            //var typeID = ;

            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
            array.push(bi);
        });

        var inputs = $('input[name="每小时收费"]');

        //1
        for (var i = 0; i < inputs.length; ++i) {
            var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
            var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

            var checkboxes = $('input[name="ckItem"]');
            for (var j = 0; j < checkboxes.length; ++j) {
                if (true == $(checkboxes[j]).is(':checked')) {
                    var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                    var itemValue = $(checkboxes[j]).attr("id").split('_')[2];
                    if (itemValue.charAt(0) == "B") {

                        var td = $('td[name="百分比"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                        var unitPrice = parseFloat($(td).text());
                        var currency = "港币";

                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
                }
            }
        }

        //2
        $('input[name="ckItem3600"]').each(function () {
            var serviceNatureId = $(this).attr("id").split('_')[0];
            var schedulerId = $(this).attr("id").split('_')[1];
            var itemId = $(this).attr("id").split('_')[2];
            var itemValue = $(this).attr("id").split('_')[3];

            var p = $('p[name="百分比"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
            var unitPrice = parseFloat($(p).text());
            var currency = "港币";

            var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
            array.push(bi);
        });

        //3 燃油和拖缆费
        for (var i = 0; i < inputs.length; ++i) {
            var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
            var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

            var checkboxes = $('input[name="ckItem"]');
            for (var j = 0; j < checkboxes.length; ++j) {
                if (true == $(checkboxes[j]).is(':checked')) {
                    var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                    var itemValue = $(checkboxes[j]).attr("id").split('_')[2];

                    if (itemValue.substr(0, 3) == "C80") {

                        var input = $('input[name="txt燃油附加费"][id="txtItem_' + itemId + "_" + itemValue + '"]');
                        //var td = $('td[id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                        var unitPrice = parseFloat($(input).val());
                        var currency = "港币";
                        //alert(unitPrice);

                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }

                    if (itemValue.substr(0, 3) == "C81") {
                        var input = $('input[name="txt拖缆费"][id="txtItem_' + itemId + "_" + itemValue + '"]');
                        //var td = $('td[id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                        var unitPrice = parseFloat($(input).val());
                        var currency = "港币";
                        //alert(unitPrice);

                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
                }
            }
        }

        //4折扣
        for (var i = 0; i < inputs.length; ++i) {
            var serviceNatureId = $(inputs[i]).attr("id").split('_')[0]; //服务id
            var schedulerId = $(inputs[i]).attr("id").split('_')[1]; //调度id

            var checkboxes = $('input[name="ckItem"]');
            for (var j = 0; j < checkboxes.length; ++j) {
                if (true == $(checkboxes[j]).is(':checked')) {
                    var itemId = $(checkboxes[j]).attr("id").split('_')[1];
                    var itemValue = $(checkboxes[j]).attr("id").split('_')[2];

                    if (itemValue.substr(0, 3) == "C82") {

                        var td = $('td[name="折扣"][id="' + serviceNatureId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                        var unitPrice = parseFloat($(td).text());
                        var currency = "港币";
                        //alert(unitPrice);

                        var bi = new BillingItem(schedulerId, itemId, unitPrice, currency);
                        array.push(bi);
                    }
                }
            }
        }

        return array;
    }
</script>

<!--复选框勾选改变-->
<script>
    function BanbaoTopCheckboxChanged(obj) {

        //alert($(obj).is(':checked'));

        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //25%港外附加费
        if (itemId == 17 || itemValue == "B10") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val()) * 0.25;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + parseFloat(v);
  
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val()) * 0.25;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = parseFloat($('td[name="百分比"][id="' + td_id + '"]').text());

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - parseFloat(old_v);
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }  
                
            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //50% 18时至22时附加费
        if (itemId == 18 || itemValue == "B11") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val()) * 0.5;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val()) * 0.5;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100% 22时至08时附加费
        if (itemId == 19 || itemValue == "B12") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100%假日附加费
        if (itemId == 20 || itemValue == "B13") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100%台风附加费
        if (itemId == 21 || itemValue == "B14") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

    }

    function BanbaoMidCheckboxChanged(obj) {
        var serviceId = $(obj).attr("id").split('_')[0];
        var schedulerId = $(obj).attr("id").split('_')[1];;
        var itemId = $(obj).attr("id").split('_')[2];
        var itemValue = $(obj).attr("id").split('_')[3];

        //使用3600BHP以上的拖轮+15%
        {
            var grand_total = 0;

            {
         
                if ($(obj).is(':checked') == true) {

                    var input = $('input[name="协议收费"][id="' + serviceId + "_" + schedulerId + "_" + serviceId + '"]');
                    var v = $(input).val() * 0.15;

                    var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                    $(p).text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));
                   
                }
                else {
                    var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');

                    var old_v = parseFloat($(p).text());

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    var v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    $(p).text(0);
                }

            }

            $('td[name="总计港币"]').each(function () {
                grand_total += parseFloat($(this).text());
            })

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

    }

    function BanbaoBottomCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //燃油附加费
        if (itemId == 23 || itemValue == "C80") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt燃油附加费"]').val();
                    var time_consum = $('td[name="换算耗时"][id="' + serviceId + '_' + schedulerId + '"]').text();
                    var v = parseFloat(unit_price) * parseFloat(time_consum);

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="燃油附加费"][id="' + td_id + '"]').text(v.toFixed(2));
               
                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="燃油附加费"][id="' + td_id + '"]').text();
                    
                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="燃油附加费"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

        //拖缆费
        if (itemId == 24 || itemValue == "C81") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt拖缆费"]').val();
                    var rope_num = $('td[name="拖缆数量"][id="' + serviceId + '_' + schedulerId + '"]').text();
                    var v = parseFloat(unit_price) * parseFloat(rope_num);

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="拖缆费"][id="' + td_id + '"]').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="拖缆费"][id="' + td_id + '"]').text();

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="拖缆费"][id="' + td_id + '"]').text(0);
                }

            }
        }

        //折扣
        if (itemId == 43 || itemValue == "C82") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt折扣"]').val();

                    var v = parseFloat(unit_price) * -1;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="折扣"][id="' + td_id + '"]').text(v.toFixed(2));

                    var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(discount_sub_total_total).text()) + v;
                    $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    v = parseFloat(unit_price) * -1;
                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="折扣"][id="' + td_id + '"]').text();

                    var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(discount_sub_total_total).text()) - old_v;
                    $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="折扣"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
            
    }

    function TiaoKuanTopCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //25%港外附加费
        if (itemId == 17 || itemValue == "B10") {

            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).text()) * 0.25;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text()) * 0.25;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //50% 18时至22时附加费
        if (itemId == 18 || itemValue == "B11") {
            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).text()) * 0.5;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text()) * 0.5;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100% 22时至08时附加费
        if (itemId == 19 || itemValue == "B12") {
            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).text());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100%假日附加费
        if (itemId == 20 || itemValue == "B13") {
            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).text());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100%台风附加费
        if (itemId == 21 || itemValue == "B14") {
            var grand_total = 0;
            var inputs = $('td[name="正常收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).text());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).text());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
    }

    function TiaoKuanMidCheckboxChanged(obj) {
        var serviceId = $(obj).attr("id").split('_')[0];
        var schedulerId = $(obj).attr("id").split('_')[1];;
        var itemId = $(obj).attr("id").split('_')[2];
        var itemValue = $(obj).attr("id").split('_')[3];

        //使用3600BHP以上的拖轮+15%
        {
            var grand_total = 0;

            {

                if ($(obj).is(':checked') == true) {

                    var td = $('td[name="正常收费"][id="' + serviceId + "_" + schedulerId + "_" + serviceId + '"]');
                    var v = parseFloat($(td).text()) * 0.15;

                    var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');
                    $(p).text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                }
                else {
                    var p = $('p[name="百分比"][id="' + serviceId + "_" + schedulerId + "_" + itemId + "_" + itemValue + '"]');

                    var old_v = parseFloat($(p).text());

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    var v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    $(p).text(0);
                }

            }

            $('td[name="总计港币"]').each(function () {
                grand_total += parseFloat($(this).text());
            })

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
    }

    function TiaoKuanBottomCheckboxChanged(obj) {
        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //燃油附加费
        if (itemId == 23 || itemValue == "C80") {

            var grand_total = 0;
            var inputs = $('input[name="每小时收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt燃油附加费"]').val();
                    var time_consum = $('td[name="换算耗时"][id="' + serviceId + '_' + schedulerId + '"]').text();
                    var v = parseFloat(unit_price) * parseFloat(time_consum);

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="燃油附加费"][id="' + td_id + '"]').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="燃油附加费"][id="' + td_id + '"]').text();

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="燃油附加费"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

        //拖缆费
        if (itemId == 24 || itemValue == "C81") {

            var grand_total = 0;
            var inputs = $('input[name="每小时收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt拖缆费"]').val();
                    var rope_num = $('td[name="拖缆数量"][id="' + serviceId + '_' + schedulerId + '"]').text();
                    var v = parseFloat(unit_price) * parseFloat(rope_num);

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="拖缆费"][id="' + td_id + '"]').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="拖缆费"][id="' + td_id + '"]').text();

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="拖缆费"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

        //折扣
        if (itemId == 43 || itemValue == "C82") {

            var grand_total = 0;
            var inputs = $('input[name="每小时收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {

                    var unit_price = $('input[name="txt折扣"]').val();

                    var v = parseFloat(unit_price) * -1;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="折扣"][id="' + td_id + '"]').text(v.toFixed(2));

                    var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(discount_sub_total_total).text()) + v;
                    $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    v = parseFloat(unit_price) * -1;
                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="折扣"][id="' + td_id + '"]').text();

                    var discount_sub_total_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(discount_sub_total_total).text()) - old_v;
                    $(discount_sub_total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="折扣"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
    
    }





    function edit_BanbaoTopCheckboxChanged(obj) {

        //alert($(obj).is(':checked'));

        var itemId = $(obj).attr("id").split('_')[1];
        var itemValue = $(obj).attr("id").split('_')[2];

        //25%港外附加费
        if (itemId == 17 || itemValue == "B10") {

            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val()) * 0.25;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    
                    v = parseFloat($(sub_total).text()) + parseFloat(v);
                    
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val()) * 0.25;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = parseFloat($('td[name="百分比"][id="' + td_id + '"]').text());

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - parseFloat(old_v);
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //50% 18时至22时附加费
        if (itemId == 18 || itemValue == "B11") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val()) * 0.5;

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val()) * 0.5;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100% 22时至08时附加费
        if (itemId == 19 || itemValue == "B12") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100%假日附加费
        if (itemId == 20 || itemValue == "B13") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }
        //100%台风附加费
        if (itemId == 21 || itemValue == "B14") {
            var grand_total = 0;
            var inputs = $('input[name="协议收费"]');

            for (var i = 0; i < inputs.length; ++i) {
                var serviceId = $(inputs[i]).attr("id").split("_")[0];
                var schedulerId = $(inputs[i]).attr("id").split("_")[1];

                if ($(obj).is(':checked') == true) {
                    var v = parseFloat($(inputs[i]).val());

                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    $('td[name="百分比"][id="' + td_id + '"]').text(v.toFixed(2));

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    v = parseFloat($(sub_total).text()) + v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) + parseFloat($(inputs[i]).val());
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());
                }
                else {
                    var td_id = serviceId + '_' + schedulerId + '_' + itemId + '_' + itemValue;
                    var old_v = $('td[name="百分比"][id="' + td_id + '"]').text();

                    var sub_total = $('td[name="合计港币"][id="' + serviceId + "_" + schedulerId + '"]');

                    var v = parseFloat($(sub_total).text()) - old_v;
                    $(sub_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    var discout_sub_total = $('td[name="折扣后合计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    //$(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) * ($('input[id="txt_discount"]').val())).toFixed(2));
                    $(discout_sub_total).css('fontWeight', 'bold').text((parseFloat($(sub_total).text()) + parseFloat($('input[name="txt折扣"]').val()) * -1).toFixed(2));

                    var total_total = $('td[name="总计港币"][id="' + serviceId + "_" + schedulerId + '"]');
                    v = parseFloat($(total_total).text()) - old_v;
                    $(total_total).css('fontWeight', 'bold').text(v.toFixed(2));

                    grand_total += parseFloat($(total_total).text());

                    $('td[name="百分比"][id="' + td_id + '"]').text(0);
                }

            }

            $('td[id="GrandTotalHKS"]').css('fontWeight', 'bold').text(grand_total.toFixed(2));
        }

    }
</script>



<!--报表预览-->
<script>
    function ReportPreViewInvoice(orderId, timeTypeId, billingTypeId, billingTypeValue, billingTypeLabel) {
        if(billingTypeId == 6 || billingTypeValue == "0" || billingTypeLabel == "全包"
            || billingTypeId == 7 || billingTypeValue == "1" || billingTypeLabel == "全包加特别条款") {
            //alert("全包或半包报表预览");
            //location.href = '/Report/Invoice_qborbb' + '?OrderID=' + orderId + '&TimeTypeValue=' + timeTypeId
            open('/Report/Invoice_qborbb' + '?OrderID=' + orderId + '&TimeTypeValue=' + timeTypeId)
        }
        
        else if (billingTypeId == 8 || billingTypeValue == "2" || billingTypeLabel == "条款") {
            //alert("条款报表预览");
            open('/Report/Invoice_tk' + '?OrderID=' + orderId + '&TimeTypeValue=' + timeTypeId)
        }

    }
</script>